<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>KB 3191877 の適用後に VBA のコンパイルエラーが発生する | Japan Office Client Support Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="(※ 2017 年 5 月 17 日に Japan Office Developer Support Blog に公開した情報のアーカイブです。)   2017&#x2F;12&#x2F;12 Update本現象を修正する Excel 2013 向け更新プログラムを公開しました。Excel 2016 向けの修正も追って公開予定です。 2018&#x2F;1&#x2F;26 UpdateExcel 2016 向けの修正を公開しました。合わ">
<meta property="og:type" content="article">
<meta property="og:title" content="KB 3191877 の適用後に VBA のコンパイルエラーが発生する">
<meta property="og:url" content="https://officesupportjp.github.io/blog/cl0mc9o17000zb0vs3hta6j0c/index.html">
<meta property="og:site_name" content="Japan Office Client Support Blog">
<meta property="og:description" content="(※ 2017 年 5 月 17 日に Japan Office Developer Support Blog に公開した情報のアーカイブです。)   2017&#x2F;12&#x2F;12 Update本現象を修正する Excel 2013 向け更新プログラムを公開しました。Excel 2016 向けの修正も追って公開予定です。 2018&#x2F;1&#x2F;26 UpdateExcel 2016 向けの修正を公開しました。合わ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://officesupportjp.github.io/blog/cl0mc9o17000zb0vs3hta6j0c/image1.png">
<meta property="article:published_time" content="2019-02-28T15:00:00.000Z">
<meta property="article:modified_time" content="2022-03-18T06:39:40.356Z">
<meta property="article:author" content="Office Support Japan">
<meta property="article:tag" content="Microsoft">
<meta property="article:tag" content="Office">
<meta property="article:tag" content="Support">
<meta property="article:tag" content="Excel">
<meta property="article:tag" content="Word">
<meta property="article:tag" content="PowerPoint">
<meta property="article:tag" content="OneNote">
<meta property="article:tag" content="Access">
<meta property="article:tag" content="マイクロソフト">
<meta property="article:tag" content="オフィス">
<meta property="article:tag" content="サポート">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://officesupportjp.github.io/blog/cl0mc9o17000zb0vs3hta6j0c/image1.png">
  
    <link rel="alternate" href="/blog/atom.xml" title="Japan Office Client Support Blog" type="application/atom+xml">
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/blog/icons/favicon-16x16.png">
    <link rel="manifest" href="/blog/icons/site.webmanifest">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/blog/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="/blog/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="site-header-logo"></div>
  <div id="site-header-blog-wrapper"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Japan Office Client Support Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">日本マイクロソフト Office Client サポート チームのブログです</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://officesupportjp.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-KB 3191877 の適用後に VBA のコンパイルエラーが発生する" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/cl0mc9o17000zb0vs3hta6j0c/" class="article-date">
  <time datetime="2019-02-28T15:00:00.000Z" itemprop="datePublished">2019-03-01</time>
</a>
    <!--  -->
  </div>
  <div class="article-inner">
    
    
      <header class="article-header-single">
        
  
    <h1 class="article-title" itemprop="name">
      KB 3191877 の適用後に VBA のコンパイルエラーが発生する
    </h1>
  

      </header>
      <div class="article-share">
        Last Update: 
        <a href="/blog/cl0mc9o17000zb0vs3hta6j0c/" class="article-date-single">    
    
    <time datetime="2019-02-28T15:00:00.000Z" itemprop="dateUpdated">2019-03-01</time>
    
</a>              
      </div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>(※ 2017 年 5 月 17 日に Japan Office Developer Support Blog に公開した情報のアーカイブです。)  </p>
<p><span style="color:#ff0000"><strong>2017/12/12 Update</strong></span><br><span style="color:#339966">本現象を修正する Excel 2013 向け更新プログラムを公開しました。Excel 2016 向けの修正も追って公開予定です。</span></p>
<p><span style="color:#ff0000"><strong>2018/1/26 Update</strong></span><br><span style="color:#339966">Excel 2016 向けの修正を公開しました。合わせて、記事全体の構成を見直しました。</span></p>
<p>こんにちは、Office 開発 サポート チームの多田です。</p>
<p>今回は 2017 年 5 月 2 日にリリースされた Excel の更新プログラム KB3191877 を適用した Excel 2013 (MSI インストーラ形式) 、および同等の更新を含む Excel 2016 バージョン 1705  (クイック実行形式) 以降において、特定の条件下で Excel を起動する際に VBA のコンパイルエラーを示すダイアログが表示される動作について紹介します。</p>
<p><img src="image1.png" alt=""></p>
<p>図 1. VBA のコンパイルエラーが発生</p>
<h4 id="現象"><a href="#現象" class="headerlink" title="現象"></a><strong>現象</strong></h4><p>以下の手順にて Excel ブックおよび VBA を作成して Excel 97-2003 形式 (.xls) で保存した際に、ブックを開くときに自動的に行われる VBA のコンパイルでエラーが発生します。</p>
<p>現象再現手順 (Excel 2013 の場合)</p>
<p>^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<p>1. Excel 2013 SP1 に以下の KB 3191877 を適用します。</p>
<p>タイトル : May 2, 2017, update for Excel 2013 (KB3191877)<br>アドレス : <a href="https://support.microsoft.com/ja-jp/help/3191877" target="_blank" rel="noopener">https://support.microsoft.com/ja-jp/help/3191877</a></p>
<p>2. Excel で新規ブックを作成します。<br>3. [挿入] - [図] - [図形] で任意の図形を挿入します。<br>4. 上記手順 3 で挿入した図形を右クリックし、[マクロの登録] をクリックします。<br>5. [新規作成] をクリックします。<br>6. 表示された VBA にて、以下のようなコードを追加します。(ここでは例として手順 3. で “正方形長方形” を追加したとします)</p>
<p>&lt;追加前&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sub 正方形長方形 1_Click()</span><br><span class="line"></span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>



<p>&lt;追加後&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Sub 正方形長方形 1_Click()</span><br><span class="line"></span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Sub hoge(Optional ByVal sr As String &#x3D; vbNullString)</span><br><span class="line"></span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>


<p>7. VBA を保存します。<br>8. Excel のファイルを Excel 97 - 2003 ブック (*.xls) として保存して、ファイルを閉じます。<br>9. 保存したファイルを開きます。セキュリティの警告のバーが表示されますので、[コンテンツの有効化] をクリックし、ファイルを閉じます。<br>10. 保存したファイルを再度開きます。コンパイルエラーのダイアログが表示されることを確認します。</p>
<p>※ また、上記手順 6. にて以下のようなコードを記述した場合でも現象が発生します。基本的には、図形のクリックイベントと同じモジュール内において、内部的に定義されているオブジェクトを参照した場合に発生いたしますが、発生パターンは様々です。</p>
<p>&lt;他の現象発生パターン&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Dim hoge As Workbook</span><br><span class="line"></span><br><span class="line">Sub 正方形長方形1_Click()</span><br><span class="line"></span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>




<h4 id="対象製品"><a href="#対象製品" class="headerlink" title="対象製品"></a><strong>対象製品</strong></h4><p>Excel 2013 MSI インストーラ版 : 15.0.4927.1000 以降</p>
<p>Excel 2016 クイック実行版 : バージョン 1705 (ビルド 8117.1000) 以降</p>
<p>※ Excel 2016 MSI インストーラ版では本現象が発生する契機となる修正が含まれないため、現象は発生しません。</p>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a><strong>原因</strong></h4><p>KB 3191877 では、特定の条件下においてマクロを含むファイルを開く際に Excel がハングアップする問題に対して、明示的にコンパイルエラーを検出しハングアップを回避する修正を実施しています。今回の現象は、この修正の影響で VBA コード上は問題ないため本来検出不要なコンパイルエラーが検出され、結果としてエラーダイアログが表示される動作が生じています。</p>
<p><span style="color:#ff0000"><strong>2018/1/26 Update</strong></span></p>
<h4 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a><strong>解決方法</strong></h4><p>以下の更新で修正されましたので、本現象を解決するには、修正プログラムを適用してください。</p>
<p><strong>Excel 2013</strong></p>
<p>文書番号 : KB4011597<br>タイトル : 2017 年 12 月 5日は、Excel 2013 (KB4011597) の更新します。<br>アドレス : <a href="https://support.microsoft.com/ja-jp/help/4011597" target="_blank" rel="noopener">https://support.microsoft.com/ja-jp/help/4011597</a></p>
<p><strong>Excel 2016</strong></p>
<p>バージョン 1712 (ビルド 8827.2148)</p>
<p>修正バージョンの各チャネルへの公開状況は、以下の公開情報をご確認ください。</p>
<p>タイトル : 更新プログラム チャネル リリースのバージョン番号とビルド番号<br>アドレス : <a href="https://support.office.com/ja-jp/article/ae942449-1fca-4484-898b-a933ea23def7" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/ae942449-1fca-4484-898b-a933ea23def7</a></p>
<h4 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a><strong>回避策</strong></h4><p>更新の適用が難しい場合は、問題が発生するファイルを Excel 2007 形式のファイル「Excel マクロ有効ブック (*.xlsm)」 形式で保存し直すと、この現象を回避することができます。</p>
<p>今回の投稿は以上です。</p>
<p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://officesupportjp.github.io/blog/cl0mc9o17000zb0vs3hta6j0c/" data-id="ckzqb7f2u000u2c3pg125cy1h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/cl0mc9o15000vb0vscpvphs5e/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Excel の SpecialCells メソッドで特定の状況において期待しない該当セルが取得される
        
      </div>
    </a>
  
  
    <a href="/blog/cl0mc9o1b0014b0vsbsrk3ew0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Microsoft ストア アプリ版 Office 2016 (Centennial) での開発 – その1 – (DLL の読み込み)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/MC322553/" rel="tag">MC322553</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%83%9E%E3%82%AF%E3%83%AD/" rel="tag">マクロ</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/cl0m4f5o1003504vsa5tp25c2/">インターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について (MC322553)</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4rqa2001y50vshhi75we2/">Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4xkl00039eovs4fp4ffbt/">お知らせ - Japan Office Client Support Blog について</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4xkk8002oeovs8ggucayv/">Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4xkk1002beovs87lwadzx/">Office 製品のサインインで先進認証が有効化、無効化されているかを確認する方法について</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Office Support Japan<br>      
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<script src="/blog/js/script.js"></script>




  </div>
</body>
</html>