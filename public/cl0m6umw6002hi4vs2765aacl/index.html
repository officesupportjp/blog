<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>OneDrive などのクラウド上の日本語パスに格納されたファイルからのリンク貼り付けでエラーが発生する | Japan Office Client Support Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="こんにちは、Office サポート チームの中村です。 Office には、Excel から PowerPoint のように異なるアプリケーション間でコピー&amp;貼り付けを行うときに選択できる貼り付け形式として [リンク貼り付け] があります。 リンク貼り付けを行うと、Excel ファイルの値の変更に連動して PowerPoint 上に貼り付けたセルの値も更新されます。また、貼り付けた部分をダ">
<meta property="og:type" content="article">
<meta property="og:title" content="OneDrive などのクラウド上の日本語パスに格納されたファイルからのリンク貼り付けでエラーが発生する">
<meta property="og:url" content="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/index.html">
<meta property="og:site_name" content="Japan Office Client Support Blog">
<meta property="og:description" content="こんにちは、Office サポート チームの中村です。 Office には、Excel から PowerPoint のように異なるアプリケーション間でコピー&amp;貼り付けを行うときに選択できる貼り付け形式として [リンク貼り付け] があります。 リンク貼り付けを行うと、Excel ファイルの値の変更に連動して PowerPoint 上に貼り付けたセルの値も更新されます。また、貼り付けた部分をダ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/image1.png">
<meta property="og:image" content="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/image2.png">
<meta property="og:image" content="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/image3.png">
<meta property="og:image" content="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/image4.png">
<meta property="og:image" content="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/image5.png">
<meta property="article:published_time" content="2020-06-22T15:00:00.000Z">
<meta property="article:modified_time" content="2022-03-11T09:05:07.961Z">
<meta property="article:author" content="Office Support Japan">
<meta property="article:tag" content="Microsoft">
<meta property="article:tag" content="Office">
<meta property="article:tag" content="Support">
<meta property="article:tag" content="Excel">
<meta property="article:tag" content="Word">
<meta property="article:tag" content="PowerPoint">
<meta property="article:tag" content="OneNote">
<meta property="article:tag" content="Access">
<meta property="article:tag" content="マイクロソフト">
<meta property="article:tag" content="オフィス">
<meta property="article:tag" content="サポート">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/image1.png">
  
    <link rel="alternate" href="/blog/atom.xml" title="Japan Office Client Support Blog" type="application/atom+xml">
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/blog/icons/favicon-16x16.png">
    <link rel="manifest" href="/blog/icons/site.webmanifest">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/blog/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="/blog/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="site-header-logo"></div>
  <div id="site-header-blog-wrapper"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Japan Office Client Support Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">日本マイクロソフト Office Client サポート チームのブログです</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://officesupportjp.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-OneDrive などのクラウド上の日本語パスに格納されたファイルからのリンク貼り付けでエラーが発生する" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/cl0m6umw6002hi4vs2765aacl/" class="article-date">
  <time datetime="2020-06-22T15:00:00.000Z" itemprop="datePublished">2020-06-23</time>
</a>
    <!--  -->
  </div>
  <div class="article-inner">
    
    
      <header class="article-header-single">
        
  
    <h1 class="article-title" itemprop="name">
      OneDrive などのクラウド上の日本語パスに格納されたファイルからのリンク貼り付けでエラーが発生する
    </h1>
  

      </header>
      <div class="article-share">
        Last Update: 
        <a href="/blog/cl0m6umw6002hi4vs2765aacl/" class="article-date-single">    
    
    <time datetime="2020-06-22T15:00:00.000Z" itemprop="dateUpdated">2020-06-23</time>
    
</a>              
      </div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Office サポート チームの中村です。</p>
<p>Office には、Excel から PowerPoint のように異なるアプリケーション間でコピー&amp;貼り付けを行うときに選択できる貼り付け形式として [リンク貼り付け] があります。</p>
<p>リンク貼り付けを行うと、Excel ファイルの値の変更に連動して PowerPoint 上に貼り付けたセルの値も更新されます。また、貼り付けた部分をダブルクリックで起動すると、貼り付け元の Excel ファイルが開かれます。</p>
<p>参考) 形式を選択して貼り付け<br><a href="https://support.microsoft.com/ja-jp/office/e03db6c7-8295-4529-957d-16ac8a778719" target="_blank" rel="noopener">https://support.microsoft.com/ja-jp/office/e03db6c7-8295-4529-957d-16ac8a778719</a></p>
<p>この機能は、機能追加当初から想定されていたシナリオである ローカルやファイル サーバー上に格納された Office ファイルからのコピーにおいては特に問題なく利用できます。しかし、OneDrive for Business や SharePoint Online 上に格納した Office ファイルからリンク貼り付けを行うときには、日本語 (DBCS) をファイル パス (格納フォルダやファイル名) に含むとエラーが生じます。</p>
<p>本記事では、このクラウド上の日本語をパスに含むファイルのリンク貼り付けでのエラーの詳細について記載します。  </p>
<p><strong>1.</strong> <strong>現象詳細</strong></p>
<p>現象が発生する操作手順とエラーの内容は以下の通りです。</p>
<p><strong>再現手順</strong></p>
<p>1. OneDrive for Business や SharePoint Online のドキュメント ライブラリなどに、日本語のファイル名で、または日本語を名前に含むフォルダ内に Excel ブックを格納します。<br>(例 : Excel ブックに「テスト.xlsx」という名前を付ける / 「ドキュメント」というフォルダを作成してその中に Excel ブックを格納)</p>
<p>2. Excel ファイルを開き、任意のセル範囲をコピーします。</p>
<p>3. 新規 PowerPoint プレゼンテーションを作成し、[リンク貼り付け] を行います。([ホーム] タブ – [貼り付け] の下三角をクリックし、[形式を選択して貼り付け])</p>
<p><img src="image1.png" alt=""><br>図 1: リンク貼り付け画面  </p>
<p>以下のようにコピーしたセル範囲が貼り付けられます。</p>
<p><img src="image2.png" alt=""><br>図 2 : リンク貼り付けされたプレゼンテーション  </p>
<p>4. PowerPoint プレゼンテーションを .pptx 形式で保存します。(こちらはローカル フォルダなどでも構いません。また、日本語をファイル パスに含む必要はありません。)</p>
<p>5. Excel ブック、PowerPoint プレゼンテーションをいったん閉じます。</p>
<p>6. 4. で保存した PowerPoint プレゼンテーションを再度開きます。</p>
<p>7. 開くときに表示される以下のメッセージで [リンクの更新] をクリックすると、エラーが発生します。</p>
<p><img src="image3.png" alt=""><br>図 3 : リンクの更新メッセージ  </p>
<p><img src="image4.png" alt=""><br>図 4 : エラー画面の例</p>
<p>8. また、貼り付けられたセル範囲をダブル クリックして Excel ブックを開こうとすると、エラーが発生します。</p>
<p><img src="image5.png" alt=""><br>図 5 : ダブル クリック時のエラー画面の例  </p>
<p><strong>2.</strong> <strong>原因</strong></p>
<p>リンクの更新やダブル クリックで Excel ブックを開くため、Office アプリケーションから OneDrive for Business や SharePoint Online へ Excel ブックの格納 URL が HTTP リクエストで送信されます。この URL は、クライアントの OS ロケールを基に判断された ANSI 文字コードを使用して % エンコードが行われます (日本語環境の場合、Shift－JIS)。</p>
<p>例 : ファイル名「テスト.xlsx」を OneDrive for Business に格納したときの Shift-JIS エンコードの URL</p>
<span>
https://microsoft-my.sharepoint.com/personal/username_microsoft_com/Documents/%83%65%83%58%83%67.xlsx
</span>

<p>しかしながら、OneDrive for Business や SharePoint Online は UTF-8 文字コードを使用することを期待しているため、ファイルを見つけることができずエラーが発生します。</p>
<p>例 : ファイル名「テスト.xlsx」を OneDrive for Business に格納したときのUTF-8 エンコードの例</p>
<span>
https://microsoft-my.sharepoint.com/personal/username_microsoft_com/Documents/%E3%83%86%E3%82%B9%E3%83%88.xlsx
</span>

<p>OneDrive for Business や SharePoint Online 上の日本語をパスに含むファイルからもリンク貼り付けを可能とすることを検討しましたが、Office は Windows OS の WinInet コンポーネントの公開 API を利用してエンコードを行っており、他のプログラム利用上の互換性を考慮し、WinInet コンポーネントの既定の動作を変更することができません。(昨今では URL のエンコードでは UTF-8 が利用されることが主流ですが、このような時流となる以前から ANSI でエンコードを行う API として公開されています。)</p>
<p>このため、OneDrive for Business や SharePoint Online上の日本語 (DBCS) をパスに含むファイルからのリンク貼り付けで生じる上記の問題は、現状では制限事項となります。  </p>
<p><strong>3.</strong> <strong>回避策</strong></p>
<p>以下のいずれかの方法でエラーを回避できます。  </p>
<p><strong>・ レジストリを設定して HTTP 通信時に UTF-8 でエンコードする</strong></p>
<p>以下のレジストリを設定すると、WinInet の URL エンコードを UTF-8 に変更できます。したがって、このレジストリを設定すると、期待通りにリンクの更新や貼り付けられたファイルをダブルクリックで開くことができます。</p>
<p>キー : HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings<br>名前 : EnableUTF8<br>種類 : REG_DWORD値 : 1  </p>
<p>※ Office のリンク貼り付け以外の、各アプリケーションでの WinInet を利用する HTTP 通信も UTF-8 でエンコードされるようになります。一般的な Web システムでは UTF-8 でエンコードされた URL を扱うことができると考えられますが、お客様社内用システムなどの限定的な利用を目的とするシステムでは、クライアント アプリケーションが WinInet API 既定の ANSI エンコードである前提で開発された Web システムがある可能性があります。このような Web システムがある場合、このレジストリを設定すると影響が生じます。  </p>
<p><strong>・ ファイル パスに日本語 (DBCS) 文字を使用しない</strong></p>
<p><strong>・ 貼り付け元ファイルをローカルや UNC 共有のファイル サーバーに格納する</strong>  </p>
<p>今回の投稿は以上です。</p>
<p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://officesupportjp.github.io/blog/cl0m6umw6002hi4vs2765aacl/" data-id="cl0n2mqdv002i84vse87265la" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/cl0m6umvg001gi4vsgppfcmk0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Office のサインインのトラブルシュートについて
        
      </div>
    </a>
  
  
    <a href="/blog/cl0m6umui000ci4vs1vcz49cz/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2020 年 4 月の更新適用後、日本語を含む外部参照を行う VBA が読み込まれない問題</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/MC322553/" rel="tag">MC322553</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%83%9E%E3%82%AF%E3%83%AD/" rel="tag">マクロ</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/cl0m4rqa2001y50vshhi75we2/">Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4f5o1003504vsa5tp25c2/">インターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について (MC322553)</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4xkl00039eovs4fp4ffbt/">お知らせ - Japan Office Client Support Blog について</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4xkk8002oeovs8ggucayv/">Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて</a>
          </li>
        
          <li>
            <a href="/blog/cl0m4xkk1002beovs87lwadzx/">Office 製品のサインインで先進認証が有効化、無効化されているかを確認する方法について</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Office Support Japan<br>      
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<script src="/blog/js/script.js"></script>




  </div>
</body>
</html>