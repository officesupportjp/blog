<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響 | Japan Office Client Support Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2022&#x2F;3&#x2F;18 Update2. &#x2F; 3. にそれぞれ、他のファイル内の VBA を参照している場合の影響と回避策を追加しました。 2024&#x2F;5&#x2F;08 Update   に Power Query の影響を追加しました。    に Power Query によるファイル・フォルダー列挙の代替案を追記しました。    に Power Que">
<meta property="og:type" content="article">
<meta property="og:title" content="Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響">
<meta property="og:url" content="https://officesupportjp.github.io/blog/cl0m4rqa2001y50vshhi75we2/index.html">
<meta property="og:site_name" content="Japan Office Client Support Blog">
<meta property="og:description" content="2022&#x2F;3&#x2F;18 Update2. &#x2F; 3. にそれぞれ、他のファイル内の VBA を参照している場合の影響と回避策を追加しました。 2024&#x2F;5&#x2F;08 Update   に Power Query の影響を追加しました。    に Power Query によるファイル・フォルダー列挙の代替案を追記しました。    に Power Que">
<meta property="og:locale" content="ja_JP">
<meta property="article:published_time" content="2022-02-17T00:00:00.000Z">
<meta property="article:modified_time" content="2024-12-13T04:04:10.124Z">
<meta property="article:author" content="Office Support Japan">
<meta property="article:tag" content="オートメーション">
<meta property="article:tag" content="クラウド ストレージ">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="Japan Office Client Support Blog" type="application/atom+xml">
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/blog/icons/favicon-16x16.png">
    <link rel="manifest" href="/blog/icons/site.webmanifest">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/blog/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="/blog/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="site-header-logo"></div>
  <div id="site-header-blog-wrapper"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Japan Office Client Support Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">日本マイクロソフト Office Client サポート チームのブログです</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://cssjpn.github.io/">サポート情報</a>
        
          <a class="main-nav-link" href="/blog/cl0m4xkl00039eovs4fp4ffbt">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSSフィード"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="検索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://officesupportjp.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/cl0m4rqa2001y50vshhi75we2/" class="article-date">
  <time datetime="2022-02-17T00:00:00.000Z" itemprop="datePublished">2022-02-17</time>
</a>
    <!--  -->
  </div>
  <div class="article-inner">
    
    
      <header class="article-header-single">
        
  
    <h1 class="article-title" itemprop="name">
      Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響
    </h1>
  

      </header>
      <div class="article-share">
        Last Update: 
        <a href="/blog/cl0m4rqa2001y50vshhi75we2/" class="article-date-single">    
        
    <time datetime="2024-05-08T00:00:00.000Z" itemprop="lastupdate">2024-05-08</time>    
    
</a>              
      </div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <br>

<hr>
<p><strong>2022&#x2F;3&#x2F;18 Update</strong><br>2. &#x2F; 3. にそれぞれ、他のファイル内の VBA を参照している場合の影響と回避策を追加しました。</p>
<p><strong>2024&#x2F;5&#x2F;08 Update</strong></p>
<ul>
<li><ol start="2">
<li>に Power Query の影響を追加しました。</li>
</ol>
</li>
<li><ol start="3">
<li>に Power Query によるファイル・フォルダー列挙の代替案を追記しました。</li>
</ol>
</li>
<li><ol start="4">
<li>に Power Query や Graph API の認証についての記述を追加しました。</li>
</ol>
</li>
</ul>
<hr>
<br>

<p>こんにちは、Office サポート チームの中村です。</p>
<p>Office ファイルの保存場所として、ファイル サーバーの共有フォルダから、SharePoint Online のドキュメント ライブラリや 個人用 OneDrive &#x2F; OneDrive for Business への移行を検討する企業も増えてきたかと思います。Office ファイルでは業務効率化のためマクロ (VBA) を利用されていることが多く、弊社サポートにも、マクロ ファイル自身やマクロ内で操作するファイルの保存場所がクラウドになることの影響を確認したい、というお問い合わせを時折頂きます。</p>
<p>今後、さらにクラウド活用が進むと想定されるため、今回の記事で、このようなシナリオで一般的に生じる影響と対応方法、考慮すべき点についてまとめたいと思います。<br><br></p>
<p><strong><h2>1. クラウド移行で変化すること</h2></strong><br>ファイルの格納場所を変更したとき、マクロに影響を与える要素は主に以下の 2 点です。</p>
<p>・フォルダやファイルのパスが UNC 共有パス形式 (\\Server\folder) から URL 形式 (http:&#x2F;&#x2F;tenantname.sharepoint.com&#x2F;xxxx など) に変わる<br>・SharePoint や OneDrive によってアクセス権が管理される<br><br></p>
<p><strong><h2 id="chapter2">2. ファイル パス変更の影響</h2></strong><br>マクロからファイルやフォルダを操作するときに使用する関数によっては、URL 形式に対応していません。このような関数を利用している場合は、マクロ処理の見直しが必要です。以下に、マクロで主に使用されるファイル操作関数の URL 形式対応状況を記載します。<br><br></p>
<h3 id="Excel-x2F-Word-x2F-PowerPoint-のライブラリ"><a href="#Excel-x2F-Word-x2F-PowerPoint-のライブラリ" class="headerlink" title="Excel &#x2F; Word &#x2F; PowerPoint のライブラリ"></a><strong>Excel &#x2F; Word &#x2F; PowerPoint のライブラリ</strong></h3><p>これらのアプリ用のライブラリ Microsoft xxx 16.0 Object Library (xxx は各種アプリ名) で提供されるファイル操作メソッドやプロパティは、Web 上のファイルを直接読み書きすることを想定しているため、基本的に URL 形式を扱うことができます。これらのメソッド・プロパティを利用している場合は、特に対応の必要はありません。<br>例) Excel の Workbooks.Open や Workbook.Path<br>※ Access ファイルは Web から直接開くことができず、ダウンロードしてから開くため URL 形式を扱うことは想定されません。<br><br></p>
<p><strong>補足情報</strong><br>エクスプローラーで、OneDrive や SharePoint ライブラリの同期フォルダからファイルを開く場合、以前の Office バージョンでは、ThisWorkbook.Path などで開いたファイルのパスを取得すると、同期フォルダのローカル パスが返されました。<br>Microsoft 365 の最新チャネル バージョン 1903 および半期チャネル バージョン 2008 以降は、この操作シナリオでも、サーバー側の URL パスが返るようになりました。<br>古い Office バージョンを利用する場合は、取得されるパスが異なることに注意してください。<br><br></p>
<h3 id="VBA-関数"><a href="#VBA-関数" class="headerlink" title="VBA 関数"></a><strong>VBA 関数</strong></h3><p>Dir や Open といった VBA 関数は、URL 形式に対応していません。以下に、ファイル操作に関わる主な VBA 関数がまとめられていますが、ここに記載されている関数を利用している場合、他の仕組みへの変更を検討してください。</p>
<p>Directories and files keyword summary<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/directories-and-files-keyword-summary">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/directories-and-files-keyword-summary</a><br>Input and output keyword summary<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/input-and-output-keyword-summary">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/input-and-output-keyword-summary</a><br><br></p>
<h3 id="FileSystemObject-ライブラリ"><a href="#FileSystemObject-ライブラリ" class="headerlink" title="FileSystemObject ライブラリ"></a><strong>FileSystemObject ライブラリ</strong></h3><p>Scripting.FileSystemObject ライブラリで提供される各種メソッドは、URL 形式に対応していません。以下の公開情報で Scripting.FileSystemObject ライブラリで提供されるファイル・フォルダ操作メソッドがまとめられています。これらを利用している場合は、他の仕組みへの変更を検討してください。</p>
<p>FileSystemObject object<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/filesystemobject-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/filesystemobject-object</a><br>File object<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/file-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/file-object</a><br>Folder object<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/folder-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/folder-object</a><br><br></p>
<h3 id="Power-Query"><a href="#Power-Query" class="headerlink" title="Power Query"></a><strong>Power Query</strong></h3><p>Power Query でファイルからデータを読み込む場合、クエリの参照場所によって使用する関数を変える必要があります。  </p>
<p>UNC 共有パスで接続するファイル サーバーを参照する場合、主に以下の関数が使用されます。</p>
<ul>
<li>File.Contents (指定ファイルの内容取得)</li>
<li>Folder.Contents (指定フォルダー内のファイル・フォルダー列挙)</li>
<li>Folder.Files (指定フォルダー内のファイル列挙)</li>
</ul>
<p>これらの関数は、URL 形式のパスでは使用できません。SharePoint や OneDrive への参照の場合、上記の関数は以下に置き換える必要があります。</p>
<ul>
<li>Web.Contents<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/powerquery-m/web-contents">https://learn.microsoft.com/en-us/powerquery-m/web-contents</a></li>
<li>SharePoint.Contents<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/ja-jp/powerquery-m/sharepoint-contents">https://learn.microsoft.com/ja-jp/powerquery-m/sharepoint-contents</a></li>
<li>SharePoint.Files<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/ja-jp/powerquery-m/sharepoint-files">https://learn.microsoft.com/ja-jp/powerquery-m/sharepoint-files</a></li>
</ul>
<p>ただし、関数の使い勝手が異なりそのまま置き換えられない場合があったり、URL の指定誤りなどから、直接クエリを編集して書き換えると、問題に直面することが多くなっています。<br>Excel 画面上の手動操作で、新しい場所を参照する正しいクエリを作成して利用する、および、これを参考に VBA からのクエリ作成処理を見直すことをお勧めします。 (Excel の [データ] タブ - [データの取得] にある [Web から] &#x2F; [ファイルから] - [SharePoint フォルダーから] などで作成できます。)</p>
<p>また、SharePoint &#x2F; OneDrive への認証も考慮する必要があります。</p>
<p>クエリ作成手順や認証に関する情報の詳細は、以下の公開情報をご参照ください。</p>
<p><strong>参考資料:</strong><br>データ ソースの設定とアクセス許可を管理する (Power Query)<br><a target="_blank" rel="noopener" href="https://support.microsoft.com/ja-jp/office/9f24a631-f7eb-4729-88dd-6a4921380ca9">https://support.microsoft.com/ja-jp/office/9f24a631-f7eb-4729-88dd-6a4921380ca9</a></p>
<p>Web データに接続する<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/ja-jp/power-query/connectors/web/web">https://learn.microsoft.com/ja-jp/power-query/connectors/web/web</a></p>
<p>データ ソースによる認証<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/ja-jp/power-query/connector-authentication">https://learn.microsoft.com/ja-jp/power-query/connector-authentication</a><br><br></p>
<h3 id="補足-1-その他、独自にパスを解析・組み立てる処理"><a href="#補足-1-その他、独自にパスを解析・組み立てる処理" class="headerlink" title="補足 1) その他、独自にパスを解析・組み立てる処理"></a><strong>補足 1) その他、独自にパスを解析・組み立てる処理</strong></h3><p>マクロの独自処理として、例えばマクロ ファイル自身の格納フォルダ パスの一部を加工して処理結果ファイルの出力パスを組み立てるなど、パスのテキストを意識した処理がある場合は注意が必要です。URL 形式への変更に伴い、既存の文字列操作処理では、期待する結果が得られない場合があります。<br><br></p>
<h3 id="補足-2-他のファイルへの参照"><a href="#補足-2-他のファイルへの参照" class="headerlink" title="補足 2) 他のファイルへの参照"></a><strong>補足 2) 他のファイルへの参照</strong></h3><p>先述したような一般的なライブラリは、クライアント マシンに登録されたものを呼び出すため、ファイルの保存場所が変わっても影響を受けません。<br>しかし、他の Excel ブックを [参照設定] で参照して、そのブック内の独自に作成した VBA プロシージャを呼び出している場合、参照先のファイルをクラウドに移行すると、参照不可となります。(VBA の参照設定は URL 形式に対応していないため、参照設定を再設定してもクラウド上のファイルは参照できません。)</p>
<p>参照設定の他にも、マクロ処理内でパスを指定して他のファイルを開いている場合は、パスの指定方法がファイルの移動後も有効な実装となっているか十分に確認してください。<br><br></p>
<p><strong><h2>3. 影響を受ける場合の対処方法</h2></strong><br>一般的には、以下のような対処方法が検討できます。実際の処理内容や環境構成、対応にかけられる工数などを考慮して対処方法をご検討ください。<br><br></p>
<h3 id="a-Office-ライブラリを用いて操作する"><a href="#a-Office-ライブラリを用いて操作する" class="headerlink" title="a. Office ライブラリを用いて操作する"></a><strong>a. Office ライブラリを用いて操作する</strong></h3><p>先述の通り、Microsoft xxx 16.0 Object Library で提供されるメソッド・プロパティは基本的に URL 形式を扱うことができます。そして、Word や Excel は、テキスト ファイルを扱うこともできます。現在 VBA 関数や FileSystemObject でテキスト ファイルを操作している場合には、これを Word や Excel アプリで Microsoft xxx 16.0 Object Library を用いて扱うよう変更することが検討できます。<br><br></p>
<h3 id="b-ファイル・フォルダー列挙は-Power-Query-を使用する"><a href="#b-ファイル・フォルダー列挙は-Power-Query-を使用する" class="headerlink" title="b. ファイル・フォルダー列挙は Power Query を使用する"></a><strong>b. ファイル・フォルダー列挙は Power Query を使用する</strong></h3><p><a href="#chapter2">&lt;2. ファイル パス変更の影響&gt;</a> の “Power Query” セクションで紹介した SharePoint.Contents や SharePoint.Files では、SharePoint Online の指定した場所のファイルやフォルダーを列挙できます。<br>VBA の Dir 関数や FileSystemObject を用いて、ファイルを列挙している場合は、Power Query を利用するよう変更することが検討できます。</p>
<h3 id="c-不要なファイル・フォルダ操作を止める"><a href="#c-不要なファイル・フォルダ操作を止める" class="headerlink" title="c. 不要なファイル・フォルダ操作を止める"></a><strong>c. 不要なファイル・フォルダ操作を止める</strong></h3><p>例えば、次回利用時に引き継ぎたい内容を動的に保持する設定ファイルを別ファイルとして用意し、これを読み書きするために対応していない関数を使っている、というシナリオを考えます。このような場合、これをマクロ ファイル自身のどこかに保持する (Excel の非表示シート、Word の隠し文字、ファイルのユーザー設定プロパティ等) ことで、他のファイルへの読み書きを行わないようにする、といった対応もマクロの内容次第では検討できます。<br><br></p>
<h3 id="d-Graph-API-に変更する-ファイル操作と-Excel-操作が対応"><a href="#d-Graph-API-に変更する-ファイル操作と-Excel-操作が対応" class="headerlink" title="d. Graph API に変更する (ファイル操作と Excel 操作が対応)"></a><strong>d. Graph API に変更する (ファイル操作と Excel 操作が対応)</strong></h3><p>SharePoint Online や OneDrive に対し、HTTP リクエスト ベースで操作する API として Graph API が提供されています。現在、SharePoint ライブラリや OneDrive のフォルダ・ファイル自体の操作 (作成やコピー、削除など) と、Excel ファイルの操作用 API が利用できます。ただし、プログラムの実装イメージがマクロと大きく異なりますので、Graph API 自体の利用に習熟している開発者向けの代替案です。  </p>
<p>Microsoft Graph API を使用する<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/use-the-api">https://docs.microsoft.com/ja-jp/graph/use-the-api</a><br>Microsoft Graph REST API v1.0 リファレンス<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/ja-jp/graph/api/overview">https://docs.microsoft.com/ja-jp/graph/api/overview</a>  </p>
<p>現時点では、マクロで可能な全ての操作が Graph API からも行えるものではありませんが、簡単な操作は可能です。ただし、一般的に、マクロから呼び出すことには適していません。一般的には、独立したアプリケーションを作成して HTTP リクエストを発行し、Web 上のファイルを操作します。また、Microsoft 365 サービスへの認証も考慮する必要があります。  </p>
<p><strong>参考資料</strong><br>(WebAPI)OAuth Bearer Token (Access Token) の取得方法について<br><a href="https://officesupportjp.github.io/blog/cl0m8t2ac00023gvs6bwo9tp2/">https://officesupportjp.github.io/blog/cl0m8t2ac00023gvs6bwo9tp2/</a><br>(WebAPI)Microsoft Graph を使用した開発に便利なツール群<br><a href="https://officesupportjp.github.io/blog/cl0m8t2ae00033gvsbtlo3btc/">https://officesupportjp.github.io/blog/cl0m8t2ae00033gvsbtlo3btc/</a><br>(WebAPI)Microsoft Graph - OneDrive API (C Sharp) を使ったサンプル コード<br><a href="https://officesupportjp.github.io/blog/cl0m8t2aa00013gvsa2mr8xj5/">https://officesupportjp.github.io/blog/cl0m8t2aa00013gvsa2mr8xj5/</a><br>(WebAPI)Microsoft Graph – Excel REST API (C Sharp) を使い Range を操作するサンプル コード<br><a href="https://officesupportjp.github.io/blog/cl0m8t2a400003gvsgcr96w6h/">https://officesupportjp.github.io/blog/cl0m8t2a400003gvsgcr96w6h/</a><br><br></p>
<h3 id="e-OneDrive-や-SharePoint-ライブラリの同期フォルダを操作する"><a href="#e-OneDrive-や-SharePoint-ライブラリの同期フォルダを操作する" class="headerlink" title="e. OneDrive や SharePoint ライブラリの同期フォルダを操作する"></a><strong>e. OneDrive や SharePoint ライブラリの同期フォルダを操作する</strong></h3><p>OneDrive 同期クライアントで、ファイル格納フォルダをクライアント コンピューターと同期すると、ローカルの同期フォルダにファイルがコピーされます。この同期フォルダに対してマクロから操作を行うと、通常のローカル パスとして扱うことができます。(なお、先述の通り、ThisWorkbook.Path の結果は最新の Microsoft 365 では URL 形式になり、同期フォルダのローカル パスではない点にご注意ください。)  </p>
<p>Windows の OneDrive とファイルを同期する<br><a target="_blank" rel="noopener" href="https://support.microsoft.com/ja-jp/office/615391c4-2bd3-4aae-a42a-858262e42a49">https://support.microsoft.com/ja-jp/office/615391c4-2bd3-4aae-a42a-858262e42a49</a>  </p>
<p>ただし、マクロから編集した内容がサーバー上へ同期されることは、マクロの動作としては保証されません。マクロからは、ローカルの同期フォルダへの操作が成功することをもって成功と判断されます。ネットワークの問題で同期に失敗したり、クラウド上のファイルに他のユーザーから競合する変更が行われて同期エラーが生じるなど、クラウド上にマクロの実行結果が期待通り反映されない可能性についての考慮が必要です。<br><br></p>
<h4 id="補足-WebDAV-パスでのアクセス"><a href="#補足-WebDAV-パスでのアクセス" class="headerlink" title="補足: WebDAV パスでのアクセス"></a><strong>補足: WebDAV パスでのアクセス</strong></h4><p>SharePoint ライブラリを Internet Explorer で開くと、[エクスプローラ―で開く] というメニューが使用でき、”\\SharePoint サイト\DavWWWRoot\Folder” のような UNC パスで、ライブラリが開かれていました。これは、WebDAV と呼ばれる Web フォルダを読み書き可能とする技術を用いて​実現されています。<br>以前は、このパスを用いてマクロからアクセスすることも検討できる方法の 1 つでした。<br>しかしながら、この仕組みはレガシな技術を用いており、Edge ブラウザでは対応していません。<br>また、WebDAV でのアクセスには別のサービス (WebClient サービス) が利用されるため、マクロが実行されている Office アプリの認証情報は引き継がれません。<br>WebClient サービス用の認証情報の保存にはまもなくサポートを終了する Internet Explorer を利用する必要があることなどからも、新たに WebDAV パスでの利用を検討することは推奨しません。<br><br></p>
<h3 id="f-参照設定を-Application-Run-に変更する"><a href="#f-参照設定を-Application-Run-に変更する" class="headerlink" title="f. 参照設定を Application.Run に変更する"></a><strong>f. 参照設定を Application.Run に変更する</strong></h3><p>参照設定で他のファイルの VBA プロシージャを呼び出している場合、参照設定を止め、以下のようにファイルを開いた上で Application.Run で実行することが検討できます。</p>
<p>例:<br>Ref.xlsm に SampleProc() が含まれているとします。   </p>
<p>&lt;変更前&gt;<br>[参照設定] から Ref.xlsm を参照し、VBA コードから SampleProc をそのまま呼び出し  </p>
<p>&lt;変更後&gt;<br>参照設定は解除し、以下のように呼び出し  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Workbooks.Open &quot;https://xxxx/Ref.xlsm&quot;</span><br><span class="line">Application.Run &quot;Ref.xlsm!SampleProc&quot;</span><br></pre></td></tr></table></figure>
<br>

<p><strong><h2>4. Microsoft 365 サービスへの認証とアクセス権</h2></strong><br>対応方法のうち、引き続きマクロから Microsoft 365 サービス上のファイルへのアクセスを行う “a. Office ライブラリを用いて操作する” の場合、マクロが実行されている Office アプリケーションにサインインしているユーザーとして認証が行われます。このため、マクロ実行時の Office サインイン ユーザーに、マクロで操作するファイルへのアクセス権を付与する必要があります。</p>
<p>Power Query や Graph API については独自に認証を行うため、上記の対応方法内に記載の資料をご参照ください。<br><br></p>
<p><strong><h2>5. サポートされる Office クライアント アプリケーション</h2></strong><br>マクロからの操作においても、Microsoft 365 サービスとの接続がサポートされる Office クライアント アプリケーションがサポート対象です。サポートされる製品は、以下の公開情報でご確認ください。</p>
<p>Office versions and connectivity to Microsoft 365 services<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/deployoffice/endofsupport/microsoft-365-services-connectivity">https://docs.microsoft.com/en-us/deployoffice/endofsupport/microsoft-365-services-connectivity</a></p>
<p>今回の投稿は以上です。<br><br></p>
<p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://officesupportjp.github.io/blog/cl0m4rqa2001y50vshhi75we2/" data-id="cm4m97pfa004t6g6yd0eh279n" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E3%82%AA%E3%83%BC%E3%83%88%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/" rel="tag">オートメーション</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/" rel="tag">クラウド ストレージ</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/cl0m4f5o1003504vsa5tp25c2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">次の記事</strong>
      <div class="article-nav-title">
        
          インターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について (MC322553)
        
      </div>
    </a>
  
  
    <a href="/blog/cl0m4xkl00039eovs4fp4ffbt/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前の記事</strong>
      <div class="article-nav-title">お知らせ - Japan Office Client Support Blog について</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグ</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Access/" rel="tag">Access</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Excel/" rel="tag">Excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Graph-API/" rel="tag">Graph API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/MIP-%E3%83%A9%E3%83%99%E3%83%AB/" rel="tag">MIP ラベル</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Office-%E9%96%8B%E7%99%BA%E5%85%A8%E8%88%AC/" rel="tag">Office 開発全般</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/SDI/" rel="tag">SDI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/SwayForms/" rel="tag">SwayForms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/" rel="tag">VBA マクロ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Web-%E3%82%A2%E3%83%89%E3%82%A4%E3%83%B3/" rel="tag">Web アドイン</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Word/" rel="tag">Word</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/" rel="tag">お知らせ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%A2%E3%83%89%E3%82%A4%E3%83%B3/" rel="tag">アドイン</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/" rel="tag">インストール</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%AA%E3%83%BC%E3%83%88%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/" rel="tag">オートメーション</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/" rel="tag">クラウド ストレージ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%B3%E3%83%94%E3%83%BC%EF%BC%86%E3%83%9A%E3%83%BC%E3%82%B9%E3%83%88/" rel="tag">コピー＆ペースト</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/" rel="tag">サインイン、認証</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%B9%E3%83%88%E3%82%A2-%E3%82%A2%E3%83%97%E3%83%AA%E9%96%8B%E7%99%BA/" rel="tag">ストア アプリ開発</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3/" rel="tag">セキュリティ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9/" rel="tag">パフォーマンス</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/" rel="tag">ファイル I&#x2F;O</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88/" rel="tag">フォント</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E3%83%AA%E3%83%9C%E3%83%B3-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/" rel="tag">リボン カスタマイズ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%8D%B0%E5%88%B7/" rel="tag">印刷</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%8F%8F%E7%94%BB/" rel="tag">描画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%9B%B4%E6%96%B0/" rel="tag">更新</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグクラウド</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Access/" style="font-size: 13.33px;">Access</a> <a href="/blog/tags/Excel/" style="font-size: 12.5px;">Excel</a> <a href="/blog/tags/Graph-API/" style="font-size: 13.33px;">Graph API</a> <a href="/blog/tags/MIP-%E3%83%A9%E3%83%99%E3%83%AB/" style="font-size: 10px;">MIP ラベル</a> <a href="/blog/tags/Office-%E9%96%8B%E7%99%BA%E5%85%A8%E8%88%AC/" style="font-size: 10.83px;">Office 開発全般</a> <a href="/blog/tags/SDI/" style="font-size: 12.5px;">SDI</a> <a href="/blog/tags/SwayForms/" style="font-size: 13.33px;">SwayForms</a> <a href="/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/" style="font-size: 18.33px;">VBA マクロ</a> <a href="/blog/tags/Web-%E3%82%A2%E3%83%89%E3%82%A4%E3%83%B3/" style="font-size: 10px;">Web アドイン</a> <a href="/blog/tags/Word/" style="font-size: 10.83px;">Word</a> <a href="/blog/tags/%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/" style="font-size: 13.33px;">お知らせ</a> <a href="/blog/tags/%E3%82%A2%E3%83%89%E3%82%A4%E3%83%B3/" style="font-size: 10px;">アドイン</a> <a href="/blog/tags/%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/" style="font-size: 16.67px;">インストール</a> <a href="/blog/tags/%E3%82%AA%E3%83%BC%E3%83%88%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/" style="font-size: 20px;">オートメーション</a> <a href="/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/" style="font-size: 14.17px;">クラウド ストレージ</a> <a href="/blog/tags/%E3%82%B3%E3%83%94%E3%83%BC%EF%BC%86%E3%83%9A%E3%83%BC%E3%82%B9%E3%83%88/" style="font-size: 10.83px;">コピー＆ペースト</a> <a href="/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/" style="font-size: 17.5px;">サインイン、認証</a> <a href="/blog/tags/%E3%82%B9%E3%83%88%E3%82%A2-%E3%82%A2%E3%83%97%E3%83%AA%E9%96%8B%E7%99%BA/" style="font-size: 10px;">ストア アプリ開発</a> <a href="/blog/tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3/" style="font-size: 11.67px;">セキュリティ</a> <a href="/blog/tags/%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9/" style="font-size: 15.83px;">パフォーマンス</a> <a href="/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/" style="font-size: 19.17px;">ファイル I/O</a> <a href="/blog/tags/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88/" style="font-size: 12.5px;">フォント</a> <a href="/blog/tags/%E3%83%AA%E3%83%9C%E3%83%B3-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/" style="font-size: 15px;">リボン カスタマイズ</a> <a href="/blog/tags/%E5%8D%B0%E5%88%B7/" style="font-size: 15.83px;">印刷</a> <a href="/blog/tags/%E6%8F%8F%E7%94%BB/" style="font-size: 10px;">描画</a> <a href="/blog/tags/%E6%9B%B4%E6%96%B0/" style="font-size: 13.33px;">更新</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">アーカイブ</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/12/">12月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/11/">11月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/09/">9月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/01/">1月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/12/">12月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/11/">11月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/10/">10月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/09/">9月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/02/">2月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/01/">1月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/12/">12月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/11/">11月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/10/">10月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/09/">9月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/08/">8月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/06/">6月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/04/">4月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/02/">2月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/01/">1月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/06/">6月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/04/">4月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/03/">3月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/01/">1月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/12/">12月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/11/">11月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/10/">10月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/09/">9月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/08/">8月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/07/">7月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/06/">6月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/04/">4月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/02/">2月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/01/">1月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/12/">12月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/10/">10月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/09/">9月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/05/">5月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/04/">4月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/03/">3月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/02/">2月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近の投稿</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/cm53l15yg0000j46y7a4s6u9f/">ラベル ポリシー「ユーザーがメールとドキュメントにラベルを適用することを必須にする」が有効の場合 Excel アドイン (.xlam) 保存時にラベル適用が求められ保存できない</a>
          </li>
        
          <li>
            <a href="/blog/cm4m8fp9y0009346y3p6tg4s6/">Word で表のレイアウトが変わる</a>
          </li>
        
          <li>
            <a href="/blog/cm3e5mpvi0000cgkj2sfvb55j/">Office のインストール・更新・環境情報の採取について</a>
          </li>
        
          <li>
            <a href="/blog/cm372f6jk000058se8jgwhvee/">Excel シート タブの外観変更後、オートメーションのパフォーマンスが低下する</a>
          </li>
        
          <li>
            <a href="/blog/cm15ufuis0000f0seec0i7yev/">Word で「打」で始まるテキスト ファイルを開くとコンバーターを要求される</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 Office Support Japan<br>      
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
    <a target="_blank" rel="noopener" href="https://cssjpn.github.io/" class="mobile-nav-link">サポート情報</a>
  
    <a href="/blog/cl0m4xkl00039eovs4fp4ffbt" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<script src="/blog/js/script.js"></script>




  </div>
</body>
</html>