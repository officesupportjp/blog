<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Office Client Support Blog</title>
  
  <subtitle>日本マイクロソフト Office Client サポート チームのブログです</subtitle>
  <link href="https://officesupportjp.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://officesupportjp.github.io/blog/"/>
  <updated>2023-02-10T09:42:33.888Z</updated>
  <id>https://officesupportjp.github.io/blog/</id>
  
  <author>
    <name>Office Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>VL 版の Office 2016 でオンラインストレージからファイルを開く際に稀にサインイン画面が表示される現象について</title>
    <link href="https://officesupportjp.github.io/blog/cldybofry00010gkj32idbkw7/"/>
    <id>https://officesupportjp.github.io/blog/cldybofry00010gkj32idbkw7/</id>
    <published>2023-02-10T00:00:00.000Z</published>
    <updated>2023-02-10T09:42:33.888Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。 </p><p>今回の投稿では、VL (ボリュームライセンス) 版の Office 2016 でオンラインストレージからファイルを開く際に稀にサインイン画面が表示される現象についてご説明いたします。</p><p><a href="https://officesupportjp.github.io/blog/cl0m8t2dj00393gvs3r7oar2m/index.html">VL 版の Office 2016 とは？</a></p><br><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>VL 版の Office 2016 において、Teams やブラウザを介して SharePoint 等のオンラインストレージよりファイルを開く際、稀に以下のようなサインイン画面が表示されます。</p><p>・例</p><p><img src="/blog/cldybofry00010gkj32idbkw7/image1.png"></p><br><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>本事象は Office 2016 で生じる可能性がございます。</p><p>本ダイアログが表示された場合、Office を再起動して事象が解消するかをご確認いただくとともに、改善されない場合には再度サインインをしていただきますようお願いいたします。<br>また、Microsoft 365 Apps ではオンラインストレージとのやり取りの機能が向上しておりますので、Microsoft 365 Apps をご利用いただき事象が改善するかをご確認いただけますと幸いです。</p><br><h2 id="留意点"><a href="#留意点" class="headerlink" title="留意点"></a>留意点</h2><p>本事象は以下のような場合には該当いたしません。</p><ul><li>Office を再起動してもファイルが開けない</li><li>Office のファイルの保存に失敗する</li><li>Office のサインインが出来ない</li></ul><p>このような場合には、以下の情報をご参考にいただけますと幸いです。</p><p><a href="https://officesupportjp.github.io/blog/cl0m69xu000124cvsclmc5vis/">MSI 版の Office 2016 で SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象について</a></p><p><a href="https://officesupportjp.github.io/blog/cl0m82yjj002mvovs9cil5fgy/index.html">SharePoint Server など WebDAV が有効なサーバーから Office ファイルが開かない、保存できない現象について</a></p><p><a href="https://officesupportjp.github.io/blog/cl0m6umvg001gi4vsgppfcmk0/">Office のサインインのトラブルシュートについて</a></p><br><p>今回の投稿は以上です。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。 &lt;/p&gt;
&lt;p&gt;今回の投稿では、VL (ボリュームライセンス) 版の Office 2016 でオンラインストレージからファイルを開く際に稀にサインイン画面が表示される現象についてご説明いたします。&lt;/p&gt;
&lt;p&gt;&lt;</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>Excel 2016 で 3D マップを利用するとエラーが発生する (状態コード 4)</title>
    <link href="https://officesupportjp.github.io/blog/cldu0kdx900004k6yd6dvgatz/"/>
    <id>https://officesupportjp.github.io/blog/cldu0kdx900004k6yd6dvgatz/</id>
    <published>2023-02-06T15:00:00.000Z</published>
    <updated>2023-02-22T09:35:46.769Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの佐村です。<br>今回の投稿では、Excel 2016 において、[挿入] タブの 3D マップを利用時にエラーとなる現象についてご案内いたします。  </p><h1 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h1><p>Excel 2016 の 3D マップ機能を利用しようとすると以下のエラーが発生します。  </p><p>3D Maps<br>3D Maps が Microsoft Bing 地図サービスに接続しているときにエラーが発生しました。　　<br>機能が制限される場合があります (状態コード: 4)。　</p><p><img src="/blog/cldu0kdx900004k6yd6dvgatz/img1.png"></p><p>その後、DirectX の初期化に関するエラーが表示され、3D マップ機能が起動しません。<br>※過去の利用履歴により上記エラー後に 3D マップ機能が起動することもあります。  </p><p><img src="/blog/cldu0kdx900004k6yd6dvgatz/img2.png"></p><h1 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h1><p>3D マップで利用する .Net framework で TLS 1.2 を利用して接続できるように<br>以下のレジストリを構成 (新規作成) します。<br>レジストリの設定には端末の管理者権限が必要となります。 </p><p>&lt;OS と Office が同じ bit&gt;<br>キー : HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319<br>名前 : SchUseStrongCrypto<br>種類 : REG_DWORD<br>値 : 1  </p><p>&lt;64bit OS 上に 32bit の Office&gt;<br>キー : HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319<br>名前 : SchUseStrongCrypto<br>種類 : REG_DWORD<br>値 : 1  </p><h3 id="ご参考"><a href="#ご参考" class="headerlink" title="ご参考"></a>ご参考</h3><p>クライアントの SSL&#x2F;TLS プロトコルと暗号スイートのAD FSを管理する<br><a href="https://learn.microsoft.com/ja-jp/windows-server/identity/ad-fs/operations/manage-ssl-protocols-in-ad-fs#enabling-strong-authentication-for-net-applications">https://learn.microsoft.com/ja-jp/windows-server/identity/ad-fs/operations/manage-ssl-protocols-in-ad-fs#enabling-strong-authentication-for-net-applications</a>  </p><h1 id="エラーの原因"><a href="#エラーの原因" class="headerlink" title="エラーの原因"></a>エラーの原因</h1><p>「状態コード: 4」のエラーは、TLS での接続に失敗していることが原因として考えられます。<br>2022年の下旬 (10月頃) に、コンテンツ配信サービス (3D マップ) 側でセキュリティ要件を変更したことにより、TLS 1.2 の接続が必要となりました。<br>これまでは TLS 1.0&#x2F;1.1 での接続も動作していましたが、TLS 1.2 での接続を必要とし、TLS 1.0&#x2F; 1.1 での接続をエラーとするよう変更がありました。 </p><p>Office 2019 や Microsoft 365 Apps では更新プログラムにより TLS 1.2 に<br>対応するように修正されましたが、Office 2016 は延長サポートフェーズであるため<br>更新による修正がリリースされていません。<br>そのため、レジストリを設定して TLS の接続方法を変更する必要があります。  </p><h1 id="レジストリの構成による影響について"><a href="#レジストリの構成による影響について" class="headerlink" title="レジストリの構成による影響について"></a>レジストリの構成による影響について</h1><p>レジストリ SchUseStrongCrypto&#x3D;1 とすると、.NET Framework 4.5.2 のバージョンで既定で利用されるプロトコルが TLS 1.2 &#x2F; 1.1 &#x2F; 1.0 となります。<br>※高いバージョンから優先的に使用されるため、基本的には TLS 1.2 を利用します。  </p><p>このレジストリが未指定または 0 となっている場合は、.NET Framework 4.5.2 では既定で利用されるプロトコルは SSL 3.0 &#x2F; TLS 1.0 となります。<br>また、.NET Framework のプログラム上で明示的にプロトコルバージョンを指定している場合上記のレジストリの値や有無に関わらず、プログラムで指定したバージョンのプロトコルを利用します。  </p><p>以上のことから、影響としてはプログラム上で明示的にプロトコルバージョンを指定して「いない」、かつ.NET Framework 4.5.2 をターゲットにビルドされているアプリを利用する場合に通信のプロトコルが変更されます。  </p><p>上記条件で通信先のサービスで TLS 1.2 をサポートしていない場合 (レガシサービスの場合) はエラーとなる可能性はございますが、セキュリティ観点から TLS 1.2 への対応を進めていただくことを推奨しております。  </p><h3 id="ご参考-1"><a href="#ご参考-1" class="headerlink" title="ご参考"></a>ご参考</h3><p>.NET Framework で TLS 1.1 および TLS 1.2 を有効化する方法 - まとめ –<br>※#6 をご参照ください。<br><a href="https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/dotnet-framework-tls12">https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/dotnet-framework-tls12</a> </p><p>今回の投稿は以上です。<br>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。 </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの佐村です。&lt;br&gt;今回の投稿では、Excel 2016 において、[挿入] タブの 3D マップを利用時にエラーとなる現象についてご案内いたします。  &lt;/p&gt;
&lt;h1 id=&quot;現象&quot;&gt;&lt;a href=&quot;#現象&quot; class=&quot;heade</summary>
      
    
    
    
    
    <category term="Excel" scheme="https://officesupportjp.github.io/blog/tags/Excel/"/>
    
  </entry>
  
  <entry>
    <title>「必要なサービスが無効になっています」と表示される現象について</title>
    <link href="https://officesupportjp.github.io/blog/cld8jp0gd00422skj5eabeqvb/"/>
    <id>https://officesupportjp.github.io/blog/cld8jp0gd00422skj5eabeqvb/</id>
    <published>2023-01-23T00:00:00.000Z</published>
    <updated>2023-01-23T08:36:56.571Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。 </p><p>今回の投稿では、Microsoft 365 Apps、Office LTSC 2021、Office 2019 のご利用時に「必要なサービスが無効になっています」と表示される現象についてご説明いたします。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>Office をご利用されている際に、以下のようなメッセージが表示されるとお問い合わせいただくことがございます。</p><p>・例1</p><p><img src="/blog/cld8jp0gd00422skj5eabeqvb/image0.png"></p><br><p>・例2</p><p><img src="/blog/cld8jp0gd00422skj5eabeqvb/image1.png"></p><br><p>・例3</p><p><img src="/blog/cld8jp0gd00422skj5eabeqvb/image2.png"></p><p>これらの表示は機能によって若干異なる場合がございます。<br>また、オンライン通信を伴う機能がグレーアウトされていたり、表示されていない場合もございます。</p><br><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Microsoft 365 Apps、Office LTSC 2021、Office 2019 (*) では、接続エクスペリエンスという機能が導入されており、オンライン接続の機能を用途ごとに有効・無効と切り替えるすることが出来るようになりました。<br>詳細は以下の資料をご確認ください。</p><p>Title : Microsoft 365 Apps for enterprise のプライバシー コントロールの概要<br>URL : <a href="https://learn.microsoft.com/ja-jp/deployoffice/privacy/overview-privacy-controls">https://learn.microsoft.com/ja-jp/deployoffice/privacy/overview-privacy-controls</a></p><p>この機能が無効にされているとオンライン機能が利用できないため、上記のような現象が生じます。</p><p>Title : Officeでの接続環境<br>URL : <a href="https://learn.microsoft.com/ja-jp/deployoffice/privacy/connected-experiences">https://learn.microsoft.com/ja-jp/deployoffice/privacy/connected-experiences</a></p><p><em>補足</em><br>Office 2019 では “Office での追加オプションである接続エクスペリエンスの使用を許可する” のみが利用可能です。</p><br><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>以下を上からご確認ください。</p><h3 id="1-プライバシー設定の見直し"><a href="#1-プライバシー設定の見直し" class="headerlink" title="1) プライバシー設定の見直し"></a>1) プライバシー設定の見直し</h3><ol><li>Excel 等を起動し、[ファイル] - “オプション” をクリックします</li><li>[トラストセンター] - “トラストセンターの設定” をクリックします</li><li>[プライバシーオプション] - “プライバシー設定” をクリックします</li><li>“オプションの接続エクスペリエンスをオンにする” にチェックをつけてください</li><li>事象が解消するかご確認ください。</li></ol><br><h3 id="2-接続エクスペリエンス機能の見直し"><a href="#2-接続エクスペリエンス機能の見直し" class="headerlink" title="2) 接続エクスペリエンス機能の見直し"></a>2) 接続エクスペリエンス機能の見直し</h3><p>Office 管理用グループポリシーでご実施されている接続エクスペリエンス機能の無効化を見直します。</p><h4 id="ポリシーの確認"><a href="#ポリシーの確認" class="headerlink" title="ポリシーの確認"></a>ポリシーの確認</h4><p>以下の資料より、今回ご利用されたい機能が以下のどのポリシーで制御されているかをご確認ください。</p><p>Title : Officeでの接続環境<br>URL : <a href="https://learn.microsoft.com/ja-jp/deployoffice/privacy/connected-experiences">https://learn.microsoft.com/ja-jp/deployoffice/privacy/connected-experiences</a></p><p>例えば、”PowerPoint デザイナー” の場合、[コンテンツを分析する Office の接続エクスペリエンスの使用を許可する] を有効にします。</p><p>“3D マップ” の場合、[コンテンツを分析する Office の接続エクスペリエンスの使用を許可する] に加えて、[Office の追加オプションである接続エクスペリエンスの使用を許可する]を有効にします。</p><p>“アイコンの挿入” の場合、[オンラインのコンテンツをダウンロードする Office の接続エクスペリエンスの使用を許可する] を有効にします。</p><p>“共有” や、その他記載がない機能の場合、[Office の接続エクスペリエンスの使用を許可する​] を有効にします。</p><h4 id="ポリシーの変更"><a href="#ポリシーの変更" class="headerlink" title="ポリシーの変更"></a>ポリシーの変更</h4><p>Office 管理用グループポリシーで該当するポリシーの制御を変更してください。</p><p>[ユーザーの構成]‐[ポリシー]-[管理用テンプレート]-[Microsoft Office 2016]-[プライバシー]-[セキュリティ センター]</p><p>・コンテンツを分析する Office の接続エクスペリエンスの使用を許可する<br>・オンラインのコンテンツをダウンロードする Office の接続エクスペリエンスの使用を許可する<br>・Office の追加オプションである接続エクスペリエンスの使用を許可する<br>・Office の接続エクスペリエンスの使用を許可する​</p><p>もしくは、以下の資料より対応するレジストリをご確認いただき、設定を変更することで事象が解消するかをご確認ください。</p><p>Title : ポリシー設定を使用して Microsoft 365 Apps for enterprise のプライバシー コントロールを管理する<br>URL : <a href="https://learn.microsoft.com/ja-jp/deployoffice/privacy/manage-privacy-controls#control-privacy-settings-by-editing-the-registry">https://learn.microsoft.com/ja-jp/deployoffice/privacy/manage-privacy-controls#control-privacy-settings-by-editing-the-registry</a></p><h3 id="3-Information-Rights-Management-関連のユーザーインターフェイスをオンにする"><a href="#3-Information-Rights-Management-関連のユーザーインターフェイスをオンにする" class="headerlink" title="3) Information Rights Management 関連のユーザーインターフェイスをオンにする"></a>3) Information Rights Management 関連のユーザーインターフェイスをオンにする</h3><p>今回ご利用される機能が Azure Information Protection 関連かつ、以下の設定が “有効” となっている場合には、”未構成” または “無効” に変更することで事象が解消するかご確認ください。</p><p>[ユーザーの構成]‐[ポリシー]-[管理用テンプレート]-[Microsoft Office 2016]-[アクセス制限の管理]</p><p>・”Information Rights Management 関連のユーザーインターフェイスをオフにする” : “未構成” または “無効” </p><br><p>今回の投稿は以上です。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。 &lt;/p&gt;
&lt;p&gt;今回の投稿では、Microsoft 365 Apps、Office LTSC 2021、Office 2019 のご利用時に「必要なサービスが無効になっています」と表示される現象についてご説明いたしま</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>Word 文書内の図の位置がずれて印刷される現象について</title>
    <link href="https://officesupportjp.github.io/blog/clc72h24j0001v0jo35060br5/"/>
    <id>https://officesupportjp.github.io/blog/clc72h24j0001v0jo35060br5/</id>
    <published>2022-12-28T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.308Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、図を含んだ Word 文書を印刷した際に、図の位置が編集中の表示箇所とは異なる位置で印刷される現象について説明します。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>図や図形等のオブジェクトが挿入されている Word 文書を印刷した際、編集中や印刷プレビューで確認できる図やオブジェクトの配置場所とは異なる場所に図やオブジェクトが印刷されてしまう場合があります。<br>Word 文書の構成内容に依存して発生する場合があり、また、毎回必ず位置がずれるわけではなく、正常な位置で印刷される場合もあります。</p><p>Microsoft 365 Apps の Word の他、Word 2019 や Word 2021、過去のバージョンの Word でも発生する場合があります。</p><h2 id="回避方法"><a href="#回避方法" class="headerlink" title="回避方法"></a>回避方法</h2><p>上記の現象について、Word のバックグラウンド印刷の設定を変更することで回避できる場合があります。<br>手順を以下に説明します。</p><ol><li>Word を起動します。</li><li>[ファイル] メニューより [オプション] を選択します。</li><li>「Word のオプション」 ダイアログで [詳細設定] を選択します。</li><li>[印刷] の項目内にある [バックグラウンドで印刷する] のチェックをオフにします。</li><li>[OK] を押して 「Word のオプション」 ダイアログを閉じます。</li><li>Word を終了します。</li></ol><p>この設定を行った後で Word 文書を開きなおし、印刷を行います。</p><h2 id="Word-のバックグラウンド印刷について"><a href="#Word-のバックグラウンド印刷について" class="headerlink" title="Word のバックグラウンド印刷について"></a>Word のバックグラウンド印刷について</h2><p>[バックグラウンドで印刷する] の設定は、既定ではチェックがオンになっています。<br>チェックのオン、オフそれぞれの場合の動作は以下となります。</p><p>チェックがオンの場合 :<br>印刷を実行中に Word の操作が可能となります。<br>Word のウィンドウの下部に表示されるステータス バーに印刷状況が表示されます。</p><p>チェックがオフの場合 :<br>印刷処理が完了するまで Word の操作を行えません。<br>印刷中には印刷中であることを示すメッセージが表示されます。</p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、図を含んだ Word 文書を印刷した際に、図の位置が編集中の表示箇所とは異なる位置で印刷される現象について説明します。&lt;/p&gt;
&lt;h2 id=&quot;現象&quot;&gt;&lt;a href=&quot;#現象&quot; class=&quot;heade</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>Office プロセスを自プログラム専用にする方法</title>
    <link href="https://officesupportjp.github.io/blog/cl0mfb7bc0021nwvs6zie7xtv/"/>
    <id>https://officesupportjp.github.io/blog/cl0mfb7bc0021nwvs6zie7xtv/</id>
    <published>2022-12-26T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.293Z</updated>
    
    <content type="html"><![CDATA[<hr><p><strong>2022&#x2F;12&#x2F;26 Update</strong><br>Microsoft 365 Apps での動作をベースに全体的に記事の構成を改訂しました。</p><hr><br><p>こんにちは、Office 開発 サポート チームです。</p><p><a href="https://officesupportjp.github.io/blog/cl0n10ddh000t90vsbpgv3r9l">前回の投稿</a>で Excel のプロセスを統合することについて記載しましたが、今回はこれに関連し、Office を操作するプログラムを開発するときに、プログラムから操作する Office プロセスを自分のプログラム専用にできるか、という話を記載します。<br><br></p><p>Office を操作するプログラム開発を行う際、プログラムの処理が行いやすいよう、Office アプリケーションのプロパティを変更したり、画面を非表示にすることがあります。このとき、プログラムから行うプロパティ設定や画面の状態を、ユーザーが開いている他の Office ファイルには反映させたくないといった理由から、「ユーザーが起動する Office とプログラムが起動する Office でプロセスを分けたい」というご相談を頂くことがあります。<br><br></p><p><strong><h4>実現方法</h4></strong><br><u>Excel</u><br>COM オートメーションで Office を起動してください。 (CreateObject や new、CoCreateInstance など)  </p><p><u>Word &#x2F; PowerPoint</u><br>このような動作を実現する方法はありません。</p><p><strong><h4>既定の動作</h4></strong><br>過去投稿で、Office では起動方法によって、既に起動されたプロセスがある場合には、これを利用して新しいファイルを開く動作となることをご紹介しています。  </p><p>過去の投稿)<br>タイトル : Excel 2013 からのウィンドウ管理方法変更について – シングル ドキュメント インターフェイス (SDI)<br>アドレス : <a href="https://officesupportjp.github.io/blog/cl0n10dct000i90vs4c2a3pct/">https://officesupportjp.github.io/blog/cl0n10dct000i90vs4c2a3pct/</a></p><p>タイトル : Office のプロセス インスタンス制御について<br>アドレス : <a href="https://officesupportjp.github.io/blog/cl0n10de6001p90vsaa9n6gy8/">https://officesupportjp.github.io/blog/cl0n10de6001p90vsaa9n6gy8/</a></p><br><p><strong><h4>対応方法 1</h4></strong><br>過去投稿でご案内している Excel の &#x2F;x コマンドライン スイッチや DisableMergeInstance レジストリのように、アプリ起動時に新規プロセスで起動するよう変更できる起動方法も一部用意されています。このような仕組みを用いて、後からユーザーがファイルを開くときに、起動済みのプログラム用のプロセスで開かれることを、ある程度は防ぐことができます。  </p><p>しかし、このような構成を行っても、例えば以下のような方法で 2 つめの Office ファイルを開くと、既存プロセスで開かれます。 </p><ul><li>Offie ファイルをダブル クリックする</li><li>OLE 埋め込みオブジェクトとして埋め込まれた Office ファイルを開く</li><li>他の Office オートメーションを行うプログラムが Process.Start 等の方法で Office プログラムを起動してファイルを開く</li></ul><br><p><strong><h4>対応方法 2</h4></strong><br>Excel のみは、COM オートメーションでプロセスを起動すると、以下のどちらのシナリオでも、起動した Excel プロセスが既存プロセスにマージされるのを防ぐことができます。</p><ul><li>既にプロセスが存在する状態で COM オートメーションでプロセスを起動する</li><li>COM オートメーションでプロセスを起動した後、ユーザーが新たにアプリを起動したりファイルを開く<br></li></ul><p>ただし、プログラムから起動したプロセスの Excel 画面を表示状態にしてユーザー操作可能とする場合、その画面内の操作 ([ファイル] - [開く] など) でファイルを開く場合は、そのプロセス内で開きます。<br><br></p><p><strong><h4>補足</h4></strong><br>リモートデスクトップで複数のユーザーが 1 つの端末にログインして Office を利用する場合、ユーザー間でプロセスが統合されることはありません。ただし、これを利用して意図的にログインしていないユーザーで Office を起動するような動作は、Office のサポート外の構成となります (Office のサーバーサイド オートメーションと呼ばれる構成に該当します) 。Office の起動ユーザーは、必ずログインしているユーザーで行う必要があります。  </p><p>Office のサーバーサイド オートメーションについては、公開情報や本ブログの過去投稿でご案内しています。  </p><p>タイトル : Office のサーバーサイド オートメーションについて<br>アドレス : <a href="https://support.microsoft.com/ja-jp/kb/257757">https://support.microsoft.com/ja-jp/kb/257757</a>  </p><p>タイトル : Office サーバー サイド オートメーションの危険性について<br>アドレス : <a href="https://officesupportjp.github.io/blog/cl0mfb7b7001wnwvshfp01l5u/">https://officesupportjp.github.io/blog/cl0mfb7b7001wnwvshfp01l5u/</a>  </p><br><p><strong><h4>図解</h4></strong><br>文章だけでは分かり辛い点もあるかと思いますので、以下に Excel の動作を例にどのような動作になるか、図を用いて説明します。Microsoft 365 Excel での既定の設定の場合を代表として解説します。Excel 以外のアプリでは動作が異なるため注意してください。<br><br></p><p>まず、以下に自分のプログラムが初めに Excel プロセスを起動した後、他の方法で Excel を利用する場合の動作を図解します。(ここで初めにプログラムからプロセスを起動するときは、Process.Start のように COM オートメーションではない方法での起動を想定しています。)</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image1.png">  </p><p>図 1. 自プログラム (Process.Start) → 他の方法</p><br><p>一方、&lt;対応方法 2&gt; に記載したように COM オートメーションでプロセスを起動した場合の図です。COM オートメーションで起動したプロセスには、他の操作によりファイルを開いた場合もマージされません。<br>※ ただし先述の通り、①で起動したプロセス内での操作で開くファイルは①のプロセスで開かれます。([開く] メニューからの操作や、OLE 埋め込みファイルを開く場合など)</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image4.png">  </p><p>図 2. 自プログラム (COM オートメーション) → 他の方法</p><br><p>次に、先にユーザー操作などですでに Excel プロセスを起動しているところに、自プログラムが Excel を起動した場合について図解します。</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image2.png">  </p><p>図 3. 他の方法 → 自プログラム</p><br><p>また、複数のプロセスが存在する場合の動作はさらに複雑です。以下の図に示す通り、既存プロセスに統合される場合にどちらのプロセスに統合されるかは、明確に決められておりません。</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image3.png">  </p><p>図 4. 複数プロセスが存在する場合</p><br><p>以上の通り、Excel では COM オートメーションにより、自プログラムから起動したプロセスを自身専用にすることができますが、Word や PowerPoint では実現できません。また、Excel でも設計によっては、Process.Start 等の起動方法の方が実装しやすい処理もあるかと思いますので、このような場合は、プロセスの専用化とのトレードオフが生じます。</p><p>プロセスのマージが生じるようなプログラムを設計する場合は、自ブログラムで起動する Office プロセスがユーザー操作や他のプログラムで起動されるプロセスと統合されても問題ない動作となるよう設計してください。<br><br></p><p>今回の投稿は以上です。<br><br></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;2022&amp;#x2F;12&amp;#x2F;26 Update&lt;/strong&gt;&lt;br&gt;Microsoft 365 Apps での動作をベースに全体的に記事の構成を改訂しました。&lt;/p&gt;
&lt;hr&gt;
&lt;br&gt;

&lt;p&gt;こんにちは、Office 開発 サポート</summary>
      
    
    
    
    
    <category term="SDI" scheme="https://officesupportjp.github.io/blog/tags/SDI/"/>
    
  </entry>
  
  <entry>
    <title>Word での印刷で意図しない塗りつぶしが生じる</title>
    <link href="https://officesupportjp.github.io/blog/cla7qogkl006pa0jo434segs3/"/>
    <id>https://officesupportjp.github.io/blog/cla7qogkl006pa0jo434segs3/</id>
    <published>2022-11-08T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.308Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、Word で文書を印刷した際、編集画面や印刷プレビューでの表示とは異なり、画像データの一部が塗りつぶされた状態で印刷されてしまう現象について説明します。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>Word 文書に以下のような構成の画像データを貼り付けて印刷した場合、編集時や印刷プレビューでは白もしくはグレー等の色で表示されている箇所がすべて塗りつぶされた状態で印刷されてしまう場合があります。</p><p>  ・EMF 形式のデータで構成される画像データを貼り付けている。<br>  ・EMF 形式のデータ内で、透過処理を行ったビットマップが使用されている。</p><p>例えば黒色の矩形のビットマップを透過処理にてグレーに見えるように表示させている画像データが貼られている Word 文書を印刷した時、画像データの当該箇所が黒で塗りつぶされた状態で印刷されてしまう場合があります。</p><h2 id="回避方法"><a href="#回避方法" class="headerlink" title="回避方法"></a>回避方法</h2><p>上記の要因で発生している現象につきましては、ご使用のプリンター ドライバーの設定でスプール ファイルの形式を変更可能であれば EMF スプール形式を選択いただくことで、現象を回避できる場合があります。<br>具体的な設定方法はプリンター ドライバーごとに異なりますので、各プリンター ドライバーのヘルプ等を参照くださいますようお願いいたします。</p><p>プリンター ドライバーの設定でスプール ファイルの形式を変更できないプリンターの場合は、以下のような手順で問題が発生する画像データをコピーしてビットマップとして貼り付けなおすことで現象を回避できる場合があります。なお、この手順の場合、印刷結果として出力される画像の変更前と比較して精度が低くなる可能性がございます。</p><p>ビットマップ形式で貼り付けなおす手順の例</p><ol><li>あらかじめオリジナルのファイルをコピーするなどしてバックアップしておきます。</li><li>Word で当該ファイルを開きます。</li><li>問題の生じる画像データを右クリックし、[切り取り] メニューを選択します。</li><li>Word の [ホーム] タブ内の [貼り付け] ボタン下の矢印をクリックして [貼り付けのオプション] より [形式を選択して貼り付け] を選択します。</li><li>「形式を選択して貼り付け」 ダイアログで [ビットマップ] を選択して OK を押して貼り付けます。</li><li>貼り付けられた画像データを確認し、別名を付けて保存します。</li></ol><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、Word で文書を印刷した際、編集画面や印刷プレビューでの表示とは異なり、画像データの一部が塗りつぶされた状態で印刷されてしまう現象について説明します。&lt;/p&gt;
&lt;h2 id=&quot;現象&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>Word for Mac での印刷時のカラー設定の表記差異について</title>
    <link href="https://officesupportjp.github.io/blog/cl9dgphrg0000m4vsb52864vv/"/>
    <id>https://officesupportjp.github.io/blog/cl9dgphrg0000m4vsb52864vv/</id>
    <published>2022-10-18T15:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.308Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。</p><p>この記事では、Word for Mac での印刷時のカラー設定に関して、<br>確認されている動作をご案内いたします。</p><br /><h1 id="事象詳細"><a href="#事象詳細" class="headerlink" title="事象詳細"></a>事象詳細</h1><p>Word for Mac では、ご利用のドライバ等によって、<br>以下二か所から、カラー設定を行うことが可能です。<br>※実際の見た目はご利用のプリンタ・プリンタドライバ等によって異なります。</p><ul><li>[印刷部数と印刷ページ] メニュー<br><img src="/blog/cl9dgphrg0000m4vsb52864vv/%E5%8D%B0%E5%88%B7%E9%83%A8%E6%95%B0%E3%81%A8%E5%8D%B0%E5%88%B7%E3%83%9A%E3%83%BC%E3%82%B8.png"></li></ul><br><ul><li>[プリンタの機能] メニュー<br><img src="/blog/cl9dgphrg0000m4vsb52864vv/%E3%83%97%E3%83%AA%E3%83%B3%E3%82%BF%E3%81%AE%E6%A9%9F%E8%83%BD.png"></li></ul><br><p>それぞれの設定の変更を繰り返す際、Word for Mac の動作に影響を受け、<br>[印刷部数と印刷ページ] メニューと [プリンタの機能] メニュー の印刷のカラー印刷設定の表記が、<br>一方では “白黒で印刷する設定”, 一方では “カラーで印刷する設定” のように、<br>異なるカラー印刷設定を示す場合があることが確認されております。  </p><br><p>恐れ入りますが、現時点で有効な回避方法はございません。<br>Word for Mac を再起動すると再度両方の設定が一致した状態となりますので、<br>事象発生時には Word for Mac を再起動する、<br>印刷時に期待したカラー設定で印刷されているか印刷結果を再確認するなどによって、<br>ご対応くださいますようお願いいたします。  </p><br><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;/p&gt;
&lt;p&gt;この記事では、Word for Mac での印刷時のカラー設定に関して、&lt;br&gt;確認されている動作をご案内いたします。&lt;/p&gt;
&lt;br /&gt;

&lt;h1 id=&quot;事象詳細&quot;&gt;&lt;a href=&quot;#事象詳細&quot; cla</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>インターネット入手マクロ ブロックのトラブルシュートの流れ</title>
    <link href="https://officesupportjp.github.io/blog/cl97y6c2w0000ykse7nll9auc/"/>
    <id>https://officesupportjp.github.io/blog/cl97y6c2w0000ykse7nll9auc/</id>
    <published>2022-10-14T00:00:00.000Z</published>
    <updated>2023-02-10T08:34:08.075Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2023&#x2F;02&#x2F;09 Update</strong></span><br><span style="color:#339966">- &lt;5. Web サイトの URL を確認&gt; 内のインターネット一フォルダーの動作の項番ずれを修正し、詳細を追記しました。</span><br><span style="color:#339966">- &lt;補足 3: 信頼できる署名での回避方法&gt; を追記しました。</span><br><br></p><p>こんにちは、Office サポート チームの中村です。</p><p>2022 年 4 月以降、Office 製品ではインターネットから入手したマクロが既定でブロックされるようになる変更を進めています。すでに公開情報や過去のブログ記事で、この動作変更詳細や、ブロックされるマクロを有効化する方法をご案内しています。  </p><p>ただ、今回の動作変更では、マクロがブロックされるシナリオや関連する設定が多岐に渡り、公開情報にも様々な情報が掲載されています。このため、実際にマクロがブロックされている状態において、「何が理由でブロックされているのか」、「どのような対処方法をとるべきか」の判断が難しいことから、サポートへのお問い合わせを頂くことがあります。  </p><p>本記事ではこのようなユーザーに向けて、トラブルシュートの流れをまとめました。以下の記述に従って上から順に確認していくことで、そのファイルがブロックされている理由を特定し、その場合に検討できる対応方法を確認できる記事内容となっています。  </p><p>個々の動作詳細や、対応方法の設定手順などは割愛しますので、既存記事をご参照ください。  </p><p>&lt;既存関連記事&gt;<br>A) Macros from the internet will be blocked by default in Office<br><a href="https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked</a> (日本語版 - 機械翻訳)<br><a href="https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked</a> (英語版)  </p><p>B) インターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について (MC322553)<br><a href="https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/">https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/</a>  </p><br><br><p><strong><h2>前提: 動作概要</h2></strong><br>今回の動作変更で “インターネットから入手” と判断されマクロがブロックされるシナリオは、大きく分けて以下の 3 種類があります。</p><ul><li>外部から受信したメールの添付ファイル</li><li>ファイルに Web マークがついている</li><li>ファイルの格納フォルダー パスがインターネット ゾーンである (Web サイトやファイル共有上のファイルを開く場合)</li></ul><p>以下のトラブルシュートの流れでは、これらのどの条件に該当するかを順に確認していきます。  </p><br><br><p><strong><h2>トラブルシュートの流れ</h2></strong><br>まず、以下の確認の流れをフロー図で記載します。このフローで確認の流れをイメージし、1. から順に確認を進めてください。</p><p><img src="/blog/cl97y6c2w0000ykse7nll9auc/FlowChart.png">  </p><br><br>    <p><strong><h2 id="chapter1">1. エラーメッセージの確認</h2></strong><br>今回の変更の他にも、Office にはマクロの実行をブロックする様々な設定があります。<br>今回の動作変更によってブロックされている場合は以下のメッセージが表示されますので、まずはメッセージ内容がこの通りであるかを確認します。<br><img src="/blog/cl97y6c2w0000ykse7nll9auc/BlockMessage.png">  </p><p><u>次のステップ</u><br>メッセージ内容に相違がなければ、<a href="#chapter2">&lt;2. メール添付ファイルかの確認&gt;</a> に進みます。<br>異なるメッセージの場合は、メッセージ内容に応じた設定などの確認が必要ですので、この記事では割愛します。</p><br><br><p><strong><h2 id="chapter2">2. メール添付ファイルかの確認</h2></strong><br>Outlook アプリで受信した社外からのメールに添付された Office ファイルを、Outlook 上で添付ファイルのアイコンをダブル クリックしたり、Outlook の添付ファイル横の矢印で開いたメニューの [開く] から開いている場合は、【外部から受信したメールの添付ファイルであること】が理由でマクロがブロックされています。  </p><p>&lt;対処方法&gt;<br>一旦添付ファイルをマシンに保存してからファイルを開きます。<br>ただしその際に、さらに 3. 以降の理由でブロックされることが想定されます。保存したファイルがブロックされる場合は、3. 以降の確認を続けて行ってください。</p><p><u>次のステップ</u><br>このような操作シナリオではない場合は、<a href="#chapter3">&lt;3. Web マーク有無の確認&gt;</a> に進みます。</p><br><br><p><strong><h2 id="chapter3">3. Web マーク有無の確認</h2></strong><br>現在開いているファイルを、どこかに保存して開いている場合は、そのファイルを右クリックして [プロパティ] を確認します。<br>このとき、以下の赤枠のメッセージが表示される場合は、【ファイルに Web マークが付与されていること】が理由でマクロがブロックされています。(Web マークは、インターネット サイトからダウンロードしたファイルや、外部からのメール添付ファイルを保存した場合に付与されます。)<br><img src="/blog/cl97y6c2w0000ykse7nll9auc/WebMark.png">  </p><p>&lt;対処方法&gt;<br><u>1) Web マークを削除する</u><br>上図の [許可する] にチェックを入れて [OK] をクリックし、Web マークを削除します。<br>ただし、この理由に加えて、<a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> のブロック理由にも当てはまる場合があります。Web マークを削除してもマクロがブロックされる場合は、続けて <a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> について確認してください。  </p><p>※ 注<br>プロパティに上記のセキュリティ メッセージが表示される場合でも、厳密には Web マークには該当せずブロック対象とならない場合があります。この動作については、冒頭の公開情報 A) の「<a href="https://learn.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked#mark-of-the-web-and-zones">Web とゾーンのマーク</a>」を参照してください。このような細かな動作はありますが、マクロを利用したい場合は、「プロパティにセキュリティ メッセージが表示されていたら削除する」という運用にすると、シンプルな対応が可能です。  </p><br><br><p><u>2) ファイルを信頼されたフォルダーに格納する</u><br>以下のいずれかの方法で、「このフォルダーに格納したファイルは安全とみなす」という “信頼できるフォルダー” の設定が可能です。<br>任意の場所を信頼できるフォルダーとして設定したら、そこに Web マークがついたままのファイルを格納します。この場合は、ファイルに Web マークがあることより「その場所が安全である」ということが優先されるため、マクロを有効にできます。</p><p>  a. Office の [信頼できる場所] に登録する<br>  手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-3">3) 特定のフォルダーのファイルでマクロを有効にする方法</a>」を参照してください。  </p><p>  b. インターネット オプションの [信頼済みサイト] に登録する (ファイルの保存フォルダーがネットワーク共有の場合のみ)<br>  手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-4">4) Web・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</a>」を参照してください。  </p><p>  ※ a. &#x2F; b. の対処方法の違いは、後述の「<a href="#chapterEx1">補足1: フォルダーや URL を信頼する対処方法の違い</a>」をご参照ください。  </p><p><u>次のステップ</u><br>プロパティにセキュリティ メッセージが表示されていない場合は、ファイルの保存場所に応じて以下の手順に進みます。(ファイルが元々どこにあったかではなく、今開いているファイル自体が存在する場所です。)<br>ファイルをネットワーク共有に保存している場合 → <a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> に進みます。<br>Web サイトから直接ファイルを開いている場合 → <a href="#chapter5">&lt;5. Web サイトの URL を確認&gt;</a> に進みます。  </p><br><br>  <p><strong><h2 id="chapter4">4. ファイルの格納フォルダーパスの確認</h2></strong><br>ファイルに Web マークがついていなくても、ファイルの格納場所が「インターネット ゾーン」と判断される場合は、安全でない場所としてマクロがブロックされます。<br>インターネット ゾーンの判断はファイル格納パスによって行われ、一般的に以下の場合はインターネット ゾーンとなります。  </p><ul><li>IP アドレスで接続しているネットワーク共有 (例: \\111.111.111.111\share)</li><li>FQDN で接続しているネットワーク共有 (例: \\server.domain.com\share)<br>※ ネットワーク ドライブの場合、ネットワーク ドライブ割り当て時に上記のようなパスを使用すると同様にインターネット ゾーンとなります。</li></ul><p>この要因でブロックされているかを確認するため、ファイルをローカルにコピーして開いてください。(企業環境では、ユーザー プロファイルのフォルダーがフォルダー リダイレクト設定でサーバー上にリダイレクトされている場合があるため、C:¥work のように C ドライブ直下にフォルダーを作成してここにファイルを格納して確認することをお勧めします。)  </p><p>ローカルにコピーするとブロックされない場合は、【ファイル格納パス】が理由でマクロがブロックされています。  </p><p>&lt;対処方法&gt;<br><u>1) サーバー名のみで接続する</u><br>ネットワーク共有がクライアントと同じドメイン内にある場合は、「\\server\share」のようにサーバー名のみで接続します。この場合は、安全な場所と判断されるため、ファイル格納フォルダーパスによるブロックは行われません。</p><p><u>2) ファイルをローカルにコピーして開く</u><br>ファイルをローカル フォルダーにコピーしてから開きます。</p><p><u>3) Office の [信頼できる場所] に登録する (FQDN の場合のみ利用可能)</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-3">3) 特定のフォルダーのファイルでマクロを有効にする方法</a>」を参照してください。</p><p><u>4) インターネット オプションの [信頼済みサイト] に登録する</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-4">4) Web・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</a>」を参照してください。</p><p><u>5)インターネット オプションの [ローカル イントラネット] に登録する</u><br>手順は 4) とほぼ同様です。手順 3. で [ローカル イントラネット] を選んで、[詳細設定] からフォルダー パスを追加できます。  </p><p>※3) ～ 5) の対処方法の違いは、後述の「<a href="#chapterEx1">補足1: フォルダーや URL を信頼する対処方法の違い</a>」をご参照ください。  </p><br><br><p><strong><h2 id="chapter5">5. Web サイトの URL を確認</h2></strong><br>Web サイトからファイルを開いている場合、その Web サイトがインターネット ゾーンの場合はマクロがブロックされます。<br>一般的に以下の場合はインターネット ゾーンとなります。  </p><ul><li>IP アドレスで接続 (例: <code>https://111.111.111.111</code>)</li><li>FQDN で接続(例: <code>https://server.domain.com</code>)</li></ul><p>この要因でブロックされているかを確認するため、一旦ファイルをローカルにダウンロードして <a href="#chapter3">&lt;3. Web マークの確認&gt;</a> を行ってください。<br>ダウンロードしたファイルに Web マークが付与されている場合は、ダウンロード元の Web サイトがインターネット ゾーンと判断されています。この場合、Web サイトから直接開くときは【ファイルをホストしている Web サイトの URL】が理由でマクロがブロックされています。</p><p>&lt;対処方法&gt;<br><u>1) サーバー名のみで接続する</u><br>Web サーバーがクライアントと同じドメイン内にある場合は、「<code>https://server</code>」のようにサーバー名のみで接続します。この場合は、通常イントラネットと判断されるため、ファイル格納フォルダーパスによるブロックは行われません。  </p><p><u>2) ファイルをダウンロードして開く</u><br>ファイルを開くときの確認メッセージで [保存] を選び、ローカルにダウンロードしてから開きます。<br>ただし、ダウンロードしたファイルが今度は <a href="#chapter3">&lt;3. Web マークの確認&gt;</a> や <a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> の理由でブロックされる場合があるため、ダウンロードしたファイルについて、改めてこれらの確認を行ってください。  </p><p><u>3) Office の [信頼できる場所] に登録する (FQDN の場合のみ)</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-3">3) 特定のフォルダーのファイルでマクロを有効にする方法</a>」を参照してください。  </p><p><u>4) インターネット オプションの [信頼済みサイト] に登録する</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-4">4) Web・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</a>」を参照してください。  </p><p><u>5) インターネット オプションの [ローカル イントラネット] に登録する</u><br>手順は 4) とほぼ同様です。手順 3. で [ローカル イントラネット] を選んで、[詳細設定] からフォルダー パスを追加できます。  </p><p>※3) ～ 5) の対処方法の違いは、後述の「補足 1: フォルダーや URL を信頼する対処方法の違い」をご参照ください。</p><p><strong>注意</strong><br>Microsoft Edge の IE モードや、Internet Explorer で Web サイトを開いている場合は、Web サイトの応答によっては (後述の <a href="#ResponseHeader">&lt;※ 応答ヘッダーの動作&gt;</a> 参照) [インターネット一時ファイル] 格納フォルダーにファイルをダウンロードして開きます。このフォルダーの場所は、[インターネット オプション] – [全般] タブ – [設定] の以下赤枠より確認できます。  </p><p><img src="/blog/cl97y6c2w0000ykse7nll9auc/IETempFolder.png">  </p><p>このフォルダーに一時保存されて開くシナリオは、先述の 1) および 3) ～ 5) の対応方法では回避できません。以下のいずれかの方法で対処してください。</p><ul><li>“2) ファイルをダウンロードして開く” で対処する</li><li>Web サイト側で、応答を変更した上で 1) &#x2F; 3) &#x2F; 4) &#x2F; 5) のいずれかを実施する (後述の <a href="#ResponseHeader">&lt;※ 応答ヘッダーの動作&gt;</a> 参照)</li></ul><p>このフォルダーからファイルが開かれているかどうかは、Office の [ファイル] タブ - [情報] メニューから確認できます。[パスのコピー] をクリックし、その後テキスト エディタなどに貼り付けて、現在開いているファイルの格納フォルダーを確認します。  </p><p><img src="/blog/cl97y6c2w0000ykse7nll9auc/FilePath.png">  </p><br><p><strong><p id="ResponseHeader">※ 応答ヘッダーの動作</p></strong><br>Web サイトの応答によって、開かれる Office ファイルのパスが異なります。マクロ ブロックを避けるには、レスポンス ヘッダーを Content-Disposition:Inline に設定してください。</p><p>Content-Disposition:Attachment の場合:<br>インターネット一時フォルダーにテンポラリ ファイルとして保存され、Office からはこのテンポラリ ファイルを開く流れとなります。したがって、ファイル パスがインターネット一時フォルダーであるとみなされ、マクロがブロックされます。</p><p>Content-Disposition:Inline の場合:<br>Office からは、Web サイト上のファイルを開いている扱いとなり、ファイル パスは Web サイトの URL となります。したがって、1) の方法でホスト名のみで接続するか、3) ～ 5) の方法で Web サイトのパスを信頼する・社内ネットワークとして扱うことで、マクロはブロックされません。</p><br><br><p><strong><h2 id="chapterEx1">補足 1: フォルダーや URL を信頼する対処方法の違い</h2></strong><br>対処方法として記載した各フォルダーを信頼する方法について、動作の違いを以下にまとめます。これを参考に、どの方法を採用するかをご検討ください。</p><table><thead><tr><th></th><th>Office の  信頼できる場所</th><th>インターネット オプションの [信頼済みサイト]</th><th>インターネット オプションの [ローカル イントラネット]</th></tr></thead><tbody><tr><td>マクロ有効化の動作</td><td>(マクロのセキュリティ オプションが既定の場合)自動有効化</td><td>一旦無効な状態で開き、警告バーを表示 ([コンテンツの有効化] をクリックして有効化可能)</td><td>一旦無効な状態で開き、警告バーを表示 ([コンテンツの有効化] をクリックして有効化可能)</td></tr><tr><td>Web マークがついたファイルのマクロ有効化の動作</td><td>自動有効化</td><td>一旦無効な状態で開き、警告バーを表示 ([コンテンツの有効化] をクリックして有効化可能)</td><td><span style="color:#ff0000"><strong>ブロック</strong></span></td></tr><tr><td>設定単位</td><td>任意のフォルダー階層で指定可能</td><td>サーバーやホスト単位</td><td>サーバーやホスト単位</td></tr><tr><td>サブ フォルダーを含むか</td><td>選択可能 (フォルダーを登録するときに個別に指定)</td><td>含む</td><td>含む</td></tr><tr><td>IP アドレスでの指定</td><td><span style="color:#ff0000"><strong>不可</strong></span></td><td>可能</td><td>可能</td></tr><tr><td>適用範囲</td><td>Office のみ</td><td>ブラウザーでの Web サイト アクセスを含む当該ユーザーのネットワーク通信全般でゾーンに従ったセキュリティ レベルになる</td><td>ブラウザーでの Web サイト アクセスを含む当該ユーザーのネットワーク通信全般でゾーンに従ったセキュリティ レベルになる</td></tr></tbody></table><br><br>  <p><strong><h2 id="chapterEx2">補足 2: ゾーン判定の詳細な仕組み</h2></strong><br>上記の説明では、ネットワーク共有や Web サイトのゾーン判定について最も基本的な動作を説明しましたが、インターネット オプションの設定によっては、異なるゾーンと判断される場合もあります。ゾーン判定の詳細動作は、以下のブラウザー サポート チームのブログ記事をご参考としてください。</p><p>IE のセキュリティ ゾーンについて<br><a href="https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/IE-SecurityZones/">https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/IE-SecurityZones/</a>  </p><br><p><strong><h2 id="chapterEx3">補足 3: 信頼できる署名での回避方法</h2></strong><br>開発者向け手順のため上記の流れでは記載していませんが、他の対処方法として、対象ファイルの VBA マクロに信頼できる発行元の証明書でデジタル署名を行うことでも、マクロ ブロックを避けることができます。</p><p>この対応には、以下 2 つの作業が必要になります。</p><ul><li>マクロをブロックしたくない VBA マクロにデジタル署名を付与する</li><li>署名に使用する証明書をマクロを実行したいユーザー環境の証明書ストア [信頼された発行元] に、および、そのルート証明書を [信頼されたルート証明機関] に登録する</li></ul><p>VBA マクロへのデジタル署名の付与手順は、先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-Sign">信頼できる発行元のデジタル署名を追加する方法</a>」でご案内しています。<br>使用する証明書の発行方法や、証明書ストアへの登録方法は Windows 上でのデジタル署名全般の動作となるため、本ブログでは割愛しています。<br><br></p><p>今回の投稿は以上です。</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2023&amp;#x2F;02&amp;#x2F;09 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color:#339966&quot;&gt;- &amp;lt;5. Web サイトの URL を確認&amp;</summary>
      
    
    
    
    
    <category term="VBA マクロ" scheme="https://officesupportjp.github.io/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/"/>
    
  </entry>
  
  <entry>
    <title>PowerPoint でのカラー印刷について</title>
    <link href="https://officesupportjp.github.io/blog/cl8ntfhk30000246y446z0u65/"/>
    <id>https://officesupportjp.github.io/blog/cl8ntfhk30000246y446z0u65/</id>
    <published>2022-09-30T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.308Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、PowerPoint でカラー印刷に対応したプリンターに印刷をする際の色の設定について説明します。</p><h2 id="事象の詳細"><a href="#事象の詳細" class="headerlink" title="事象の詳細"></a>事象の詳細</h2><p>PowerPoint では印刷時に “カラー”、”グレースケール”、”単純白黒” のいずれかの設定を選んで印刷することができます。</p><p><img src="/blog/cl8ntfhk30000246y446z0u65/image1.png"></p><p>PowerPoint の既定の設定では、プリンター ドライバーの既定の設定よりも PowerPoint で印刷時に選択した設定が優先されて印刷されます。<br>プリンターから印刷された印刷結果が、PowerPoint で印刷時に選択した設定ではなく、プリンター ドライバーの既定の設定となって印刷される場合、以下のレジストリ値が設定されている可能性があります。<br><br><br><br></p><p>キー</p><p>HKEY_CURRENT_USER\Software\Microsoft\Office&lt;以下参照&gt;\PowerPoint</p><p>Office 2013 の場合 : 15.0<br>Office 2016、2019、2021、Microsoft 365 Apps の場合 : 16.0</p><p>値の名前 : IgnoreDevModeColor<br>値の種類 : REG_DWORD<br>設定されている値 : 1</p><p>レジストリ値が 1 でセットされている場合の動作としては、以下のようになります。</p><p>プリンターの既定設定 : カラー<br>PowerPoint の設定 : 単純白黒</p><p>印刷結果 : カラー</p><p>なお、本レジストリ値は、Office 製品をインストールした既定の状態では設定されていません。</p><p>PowerPoint からの印刷で色の設定が期待通りに動作しない場合、こちらの設定がされていないかご確認をお願いいたします。</p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、PowerPoint でカラー印刷に対応したプリンターに印刷をする際の色の設定について説明します。&lt;/p&gt;
&lt;h2 id=&quot;事象の詳細&quot;&gt;&lt;a href=&quot;#事象の詳細&quot; class=&quot;headerlin</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>ボリュームライセンス版 Visio 2019、Project 2019 または Visio 2021、Project 2021 と Microsoft 365 Apps を共存インストールする方法について</title>
    <link href="https://officesupportjp.github.io/blog/cl8lbafua0000vg6yhn5ahyju/"/>
    <id>https://officesupportjp.github.io/blog/cl8lbafua0000vg6yhn5ahyju/</id>
    <published>2022-09-13T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.327Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>本記事では、ボリュームライセンス版の Visio 2019 &#x2F; Project 2019 または Visio 2021 &#x2F; Project 2021 と Microsoft 365 Apps を共存インストールする方法についてご案内します。</p><p>ボリュームライセンス版の Visio 2019 &#x2F; Project 2019 または Visio 2021 &#x2F; Project 2021 と Microsoft 365 Apps は、共存してインストールすることが可能です。</p><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a><span style="color:#0000ff"><strong>前提条件</strong></span></h3><p>共存インストールのためにはバージョンによって以下の前提条件があるため、ご注意ください。</p><ul><li><p>Visio 2019 &#x2F; Project 2019 を共存インストールする場合<br>Microsoft 365 Apps バージョン 1808 以上を使用している必要があります。 </p></li><li><p>Visio 2021 &#x2F; Project 2021 を共存インストールする場合<br>Microsoft 365 Apps バージョン 2108 以上を使用している必要があります。</p></li></ul><p>また、同一端末に共存してインストール可能なクイック実行形式の Office 製品は、同一のチャネル、バージョン (ビルド)、bit である必要があります。<br>Microsoft 365 Apps と Visio &#x2F; Project を異なるバージョンとする等、複数のチャネルやビルド バージョンを同一端末にインストールすることはできません。</p><p>以下にインストールの詳細手順をご案内いたします。</p><h3 id="インストール手順"><a href="#インストール手順" class="headerlink" title="インストール手順"></a><span style="color:#0000ff"><strong>インストール手順</strong></span></h3><p>※インストール手順は Visio 2019 をインストールする手順を示します。 Visio 2021, Project 2019 &#x2F; Project 2021も同様の手順でインストールすることができます。</p><ol><li><p>現在インストールされている M365Apps の更新チャネル、ビルドを確認します。<br>  いずれかの Microsoft 365 Apps のソフトウェアを起動し、[ファイル] - [アカウント] の順にクリックし、[Wordのバージョン情報] (Word の場合) 欄に表示されている更新チャネル、ビルドを記録してください。</p><p> 例</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">バージョン 2018(ビルド 14326.21080 クイック実行)</span><br><span class="line">半期エンタープライズ チャネル</span><br></pre></td></tr></table></figure><p> 更新チャネル：半期エンタープライズ チャネル (SemiAnnual)<br> ビルド：14326.21080</p></li><li><p>インストール関連ファイルを保存するためのフォルダを用意します。<br> ※ この手順では “C:\Visio2019” を使用する例でご説明します。</p></li><li><p>以下のサイトの [Download] から、Office 展開ツールを入手して、手順 2 で作成したフォルダに保存します。<br>  Office 展開ツール (ODT)<br>  <a href="https://www.microsoft.com/en-us/download/details.aspx?id=49117">https://www.microsoft.com/en-us/download/details.aspx?id=49117</a><br>  ファイル名 [officedeploymenttool_xxxxx-xxxxx.exe]</p></li><li><p>ダウンロードしたファイルをダブルクリックします。<br>  マイクロソフト ソフトウェア ライセンス条項の確認画面が表示されるので、チェックボックスにチェックを付け、[Continue] をクリックします。その後、手順 2 で作成したフォルダを指定してファイルを展開します。<br>  ※ この手順では、”C:\Visio2019” フォルダに保存する例でご説明します。</p><ul><li>展開後に生成されるファイル<ul><li>configuration-Office365-x64.xml</li><li>configuration-Office365-x86.xml</li><li>configuration-Office2019Enterprise.xml</li><li>configuration-Office2021Enterprise.xml</li><li>setup.exe</li></ul></li></ul></li><li><p>ダウンロード用構成ファイルを作成します。</p><p> ※この手順はツールを使った構成ファイル作成方法もございます。後述の「Officeカスタマイズツールを使った XML ファイルの作成」をご参照ください。</p><p> 展開した上記ファイルのうち、いずれかの XML ファイルをメモ帳で開き、全ての内容を削除した後、以下のサンプル コードの &lt;Configuration&gt; から &lt;&#x2F;Configuration&gt;までをコピーして、貼り付けます。編集したファイルを、任意のファイル名で .xml ファイルとして保存します。 Channelの要素は手順 1 で取得したチャネル、Versionの要素は “16.0.” + (手順 1 で取得したビルド)となります。</p><p> ※ この手順では、”Visio-configuration.xml” という名前で保存する例でご説明します。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Configuration&gt;</span><br><span class="line">  &lt;Add SourcePath=&quot;C:\Visio2019&quot; OfficeClientEdition=&quot;64&quot; Channel=&quot;SemiAnnual&quot; Version=&quot;16.0.14326.21080&quot;&gt;</span><br><span class="line">    &lt;Product ID=&quot;VisioPro2019Volume&quot; PIDKEY=&quot;9BGNQ-K37YR-RQHF2-38RQ3-7VCBB&quot;&gt;</span><br><span class="line">      &lt;Language ID=&quot;ja-jp&quot; /&gt;</span><br><span class="line">    &lt;/Product&gt;</span><br><span class="line">  &lt;/Add&gt;</span><br><span class="line">&lt;/Configuration&gt;</span><br></pre></td></tr></table></figure><p> ※ 冒頭の「Add SourcePath&#x3D;」以下のパスには、手順 3 で指定した setup.exe の保存パスを指定します。<br> ※ 上記のサンプルは、Visio Visio 2019 の 64 ビット版、半期エンタープライズ チャネル、日本語版をダウンロードするための構成ファイルとなります。<br> ご利用の Visio&#x2F;Project のエディションによって、以下のように Product ID と PIDKEY を変更してください。</p><table><thead><tr><th>Product</th><th>ID</th><th>PIDKEY</th></tr></thead><tbody><tr><td>Visio Standard 2019</td><td>VisioStd2019Volume</td><td>7TQNQ-K3YQQ-3PFH7-CCPPM-X4VQ2</td></tr><tr><td>Visio Professional 2019</td><td>VisioPro2019Volume</td><td>9BGNQ-K37YR-RQHF2-38RQ3-7VCBB</td></tr><tr><td>Project Standard 2019</td><td>ProjectStd2019Volume</td><td>C4F7P-NCP8C-6CQPT-MQHV9-JXD2M</td></tr><tr><td>Project Professional 2019</td><td>ProjectPro2019Volume</td><td>B4NPR-3FKK7-T2MBV-FRQ4W-PKD2B</td></tr><tr><td>Visio Standard 2021</td><td>VisioStd2021Volume</td><td>MJVNY-BYWPY-CWV6J-2RKRT-4M8QG</td></tr><tr><td>Visio Professional 2021</td><td>VisioPro2021Volume</td><td>KNH8D-FGHT4-T8RK3-CTDYJ-K2HT4</td></tr><tr><td>Project Standard 2021</td><td>ProjectStd2021Volume</td><td>J2JDC-NJCYY-9RGQ4-YXWMH-T3D4T</td></tr><tr><td>Project Professional 2021</td><td>ProjectPro2021Volume</td><td>FTNWT-C6WBT-8HMGF-K9PRX-QV9H8</td></tr></tbody></table><p> ※ 上記 PIDKEY は KMS 認証を行うための GVLK となります。MAK 認証を行う場合、個別の専用プロダクトキーを入力ください。詳細は後述の「ライセンス認証について」の b) に記載されております。</p><p> KMS および Office、Project、Visio の Active Directory によるライセンス認証用の GVLKs<br> <a href="https://learn.microsoft.com/ja-jp/DeployOffice/vlactivation/gvlks?redirectedfrom=MSDN">https://learn.microsoft.com/ja-jp/DeployOffice/vlactivation/gvlks?redirectedfrom=MSDN</a></p><p> 下記公開情報をご参照のうえ、適宜 XML ファイルの要素を変更してください。<br> Office 展開ツールのオプションの構成<br> <a href="https://docs.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options">https://docs.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options</a></p></li><li><p>以下のコマンドを実行して、インストール実行モジュールのダウンロードを行います。<br>  [FilePath] 部分には、setup.exe の保存パス、および、Visio-configuration.xml の保存パスをそれぞれ指定します。 </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; [FilePath]setup.exe /download [FilePath]Visio-configuration.xml</span><br><span class="line">例 : &gt; C:\Visio2016\setup.exe /download C:\Visio2019\Visio-configuration.xml</span><br></pre></td></tr></table></figure></li><li><p>コマンド実行後、プロンプトが戻ってくるまで少し待ちます。(完了時にメッセージは表示されません。)<br> ダウンロード完了後、「Add SourcePath&#x3D;」で指定したフォルダ内に “Office” フォルダが作成され、インストール モジュールが保存されます。</p></li><li><p>ダウンロード作業とインストール作業を行う PC が別である場合、ダウンロード完了後の C:\Visio2019 フォルダの内容をすべてコピーし、インストールを行う PC にも C:\Visio2019 フォルダを作成して貼り付けてください。</p></li><li><p>以下のコマンドを実行して、ダウンロードしたモジュールからインストールを実行します。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; [FilePath]setup.exe /configure [FilePath]Visio-configuration.xml</span><br><span class="line">例 : &gt; C:\Visio2019\setup.exe /configure C:\Visio2019\Visio-configuration.xml</span><br></pre></td></tr></table></figure></li><li><p>インストールが完了したら、Visio 2019のライセンス認証を行います。<br>ライセンス認証するために、Office ソフトウェア保護プラットフォーム スクリプト (ospp.vbs) を使います。<br>64 ビット版では Program Files\Microsoft Office\Office16 フォルダに、32 ビット版では Program Files (x86)\Microsoft Office\Office16 フォルダにあります。以下が認証するためのコマンドになります。</p><p>ospp.vbsのあるフォルダに移動します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Program Files\Microsoft Office\Office16</span><br></pre></td></tr></table></figure><p>ospp.vbsを実行して、ライセンス認証を行います。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript ospp.vbs /act</span><br></pre></td></tr></table></figure><p>実行結果として、VisioPro2019 について Product activation successful と表示されると認証成功となります。<br>※ ライセンス認証の詳細に関しましては、後述の「ライセンス認証について」をご参照ください。</p></li></ol><h3 id="Officeカスタマイズツールを使った-XML-ファイルの作成"><a href="#Officeカスタマイズツールを使った-XML-ファイルの作成" class="headerlink" title="Officeカスタマイズツールを使った XML ファイルの作成"></a><span style="color:#0000ff"><strong>Officeカスタマイズツールを使った XML ファイルの作成</strong></span></h3><ol><li><p>Office カスタマイズ ツールにアクセス</p><p> Office カスタマイズ ツール ( <a href="https://config.office.com/">https://config.office.com</a> )にアクセスしてください。</p></li><li><p>展開の設定</p><p> 構成する製品、言語、およびアプリケーションの基本設定を選択します。 </p><p> 今回のインストール手順では以下の設定項目が最低限必要となります。その他の項目は適宜設定を追加してください。</p><ul><li><p>製品とリソース</p><p>  アーキテクチャで対応するビットを選択、製品は今回のインストールする Visio &#x2F; Project を選択してください。</p><p>  ※各構成ファイルでデプロイできるアーキテクチャは 1 つだけです。</p><p>  更新チャネルでは手順 1 で取得したチャネルとバージョンを選択してください。<br>  ※ Office 2019 永続エンタープライズ チャネル &#x2F; Office LTSC 2021 永続エンタープライズ チャネル が選択されていると、Microsoft 365 Apps と共存できません。 </p></li><li><p>言語</p><p>  主言語を選択してください。オペレーティング システムに合わせる を選択すると、クライアント デバイスで使用されているのと同じ言語が自動的にインストールされます。</p></li><li><p>インストール</p><p>  Office ファイルをクラウドから直接インストールするか、ネットワーク上のローカル ソースから直接インストールするかを選択します。今回のインストール手順では [インストールのオプション] - [ローカル ソース] よりソース パスに C:\Visio2019 と入力してください。</p></li><li><p>ライセンスとアクティブ化</p><p>  プロダクト キーは試用する認証方式を選択してください。MAK 認証を選択した場合は適切なライセンスキーを入力してください。</p></li></ul></li><li><p>構成ファイルのエクスポート</p><p> 右側のウィンドウで構成済みの設定を確認し、[エクスポート] を選択してください。<br> 使用許諾契約書の条項に同意し、構成ファイルに名前を付けてから、[ エクスポート ] を選択してダウンロードしてください。今回の手順では Visio-configuration と名前を設定します。</p></li><li><p>構成ファイルの配置</p><p> ダウンロードしたファイルを C:\Visio2019 に移動し、インストール手順 6 よりインストールを進めてください。</p></li></ol><p>Office カスタマイズ ツールの概要</p><p><a href="https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-customization-tool">https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-customization-tool</a></p><h3 id="ライセンス認証について"><a href="#ライセンス認証について" class="headerlink" title="ライセンス認証について"></a><span style="color:#0000ff"><strong>ライセンス認証について</strong></span></h3><p>ボリュームライセンス版の Office では、KMS 認証や MAK 認証などによりライセンス認証が実施可能です。<br>KMS 認証を行う場合、事前に KMS ホストを構築し、認証を行える環境を構築いただく必要がございます。<br>それぞれの詳細につきましては、以下をご参照ください。</p><p><span style="color:#0000ff"><strong>a) KMS ホストを構築し、ライセンス認証を行う手順</strong></span></p><p>通常のボリュームライセンス用の KMS ホストを構築することで、ライセンス認証が実施可能です。<br>KMS でのライセンス認証を行うためには、Office 2019 を利用する 5 台以上のクライアントが存在する必要があります。<br>ボリューム ライセンス版の Office のライセンス認証の KMS ホストの構築や、ライセンス認証の詳細手順については、以下をご参照ください。</p><p>Office のボリューム ライセンス認証の概要 </p><p><a href="https://docs.microsoft.com/ja-jp/deployoffice/vlactivation/plan-volume-activation-of-office">https://docs.microsoft.com/ja-jp/deployoffice/vlactivation/plan-volume-activation-of-office</a></p><p>ボリューム ライセンス版の Office のライセンス認証を行うように KMS ホスト コンピューターを構成する </p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/configure-a-kms-host-computer-for-office">https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/configure-a-kms-host-computer-for-office</a></p><p><span style="color:#0000ff"><strong>b) MAK を使用したコンピューターのライセンス認証手順</strong></span></p><p>Office 展開ツールで使用される configuration.xml ファイルの PIDKEY を指定し、認証を行います。<br>今回のインストールの手順ではサンプル XML ファイルの 「PIDKY&#x3D;　」 に KMS キーではなく MAK キーを入力してください。<br>詳細手順については、以下をご参照ください。</p><p>MAK を使用してボリューム ライセンスバージョンの Office をアクティブ化する</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/activate-office-by-using-mak">https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/activate-office-by-using-mak</a></p><p>Office LTSC 2021 を展開する</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/ltsc2021/deploy">https://docs.microsoft.com/ja-jp/DeployOffice/ltsc2021/deploy</a></p><p>Office 2019 を展開する (IT 担当者向け)</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/office2019/deploy">https://docs.microsoft.com/ja-jp/DeployOffice/office2019/deploy</a></p><h3 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a><span style="color:#0000ff"><strong>参考情報</strong></span></h3><p>今回ご案内した詳細につきましては、以下の公開情報に記載しております。</p><p>同一コンピューター上に異なるバージョンの Office、Visio、Project をインストールするためのサポート対象シナリオ  </p><p><a href="https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx">https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx</a></p><p>Office 展開ツール を利用する際の xml ファイル、および、コマンドの書式については、以下の技術情報をご覧ください。<br>概要: Office 展開ツール  </p><p><a href="https://technet.microsoft.com/ja-jp/library/jj219422.aspx">https://technet.microsoft.com/ja-jp/library/jj219422.aspx</a></p><p>Visio の展開ガイド</p><p><a href="https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-visio">https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-visio</a></p><p>Project の展開ガイド</p><p><a href="https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-project">https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-project</a></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;本記事では、ボリュームライセンス版の Visio 2019 &amp;#x2F; Project 2019 または Visio 2021 &amp;#x2F; Project 2021 と Microsoft 365 Apps を共存</summary>
      
    
    
    
    
    <category term="インストール" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/"/>
    
  </entry>
  
  <entry>
    <title>暗号化された Office ファイルを保護ビューで開き、保護ビューが閉じた後、クライアントの %localappdata% フォルダ配下 Packages フォルダに oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダが残存する</title>
    <link href="https://officesupportjp.github.io/blog/cl7pvphjn0000a46ygd3m4nro/"/>
    <id>https://officesupportjp.github.io/blog/cl7pvphjn0000a46ygd3m4nro/</id>
    <published>2022-09-06T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.327Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、暗号化された Office ファイル (*) を保護ビューで開き、保護ビューが閉じた後、<br>クライアントのローカル フォルダ %localappdata%\Packages 配下に oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ (x は任意の英数字) が残存する事象について説明します。  </p><h1 id="事象の詳細"><a href="#事象の詳細" class="headerlink" title="事象の詳細"></a>事象の詳細</h1><p>Office アプリでは、暗号化された Office ファイルであるかどうかに関わらず、ファイルを保護ビューで開く場合、以下のフォルダを作成します。  </p><p>%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ<br>(例: C:\Users&lt;ユーザー名&gt;\AppData\Local\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx)  </p><p>この oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ配下に、元のファイルや元のファイルに紐づく情報を一時ファイルとしてコピー&#x2F;作成した上で、保護ビューでファイルを読み取り専用で開きます。  </p><p>この動作は、ユーザーが明示的に [編集を有効にする] を実行しない限り、リスクを軽減しながらファイルの内容を確認できるセキュリティを考慮した実装です。  </p><p>なお、Office ファイルが暗号化されていない場合は、[編集を有効にする] をクリックしたタイミングで、%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダは削除されます。  </p><p>一方、暗号化された Office ファイル (*) の場合、[編集を有効にする] をクリックしても、%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダは削除されず、残ります。  </p><p><img src="/blog/cl7pvphjn0000a46ygd3m4nro/image1.png"><br><img src="/blog/cl7pvphjn0000a46ygd3m4nro/image2.png">  </p><p>(*) 暗号化された Office ファイルとは、以下のような操作などで暗号化されたファイルを指します。<br>・Azure Information Protection 統合ラベル付けクライアントや Office アプリで秘密度ラベルを設定したファイル<br>・Office アプリの [ファイルの保護] - [アクセスの制限] からアクセス制限ありを設定したファイル<br>・SharePoint の Information Rights Management (IRM) を有効に設定したライブラリからダウンロードされたファイル  </p><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>この問題は、Microsoft 365 Apps にて確認されており、現在、製品開発部門で調査中です。<br>新たな情報が確認された場合は、この記事に追記する形で公開していく予定です。</p><h1 id="回避案"><a href="#回避案" class="headerlink" title="回避案"></a>回避案</h1><p>エクスプローラーを起動し、残っている %localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ<br>(例: C:\Users&lt;ユーザー名&gt;\AppData\Local\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx) を選択し、手動で削除してください。  </p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、暗号化された Office ファイル (*) を保護ビューで開き、保護ビューが閉じた後、&lt;br&gt;クライアントのローカル フォルダ %localappdata%\Packages 配下に oice_xx_x</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>WSFC 継続的可用性 (CA) が有効な共有フォルダーから Office ファイルが開けない</title>
    <link href="https://officesupportjp.github.io/blog/cl6q3dt1k0000ks3pemokg0de/"/>
    <id>https://officesupportjp.github.io/blog/cl6q3dt1k0000ks3pemokg0de/</id>
    <published>2022-08-12T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.308Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの中村です。</p><p>今回の記事では、Windows Server Failover Cluster (WSFC) 構成のファイル サーバー上に作成した共有フォルダーで、継続的可用性 (Continuous Availability<br> (CA)) 設定を有効にすると、このフォルダー配下の Office ファイルを開くときに時間がかかる、という動作について説明します。なお、このときに要する時間は数十分となる場合があるため、ユーザーが開き終わるまで待機することなく「Office ファイルを開くことができず、Office アプリの応答がなくなる」といった現象として報告されることが想定されます。<br><br></p><h3 id="1-発生条件"><a href="#1-発生条件" class="headerlink" title="1. 発生条件"></a><strong>1. 発生条件</strong></h3><p> 以下をすべて満たす場合に発生します。</p><ul><li><p>Office デスクトップ アプリ バージョン 1812 以降</p></li><li><p>WSFC 構成のファイル サーバーで、共有フォルダーの継続的可用性 (CA) を有効にしている</p></li></ul><p> <img src="/blog/cl6q3dt1k0000ks3pemokg0de/WSFC_CA.png">  </p><ul><li><p>共有フォルダーの名前に NFKC 形式での Unicode正規化により、別の文字に置き換わる文字を使用している (例: 全角アルファベット)</p><p>Unicode 正規化の詳細は以下をご参照ください。<br>Using Unicode Normalization to Represent Strings<br><a href="https://docs.microsoft.com/en-us/windows/win32/intl/using-unicode-normalization-to-represent-strings">https://docs.microsoft.com/en-us/windows/win32/intl/using-unicode-normalization-to-represent-strings</a></p><p>※ サブ フォルダーは影響しません。共有ルート フォルダーの名前のみです。</p></li></ul><br><h3 id="2-原因"><a href="#2-原因" class="headerlink" title="2. 原因"></a><strong>2. 原因</strong></h3><p>WSFC 構成の継続的可用性 (CA) は、一般的に可用性が重要なスケールアウト ファイル サーバーなどの構成で利用され、ファイルへのアクセス中にフェイル オーバーが発生したときにも、フェイル オーバー後にそのままアクセスを継続することを実現します。<br>本機能の詳細は、以下の公開情報をご参照ください。</p><p>Windows Server 2012 Continuous Availability File Server feature<br><a href="https://docs.microsoft.com/en-us/archive/blogs/davguents_blog/windows-server-2012-continuous-availability-file-server-feature">https://docs.microsoft.com/en-us/archive/blogs/davguents_blog/windows-server-2012-continuous-availability-file-server-feature</a></p><p>この仕組みの実現のため、継続的可用性が有効な共有フォルダーが検出されると、SMB クライアントはそのファイル サーバーへのアクセスが失敗した場合も、しばらくの間リトライを繰り返します。このリトライによって、フェイル オーバー後に自動的に再接続され、継続アクセスが可能となります。<br><br></p><p>一方で、先述の発生条件に記載したバージョン以降の Office アプリケーションでは、セキュリティ脆弱性への対応のため、ファイルが格納されているネットワーク フォルダー パスを Unicode 正規化してアクセスする処理を追加しました。<br>例えば、「ｓｈａｒｅ」という全角英字を Unicode 正規化すると、半角英字「share」となります。したがって、「\\server\ｓｈａｒｅ\test.xlsx」という全角英字フォルダー内のファイルを開くときに、「\\server\share」 (半角英字) へのアクセスが発生することになります。</p><p>半角英字の「share」フォルダーが存在せず、そのようなフォルダーは存在しない旨のエラーが返されても以後の処理は正常に動作しますが、継続的可用性が有効な場合は、存在しないことによるエラーであってもこのエラーがすぐに Office に返らず、リトライが繰り返されます。<br>この結果、リトライ オーバーまで Office は待機し続け、ファイルを開くまでに長い時間を要します。</p><p>Windows OS の継続的可用性によるリトライ、Office アプリケーションのファイル オープン時の Unicode 正規化ともに、想定された仕組みであり、本動作は現在の製品動作上の制限事項です。<br><br></p><h3 id="3-回避策"><a href="#3-回避策" class="headerlink" title="3. 回避策"></a><strong>3. 回避策</strong></h3><p>以下のいずれかの方法による回避をご検討ください。</p><ol><li><p>共有フォルダーの名前に Unicode 正規化で別の文字となる文字を使用しない</p></li><li><p>共有フォルダーをネットワーク ドライブに割り当てて使用する<br>(この場合、Office が Unicode 正規化してアクセスするのはネットワーク ドライブを用いたパスとなるため、現象を回避できます)</p></li><li><p>共有フォルダーの継続的可用性を無効にする</p></li></ol><br>今回の投稿は以上です。  <br><br><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの中村です。&lt;/p&gt;
&lt;p&gt;今回の記事では、Windows Server Failover Cluster (WSFC) 構成のファイル サーバー上に作成した共有フォルダーで、継続的可用性 (Continuous Availabil</summary>
      
    
    
    
    
    <category term="ファイル I/O" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/"/>
    
  </entry>
  
  <entry>
    <title>ストア アドインを利用したファイルを一元展開で利用できるようになりました</title>
    <link href="https://officesupportjp.github.io/blog/cl6as2js40007m0u87h40erld/"/>
    <id>https://officesupportjp.github.io/blog/cl6as2js40007m0u87h40erld/</id>
    <published>2022-08-02T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.324Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。</p><p>以前の Microsoft 365 Apps では、Office ストアから入手した Web アドインの情報が埋め込まれた Office ファイルを、ストアの利用が禁止されているユーザー環境で開くと、該当の Web アドインが一元展開から配信されていたとしてもアドインが利用できませんでした。Microsoft 365 Apps でこの動作が改善され、このようなシナリオでも利用が可能となりましたので、本記事では、この改善の詳細について説明します。</p><h1 id="【前提】"><a href="#【前提】" class="headerlink" title="【前提】"></a>【前提】</h1><p>本記事に記載の “一元展開” とは、<a href="https://admin.microsoft.com/#/homepage">Microsoft 365 管理センター</a> より実施可能な設定で以下公開情報に掲載されています。  </p><p>タイトル : アドインの一元展開が組織で機能するかどうかを確認する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/centralized-deployment-of-add-ins">https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/centralized-deployment-of-add-ins</a>    </p><p>タイトル : Microsoft 365 管理センターにアドインをデプロイする<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/manage-deployment-of-add-ins">https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/manage-deployment-of-add-ins</a>    </p><p>上記に従って一元展開をすると以下のように [Office アドイン] 画面の [管理者による管理] タブから指定したアドインを利用できるようになります。</p><p><img src="/blog/cl6as2js40007m0u87h40erld/Office_Store_Admin_Managed.png"></p><p>特定の Web アドインのみの利用を許可したいテナントで、一元展開を活用して利用するアドインのみを展開し、Office ストアの利用を禁止する以下の 1) 2) のいずれかの設定も併せて適用するという利用方法が多く採用されています。</p><h3 id="1-Microsoft-365-管理センターでストアを禁止する設定"><a href="#1-Microsoft-365-管理センターでストアを禁止する設定" class="headerlink" title="1) Microsoft 365 管理センターでストアを禁止する設定"></a>1) Microsoft 365 管理センターでストアを禁止する設定</h3><p>Microsoft 365 管理センターにおいてストアを禁止する手順は以下となります。 後述する 2) の場合は、デスクトップ アプリケーションのみが対象となりますが、本設定は Office for the Web (Web 版 Office) も対象となります。</p><h4 id="lt-設定手順-gt"><a href="#lt-設定手順-gt" class="headerlink" title="&lt;設定手順&gt;"></a>&lt;設定手順&gt;</h4><ol><li><a href="https://admin.microsoft.com/#/homepage">Microsoft 365 管理センター</a> へグローバル管理者などでサインインします。</li><li>[設定] - [組織設定] をクリックします。</li><li>[組織設定] 画面 - [サービス] タブ に表示されている [ユーザーが所有するアプリとサービス] をクリックします。</li><li>表示された設定で [ユーザーが Office Store にアクセスすることを許可する] のチェックを外し、[保存] をクリックします。</li></ol><p>なお、本設定を適用すると、[Office アドイン] 画面の [ストア] タブに Office ストアが利用できない旨のメッセージが表示され、ストアが利用禁止になります。</p><br><h3 id="2-ポリシーでストアを禁止する設定"><a href="#2-ポリシーでストアを禁止する設定" class="headerlink" title="2) ポリシーでストアを禁止する設定"></a>2) ポリシーでストアを禁止する設定</h3><p>Office 管理用テンプレートのグループ ポリシーなどを利用し以下を設定すると [Office アドイン] 画面の [ストア] タブが非表示になり、ストアから入手した Web アドインが利用できなくなります。</p><h4 id="lt-グループ-ポリシー設定-gt"><a href="#lt-グループ-ポリシー設定-gt" class="headerlink" title="&lt;グループ ポリシー設定&gt;"></a>&lt;グループ ポリシー設定&gt;</h4><p>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Office 2016] - [アプリケーション設定] -[セキュリティ] - [セキュリティ センター]<br>&amp;nbsp;- [Office ストアのブロック] : 有効  </p><p>なお、上記ポリシーは Office デスクトップ アプリケーションの [トラスト センターの設定] - [信頼できるアドイン カタログ] - [Office ストアの Web アドインの起動を許可しない。] の強制的にチェック有りにし、変更不可とする設定となります。</p><h1 id="【改善内容】"><a href="#【改善内容】" class="headerlink" title="【改善内容】"></a>【改善内容】</h1><p>上記【前提】のように、ストアを利用禁止して一元展開で一部アドインを展開している環境において、以前は ストアから入手したアドインを利用している Office ファイルを開いた場合、表示されたアドインには、以下のような画面が表示され、アドインを利用することができませんでした。</p><p><img src="/blog/cl6as2js40007m0u87h40erld/Office_Store_Addin_Blocked1.png"></p><p><img src="/blog/cl6as2js40007m0u87h40erld/Office_Store_Addin_Blocked2.png"></p><p>これは、Office ファイルの作成時にどこからアドインが挿入されたがファイル内に記録されているためです。従来は、同じアドインが一元展開で利用できる状況でも、ストアから挿入したアドインとして記録されている場合は、一元展開のアドインが使われることはありませんでした。  </p><p>実運用で特にこの状況に直面する例として、Power Apps や Power BI、Dynamics のサイトから Office ファイルにデータを埋め込んで出力するシナリオの報告を多く頂いていました。これらのシナリオでは、ストア アドインの情報がファイルに埋め込まれます。</p><h4 id="lt-Power-Apps-gt"><a href="#lt-Power-Apps-gt" class="headerlink" title="&lt;Power Apps&gt;"></a>&lt;Power Apps&gt;</h4><p>タイトル : テーブル データを Excel で開く<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/powerapps/maker/data-platform/data-platform-excel-addin">https://docs.microsoft.com/ja-jp/powerapps/maker/data-platform/data-platform-excel-addin</a><br>該当箇所 : テーブル データを Excel で開く　　</p><h4 id="lt-Power-BI-gt"><a href="#lt-Power-BI-gt" class="headerlink" title="&lt;Power BI&gt;"></a>&lt;Power BI&gt;</h4><p>タイトル : PowerPoint にライブ Power BI レポート ページを追加する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/power-bi/collaborate-share/service-power-bi-powerpoint-add-in-install?tabs=export">https://docs.microsoft.com/ja-jp/power-bi/collaborate-share/service-power-bi-powerpoint-add-in-install?tabs=export</a><br>該当箇所 : “[エクスポート] オプションを使用する” に関する記述  </p><h4 id="lt-Dynamics-365-gt"><a href="#lt-Dynamics-365-gt" class="headerlink" title="&lt;Dynamics 365&gt;"></a>&lt;Dynamics 365&gt;</h4><p>- Excel<br>タイトル : Excel 用 Microsoft Dynamics AX アドインの使用について<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-excel">https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-excel</a><br>- Word<br>タイトル : Word 用 Microsoft Dynamics AX アドインの使用について<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-word">https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-word</a><br>※ Dynamics については、設定次第で一元展開したアドインを利用する設定も可能ですが、既定ではストア アドインを利用します。</p><p>本記事の改善によって、ファイルにストアからダウンロードしたアドインの情報が記録されていたとしても、一元展開で同じアドインを展開していれば、上記画面が表示されることなく、自動的に 一元展開されたアドインを利用することが可能になりました。</p><p>また同様に、従来はテナント A で一元展開されたアドインを用いて作成したファイルをテナント B で開いた場合も、テナント A の一元展開アドインの情報が記録されているため、以下画面が表示されて利用ができませんでした。</p><p><img src="/blog/cl6as2js40007m0u87h40erld/Admin_Managed_Addin_Blocked.png"></p><p>今回の改善は同じアドインであれば、展開方法に依存せず利用できるというものです。そのため、こちらのケースでも本改善によって自動的にストア アドインやテナント B の一元展開アドインを利用できます。</p><h1 id="【利用可能な-Office-バージョン】"><a href="#【利用可能な-Office-バージョン】" class="headerlink" title="【利用可能な Office バージョン】"></a>【利用可能な Office バージョン】</h1><p>上記機能が利用可能な Office バージョンは、Microsoft 365 Apps の各更新チャネルにおいてそれぞれ以下が対象となります。</p><ul><li>Microsoft 365 Apps 最新チャネル - バージョン 2107 (ビルド 14228.20204) 及びそれ以降</li><li>Microsoft 365 Apps 月次エンタープライズ チャネル - バージョン 2107 (ビルド 14228.20324) 及びそれ以降</li><li>Microsoft 365 Apps 半期エンタープライズ チャネル - バージョン 2202 (ビルド 14931.20604) 及びそれ以降</li></ul><br><p>今回の投稿は以上です。</p><br><p><strong>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;/p&gt;
&lt;p&gt;以前の Microsoft 365 Apps では、Office ストアから入手した Web アドインの情報が埋め込まれた Office ファイルを、ストアの利用が禁止されているユーザー環境で開くと、該当の W</summary>
      
    
    
    
    
    <category term="Web アドイン" scheme="https://officesupportjp.github.io/blog/tags/Web-%E3%82%A2%E3%83%89%E3%82%A4%E3%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>Office 利用時に storage.googleapis.com や cdn01.boxcdn.net への通信が発生する</title>
    <link href="https://officesupportjp.github.io/blog/cl4hy59k50027usvsc5k6cuto/"/>
    <id>https://officesupportjp.github.io/blog/cl4hy59k50027usvsc5k6cuto/</id>
    <published>2022-06-19T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.293Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000">2022&#x2F;08&#x2F;19 Update<br>[対応案] の内容を更新しました</span> </p><p>こんにちは、Office サポート チームです。<br>この記事では、クイック実行版 Office アプリケーション利用時に<br>storage.googleapis.com や cdn01.boxcdn.net への通信が発生する事象について説明します。</p><p>新たな情報がある場合には、随時この記事でお知らせします。  </p><h1 id="事象の詳細"><a href="#事象の詳細" class="headerlink" title="事象の詳細"></a>事象の詳細</h1><p>M365Apps や Office 2019 などのクイック実行版 Office アプリケーションで以下の操作をしたときに<br>storage.googleapis.com や cdn01.boxcdn.net への通信が発生します。</p><ul><li>[スタート] メニューから Excel 等を起動して、[開く] ボタンをクリックする</li><li>[名前を付けて保存] をクリックする</li></ul><p>このとき、プロキシ認証を利用している環境では<br>「storage.googleapis.com のプロキシサーバーに接続しています」や<br>「cdn01.boxcdn.net のプロキシサーバーに接続しています」<br>というメッセージが表示されます。  </p><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>本事象は、主に、クイック実行版 Office のクラウド側の設定追加の影響で発生しています。  </p><p>Office アプリケーションから接続するサービスの定義 (クラウド側の設定) として<br>サードパーティーの Egnyte や Box のファイル共有サービスの定義が追加されました。  </p><p>この新しいクラウド側の定義をクライアントが受信すると、<br>以降、Office のバックステージ ビューに、Egnyte や Box (いずれもサードパーティーのファイル共有サービス) が読み込まれ、<br>Egnyte のアイコン画像取得のために「storage.googleapis.com」へ<br>Box のアイコン画像取得のために「cdn01.boxcdn.net」への通信が発生します。</p><h1 id="対応案"><a href="#対応案" class="headerlink" title="対応案"></a>対応案</h1><p><span style="color:#ff0000">2022&#x2F;08&#x2F;19 現在、Egnyte および Box のアイコン画像取得のための通信先が、Microsoft 365 Apps をご利用いただくにあたり必須の通信先である 「cdn.odc.officeapps.live.com」 へ変更になっております。<br>そのため、現在本事象は発生いたしません。</span> </p><p><span style="color:#ff0000">本事象に対する対応として、下記のポリシー設定は不要となります。既に設定いただいている場合は、必要に応じて設定の見直しをご検討ください。</span></p><p>サードパーティーのファイル共有サービスを全く使っていない場合は、以下のポリシー設定で回避できます。</p><p>[ユーザーの構成]<br>- [ポリシー]<br>- [管理用テンプレート]<br>- [Microsoft Office 2016]<br>- [ツール | オプション | 全般 | サービス オプション]<br>- [オンライン コンテンツ]<br>- [サービス レベルのオプション]<br>を有効にして、 “Microsoft のサービスのみ” にする  </p><p>上記ポリシーを設定すると以下のレジストリが作成されます。<br>レジストリを直接設定することでも同じ動作となります。</p><p>キー : HKEY_CURRENT_USER\Software\Policies\Microsoft\office\16.0\common\internet<br>名前 : serviceleveloptions<br>種類 : REG_DWORD<br>データ : 1</p><p>BOX 等、サードパーティーのファイル共有サービスの一部製品をご利用の場合は<br>上記設定をすると、ご利用いただけなくなります (*1) ので<br>上記設定は行わずに、「storage.googleapis.com」 等へのプロキシ認証を除外することをご検討をお願いいたします。</p><p>(*1)<br>[場所の追加] や [アカウント] – [サービスの追加] – [ストレージ] の項目が表示されなくなります。</p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;2022&amp;#x2F;08&amp;#x2F;19 Update&lt;br&gt;[対応案] の内容を更新しました&lt;/span&gt; &lt;/p&gt;
&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、クイック実行版 Off</summary>
      
    
    
    
    
    <category term="クラウド ストレージ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>OneNote の OCR 機能で読み取りにくい文字列がある</title>
    <link href="https://officesupportjp.github.io/blog/cl28oxvt6002ku8uj1ose6ej2/"/>
    <id>https://officesupportjp.github.io/blog/cl28oxvt6002ku8uj1ose6ej2/</id>
    <published>2022-04-21T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.293Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの永田です。</p><p>デスクトップ版 OneNote は光学式文字認識 (OCR) をサポートしており、ページに挿入された画像からテキストを読み取って、クリップボードに取得することができます。このとき、画像の解像度や、画像の形式によって、期待通りにテキストを読み取れないことがあります。</p><p>読み取りに影響する要因は、以下のようなものがあります。</p><ul><li>フォントが小さい文字列<ul><li>画像に含まれる文字のフォント サイズが小さければ小さいほど、読み取られにくい</li></ul></li><li>罫線を含む文字列<ul><li>文字列の上や下に罫線がある場合、文字が正確に読み取られにくい</li></ul></li><li>表形式の文字列<ul><li>複数列によってレイアウトされている表形式の文字列は、レイアウトを維持して読み取られにくい</li></ul></li></ul><h1 id="対応状況"><a href="#対応状況" class="headerlink" title="対応状況"></a>対応状況</h1><p>この動作は OneNote の機能上の制限です。</p><h1 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h1><p>誠に恐れ入りますが、以下の方法を検討ください。</p><ul><li>フォントが小さい文字列<ul><li>画像の表示倍率を拡大して読み込む。拡大して画像がぼやける場合は、必要に応じてシャープネス機能を利用する。Word の場合、図の書式設定の「シャープネス」機能を利用可能。</li></ul></li><li>罫線を含む文字列<ul><li>文字列の上や下に罫線がある場合、最上段や最下段には出来るだけ罫線を含まないようスクリーンショットを採取して OneNote に貼り付けて読み取る</li></ul></li><li>表形式の文字列<ul><li>読み取り対象画像に対して、一列ずつスクリーンショットを採取して OneNote に貼り付けて読み取る</li></ul></li></ul><p>今回の投稿は以上です。</p><p><strong>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの永田です。&lt;/p&gt;
&lt;p&gt;デスクトップ版 OneNote は光学式文字認識 (OCR) をサポートしており、ページに挿入された画像からテキストを読み取って、クリップボードに取得することができます。このとき、画像の解像度や、画像の形</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>インターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について (MC322553)</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/</id>
    <published>2022-02-18T00:00:00.000Z</published>
    <updated>2023-02-10T08:34:08.075Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2022&#x2F;03&#x2F;18 Update</strong></span><br><span style="color:#339966">- “【インターネット入手ファイルとみなされるシナリオ】” を追記しました。</span>  </p><p><span style="color:#339966">- “【マクロを有効にする方法について】” 内に以下を追記しました。</span><br><span style="color:#339966"> “1) ポリシーでマクロを有効にする方法” に [マクロの設定] による制御が実施されることを追記しました。</span><br><span style="color:#339966"> “4) Web 上のファイルを開くシナリオで、信頼済みサイトに登録する方法” を追記しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;06&#x2F;08 Update</strong></span><br><span style="color:#339966">ネットワーク共有がインターネット ゾーンとみなされるシナリオについて追記しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;07&#x2F;08 Update</strong></span><br><span style="color:#339966">最新チャネルへのリリースがロールバックされたため、冒頭の記載を変更しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;07&#x2F;29 Update</strong></span><br><span style="color:#339966">最新チャネルへのリリース再開されたため、記載を変更しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;10&#x2F;14 Update</strong></span><br><span style="color:#339966">本動作変更に関する新しいブログ記事「インターネット入手マクロ ブロックのトラブルシュートの流れ」へのリンクを追加しました。</span>  </p><br><p>こんにちは、Office サポート チームです。</p><p>本記事では、2022 年 4 月 より Microsoft 365 Apps への展開が開始されるインターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について説明します。本記事に記載の既定の動作変更は 7 月 27 日 (米国時間) に最新チャネルにおいてリリースが開始されました。</p><br><h1 id="【前提】"><a href="#【前提】" class="headerlink" title="【前提】"></a>【前提】</h1><p>今回のご説明は以下公開情報でご案内している内容となります。</p><p>タイトル : Macros from the internet will be blocked by default in Office<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked</a> (日本語版 - 機械翻訳)<br>アドレス : <a href="https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked</a> (英語版)  </p><p>また、以下のとおり、ブログ記事も公開されています。</p><p>タイトル : Helping users stay safe: Blocking internet macros by default in Office<br>アドレス : <a href="https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805">https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805</a> (英語版)</p><p>上記公開情報 &#x2F; ブログ記事には最新状況の更新がされている場合があるため、適宜ご確認ください。</p><p><strong>追加情報</strong><br>この記事では変更の詳細をご説明していますが、ブロックされる理由は複数あります。実際にこの変更でマクロがブロックされる動作に直面した場合に、どの理由でブロックされているかを特定する流れについて以下のブログを作成しましたので、合わせてご参照ください。</p><p>タイトル : インターネット入手マクロ ブロックのトラブルシュートの流れ<br>アドレス : <a href="https://officesupportjp.github.io/blog/cl97y6c2w0000ykse7nll9auc/">https://officesupportjp.github.io/blog/cl97y6c2w0000ykse7nll9auc/</a></p><br><h1 id="【概要】"><a href="#【概要】" class="headerlink" title="【概要】"></a>【概要】</h1><p>上記公開情報で記載の概要は、Office のセキュリティ向上のため、 Office アプリケーションにてインターネットから入手した Office ファイルのマクロの実行をブロックするよう既定の動作を変更するという内容です。</p><p>これまでの Office では、インターネットから入手したファイルは保護ビューでは開かれますが、保護ビューを解除して編集モードにした後のマクロの実行可否の判断には、インターネットからの入手であることは考慮されず、他のセキュリティ設定でブロックされない限りはマクロを実行できました。今回の変更で、インターネットから入手したファイルは既定でマクロ実行がブロックされるようになります。</p><p>本変更はインターネットから入手したすべての Office ファイルが対象ではなく、特定の条件でマクロの有効 &#x2F; 無効が決定されなかった場合にブロックされる動作となります。</p><p>つまり、この条件次第でインターネットから入手するファイルのマクロを今後も実行できるようになりますので、引き続きマクロを実行したい場合は、いずれかの先に判断される条件を利用してマクロを有効にできますので、本記事で詳しく紹介します。</p><p>なお、ここで言う「インターネットから入手したファイル」とは、Mark of the Web (MOTW) 属性と呼ばれる Windows によってインターネットからのファイル取得時に自動的に付与される Web マークが付与されたファイルを指します。</p><br><h1 id="【インターネット入手ファイルとみなされるシナリオ】"><a href="#【インターネット入手ファイルとみなされるシナリオ】" class="headerlink" title="【インターネット入手ファイルとみなされるシナリオ】"></a>【インターネット入手ファイルとみなされるシナリオ】</h1><p>以下のようなシナリオがインターネット入手ファイルとみなされ、既定でマクロが無効化されるようになります。</p><ul><li>外部から受信したメールの添付ファイルを開く</li><li>ブラウザーでインターネット ゾーンのサイトからダウンロードしたファイルを開く</li><li>インターネット ゾーンの Web サイト上のファイルを直接開く (IP アドレスや FQDN で接続されたネットワーク共有のファイルを開く場合を含む)</li></ul><br><h1 id="【本変更の対象範囲について】"><a href="#【本変更の対象範囲について】" class="headerlink" title="【本変更の対象範囲について】"></a>【本変更の対象範囲について】</h1><p>先の 公開情報 “この変更のOfficeのバージョン” に記載のとおり、本件の対象となる Office アプリケーションは Access &#x2F; Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word です。</p><p>また、本変更の対象の Office は Windows デバイスにインストールされる以下となります。</p><ul><li>Microsoft 365 Apps 最新チャネル (プレビュー)</li><li>Microsoft 365 Apps 最新チャネル</li><li>Microsoft 365 Apps 月次エンタープライズ チャネル</li><li>Microsoft 365 Apps 半期エンタープライズ チャネル (プレビュー)</li><li>Microsoft 365 Apps 半期エンタープライズ チャネル</li><li>製品版 Office 2021</li><li>製品版 Office 2019</li><li>製品版 Office 2016</li></ul><br><h1 id="【変更される既定の動作の詳細】"><a href="#【変更される既定の動作の詳細】" class="headerlink" title="【変更される既定の動作の詳細】"></a>【変更される既定の動作の詳細】</h1><p>今回の既定の動作の変更は、先の公開情報に記載の以下フローチャートにて <span style="color:#ff0000"><strong>赤枠で囲った 7 の状況</strong></span> となった場合に該当します。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-macro-flowchart.png"></p><p>上記フローチャートにおいて今回の動作変更の影響を受ける条件は以下をすべて満たす場合となります。</p><ul><li>開かれるマクロ付きファイルにインターネットから入手されたことを意味する Web マークが付与されている (フローチャート 1 &#x3D; START)</li><li>マクロ付きファイルが “信頼できる場所”  に保存されていない (フローチャート 2 &#x3D; No)</li><li>マクロ付きファイルが デジタル署名されていない、またはデジタル署名されているが “信頼できる発行元” に登録されている証明書と署名が一致しない (フローチャート 3 &#x3D; No)</li><li>クラウド ポリシー &#x2F; グループ ポリシー等のポリシーにてマクロの有効 &#x2F; 無効が設定されていない (フローチャート 4a,4b &#x3D; No)</li><li>ユーザーが以前このファイルを開いていない、または以前このファイルを開いたが表示される通知にて [コンテンツを有効にする] を選択していない (フローチャート 6 &#x3D; No)</li></ul><p>これらの条件すべてに合致した場合、以下のとおり動作が変更となります。</p><h3 id="変更前"><a href="#変更前" class="headerlink" title="変更前"></a>変更前</h3><p>以下のオプション設定に従ってマクロの有効 &#x2F; 無効を決定します。</p><h4 id="lt-オプション設定-Excel-アプリケーションから確認する例-gt"><a href="#lt-オプション設定-Excel-アプリケーションから確認する例-gt" class="headerlink" title="&lt;オプション設定 (Excel アプリケーションから確認する例)&gt;"></a>&lt;オプション設定 (Excel アプリケーションから確認する例)&gt;</h4><p>[ファイル] タブ - [オプション] - [トラスト センター]- [トラスト センターの設定] - [マクロの設定] - [マクロの設定] の選択</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/macro-settings.png"></p><p>なお、既定の設定である “警告して、VBA マクロを有効にする” の場合、以下が出力されます。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-security-warning-banner.png"></p><h3 id="変更後"><a href="#変更後" class="headerlink" title="変更後"></a>変更後</h3><p>以下のメッセージが出力されマクロの実行がブロックされます。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-security-risk-banner.png"></p><br><h1 id="【マクロを有効にする方法について】"><a href="#【マクロを有効にする方法について】" class="headerlink" title="【マクロを有効にする方法について】"></a>【マクロを有効にする方法について】</h1><p>上記の動作変更にて無効化されたマクロを有効にする方法を以下に説明します。</p><h2 id="1-ポリシーでマクロを有効にする方法"><a href="#1-ポリシーでマクロを有効にする方法" class="headerlink" title="1) ポリシーでマクロを有効にする方法"></a><p id="EnableVBA-1">1) ポリシーでマクロを有効にする方法</p></h2><p>Office 管理用テンプレートのグループ ポリシーなどを利用し以下を設定するとインターネットから入手した Office ファイルについてもマクロを有効にできます。</p><h4 id="lt-グループ-ポリシー設定-gt"><a href="#lt-グループ-ポリシー設定-gt" class="headerlink" title="&lt;グループ ポリシー設定&gt;"></a>&lt;グループ ポリシー設定&gt;</h4><ul><li>Access<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Access 2016] - [アプリケーション設定] -[セキュリティ] - [セキュリティ センター]<br>- [インターネットから取得した Office ファイル内のマクロの実行をブロックします] : 無効</li><li>Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft xxx 2016] - [xxx のオプション] - [セキュリティ] - [セキュリティ センター]<br>- [インターネットから取得した Office ファイル内のマクロの実行をブロックします] : 無効<br>注) xxx はそれぞれ Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word です。<br></li></ul><p>なお、この設定とは別にオプションの [トラスト センターの設定] - [マクロの設定] による、マクロ全体のセキュリティ設定による制御は行われます。例として、既定の “警告して、VBA マクロを有効にする” 設定の場合には、以下が表示されます。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-security-warning-banner.png"></p><br><h2 id="2-特定のファイルでマクロを有効にする方法"><a href="#2-特定のファイルでマクロを有効にする方法" class="headerlink" title="2) 特定のファイルでマクロを有効にする方法"></a><p id="EnableVBA-2">2) 特定のファイルでマクロを有効にする方法</p></h2><p>特定のファイルでマクロを有効にする方法ついて、以下の “Web マークを削除する方法” 及び “信頼できる発行元のデジタル署名を追加する方法” があります。</p><h3 id="Web-マークを削除する方法"><a href="#Web-マークを削除する方法" class="headerlink" title="Web マークを削除する方法"></a>Web マークを削除する方法</h3><p>インターネットから入手したファイルには Web マークが付与されると先ほど述べましたが、この Web マークの実体はWindows OS で広く利用されている NTFS ファイルシステムの代替データストリーム（ADS：Alternate Data Stream）に保存されているゾーン識別子 (Zone.Identifier) です。</p><p>そのため、このゾーン識別子を削除すると、本動作変更の対象外となり、ローカルで作成したマクロ付きファイルと同様の動作となります。以下画面から削除する手順と PowerShell で削除する手順をそれぞれ記載します。</p><h4 id="lt-ゾーン識別子の削除手順-画面-gt"><a href="#lt-ゾーン識別子の削除手順-画面-gt" class="headerlink" title="&lt;ゾーン識別子の削除手順 (画面) &gt;"></a>&lt;ゾーン識別子の削除手順 (画面) &gt;</h4><ol><li>エクスプローラーから該当のマクロ付きファイルを右クリックし、[プロパティ]を表示します。</li><li>[全般] タブの最下部に以下画面のように [セキュリティ] が表示されている場合は、右側の [許可する] をチェックし、[OK] をクリックします。</li></ol><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/file-property-security.png"></p><h4 id="lt-ゾーン識別子の削除手順-PowerShell-コマンド-gt"><a href="#lt-ゾーン識別子の削除手順-PowerShell-コマンド-gt" class="headerlink" title="&lt;ゾーン識別子の削除手順 (PowerShell コマンド) &gt;"></a>&lt;ゾーン識別子の削除手順 (PowerShell コマンド) &gt;</h4><p>以下のコマンドを PowerShell で実行します。  (対象ファイル : C:\temp\sample.xlsm)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Remove-Item &#x27;C:\temp\sample.xlsm&#x27; -Stream Zone.Identifier;  </span><br></pre></td></tr></table></figure><br><h3 id="信頼できる発行元のデジタル署名を追加する方法"><a href="#信頼できる発行元のデジタル署名を追加する方法" class="headerlink" title="信頼できる発行元のデジタル署名を追加する方法"></a><p id="EnableVBA-Sign">信頼できる発行元のデジタル署名を追加する方法</a></h3><p>Office アプリケーション実行環境にて、”信頼できる発行元” として登録されている証明書を使用したデジタル署名がマクロに追加されている場合にはマクロが実行可能となります。</p><p>この動作を利用してマクロを実行可能とするため、署名者は秘密鍵を持つ証明書で VBA マクロに署名を行い、この証明書をマクロ実行環境のユーザーの「信頼された発行元」ストアに登録します。証明書の信頼に関する動作詳細は Windows 全般の動作となるため本記事では割愛し、Office の動作に関わる部分のみ以下に記載します。</p><p>以下に各 Office アプリケーション上での “信頼できる発行元” として登録されている証明書の確認方法を記載します。</p><h4 id="lt-オプション設定-信頼できる発行元-gt"><a href="#lt-オプション設定-信頼できる発行元-gt" class="headerlink" title="&lt;オプション設定 - 信頼できる発行元&gt;"></a>&lt;オプション設定 - 信頼できる発行元&gt;</h4><p>[ファイル] タブ - [オプション] - [トラスト センター] - [トラスト センターの設定] -  [信頼できる発行元]</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/trusted-publisher.png"></p><p>上記画面にて “信頼できる発行元” として登録されているデジタル証明書の一覧を確認することが可能です。  </p><p>マクロにデジタル署名を付与する手順は以下となります。</p><h4 id="lt-デジタル署名追加手順-gt"><a href="#lt-デジタル署名追加手順-gt" class="headerlink" title="&lt;デジタル署名追加手順&gt;"></a>&lt;デジタル署名追加手順&gt;</h4><ol><li>マクロ付きファイルを各 Officeアプリケーションで開きます。</li><li>[Alt] + [F11] キーを を押下し、Visual Basic Editor (VBE) を開きます。</li><li>VBE の [ツール] タブ - [デジタル署名] をクリックします。</li><li>表示されたウィンドウの [選択] をクリックし、使用する “信頼できる発行元” の証明書を選択して [OK] をクリックします。</li><li>“この VBA プロジェクトは以下のように署名されています。” の下の “証明書名” に選択した証明書名が表示されたことを確認し、[OK] をクリックします。</li><li>ファイルを保存して閉じます。</li></ol><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/digital-signature.png"></p><br><h2 id="3-特定のフォルダーのファイルでマクロを有効にする方法"><a href="#3-特定のフォルダーのファイルでマクロを有効にする方法" class="headerlink" title="3) 特定のフォルダーのファイルでマクロを有効にする方法"></a><p id="EnableVBA-3">3) 特定のフォルダーのファイルでマクロを有効にする方法</p></h2><p>各アプリケーションの以下オプション設定で確認 &#x2F; 追加可能な “信頼できる場所” に登録されているパスにマクロ付きファイルを保存をすることにより、マクロが実行可能となります。</p><h4 id="lt-オプション-設定-gt"><a href="#lt-オプション-設定-gt" class="headerlink" title="&lt;オプション 設定&gt;"></a>&lt;オプション 設定&gt;</h4><p>[ファイル] タブ - [オプション] - [トラスト センター] - [トラスト センターの設定] -  [信頼できる場所]<br>注) 既定で登録された場所は特殊なフォルダですので、マクロを実行したいファイルを保存するためのフォルダは [新しい場所の追加] から任意の場所を追加することをお勧めします。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/trusted-location.png"></p><p>注) Access &#x2F; Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word の各アプリケーションでそれぞれ異なる設定となります。</p><p>なお、本設定は以下グループ ポリシーでも追加 &#x2F; 削除が可能です。</p><h4 id="lt-グループポリシー設定-信頼できる場所-gt"><a href="#lt-グループポリシー設定-信頼できる場所-gt" class="headerlink" title="&lt;グループポリシー設定 - 信頼できる場所&gt;"></a>&lt;グループポリシー設定 - 信頼できる場所&gt;</h4><ul><li>Access<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Access 2016] - [アプリケーション設定] - [セキュリティ]<br>- [セキュリティ センター] - [信頼できる場所]<br>- [信頼できる場所 #1 - #20] : 有効 且つ [パス] に C:\temp などのフォルダーパスを登録します。</li><li>Visio<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Visio 2016] - [Visio のオプション] -[セキュリティ]<br>- [セキュリティ センター]<br>- [信頼できる場所 #1 - #20] : 有効 且つ [パス] に C:\temp などのフォルダーパスを登録します。  </li><li>Excel &#x2F; PowerPoint &#x2F; Word<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft xxx 2016] - [xxx のオプション] -[セキュリティ]<br>- [セキュリティ センター] - [信頼できる場所]<br>- [信頼できる場所 #1 - #20] : 有効 且つ [パス] に C:\temp などのフォルダーパスを登録します。<br>注) xxx は それぞれ Excel &#x2F; PowerPoint &#x2F; Word です。</li></ul><p>また、[信頼できる場所] 下部に表示されている [自分のネットワーク上にある信頼できる場所を許可する (推奨しません)] に対応するグループ ポリシーは以下となります。共有フォルダーなどネットワーク上のパスを指定する場合はこちらをご利用ください。</p><h4 id="lt-グループポリシー設定-自分のネットワーク上にある信頼できる場所を許可する-gt"><a href="#lt-グループポリシー設定-自分のネットワーク上にある信頼できる場所を許可する-gt" class="headerlink" title="&lt;グループポリシー設定 - 自分のネットワーク上にある信頼できる場所を許可する&gt;"></a>&lt;グループポリシー設定 - 自分のネットワーク上にある信頼できる場所を許可する&gt;</h4><ul><li>Access<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Access 2016] - [アプリケーション設定] - [セキュリティ]<br>- [セキュリティ センター] - [信頼できる場所] - [ネットワーク上の信頼できる場所を許可する]</li><li>Visio<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Visio 2016] - [Visio のオプション] - [セキュリティ]<br>- [セキュリティ センター] - [ネットワーク上の信頼できる場所を許可する]</li><li>Excel &#x2F; PowerPoint &#x2F; Word<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft xxx 2016] - [xxx のオプション] - [セキュリティ]<br>- [セキュリティ センター] - [信頼できる場所] - [ネットワーク上の信頼できる場所を許可する]<br>注) xxx は それぞれ Excel &#x2F; PowerPoint &#x2F; Word です。</li></ul><br><h2 id="4-Web-・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法"><a href="#4-Web-・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法" class="headerlink" title="4) Web ・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法"></a><p id="EnableVBA-4">4) Web ・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</p></h2><p>自社 Web サイトや社内ファイル サーバーなど、安全が保証されている場所の Office ファイルを開く場合は、Web サイトまたはサーバーを信頼済みサイトに登録すると、インターネット入手ファイルとみなされずマクロを有効にできます。</p><h4 id="lt-信頼済みサイト登録手順-gt"><a href="#lt-信頼済みサイト登録手順-gt" class="headerlink" title="&lt;信頼済みサイト登録手順&gt;"></a>&lt;信頼済みサイト登録手順&gt;</h4><ol><li>タスクバーにある検索ボックスに “インターネット オプション” と入力します。</li><li>表示された [インターネット オプション] をクリックし、[インターネットのプロパティ] を開きます。</li><li>[セキュリティ] タブ - [信頼済みサイト] を選択し [サイト] をクリックします。</li><li>マクロの実行を許可する Office ファイルが格納されたサイト・サーバーの URL を入力して [追加] をクリックします。<br>&lt;登録内容&gt;<br>Web サイト : URL (例: <a href="https://www.microsoft.com/">https://www.microsoft.com</a>)<br>ネットワーク共有 : 接続時に指定している相手先サーバーの FQDN (例: \\server.domain.com) または IP アドレス (例: 111.111.111.111)<br>※ http:&#x2F;&#x2F; で始まる URL や、ネットワーク共有を追加する場合は、下部の [このゾーンのサイトにはすべてサーバーの確認 (https:) を必要とする] のチェックを外します。</li><li>[閉じる] をクリックし、[信頼済みサイト] 画面を閉じます。</li><li>[インターネットのプロパティ] 画面で [OK] をクリックして画面を閉じます。</li></ol><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/trusted-sites.png"></p><p>補足)<br>Internet Explorer の場合は、Web サイトの応答ヘッダーが Content-Disposition: Attachment のときはインターネット一時フォルダにファイルがダウンロードされます。このフォルダに格納されたファイルは、Office ではすべてインターネット入手ファイルとみなすため、信頼済みサイトに登録してもマクロはブロックされます。</p><p>Edge ブラウザーの場合は、一時フォルダにダウンロードされたファイルも、サイトのゾーン設定に従って Web マークが付与され、それによってマクロのブロック有無が決定されるため信頼済みサイトへの登録でマクロを有効にできるようになります。</p><h2 id="ご参考"><a href="#ご参考" class="headerlink" title="ご参考"></a>ご参考</h2><p>Office グループポリシー管理用テンプレートの導入手順について、以下に詳細が記載されていますので、こちらをご確認ください。</p><p>タイトル : Office の管理用テンプレートを使用してグループ ポリシー (GPO) で Office 365 ProPlus を制御する<br>アドレス  : <a href="https://answers.microsoft.com/ja-jp/msoffice/forum/all/office/3ec9d79c-44ec-4273-97e2-2a6f3a1fd8ef">https://answers.microsoft.com/ja-jp/msoffice/forum/all/office/3ec9d79c-44ec-4273-97e2-2a6f3a1fd8ef</a>  </p><p>また、上記以外に Microsoft 365 管理センターより設定可能な Office にサインインしているユーザーに適用するクラウド ポリシーや Microsoft Intune を利用したグループ ポリシーを構成する方法も存在します。ご利用の Office バージョンや環境に応じてこれらもご利用ください。以下に公開情報を記載します。</p><p>タイトル : Microsoft 365 Apps for enterprise 向け Office クラウド ポリシー サービスの概要<br>アドレス  : <a href="https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-cloud-policy-service">https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-cloud-policy-service</a> (日本語版 - 機械翻訳)<br>アドレス  : <a href="https://docs.microsoft.com/en-us/deployoffice/admincenter/overview-office-cloud-policy-service">https://docs.microsoft.com/en-us/deployoffice/admincenter/overview-office-cloud-policy-service</a> (英語版)  </p><p>タイトル : Windows 10&#x2F;11 テンプレートを使用して、Microsoft Intune でグループ ポリシー設定を構成する<br>アドレス  : <a href="https://docs.microsoft.com/ja-jp/mem/intune/configuration/administrative-templates-windows">https://docs.microsoft.com/ja-jp/mem/intune/configuration/administrative-templates-windows</a> (日本語版 - 機械翻訳)<br>アドレス  : <a href="https://docs.microsoft.com/en-us/mem/intune/configuration/administrative-templates-windows">https://docs.microsoft.com/en-us/mem/intune/configuration/administrative-templates-windows</a> (英語版)    </p><br><p>今回の投稿は以上です。</p><br><p><strong>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2022&amp;#x2F;03&amp;#x2F;18 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color:#339966&quot;&gt;- “【インターネット入手ファイルとみなされるシナリ</summary>
      
    
    
    
    
    <category term="VBA マクロ" scheme="https://officesupportjp.github.io/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/"/>
    
  </entry>
  
  <entry>
    <title>Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4rqa2001y50vshhi75we2/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4rqa2001y50vshhi75we2/</id>
    <published>2022-02-17T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.293Z</updated>
    
    <content type="html"><![CDATA[<br><hr><p><strong>2022&#x2F;3&#x2F;18 Update</strong><br>2. &#x2F; 3. にそれぞれ、他のファイル内の VBA を参照している場合の影響と回避策を追加しました。</p><hr><br><p>こんにちは、Office サポート チームの中村です。</p><p>Office ファイルの保存場所として、ファイル サーバーの共有フォルダから、SharePoint Online のドキュメント ライブラリや 個人用 OneDrive &#x2F; OneDrive for Business への移行を検討する企業も増えてきたかと思います。Office ファイルでは業務効率化のためマクロ (VBA) を利用されていることが多く、弊社サポートにも、マクロ ファイル自身やマクロ内で操作するファイルの保存場所がクラウドになることの影響を確認したい、というお問い合わせを時折頂きます。</p><p>今後、さらにクラウド活用が進むと想定されるため、今回の記事で、このようなシナリオで一般的に生じる影響と対応方法、考慮すべき点についてまとめたいと思います。<br><br></p><h2 id="1-クラウド移行で変化すること"><a href="#1-クラウド移行で変化すること" class="headerlink" title="1. クラウド移行で変化すること"></a><strong>1. クラウド移行で変化すること</strong></h2><p>ファイルの格納場所を変更したとき、マクロに影響を与える要素は主に以下の 2 点です。</p><p>・フォルダやファイルのパスが UNC 共有パス形式 (\\Server\folder) から URL 形式 (http:&#x2F;&#x2F;tenantname.sharepoint.com&#x2F;xxxx など) に変わる<br>・SharePoint や OneDrive によってアクセス権が管理される<br><br></p><h2 id="2-ファイル-パス変更の影響"><a href="#2-ファイル-パス変更の影響" class="headerlink" title="2. ファイル パス変更の影響"></a><strong>2. ファイル パス変更の影響</strong></h2><p>マクロからファイルやフォルダを操作するときに使用する関数によっては、URL 形式に対応していません。このような関数を利用している場合は、マクロ処理の見直しが必要です。以下に、マクロで主に使用されるファイル操作関数の URL 形式対応状況を記載します。<br><br></p><h3 id="Excel-x2F-Word-x2F-PowerPoint-のライブラリ"><a href="#Excel-x2F-Word-x2F-PowerPoint-のライブラリ" class="headerlink" title="Excel &#x2F; Word &#x2F; PowerPoint のライブラリ"></a><strong>Excel &#x2F; Word &#x2F; PowerPoint のライブラリ</strong></h3><p>これらのアプリ用のライブラリ Microsoft xxx 16.0 Object Library (xxx は各種アプリ名) で提供されるファイル操作メソッドやプロパティは、Web 上のファイルを直接読み書きすることを想定しているため、基本的に URL 形式を扱うことができます。これらのメソッド・プロパティを利用している場合は、特に対応の必要はありません。<br>例) Excel の Workbooks.Open や Workbook.Path<br>※ Access ファイルは Web から直接開くことができず、ダウンロードしてから開くため URL 形式を扱うことは想定されません。<br><br></p><p><strong>補足情報</strong><br>エクスプローラーで、OneDrive や SharePoint ライブラリの同期フォルダからファイルを開く場合、以前の Office バージョンでは、ThisWorkbook.Path などで開いたファイルのパスを取得すると、同期フォルダのローカル パスが返されました。<br>Microsoft 365 の最新チャネル バージョン 1903 および半期チャネル バージョン 2008 以降は、この操作シナリオでも、サーバー側の URL パスが返るようになりました。<br>古い Office バージョンを利用する場合は、取得されるパスが異なることに注意してください。<br><br></p><h3 id="VBA-関数"><a href="#VBA-関数" class="headerlink" title="VBA 関数"></a><strong>VBA 関数</strong></h3><p>Dir や Open といった VBA 関数は、URL 形式に対応していません。以下に、ファイル操作に関わる主な VBA 関数がまとめられていますが、ここに記載されている関数を利用している場合、他の仕組みへの変更を検討してください。</p><p>Directories and files keyword summary<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/directories-and-files-keyword-summary">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/directories-and-files-keyword-summary</a><br>Input and output keyword summary<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/input-and-output-keyword-summary">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/input-and-output-keyword-summary</a><br><br></p><h3 id="FileSystemObject-ライブラリ"><a href="#FileSystemObject-ライブラリ" class="headerlink" title="FileSystemObject ライブラリ"></a><strong>FileSystemObject ライブラリ</strong></h3><p>Scripting.FileSystemObject ライブラリで提供される各種メソッドは、URL 形式に対応していません。以下の公開情報で Scripting.FileSystemObject ライブラリで提供されるファイル・フォルダ操作メソッドがまとめられています。これらを利用している場合は、他の仕組みへの変更を検討してください。</p><p>FileSystemObject object<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/filesystemobject-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/filesystemobject-object</a><br>File object<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/file-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/file-object</a><br>Folder object<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/folder-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/folder-object</a><br><br></p><h3 id="補足-1-その他、独自にパスを解析・組み立てる処理"><a href="#補足-1-その他、独自にパスを解析・組み立てる処理" class="headerlink" title="補足 1) その他、独自にパスを解析・組み立てる処理"></a><strong>補足 1) その他、独自にパスを解析・組み立てる処理</strong></h3><p>マクロの独自処理として、例えばマクロ ファイル自身の格納フォルダ パスの一部を加工して処理結果ファイルの出力パスを組み立てるなど、パスのテキストを意識した処理がある場合は注意が必要です。URL 形式への変更に伴い、既存の文字列操作処理では、期待する結果が得られない場合があります。<br><br></p><h3 id="補足-2-他のファイルへの参照"><a href="#補足-2-他のファイルへの参照" class="headerlink" title="補足 2) 他のファイルへの参照"></a><strong>補足 2) 他のファイルへの参照</strong></h3><p>先述したような一般的なライブラリは、クライアント マシンに登録されたものを呼び出すため、ファイルの保存場所が変わっても影響を受けません。<br>しかし、他の Excel ブックを [参照設定] で参照して、そのブック内の独自に作成した VBA プロシージャを呼び出している場合、参照先のファイルをクラウドに移行すると、参照不可となります。(VBA の参照設定は URL 形式に対応していないため、参照設定を再設定してもクラウド上のファイルは参照できません。)</p><p>参照設定の他にも、マクロ処理内でパスを指定して他のファイルを開いている場合は、パスの指定方法がファイルの移動後も有効な実装となっているか十分に確認してください。<br><br></p><h2 id="3-影響を受ける場合の対処方法"><a href="#3-影響を受ける場合の対処方法" class="headerlink" title="3. 影響を受ける場合の対処方法"></a><strong>3. 影響を受ける場合の対処方法</strong></h2><p>一般的には、以下のような対処方法が検討できます。実際の処理内容や環境構成、対応にかけられる工数などを考慮して対処方法をご検討ください。<br><br></p><h3 id="a-Office-ライブラリを用いて操作する"><a href="#a-Office-ライブラリを用いて操作する" class="headerlink" title="a. Office ライブラリを用いて操作する"></a><strong>a. Office ライブラリを用いて操作する</strong></h3><p>先述の通り、Microsoft xxx 16.0 Object Library で提供されるメソッド・プロパティは基本的に URL 形式を扱うことができます。そして、Word や Excel は、テキスト ファイルを扱うこともできます。現在 VBA 関数や FileSystemObject でテキスト ファイルを操作している場合には、これを Word や Excel アプリで Microsoft xxx 16.0 Object Library を用いて扱うよう変更することが検討できます。<br><br></p><h3 id="b-不要なファイル・フォルダ操作を止める"><a href="#b-不要なファイル・フォルダ操作を止める" class="headerlink" title="b. 不要なファイル・フォルダ操作を止める"></a><strong>b. 不要なファイル・フォルダ操作を止める</strong></h3><p>例えば、次回利用時に引き継ぎたい内容を動的に保持する設定ファイルを別ファイルとして用意し、これを読み書きするために対応していない関数を使っている、というシナリオを考えます。このような場合、これをマクロ ファイル自身のどこかに保持する (Excel の非表示シート、Word の隠し文字、ファイルのユーザー設定プロパティ等) ことで、他のファイルへの読み書きを行わないようにする、といった対応もマクロの内容次第では検討できます。<br><br></p><h3 id="c-Graph-API-に変更する-ファイル操作と-Excel-操作が対応"><a href="#c-Graph-API-に変更する-ファイル操作と-Excel-操作が対応" class="headerlink" title="c. Graph API に変更する (ファイル操作と Excel 操作が対応)"></a><strong>c. Graph API に変更する (ファイル操作と Excel 操作が対応)</strong></h3><p>SharePoint Online や OneDrive に対し、HTTP リクエスト ベースで操作する API として Graph API が提供されています。現在、SharePoint ライブラリや OneDrive のフォルダ・ファイル自体の操作 (作成やコピー、削除など) と、Excel ファイルの操作用 API が利用できます。ただし、プログラムの実装イメージがマクロと大きく異なりますので、Graph API 自体の利用に習熟している開発者向けの代替案です。  </p><p>Microsoft Graph API を使用する<br><a href="https://docs.microsoft.com/ja-jp/graph/use-the-api">https://docs.microsoft.com/ja-jp/graph/use-the-api</a><br>Microsoft Graph REST API v1.0 リファレンス<br><a href="https://docs.microsoft.com/ja-jp/graph/api/overview">https://docs.microsoft.com/ja-jp/graph/api/overview</a>  </p><p>現時点では、マクロで可能な全ての操作が Graph API からも行えるものではありませんが、簡単な操作は可能です。ただし、一般的に、マクロから呼び出すことには適していません。一般的には、独立したアプリケーションを作成して HTTP リクエストを発行し、Web 上のファイルを操作します。また、Microsoft 365 サービスへの認証も考慮する必要があります。  </p><p><strong>参考資料</strong><br>(WebAPI)OAuth Bearer Token (Access Token) の取得方法について<br><a href="https://officesupportjp.github.io/blog/cl0m8t2ac00023gvs6bwo9tp2/">https://officesupportjp.github.io/blog/cl0m8t2ac00023gvs6bwo9tp2/</a><br>(WebAPI)Microsoft Graph を使用した開発に便利なツール群<br><a href="https://officesupportjp.github.io/blog/cl0m8t2ae00033gvsbtlo3btc/">https://officesupportjp.github.io/blog/cl0m8t2ae00033gvsbtlo3btc/</a><br>(WebAPI)Microsoft Graph - OneDrive API (C Sharp) を使ったサンプル コード<br><a href="https://officesupportjp.github.io/blog/cl0m8t2aa00013gvsa2mr8xj5/">https://officesupportjp.github.io/blog/cl0m8t2aa00013gvsa2mr8xj5/</a><br>(WebAPI)Microsoft Graph – Excel REST API (C Sharp) を使い Range を操作するサンプル コード<br><a href="https://officesupportjp.github.io/blog/cl0m8t2a400003gvsgcr96w6h/">https://officesupportjp.github.io/blog/cl0m8t2a400003gvsgcr96w6h/</a><br><br></p><h3 id="d-OneDrive-や-SharePoint-ライブラリの同期フォルダを操作する"><a href="#d-OneDrive-や-SharePoint-ライブラリの同期フォルダを操作する" class="headerlink" title="d. OneDrive や SharePoint ライブラリの同期フォルダを操作する"></a><strong>d. OneDrive や SharePoint ライブラリの同期フォルダを操作する</strong></h3><p>OneDrive 同期クライアントで、ファイル格納フォルダをクライアント コンピューターと同期すると、ローカルの同期フォルダにファイルがコピーされます。この同期フォルダに対してマクロから操作を行うと、通常のローカル パスとして扱うことができます。(なお、先述の通り、ThisWorkbook.Path の結果は最新の Microsoft 365 では URL 形式になり、同期フォルダのローカル パスではない点にご注意ください。)  </p><p>Windows の OneDrive とファイルを同期する<br><a href="https://support.microsoft.com/ja-jp/office/615391c4-2bd3-4aae-a42a-858262e42a49">https://support.microsoft.com/ja-jp/office/615391c4-2bd3-4aae-a42a-858262e42a49</a>  </p><p>ただし、マクロから編集した内容がサーバー上へ同期されることは、マクロの動作としては保証されません。マクロからは、ローカルの同期フォルダへの操作が成功することをもって成功と判断されます。ネットワークの問題で同期に失敗したり、クラウド上のファイルに他のユーザーから競合する変更が行われて同期エラーが生じるなど、クラウド上にマクロの実行結果が期待通り反映されない可能性についての考慮が必要です。<br><br></p><h4 id="補足-WebDAV-パスでのアクセス"><a href="#補足-WebDAV-パスでのアクセス" class="headerlink" title="補足: WebDAV パスでのアクセス"></a><strong>補足: WebDAV パスでのアクセス</strong></h4><p>SharePoint ライブラリを Internet Explorer で開くと、[エクスプローラ―で開く] というメニューが使用でき、”\\SharePoint サイト\DavWWWRoot\Folder” のような UNC パスで、ライブラリが開かれていました。これは、WebDAV と呼ばれる Web フォルダを読み書き可能とする技術を用いて​実現されています。<br>以前は、このパスを用いてマクロからアクセスすることも検討できる方法の 1 つでした。<br>しかしながら、この仕組みはレガシな技術を用いており、Edge ブラウザでは対応していません。<br>また、WebDAV でのアクセスには別のサービス (WebClient サービス) が利用されるため、マクロが実行されている Office アプリの認証情報は引き継がれません。<br>WebClient サービス用の認証情報の保存にはまもなくサポートを終了する Internet Explorer を利用する必要があることなどからも、新たに WebDAV パスでの利用を検討することは推奨しません。<br><br></p><h3 id="e-参照設定を-Application-Run-に変更する"><a href="#e-参照設定を-Application-Run-に変更する" class="headerlink" title="e. 参照設定を Application.Run に変更する"></a><strong>e. 参照設定を Application.Run に変更する</strong></h3><p>参照設定で他のファイルの VBA プロシージャを呼び出している場合、参照設定を止め、以下のようにファイルを開いた上で Application.Run で実行することが検討できます。</p><p>例:<br>Ref.xlsm に SampleProc() が含まれているとします。   </p><p>&lt;変更前&gt;<br>[参照設定] から Ref.xlsm を参照し、VBA コードから SampleProc をそのまま呼び出し  </p><p>&lt;変更後&gt;<br>参照設定は解除し、以下のように呼び出し  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Workbooks.Open &quot;https://xxxx/Ref.xlsm&quot;</span><br><span class="line">Application.Run &quot;Ref.xlsm!SampleProc&quot;</span><br></pre></td></tr></table></figure><br><h2 id="4-Microsoft-365-サービスへの認証とアクセス権"><a href="#4-Microsoft-365-サービスへの認証とアクセス権" class="headerlink" title="4. Microsoft 365 サービスへの認証とアクセス権"></a><strong>4. Microsoft 365 サービスへの認証とアクセス権</strong></h2><p>対応方法のうち、引き続きマクロから Microsoft 365 サービス上のファイルへのアクセスを行う “a. Office ライブラリを用いて操作する” の場合、マクロが実行されている Office アプリケーションにサインインしているユーザーとして認証が行われます。このため、マクロ実行時の Office サインイン ユーザーに、マクロで操作するファイルへのアクセス権を付与する必要があります。<br><br></p><h2 id="5-サポートされる-Office-クライアント-アプリケーション"><a href="#5-サポートされる-Office-クライアント-アプリケーション" class="headerlink" title="5. サポートされる Office クライアント アプリケーション"></a><strong>5. サポートされる Office クライアント アプリケーション</strong></h2><p>マクロからの操作においても、Microsoft 365 サービスとの接続がサポートされる Office クライアント アプリケーションがサポート対象です。サポートされる製品は、以下の公開情報でご確認ください。</p><p>Office versions and connectivity to Microsoft 365 services<br><a href="https://docs.microsoft.com/en-us/deployoffice/endofsupport/microsoft-365-services-connectivity">https://docs.microsoft.com/en-us/deployoffice/endofsupport/microsoft-365-services-connectivity</a></p><p>今回の投稿は以上です。<br><br></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;br&gt;

&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;2022&amp;#x2F;3&amp;#x2F;18 Update&lt;/strong&gt;&lt;br&gt;2. &amp;#x2F; 3. にそれぞれ、他のファイル内の VBA を参照している場合の影響と回避策を追加しました。&lt;/p&gt;
&lt;hr&gt;
&lt;br&gt;

&lt;p&gt;こんにち</summary>
      
    
    
    
    
    <category term="オートメーション" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AA%E3%83%BC%E3%83%88%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/"/>
    
    <category term="クラウド ストレージ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>お知らせ - Japan Office Client Support Blog について</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkl00039eovs4fp4ffbt/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkl00039eovs4fp4ffbt/</id>
    <published>2022-01-31T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.308Z</updated>
    
    <content type="html"><![CDATA[<p>いつも Microsoft Office をご愛顧いただき誠にありがとうございます。<br>「Japan Office Client Support Blog」の運用についてお知らせします。</p><p>「Japan Office Client Support Blog」は、Office サポートチームより、よくお問い合わせをいただく情報をサポートトピックとして、皆様よりご要望が多い情報を配信します。</p><p>また、「Office サポートチーム」フォーラムにて公開しておりました記事について、本ブログでの公開を進めております。</p><p>なお、本ブログは情報発信専用のフォーラムとなります。</p><p>Office サポートチーム</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;いつも Microsoft Office をご愛顧いただき誠にありがとうございます。&lt;br&gt;「Japan Office Client Support Blog」の運用についてお知らせします。&lt;/p&gt;
&lt;p&gt;「Japan Office Client Support Blog」</summary>
      
    
    
    
    
    <category term="お知らせ" scheme="https://officesupportjp.github.io/blog/tags/%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/"/>
    
  </entry>
  
  <entry>
    <title>Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkk8002oeovs8ggucayv/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkk8002oeovs8ggucayv/</id>
    <published>2021-06-21T00:00:00.000Z</published>
    <updated>2023-02-22T10:28:53.621Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。  </p><p>今回の投稿では、Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて説明します。<br>以下の手順を上から順にご実施ください。</p><br><h2 id="1-Office-への再サインイン"><a href="#1-Office-への再サインイン" class="headerlink" title="1. Office への再サインイン"></a>1. Office への再サインイン</h2><p>1. Office からサインアウトし、Office を全て終了します。<br>2. OS のスタートメニュー - 歯車 - “アカウント” - “職場または学校にアクセスする” をクリックし、”職場または学校アカウント” として表示されている項目がある場合、”切断” をクリックします<br>※ Azure AD や AD に接続済みの項目を “切断” しますと、ドメインから外れてしまいますので、Azure AD や AD に接続済み の項目は切断しないようにご注意ください。</p><p><img src="/blog/cl0m4xkk8002oeovs8ggucayv/image1.png"></p><p>3. Office を起動してサインインし、事象が解消するかをお試しください。</p><br><h2 id="2-Office-のファイルキャッシュクリア"><a href="#2-Office-のファイルキャッシュクリア" class="headerlink" title="2.  Office のファイルキャッシュクリア"></a>2.  Office のファイルキャッシュクリア</h2><p>以下の “対処方法” - “方法 2” - “ユーザーインターフェースから削除する場合” をご実施ください。<br><a href="https://officesupportjp.github.io/blog/cl0m82yjj002mvovs9cil5fgy/index.html">SharePoint Server など WebDAV が有効なサーバーから Office ファイルが開かない、保存できない現象について</a></p><br><h2 id="3-Office-のファイルキャッシュの完全クリア"><a href="#3-Office-のファイルキャッシュの完全クリア" class="headerlink" title="3. Office のファイルキャッシュの完全クリア"></a>3. Office のファイルキャッシュの完全クリア</h2><p><strong>事前準備</strong><br>・ボリュームライセンス版の Office 2013、2016、または、<a href="https://learn.microsoft.com/ja-jp/officeupdates/update-history-microsoft365-apps-by-date">サポートされていない古いバージョンの Microsoft 365 Apps</a> の場合、<br>タスク マネージャーを起動し、[プロセス] タブで MSOSYNC.EXE が存在したら “プロセスの終了” をクリックしてください。<br>・”2. Office のファイルキャッシュクリア”の [ファイルを閉じたときにOfficeドキュメントキャッシュから削除する] もご実施ください<br>・以下の手順について、Office 2013 の場合は 15.0、Office 2016 以降は 16.0 となります。</p><ul><li><strong>手順 (UI から実施する場合)</strong></li></ul><ol><li><p><code>%localappdata%\Microsoft\Office\16.0</code> に移動し、OfficeFileCache と冠するフォルダーを全て削除して下さい。<br>※ OfficeFileCache2 や OfficeFileCache3 等が存在する場合、全て削除してください</p></li><li><p>スタートメニューを右クリックして [ファイル名を指定して実行] から regedit と入力し、レジストリ エディタを起動します。<br>※ ログオンユーザーの権限で起動してください。管理者権限は不要です。<br>※ UAC プロンプトで他の管理者ユーザーの UAC を入力すると、正しくキャッシュが削除出来ません。</p></li><li><p>以下のキーを展開し、Server Cache キーを削除します。<br><code>HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Common\Internet\Server Cache</code></p></li></ol><ul><li><strong>手順 (コマンドで実施する場合)</strong></li></ul><ol><li><p>コマンドプロンプトを起動します。<br>※ ログオンユーザーの権限で起動してください。管理者権限は不要です。<br>※ UAC プロンプトで他の管理者ユーザーの UAC を入力すると、正しくキャッシュが削除出来ません。</p></li><li><p>以下のコマンドを実施します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd %localappdata%\Microsoft\Office\16.0</span><br><span class="line">for /f %i in (&#x27;dir /a:d /b OfficeFileCache*&#x27;) do rd /s /q %i</span><br><span class="line">reg delete &quot;HKCU\Software\Microsoft\Office\16.0\Common\Internet\Server Cache&quot; /f</span><br></pre></td></tr></table></figure></li><li><p>念のため、<code>%localappdata%\Microsoft\Office\16.0</code> に移動し、OfficeFileCache と名前が付いているフォルダーが存在しないことをご確認ください。</p></li></ol><br><h2 id="4-Office-のサインインキャッシュのクリア"><a href="#4-Office-のサインインキャッシュのクリア" class="headerlink" title="4. Office のサインインキャッシュのクリア"></a>4. Office のサインインキャッシュのクリア</h2><p>以下の記事の手順により、サインインキャッシュのクリアをご実施ください。<br><a href="https://officesupportjp.github.io/blog/cl0m6umvg001gi4vsgppfcmk0/index.html">Office のサインインのトラブルシュートについて</a></p><br><p><strong>- 関連情報</strong><br><a href="https://officesupportjp.github.io/blog/cl0m69xu000124cvsclmc5vis/index.html">MSI 版の Office 2016 で SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象について</a></p><p><span style="color:#ff0000"><strong>2023&#x2F;2&#x2F;22 Update</strong></span><br><span style="color:#339966">体裁を整え、対処方法を簡略化しました</span></p><br>**本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。**]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。  &lt;/p&gt;
&lt;p&gt;今回の投稿では、Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて説明します。&lt;br&gt;以下の手順を上か</summary>
      
    
    
    
    
    <category term="ファイル I/O" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/"/>
    
    <category term="クラウド ストレージ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>Office 製品のサインインで先進認証が有効化、無効化されているかを確認する方法について</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkk1002beovs87lwadzx/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkk1002beovs87lwadzx/</id>
    <published>2021-06-17T00:00:00.000Z</published>
    <updated>2023-01-11T07:22:29.293Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。  </p><p>Office 製品のサインインで先進認証が有効化、無効化されているかを確認したいとお問い合わせいただくことがございます。</p><p>本投稿では、先進認証の有効化、無効化を確認する方法についてご案内いたします。</p><p><strong>【確認方法について】</strong></p><p>Office のサインイン画面を表示することで確認することが可能です。</p><p><strong>- 先進認証が有効の場合 (以下の何れかが表示されます)</strong></p><p><img src="/blog/cl0m4xkk1002beovs87lwadzx/image1.png"><br><img src="/blog/cl0m4xkk1002beovs87lwadzx/image2.png"></p><p><strong>- 先進認証が無効の場合</strong></p><p><img src="/blog/cl0m4xkk1002beovs87lwadzx/image3.png"></p><p><strong>【先進認証を有効化、無効化する方法について】</strong></p><p><strong>- Office 2013 製品の場合</strong></p><p>Office 2013 製品では、既定で先進認証が無効です。</p><p>以下のレジストリキーを設定することで、先進認証を有効にしていただけます。</p><p>キー: HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\15.0\Common\Identity<br>名前: EnableADAL<br>種類: REG_DWORD<br>データ: 1</p><p>名前: Version<br>種類: REG_DWORD<br>データ: 1</p><p>※ Office 2013 では、Microsoft Update により更新プログラムを最新に適用していただかないと、上記のレジストリを設定しても先進認証が有効にならない場合がございます。</p><p>※ 本レジストリキーは HKEY_CURRENT_USER 配下のため、レジストリエディターで値を編集される場合、別の管理者ユーザーなどでレジストリエディターを起動しないでください。</p><p><strong>- Office 2016、2019、Microsoft 365 Apps (Office 365 ProPlus) 製品の場合</strong></p><p>Office 2016 以降となるこれらの製品では、既定で先進認証が有効です。</p><p>Microsoft 365 Apps 製品では将来的に廃止される可能性はございますが、以下のレジストリの設定により、先進認証を無効化していただけます。</p><p>キー: HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Common\Identity<br>名前: EnableADAL<br>種類: REG_DWORD<br>データ: 0</p><p>※ 本レジストリキーは HKEY_CURRENT_USER 配下のため、レジストリエディターで値を編集される場合、別の管理者ユーザーなどでレジストリエディターを起動しないでください。</p><p><strong>【参考資料】</strong></p><p>EnableADAL の説明や各製品の詳細につきましては、以下の資料をご参考にいただきますようお願いいたします。</p><p>Title : 2013、Office 2016、および 2019 Office 2019 クライアント アプリOfficeのしくみ</p><p>URL : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/modern-auth-for-office-2013-and-2016?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/modern-auth-for-office-2013-and-2016?view=o365-worldwide</a></p><p>Title : Windows デバイスの Office 2013 の先進認証を有効にする<a href="https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/modern-auth-for-office-2013-and-2016?view=o365-worldwide"></a><br>URL : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/security-and-compliance/enable-modern-authentication?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/admin/security-and-compliance/enable-modern-authentication?view=o365-worldwide</a></p><p><strong>- 関連記事</strong>  </p><p>Title : Office のサインインでネットワーク接続がない旨のメッセージが表示される事象について<br>URL : <a href="https://officesupportjp.github.io/blog/Office%20%E3%81%AE%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%81%A7%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A5%E7%B6%9A%E3%81%8C%E3%81%AA%E3%81%84%E6%97%A8%E3%81%AE%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E4%BA%8B%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/">https://officesupportjp.github.io/blog/Office のサインインでネットワーク接続がない旨のメッセージが表示される事象について</a></p><p>今回の投稿は以上です。</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。  &lt;/p&gt;
&lt;p&gt;Office 製品のサインインで先進認証が有効化、無効化されているかを確認したいとお問い合わせいただくことがございます。&lt;/p&gt;
&lt;p&gt;本投稿では、先進認証の有効化、無効化を確認する方法についてご案</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
</feed>
