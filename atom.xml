<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Office Client Support Blog</title>
  
  <subtitle>日本マイクロソフト Office Client サポート チームのブログです</subtitle>
  <link href="https://officesupportjp.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://officesupportjp.github.io/blog/"/>
  <updated>2024-01-09T09:32:50.387Z</updated>
  <id>https://officesupportjp.github.io/blog/</id>
  
  <author>
    <name>Office Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOS 端末で Excel ファイルに描画を行うとアプリが強制終了する場合がある</title>
    <link href="https://officesupportjp.github.io/blog/clr65j0hm00091s6ycv6zcha4/"/>
    <id>https://officesupportjp.github.io/blog/clr65j0hm00091s6ycv6zcha4/</id>
    <published>2024-01-09T00:00:00.000Z</published>
    <updated>2024-01-09T09:32:50.387Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Office サポートチームです。<br>この記事では、iOS 端末で Excel ファイルに対して描画をする際に、<br>アプリが強制終了する動作について記載します。    </p><h1 id="事象の概要"><a href="#事象の概要" class="headerlink" title="事象の概要"></a>事象の概要</h1><p>以下公開情報の通り、Office では　[描画] 機能を使用することで、Excel ファイルに対して手書き入力を行うことが可能です。  </p><p>Title: Office で図形やテキストを手描き入力する<br>URL: <a href="https://support.microsoft.com/ja-jp/office/6d76c674-7f4b-414d-b67f-b3ffef6ccf53#OfficeVersion=iOS">https://support.microsoft.com/ja-jp/office/6d76c674-7f4b-414d-b67f-b3ffef6ccf53#OfficeVersion=iOS</a></p><p>本描画機能に関連して、iOS 端末の Excel アプリや Microsoft 365 アプリにて、<br>一度 Excel ファイルを開いて閉じるまでの間に、<br>Excel ファイルに対して長時間の描画などによって多く描画オブジェクトを作成する場合に、<br>アプリが強制終了する動作が確認されております。<br>※アプリ内部でのメモリ使用状況等によって事象が再現するとみられ、具体的な目安等についてはご案内が困難となります。  </p><h1 id="今後の対応予定"><a href="#今後の対応予定" class="headerlink" title="今後の対応予定"></a>今後の対応予定</h1><p>本動作について、現在開発部門にて詳細な原因・今後の改善可否等を含め調査中となります。<br>新たな情報が確認された場合は、この記事に追記する形で公開していく予定です。  </p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Office サポートチームです。&lt;br&gt;この記事では、iOS 端末で Excel ファイルに対して描画をする際に、&lt;br&gt;アプリが強制終了する動作について記載します。    &lt;/p&gt;
&lt;h1 id=&quot;事象の概要&quot;&gt;&lt;a href=&quot;#事象の概要&quot; class=</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Office で利用するプロキシ設定について</title>
    <link href="https://officesupportjp.github.io/blog/clr09r8tu00002wkjcubph9b8/"/>
    <id>https://officesupportjp.github.io/blog/clr09r8tu00002wkjcubph9b8/</id>
    <published>2024-01-04T15:00:00.000Z</published>
    <updated>2024-01-09T09:06:32.640Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直)です。  </p><p>本記事では、Office で利用するプロキシ設定について説明します。</p><h2 id="説明"><a href="#説明" class="headerlink" title="説明"></a>説明</h2><p>Office には、オンライン画像の挿入やオンラインテンプレートの取得などインターネット通信を利用する機能がございます。<br>このプロキシ設定はログオンユーザーの OS のプロキシ設定 (WinINET) が利用されます。WinHTTP のプロキシ設定は利用されません。</p><p>ただし、Office 2019 以降や Microsoft 365 クライアントで存在する自動更新の処理等の一部の機能については、以下の順でそれぞれのプロキシ設定を参照することがございます。</p><ol><li>WinHTTP (存在しない場合、スキップされます。また、構成していても、処理によっては参照しない場合がございます)</li><li>SYSTEM ユーザーの OS のプロキシ設定 (WinINET)</li><li>ログオンユーザーの OS のプロキシ設定 (WinINET) (ただし、ユーザーがログオンしている場合に限ります)</li></ol><p>最終的には 3 が利用されるため、1 や 2 を構成せずとも 3 を構成しておくことで通信は出来るものとなります。<br>なお、この動作を無効化したり順番を変更することは出来ません。また、処理内容によっては 1 と 2 を使用しない場合もございます。</p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p><strong>Office が利用するエンドポイントを教えてください</strong><br><a href="https://learn.microsoft.com/ja-jp/microsoft-365/enterprise/urls-and-ip-address-ranges?view=o365-worldwide">Office 365 の URL と IP アドレスの範囲</a>をご確認ください。</p><p><strong>Office でネットワーク接続がない旨のメッセージが表示されます</strong><br><a href="https://officesupportjp.github.io/blog/cl0m75al4001gmcvse36w64dv/">Office のサインインでネットワーク接続がない旨のメッセージが表示される事象について</a>をご確認ください。</p><p><strong>必要なサービスが無効になっていますと表示されます</strong><br><a href="https://officesupportjp.github.io/blog/clmk7jget0001hckj66na16pi/">必要なサービスが無効になっていますと表示される現象について</a>をご確認ください。</p><p><strong>GPO プロキシ設定を配布していますが、2 の SYSTEM ユーザーのプロキシ設定は変更されますか</strong><br>GPO は OS ログオン時に設定されますため、2 の SYSTEM ユーザーのプロキシ設定は変更されません。<br>2 の SYSTEM ユーザーのプロキシ設定を変更するには、<a href="https://docs.microsoft.com/ja-jp/windows/win32/bits/bitsadmin-tool">BitsAdmin コマンド</a>を利用する方法があります。</p><p>プロキシサーバー “192.168.1.1:8080” を指定する場合の例)<br>bitsadmin &#x2F;util &#x2F;setieproxy localsystem MANUAL_PROXY 192.168.1.1:8080 “”</p><p>バイパスリストを含め指定する場合の例)<br>bitsadmin &#x2F;util &#x2F;setieproxy localsystem MANUAL_PROXY 192.168.1.1:8080 “*.microsoft.com”</p><p>pac ファイル <a href="http://server/proxy.pac">http://server/proxy.pac</a> を指定する場合の例)<br>bitsadmin &#x2F;util &#x2F;setieproxy localsystem AUTOSCRIPT <a href="http://server/proxy.pac">http://server/proxy.pac</a></p><p>設定をリセットする方法)<br>bitsadmin &#x2F;util &#x2F;setieproxy localsystem NO_PROXY</p><p>設定を確認する方法)<br>bitsadmin &#x2F;util &#x2F;getieproxy localsystem</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直)です。  &lt;/p&gt;
&lt;p&gt;本記事では、Office で利用するプロキシ設定について説明します。&lt;/p&gt;
&lt;h2 id=&quot;説明&quot;&gt;&lt;a href=&quot;#説明&quot; class=&quot;headerlink&quot; title=&quot;説明&quot;&gt;&lt;/a&gt;説</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>MECM で M365Apps の更新プログラムが必要と判定されない</title>
    <link href="https://officesupportjp.github.io/blog/clqm07fq300005kkj5ww5bp4a/"/>
    <id>https://officesupportjp.github.io/blog/clqm07fq300005kkj5ww5bp4a/</id>
    <published>2023-12-26T00:00:00.000Z</published>
    <updated>2024-01-09T09:06:32.640Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直)です。  </p><p>MECM (Microsoft Endpoint Configuration Manager) で M365Apps (Microsoft 365 Apps for enterprise) の更新プログラムが必要と判定されない現象について説明します。</p><br><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>MECM で M365Apps の更新プログラムが必要と判定されず、更新が適用できない</p><br><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>以下の 3 つの条件を全て満たしているかをご確認ください。</p><p><strong>1) Office の更新に使用する COM IF のレジストリキーが存在する</strong><br><code>HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\&#123;B7F1785F-D69B-46F1-92FC-D2DE9C994F13&#125;</code></p><p>本レジストリは、<a href="https://learn.microsoft.com/ja-jp/deployoffice/updates/manage-microsoft-365-apps-updates-configuration-manager#enable-microsoft-365-apps-clients-to-receive-updates-from-configuration-manager">MECM から更新プログラムを受信できるようにする設定</a>が反映された後、OS を再起動することで作成されます。</p><br><p><strong>2) VersionToReport より新しいビルドを展開しようとしている、または、UpdateChannelChanged が True である</strong><br><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\ClickToRun\Configuratio\VersionToReport</code><br>ここには、16.0.12345.12345 のような 16.0 部分は固定のビルド番号が入ります。</p><p><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\ClickToRun\Configuratio\UpdateChannelChanged</code><br>初期値は False であり、後述のように UpdateChannel が優先度により変更された際に True となります。その後、更新試行を行った後に False に戻ります。</p><p>通常、チャネルの変更直後を除いて UpdateChannelChanged は False のため、VersionToReport の優劣にしたがい更新が行われます。</p><br><p><strong>3) UpdateChannel の URL に展開しているチャネルの識別子が含まれる</strong><br><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\ClickToRun\Configuratio\UpdateChannel</code></p><p><em><strong>チャネルの識別子</strong></em><br><code>最新チャネル : 492350f6-3a01-4f97-b9c0-c7c6ddf67d60</code><br><code>月次エンタープライズチャネル : 55336b82-a18d-4dd6-b5f6-9e5095c314a6</code><br><code>半期エンタープライズチャネル (プレビュー : b8f9b850-328d-4355-9145-c59439a0c4cf</code><br><code>半期エンタープライズチャネル : 7ffbc6bf-bc32-4f92-8982-f9dd17fd3114</code></p><p>UpdateChannel は UpdateChannelChanged が False である場合、以下の優先度を上から順に評価します。</p><p>優先度1) <a href="https://learn.microsoft.com/ja-jp/deployoffice/updates/configure-update-settings-microsoft-365-apps">GPO の “更新プログラムのパス”</a><br><code>HKEY_LOCAL_MACHINE\software\policies\microsoft\office\16.0\common\OfficeUpdate\updatepath</code></p><p>優先度2) <a href="https://learn.microsoft.com/ja-jp/deployoffice/updates/configure-update-settings-microsoft-365-apps">GPO の “チャネルの更新”</a><br><code>HKEY_LOCAL_MACHINE\software\policies\microsoft\office\16.0\common\OfficeUpdate\updatebranch</code></p><p>優先度3) <a href="https://learn.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options#updates-element">Office 展開ツールの Updates 要素の UpdatePath 属性</a><br><code>HKEY_LOCAL_MACHINE\Software\Microsoft\Office\ClickToRun\Configuration\UpdateUrl</code></p><p>優先度4) <a href="https://learn.microsoft.com/ja-jp/deployoffice/manage-software-download-settings-office-365">Microsoft 365 管理センターで Microsoft 365 のインストール オプションを管理する</a> の取得頻度<br><code>HKEY_LOCAL_MACHINE\Software\Microsoft\Office\ClickToRun\Configuration\UnmanagedUpdateUrl</code></p><p>優先度5) <a href="https://learn.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options#updates-element">Office 展開ツールの Updates 要素の Channel 属性</a><br><code>HKEY_LOCAL_MACHINE\Software\Microsoft\Office\ClickToRun\Configuration\CDNBaseURL</code></p><p>現在の UpdateChannel と値が異なる場合、評価された値に上書きされ、UpdateChannelChanged が True となります。</p><br><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p><strong>UpdateChannel が変更されるタイミングを教えてください</strong><br>タスクスケジューラーに登録されている Office Automatic Updates 2.0 が実行する OfficeC2RClient.exe の中で、前回の構成試行より 24 時間以上経過している場合に構成処理を行います。<br>このため、タスクスケジューラーを手動実行いただいても即座に実行することは出来ません。また、この時間を変更することは出来ません。</p><p><strong>優先度1 や 3 が入っている端末に MECM から更新プログラムを展開できますか？</strong><br>優先度1 は “未構成” に変更してください。優先度 3 の場合、UpdateUrl レジストリを削除していただくか、優先度 2 の GPO の “チャネルの更新” を代わりにご利用ください<br>なお、”チャネルの更新” を設定すると、MECM もしくはインターネット上の Office CDN から更新プログラムを取得するようになります。MECM で管理しない端末に設定する際はご留意ください。</p><p><strong>UpdateChannelChanged が既に True になっているため、優先度にしたがって設定を変更しても端末に反映されません</strong><br>UpdateChannelChanged を一度だけ False に書き換えてください。</p><p><strong>優先度4の UnmanagedUpdateUrl のチャネルを変更したいのですが、Microsoft 365 管理センターで半期エンタープライズチャネルを選択できません</strong><br>UnmanagedUpdateUrl レジストリを削除していただくか、優先度 2 の GPO の “チャネルの更新” を代わりにご利用ください<br>なお、”チャネルの更新” を設定すると、MECM もしくはインターネット上の Office CDN から更新プログラムを取得するようになります。MECM で管理しない端末に設定する際はご留意ください。</p><p><strong>MECM から更新しているのに、優先度4 の UnmanagedUpdateUrl レジストリが設定されているのはなぜですか？</strong><br><a href="https://learn.microsoft.com/ja-jp/deployoffice/updates/manage-microsoft-365-apps-updates-configuration-manager#enable-microsoft-365-apps-clients-to-receive-updates-from-configuration-manager">方法3</a> の Office 展開ツールでのインストール時に OfficeMgmtCOM を True で設定していない場合、端末に MECM から更新する設定が反映される前に M365Apps の自動更新が動作した可能性があります。</p><p><strong>COM IF のレジストリキーが作成されません</strong><br>何らかの影響により、端末で COM 登録が行えていない可能性があります。</p><p>対象の端末で、PowerShell を管理者権限で起動し、以下の 2 行を実行いただき、エラーが出るかをご確認ください。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$comCatalog = New-Object -ComObject COMAdmin.COMAdminCatalog</span><br><span class="line">$appColl = $comCatalog.GetCollection(&quot;Applications&quot;)</span><br></pre></td></tr></table></figure><p><strong>エラーが出る場合</strong><br>OS 観点で調査が必要であると考えられます。</p><p><strong>エラーが出ない場合</strong><br>以下の手順をご実施ください。</p><ol><li><p>以下の REG_DWORD レジストリに 0 を設定します。<br><code>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\office\16.0\Common\officeupdate\OfficeMgmtCOM</code></p></li><li><p>スタートメニューの検索にて、「サービス」と検索し、サービスを起動します</p></li><li><p>“Microsoft Office クイック実行サービス” を右クリックし、”再起動” を実施します。</p></li><li><p>以下の REG_DWORD レジストリに 1 を設定します。<br><code>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\office\16.0\Common\officeupdate\OfficeMgmtCOM</code></p></li><li><p>“Microsoft Office クイック実行サービス” を右クリックし、”再起動” を実施します。</p></li><li><p>COM IF のレジストリキーが作成されるかをご確認ください。</p></li></ol><br><h2 id="参考資料"><a href="#参考資料" class="headerlink" title="参考資料"></a>参考資料</h2><p><a href="https://techcommunity.microsoft.com/t5/microsoft-365-blog/how-to-manage-office-365-proplus-channels-for-it-pros/ba-p/795813">How to manage Office 365 ProPlus Channels for IT Pros</a></p><p><span style="color:#ff0000"><strong>2023&#x2F;12&#x2F;27  Update</strong></span><br><span style="color:#339966">一部記載を変更しました</span></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直)です。  &lt;/p&gt;
&lt;p&gt;MECM (Microsoft Endpoint Configuration Manager) で M365Apps (Microsoft 365 Apps for enterprise) の更新プロ</summary>
      
    
    
    
    
    <category term="更新" scheme="https://officesupportjp.github.io/blog/tags/%E6%9B%B4%E6%96%B0/"/>
    
  </entry>
  
  <entry>
    <title>Excel で図形やテキストの表示・印刷でずれやサイズ変化が生じる理由と対処</title>
    <link href="https://officesupportjp.github.io/blog/clp858vmy0000wosea1uya8uj/"/>
    <id>https://officesupportjp.github.io/blog/clp858vmy0000wosea1uya8uj/</id>
    <published>2023-11-21T00:00:00.000Z</published>
    <updated>2024-01-09T09:06:32.637Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの中村です。</p><p>Excel ファイルにおいて、異なる端末で同じブックを開いたときの表示や印刷結果における、以下のような差異についてお問い合わせを頂くことがあります。</p><p><strong>現象の例</strong>  </p><ul><li>図形やセルの縦横比が変化する</li><li>図形やセル内のテキストが見切れる、または文字列折り返し位置がずれる</li><li>図形同士、または図形とセルの位置関係がずれる</li><li>改ページ位置が変化する (1 枚に収めていた範囲が 2 枚になる、など)<br></li></ul><p>これらの動作は、多くの場合、Excel の表示・印刷レイアウトを計算する仕組みに依存する制限事項によるものです。本記事では、この Excel のレイアウト計算概要と回避・軽減策について説明します。<br><br></p><p><strong><h2>Excel のレイアウト計算</h2></strong><br>Excel では、列の幅 &#x2F; 行の高さ &#x2F; 図形のサイズや表示位置 &#x2F; 改ページ位置といったレイアウト情報を、ブックに保存されたサイズ・表示位置などの情報を基に、ディスプレイ ドライバーやプリンター ドライバーからの応答を合わせて計算します。つまり、この計算結果はディスプレイ設定やプリンター設定の影響を受け、その計算の過程で丸め誤差が生じます。<br>この結果、ディスプレイやプリンター関連の設定や、そもそも利用しているディスプレイ、プリンターが異なることにより、マシン間で表示差異が生じることがあります。  </p><p>Excel は、表計算を主目的とするアプリケーション ソフトである性格上、大量の行列の表示やスクロールのパフォーマンス向上を優先し、レイアウトに関わる計算をある程度簡略化しています。このため、上記のような誤差を設計上許容しており、異なる環境におけるレイアウトの厳密な一致は保証されません。  </p><p>参考) 列の幅の計算に関しては、以下の公開情報で詳しく説明しています。<br>Excel で列の幅を決定する方法の説明<br><a href="https://learn.microsoft.com/ja-JP/office/troubleshoot/excel/determine-column-widths">https://learn.microsoft.com/ja-JP/office/troubleshoot/excel/determine-column-widths</a><br><br></p><p><strong><h2>回避方法</h2></strong><br>大きく分けて、対応の方向性は以下のいずれかとなります。</p><p>a. ブック作成時の工夫で影響を軽減する<br>b. 表示を合わせたいマシン間のディスプレイ・印刷設定を合わせる</p><p>以下にそれぞれの方向で、主に効果が期待できる設定を記載します。<br>ただし、a. の方向の対応は、ファイルの構成によってはほぼ差異が気にならなくなりますが、現象や環境によっては効果がありません。<br>一方、b. については Excel 表示のためだけにディスプレイ表示倍率を変えると、ユーザーが画面を見づらくなったり、また、同じディスプレイやプリンターを使用できず、完全に一致させることは難しい状況が多いと考えられます。(一部の設定のみでも効果がある場合もあります。)<br>状況に応じて、どの回避方法が適しているかをご検討ください。<br><br></p><p><strong><u><h3>a. ブック作成時の工夫で影響を軽減する</h3></u></strong> </p><p><strong><h3>a-1. 図形をグループ化して位置関係を保持する</h3></strong><br>例えば、ある図形内部にきれいに納まるように別の図形を配置したものが、別の環境ではみ出している、といった図形同士のずれの場合は、それらの図形をグループ化すると位置関係を概ね保持できます。  </p><p>図形、図、その他のオブジェクトをグループ化またはグループ解除する<br><a href="https://support.microsoft.com/ja-jp/topic/a7374c35-20fe-4e0a-9637-7de7d844724b">https://support.microsoft.com/ja-jp/topic/a7374c35-20fe-4e0a-9637-7de7d844724b</a><br><br></p><p><strong><h3>a-2. サイズに余裕を持たせて文字列の見切れを防ぐ </h3></strong><br>図形やセル内の文字列が見切れてしまう場合、多少の誤差が生じても問題ないよう、ある程度余裕を持ったサイズに設定します。<br>また、改ページのずれに対しても同様に、1 ページにおさめる範囲に余裕を持っておくと、改ページ位置がずれたときにページを跨ぐことを防げます。<br><br></p><p><strong><h3>a-3. セルやテキストに合わせた図形の調整を変更して差異を軽減する </h3></strong><br>図形のプロパティにある以下の項目は、セルのサイズが変化したときに、図形の位置やサイズを調整するかどうかを変更する設定です。<br>図形自身のみでも、本記事で説明する計算結果の丸め誤差は生じるため、セルに合わせた移動やサイズ変更をしないようにしても完全に回避はできません。ただ、状況によっては、セルに合わせた調整を行わないことで軽減できたり、また反対に、セルに合わせて調整することで位置関係が保持され、より望ましい表示となる場合があります。<br>また、テキストに合わせた図形サイズ調整の設定も、図形のサイズに影響するため同様に効果がある場合があります。  </p><p><img src="/blog/clp858vmy0000wosea1uya8uj/ShapeProperty.png"><br><br></p><p><strong><h3>a-4. 図形の行列跨ぎの有無で差異を軽減する </h3></strong><br>複数の行や列に跨るように図形を配置すると、行・列の計算誤差の影響をより大きく受け、図形の位置ずれやサイズの差異が大きくなる場合があります。このような場合、行や列を跨がないよう図形を配置することで差異を軽減できます。また反対に、図形自身の計算結果による差異が、行や列を跨ることで生じる差異と相殺され、かえって表示が改善する場合もあります。<br>特に帳票のような用途で整形したシートなどでは、行や列を追加してここに納まるよう (またはあえてこれを跨ぐよう) 図形を配置し、これに合わせて全体のフォーマットを調整すると、期待する表示に近づく場合があります。<br><br></p><p><strong><h3>a-5. 改ページの自動調整を利用してページ数の変化を防ぐ </h3></strong><br>改ページ位置がずれる現象への対処として、印刷範囲を指定ページ数に納まるよう自動調整する機能を用いて印刷設定を行うと、どの環境でも同じページ数で印刷できます。</p><p>1 ページに収める<br><a href="https://support.microsoft.com/ja-jp/office/f3015be3-e007-4762-90a7-19ebc8052511">https://support.microsoft.com/ja-jp/office/f3015be3-e007-4762-90a7-19ebc8052511</a><br><br></p><p><strong><h3>a-6. テンプレートをクライアントごとに調整して都度対応を避ける </h3></strong><br>例えば帳票作成アプリケーションなどには、予めレイアウトを用意した Excel テンプレートに値を設定してファイルを作成するものがあります。このようなアプリの出力ファイルで現象が生じる場合は、初めに各クライアントでその環境で適切な表示となるよう、テンプレート上でセルのサイズや図形の位置などをカスタマイズして利用すると、帳票作成の都度、レイアウトを調整する手間を省くことができます。<br>(なお、先述の通り Excel は表計算ソフトとして設計されているため、帳票のようなレイアウトを重視するドキュメントには、本来 Word 文書の利用をお勧めします。)<br><br><br><br></p><p><strong><u><h3>b. マシン間のディスプレイ・印刷設定を合わせる</h3></u></strong><br>Excel の表示計算に関わる各種設定を以下に記載します。ファイルを作成した環境 (期待する表示レイアウトの環境) と、サイズ差異などが生じているマシン間で、これらの設定値を合わせてください。<br>全ての設定を合わせられない場合も、一部の設定の統一で回避する場合もあります。また、設定値の組み合わせ次第で、誤差が相殺され影響が少ない場合もあります。状況に応じて様々な組み合わせをお試しください。<br><br></p><p><strong><h3>b-1. Excel のディスプレイ設定</h3></strong><br>Excel の [オプション] - [全般] - [複数ディスプレイを使用する場合] の [表示を優先した最適化] &#x2F; [互換性に対応した最適化] の選択を変更します。設定の変更後、反映のため Excel を再起動してください。<br><br></p><p><strong><h3>b-2. Windows のディスプレイ設定 - テキスト表示倍率設定</h3></strong><br>&lt;Windows 10&gt;<br>Windows の [設定] - [システム] - [ディスプレイ] - [拡大縮小とレイアウト] セクションの [テキスト、アプリ、その他の項目のサイズを変更する] で表示倍率 (%) を変更します。 </p><p>&lt;Windows 11&gt;<br>Windows の [設定] - [システム] - [ディスプレイ] - [拡大縮小とレイアウト] セクションの [拡大&#x2F;縮小] で表示倍率 (%) を変更します。  </p><p>※ 本設定を含め、以降の Windows 設定の変更後は、設定の確実な反映のため、ユーザーの再サインイン、または OS 再起動を行うことをお勧めします。<br><br></p><p><strong><h3>b-3. Windows のディスプレイ設定 - アクセシビリティ設定</h3></strong><br>&lt;Windows 10&gt;<br>Windows の [設定] - [簡単操作] - [ディスプレイ] - [文字を大きくする] のスライダーで表示倍率 (%) を変更します。   </p><p>&lt;Windows 11&gt;<br>Windows の [設定] - [アクセシビリティ] - [テキストのサイズ] のスライダーで表示倍率 (%) を変更します。<br><br></p><p><strong><h3>b-4. Windows のディスプレイ設定 - カスタムスケーリング設定</h3></strong><br>&lt;Windows 10&gt;<br>Windows の [設定] - [システム] - [ディスプレイ] - [表示スケールの詳細設定] をクリックして遷移する画面の [カスタム スケーリング] の値 (%) を変更します。  </p><p>&lt;Windows 11&gt;<br>Windows の [設定] - [システム] - [ディスプレイ] - [拡大&#x2F;縮小] - [カスタム スケーリング] の値 (%) を変更します。<br><br></p><p><strong><h3>b-5. Windows のディスプレイ設定 - 自動スケーリング設定</h3></strong><br>&lt;Windows 10 のみ&gt;<br>Windows の [設定] - [システム] - [ディスプレイ] - [表示スケールの詳細設定] をクリックして遷移する画面の [アプリが鮮明に表示されるように Windows により修正を試す] を変更します。<br><br></p><p><strong><h3>b-6. Windows のディスプレイ設定 - 解像度設定</h3></strong><br>&lt;Windows 10 &#x2F; Windows 11&gt;<br>Windows の [設定] - [システム] - [ディスプレイ] - [ディスプレイの解像度] を変更します。<br><br></p><p><strong><h3>b-7. プリンター設定</h3></strong><br>異なるプリンターを利用している場合、既定のプリンターを合わせます。  </p><p>&lt;Windows 10&gt;<br>Windows の [設定] - [デバイス] - [プリンターとスキャナー] の [Windows で通常使うプリンターを管理する] をオフにした上で、既定に設定するプリンターを選択して [管理] をクリックし、[既定として設定する] をクリックします。  </p><p>&lt;Windows 11&gt;<br>Windows の [設定] - [Bluetooth とデバイス] - [プリンターとスキャナー] の [Windows で通常使うプリンターを管理する] をオフにした上で、既定に設定するプリンターを選択し、[既定として設定する] をクリックします。  </p><p>また、同一のプリンターを利用している場合、プリンターの [印刷設定] などのプリンター固有の設定画面で DPI 等の設定を合わせます。<br><br></p><p>今回の投稿は以上です。</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの中村です。&lt;/p&gt;
&lt;p&gt;Excel ファイルにおいて、異なる端末で同じブックを開いたときの表示や印刷結果における、以下のような差異についてお問い合わせを頂くことがあります。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;現象の例&lt;/strong</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
    <category term="Excel" scheme="https://officesupportjp.github.io/blog/tags/Excel/"/>
    
    <category term="描画" scheme="https://officesupportjp.github.io/blog/tags/%E6%8F%8F%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>信頼済みドキュメントに関するコンテンツ ブロックメッセージの説明 (MC302216)</title>
    <link href="https://officesupportjp.github.io/blog/clj709nu4004pqou8fyhg7wta/"/>
    <id>https://officesupportjp.github.io/blog/clj709nu4004pqou8fyhg7wta/</id>
    <published>2023-10-09T00:00:00.000Z</published>
    <updated>2023-10-30T00:14:47.604Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2023&#x2F;10&#x2F;09 Update</strong></span><br><span style="color:#339966">有害サイトと分類されていたため移動しました。</span><br><br><br>こんにちは、Office サポート チームの中村です。  </p><p>現在、Microsoft 365 Apps で Office ファイルを開くと、以下のメッセージが表示されることがあります。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/TrustDocBlockMsg.png">  </p><p>このメッセージは、Microsoft 365 Apps の仕様変更 (MC302216) によって表示されるようになりました。今回の記事では、この仕様変更の概要と、メッセージが表示される理由の特定方法や対処方法を記載します。<br><br></p><p><strong>目次</strong><br><a href="#1-%E4%BF%A1%E9%A0%BC%E6%B8%88%E3%81%BF%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%A8%E3%81%AF">1. 信頼済みドキュメントとは</a><br><a href="#2-%E4%BB%95%E6%A7%98%E5%A4%89%E6%9B%B4%E3%81%AE%E6%A6%82%E8%A6%81">2. 仕様変更の概要</a><br><a href="#3-%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E8%A1%A8%E7%A4%BA%E7%90%86%E7%94%B1%E3%81%AE%E7%89%B9%E5%AE%9A%E6%96%B9%E6%B3%95">3. メッセージ表示理由の特定方法</a><br><a href="#4-%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95">4. 対処方法</a><br><a href="#4-1-%E4%BF%A1%E9%A0%BC%E6%B8%88%E3%81%BF%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E3%82%AF%E3%83%AA%E3%82%A2%E3%83%BB%E7%84%A1%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B">4-1. 信頼済みドキュメントをクリア・無効化する</a><br><a href="#4-2-%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E3%81%BF%E3%82%92%E9%9D%9E%E8%A1%A8%E7%A4%BA%E3%81%AB%E3%81%99%E3%82%8B">4-2. メッセージのみを非表示にする</a><br><a href="#4-3-%E4%BF%A1%E9%A0%BC%E3%81%A7%E3%81%8D%E3%82%8B%E5%A0%B4%E6%89%80%E3%81%AB%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B">4-3. 信頼できる場所に保存する</a><br><a href="#4-4-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%82%92%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E8%A8%AD%E5%AE%9A%E3%82%92%E7%B7%A9%E5%92%8C%E3%81%99%E3%82%8B">4-4. コンテンツを無効にしている設定を緩和する</a>  </p><br><h2 id="1-信頼済みドキュメントとは"><a href="#1-信頼済みドキュメントとは" class="headerlink" title="1. 信頼済みドキュメントとは"></a>1. 信頼済みドキュメントとは</h2><p>Office には「信頼」という考え方があります。Office の既定の設定では、ファイルに含まれるマクロ、ActiveX、外部データ接続などの「アクティブ コンテンツ」は、ファイルを開いた時点では一旦無効化された状態とし、以下のような警告バーを表示してユーザーに手動でコンテンツを有効化するよう求めます。ファイルを信頼すると、このような警告なしにアクティブ コンテンツを自動的に有効にできます。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/ContentWarn.png"></p><p>ファイルを信頼する方法の 1 つに「信頼済みドキュメント」があります。以下の場合にそのファイルが信頼済みドキュメントとして登録されます。</p><ul><li>ローカルにあるファイルのアクティブ コンテンツを有効化する</li><li>ネットワーク共有上のファイルのアクティブ コンテンツを有効化し、信頼済みドキュメントへの登録確認メッセージで [はい] を選択する (オプションのトラスト センターでネットワーク上のドキュメントを信頼することを許可している場合のみ)  <img src="/blog/clj709nu4004pqou8fyhg7wta/NWTrustDoc.png"></li></ul><p>参考) 信頼済みドキュメント<br><a href="https://support.microsoft.com/ja-jp/office/cf872bd8-47ec-4c02-baa5-1fdba1a11b53">https://support.microsoft.com/ja-jp/office/cf872bd8-47ec-4c02-baa5-1fdba1a11b53</a></p><br><h2 id="2-仕様変更の概要"><a href="#2-仕様変更の概要" class="headerlink" title="2. 仕様変更の概要"></a>2. 仕様変更の概要</h2><p>Microsoft 365 Apps で、信頼済みドキュメントの扱いを変更しました。影響を受ける流れをイメージしやすくするため、まずは具体的な例を挙げます。</p><p>&lt;例: マクロを含むファイルと、VBA マクロのセキュリティ設定の場合&gt;</p><p><u>これまでの動作</u></p><ol><li>[トラスト センター] - [トラスト センターの設定] - [マクロの設定] を [警告して、VBA マクロを無効にする] に設定します。(マクロをユーザーが任意に有効にできる設定です)</li><li>ユーザーがローカルにあるマクロを含むファイルを開くと、警告バーが表示されます。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/ContentWarn.png"></li><li>警告バーの [コンテンツの有効化] をクリックすると、マクロは有効になり、このファイルは信頼済みドキュメントに登録されます。</li><li>ユーザーがファイルを開き直すと、信頼済みドキュメントのため、警告バーの表示なしにマクロは自動的に有効になります。</li><li>[トラスト センター] - [トラスト センターの設定] - [マクロの設定] を [警告せずに VBA マクロを無効にする] に変更します。(ユーザー操作によるマクロ有効化ができず、マクロをブロックする設定です)</li><li>Excel をいったん終了して、先ほどの信頼済みドキュメントに登録されたファイルを開きます。</li><li>警告バーの表示なしにマクロは自動的に有効になります。</li></ol><p>ポイント:<br>5. でマクロをブロックするように変更した後も、その前に信頼済みドキュメントに登録されたファイルのマクロは 7. で自動的にマクロが有効になります。</p><p><u>変更後の動作</u><br>1 ～ 6 までは、&lt;これまでの動作&gt; と同じです。5. でマクロをブロックするよう設定を変更した後に、信頼済みドキュメントに登録済みのファイルを開くと、以下の通り動作が変わります。  </p><ol start="7"><li><ol start="5"><li>で変更したトラスト センターの設定に従って、<strong>マクロは無効化</strong>されます。そして、以下の警告バーを表示します。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/TrustDocBlockMsg.png"><br></li></ol></li></ol><p>この例の通り、これまでは信頼済みドキュメントに登録すると、その後トラスト センターでアクティブ コンテンツ (上記の例ではマクロ) を無効化しても、自動的に有効になっていました。また、管理者がポリシーでアクティブ コンテンツを無効にした場合も同様でした。  </p><p>今後は、過去に 1 度信頼済みドキュメントに登録していても、トラスト センターやポリシーの設定に従ってアクティブ コンテンツを無効化します。そして、このような状況では、ユーザーに動作の変更を通知するため、新しい警告バーを表示するようになりました。これが、冒頭で記載した警告バーです。  </p><p><strong><u>まとめ</u></strong><br>今回の仕様変更により、Office の動作が以下のように変化します。</p><ul><li>信頼済みドキュメントでも、トラスト センターやポリシーで無効化しているアクティブ コンテンツは無効になります。</li><li>信頼済みドキュメントを開いたときに無効化したアクティブ コンテンツがある場合、警告バーが表示されます。</li></ul><p>注)<br>この影響を受けるのは、Office 運用開始後にアクティブ コンテンツをブロックするよう<u><strong>設定 (トラスト センターやポリシー) を厳しく変更した場合</strong></u>です。はじめからアクティブ コンテンツがブロックされている場合は、これを有効にしてファイルを信頼済みドキュメントに登録することができないため、影響はありません。<br>※ ポリシーの変更が、仕様変更の後である必要はありません。「信頼済みドキュメント登録 -&gt; ポリシーでブロック -&gt; この仕様変更」の流れでも影響を受けます。<br><br></p><p><strong><u>仕様変更の背景</u></strong><br>近年、組織での Office のセキュリティ ポリシーはより厳しく管理される傾向にあります。よりセキュリティを厳しく制限したい管理者にとって、ポリシーを変更しても信頼済みドキュメントによって、本来は無効化を想定しているコンテンツを引き続き利用できることは好ましくありません。このような管理者の要望に応えるため、Microsoft 365 Apps で今回の動作変更を行いました。</p><br>この変更の詳細は、以下の公開情報でご案内しています。  <p>Office ドキュメントでアクティブなコンテンツを管理する<br><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/active-content-in-trusted-docs">https://learn.microsoft.com/ja-jp/microsoft-365/security/active-content-in-trusted-docs</a></p><p>また、変更を行った Microsoft 365 Apps のバージョンは以下の通りです。</p><ul><li>最新チャネル: バージョン 2111 (ビルド 14701.20226)  </li><li>月次エンタープライズ チャネル: バージョン 2203 (ビルド 15028.20248)  </li><li>半期エンタープライズ チャネル (プレビュー): バージョン 2208 (ビルド 15601.20148)  </li><li>半期エンタープライズ チャネル: バージョン 2208 (ビルド 15601.20456)  <br><br></li></ul><h2 id="3-メッセージ表示理由の特定方法"><a href="#3-メッセージ表示理由の特定方法" class="headerlink" title="3. メッセージ表示理由の特定方法"></a>3. メッセージ表示理由の特定方法</h2><p>[ファイル] タブ - [情報] に表示する [セキュリティ情報] の以下の赤枠の部分に、そのファイルでブロックされているアクティブ コンテンツが表示されます。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/SecInfo.png"></p><p>このメッセージの [トラスト センターの設定] 部分をクリックすると、そのコンテンツを無効にしているトラスト センターの設定ページが開き、無効化されていることの確認や、設定の変更ができます。</p><p>一方、以下の場合はポリシーによってコンテンツが無効になっています。</p><ul><li>トラスト センターの設定項目がグレーアウトしていて変更できない</li><li>トラスト センターの設定ではコンテンツは無効になっていない</li><li>セキュリティ情報の無効化されているコンテンツの横に [トラスト センターの設定] リンクが表示されない</li></ul><p>この場合は、管理者が該当する可能性があるポリシーを確認します。ポリシーでのみ設定できるアクティブ コンテンツ関連の設定もあるため、以下の資料で、表の [カテゴリ] や [アプリ] が、現在無効になっているコンテンツの種類や、利用しているアプリと合致する各ポリシーの設定状況を確認してください。</p><p>Office ドキュメントでアクティブなコンテンツを管理する<br><a href="https://learn.microsoft.com/ja-jp/microsoft-365/security/active-content-in-trusted-docs?view=o365-worldwide#hkey_current_user-settings">https://learn.microsoft.com/ja-jp/microsoft-365/security/active-content-in-trusted-docs?view=o365-worldwide#hkey_current_user-settings</a><br>該当箇所: “HKEY_CURRENT_USER設定” &#x2F; “HKEY_LOCAL_MACHINE設定”</p><p>※ Microsoft 365 Apps で有効なポリシーを設定する方法には、以下の複数の方法があります。</p><ul><li>Microsoft 365 クラウド ポリシー</li><li>Active Directory やローカル マシンのグループ ポリシー</li><li>Intune Office アプリのポリシー</li></ul><p>なお、影響しているポリシーを特定しても、一般的には組織で決定したセキュリティ設定を緩和することは難しいと思います。特に特定の必要がなければ、影響するポリシーを確認する必要はありません。<br><br></p><h2 id="4-対処方法"><a href="#4-対処方法" class="headerlink" title="4. 対処方法"></a>4. 対処方法</h2><ul><li>実際にアクティブ コンテンツは無効でもよく、警告メッセージのみを表示したくない場合は、4-1. または 4-2. の方法が検討できます。  </li><li>アクティブ コンテンツを利用したい場合や、4-1. &#x2F; 4-2. の他への影響が好ましくない場合は、4-3. または 4-4. での対処を検討してください。</li><li>通常は、アクティブ コンテンツを利用する必要があるため、&lt;4-3. 信頼できる場所に保存する&gt; 方法での対処をお勧めします。</li></ul><br><h3 id="4-1-信頼済みドキュメントをクリア・無効化する"><a href="#4-1-信頼済みドキュメントをクリア・無効化する" class="headerlink" title="4-1. 信頼済みドキュメントをクリア・無効化する"></a>4-1. 信頼済みドキュメントをクリア・無効化する</h3><p>※ 警告メッセージのみを非表示にする方法です (アクティブ コンテンツはブロック)  </p><p>ファイルを信頼済みドキュメントと扱わないようにします。以下 2 種類の方法があります。</p><p><u>a) 信頼済みドキュメントを [クリア] する (トラスト センター)</u><br>そのアプリで登録済みの信頼済みドキュメントを全てクリアします。ただしこのとき、全てのファイルの信頼をクリアします。ブロックしていないコンテンツの信頼もクリアするため注意してください。<br>例:<br>ActiveX をブロックする設定を行っている場合、マクロのみを含むドキュメントは、信頼済みドキュメントに登録していれば自動的に有効になり、警告メッセージも表示しません。しかし、信頼済みドキュメントをクリアすると、このようなファイルも初回は一旦マクロは無効で開き、ユーザーが手動で [コンテンツの有効化] から有効にする必要があります。<br>ブロックされるコンテンツを含まないファイルは、1 度手動でコンテンツを有効化すると、信頼済みドキュメントに再登録できます。  </p><p><u>b) 信頼済みドキュメントを [無効] にする  (トラスト センター &#x2F; ポリシー)</u><br>信頼済みドキュメント機能自体を無効にします。すでに登録されている信頼済みドキュメントは信頼されなくなり、また新たに登録することもできません。a) と同様、ブロックされていないアクティブ コンテンツのみ含むファイルでも、手動で [コンテンツの有効化] が必要になります。<br>また、新たに信頼済みドキュメントに登録できないため、毎回手動での有効化が必要です。</p><p>トラスト センターでの設定は以下の画面キャプチャの赤枠のメニューから行います。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/DisableTrustDocOption.png"></p><p>ポリシーの場合は、b) のみ以下赤枠の項目で設定できます。(画面キャプチャは Excel の例ですが、同項目が各アプリに存在します)<br><img src="/blog/clj709nu4004pqou8fyhg7wta/DisableTrustDocPolicy.png"></p><br><h3 id="4-2-メッセージのみを非表示にする"><a href="#4-2-メッセージのみを非表示にする" class="headerlink" title="4-2. メッセージのみを非表示にする"></a>4-2. メッセージのみを非表示にする</h3><p>※ 警告メッセージのみを非表示にする方法です (アクティブ コンテンツはブロック)  </p><p>信頼済みドキュメントに登録済みでも警告バーを表示したくない場合は、以下のオプションで [ブロックされた内容に関する情報を表示しない] に設定すると、アクティブ コンテンツのブロック メッセージを非表示にできます。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/MsgBarOption.png"></p><p>この場合も、先述の [ファイル] タブ - [情報] のセキュリティ情報からブロック状態は確認できます。<br>ただし、<u><strong>信頼済みドキュメントに関する警告バー以外の、アクティブ コンテンツの無効化メッセージ バーもすべて非表示になる</strong></u>ため注意が必要です。(例: インターネット入手マクロのブロックを示す赤いバー)<br><br></p><h3 id="4-3-信頼できる場所に保存する"><a href="#4-3-信頼できる場所に保存する" class="headerlink" title="4-3. 信頼できる場所に保存する"></a>4-3. 信頼できる場所に保存する</h3><p>Excel オプションの [トラスト センター] - [トラスト センターの設定] - [信頼できる場所] にファイル格納フォルダーを追加すると、そのフォルダー内のファイルは信頼されます。この設定により信頼されたファイルは、トラスト センターやポリシーでアクティブ コンテンツを無効化していても、自動的にアクティブ コンテンツが有効になります。<br><img src="/blog/clj709nu4004pqou8fyhg7wta/TrustPlace.png"></p><p><u>信頼できる場所についての公開情報</u><br>Microsoft Office で信頼できる場所を追加、削除、または変更する<br><a href="https://support.microsoft.com/ja-jp/office/7ee1cdc2-483e-4cbb-bcb3-4e7c67147fb4">https://support.microsoft.com/ja-jp/office/7ee1cdc2-483e-4cbb-bcb3-4e7c67147fb4</a><br>Office ファイルの信頼できる場所<br><a href="https://learn.microsoft.com/ja-jp/deployoffice/security/trusted-locations">https://learn.microsoft.com/ja-jp/deployoffice/security/trusted-locations</a><br><br></p><h3 id="4-4-コンテンツを無効にしている設定を緩和する"><a href="#4-4-コンテンツを無効にしている設定を緩和する" class="headerlink" title="4-4. コンテンツを無効にしている設定を緩和する"></a>4-4. コンテンツを無効にしている設定を緩和する</h3><p>アクティブ コンテンツをブロックしているトラスト センターやポリシーの設定を緩和しても問題ない場合は、その設定を削除したり、コンテンツを無効にしない緩やかな設定に変更すると、信頼済みドキュメントとして扱われ、コンテンツは自動的に有効になります。<br>緩和が必要な設定の確認方法は、「<a href="#3-%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E8%A1%A8%E7%A4%BA%E7%90%86%E7%94%B1%E3%81%AE%E7%89%B9%E5%AE%9A%E6%96%B9%E6%B3%95">3. メッセージ表示理由の特定方法</a>」を参照してください。  </p><p>ただし、特定のファイルだけではなく全てのファイルでセキュリティ設定を緩和することになるため、十分に検討の上で緩和してください。</p><br>今回の投稿は以上です。<br><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2023&amp;#x2F;10&amp;#x2F;09 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color:#339966&quot;&gt;有害サイトと分類されていたため移動しました。&lt;/sp</summary>
      
    
    
    
    
    <category term="VBA マクロ" scheme="https://officesupportjp.github.io/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/"/>
    
    <category term="セキュリティ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3/"/>
    
  </entry>
  
  <entry>
    <title>必要なサービスが無効になっていますと表示される現象について</title>
    <link href="https://officesupportjp.github.io/blog/clmk7jget0001hckj66na16pi/"/>
    <id>https://officesupportjp.github.io/blog/clmk7jget0001hckj66na16pi/</id>
    <published>2023-09-15T00:00:00.000Z</published>
    <updated>2023-10-30T00:14:47.619Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。 </p><p>今回の投稿では、Microsoft 365 Apps、Office LTSC 2021、Office 2019 のご利用時に「必要なサービスが無効になっています」と表示される現象についてご説明いたします。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>Office をご利用されている際に、以下のようなメッセージが表示されるとお問い合わせいただくことがございます。</p><p><img src="/blog/clmk7jget0001hckj66na16pi/image0.png"></p><br><p>これらの表示は機能によって若干異なる場合がございます。<br>また、オンライン通信を伴う機能がグレーアウトされていたり、表示されていない場合もございます。</p><br><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Microsoft 365 Apps、Office LTSC 2021、Office 2019 (*) では、接続エクスペリエンスという機能が導入されており、オンライン接続の機能を用途ごとに有効・無効と切り替えるすることが出来るようになりました。<br>この機能が無効にされているとオンライン機能が利用できないため、上記のような現象が生じます。</p><p>Title : Microsoft 365 Apps for enterprise のプライバシー コントロールの概要<br>URL : <a href="https://learn.microsoft.com/ja-jp/deployoffice/privacy/overview-privacy-controls">https://learn.microsoft.com/ja-jp/deployoffice/privacy/overview-privacy-controls</a><br>(Office 2019 では Office での追加オプションである接続エクスペリエンスの使用を許可する のみが利用可能です)</p><br><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>以下を上からご確認ください。</p><h2 id="1-プライバシー設定の見直し"><a href="#1-プライバシー設定の見直し" class="headerlink" title="1. プライバシー設定の見直し"></a>1. プライバシー設定の見直し</h2><ol><li>Excel 等を起動し、ファイル - オプション をクリックします</li><li>トラストセンター - トラストセンターの設定 をクリックします</li><li>プライバシーオプション - プライバシー設定 をクリックします</li><li>オプションの接続エクスペリエンスをオンにする にチェックをつけてください</li><li>事象が解消するかご確認ください。</li></ol><br><h2 id="2-接続エクスペリエンス機能の見直し"><a href="#2-接続エクスペリエンス機能の見直し" class="headerlink" title="2.  接続エクスペリエンス機能の見直し"></a>2.  接続エクスペリエンス機能の見直し</h2><p>Office 管理用グループポリシーでご実施されている接続エクスペリエンス機能の無効化を見直します。</p><ul><li><strong>ポリシーの確認</strong></li></ul><p>以下の資料より、今回ご利用されたい機能が以下のどのポリシーで制御されているかをご確認ください。</p><p>Title : Officeでの接続環境<br>URL : <a href="https://learn.microsoft.com/ja-jp/deployoffice/privacy/connected-experiences">https://learn.microsoft.com/ja-jp/deployoffice/privacy/connected-experiences</a></p><p>例えば、PowerPoint デザイナー の場合、[コンテンツを分析する Office の接続エクスペリエンスの使用を許可する] を有効にします。</p><p>3D マップ の場合、[コンテンツを分析する Office の接続エクスペリエンスの使用を許可する] に加えて、[Office の追加オプションである接続エクスペリエンスの使用を許可する]を有効にします。</p><p>アイコンの挿入 の場合、[オンラインのコンテンツをダウンロードする Office の接続エクスペリエンスの使用を許可する] を有効にします。</p><p>共有 や、その他記載がない機能の場合、[Office の接続エクスペリエンスの使用を許可する​] を有効にします。</p><br><ul><li><strong>ポリシーの変更</strong></li></ul><p>Office 管理用グループポリシーで該当するポリシーの制御を変更してください。</p><p>[ユーザーの構成]‐[ポリシー]-[管理用テンプレート]-[Microsoft Office 2016]-[プライバシー]-[セキュリティ センター]</p><p>・コンテンツを分析する Office の接続エクスペリエンスの使用を許可する<br>・オンラインのコンテンツをダウンロードする Office の接続エクスペリエンスの使用を許可する<br>・Office の追加オプションである接続エクスペリエンスの使用を許可する<br>・Office の接続エクスペリエンスの使用を許可する​</p><p>もしくは、以下の資料より対応するレジストリをご確認いただき、設定を変更することで事象が解消するかをご確認ください。</p><p>Title : ポリシー設定を使用して Microsoft 365 Apps for enterprise のプライバシー コントロールを管理する<br>URL : <a href="https://learn.microsoft.com/ja-jp/deployoffice/privacy/manage-privacy-controls">https://learn.microsoft.com/ja-jp/deployoffice/privacy/manage-privacy-controls</a></p><br><h2 id="3-Information-Rights-Management-関連のユーザーインターフェイスをオンにする"><a href="#3-Information-Rights-Management-関連のユーザーインターフェイスをオンにする" class="headerlink" title="3. Information Rights Management 関連のユーザーインターフェイスをオンにする"></a>3. Information Rights Management 関連のユーザーインターフェイスをオンにする</h2><p>今回ご利用される機能が Azure Information Protection 関連かつ、以下の設定が有効となっている場合には、未構成、または、無効に変更することで事象が解消するかご確認ください。</p><p>[ユーザーの構成]‐[ポリシー]-[管理用テンプレート]-[Microsoft Office 2016]-[アクセス制限の管理]</p><p>・Information Rights Management 関連のユーザーインターフェイスをオフにする : 未構成 または 無効</p><br><p>今回の投稿は以上です。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。 &lt;/p&gt;
&lt;p&gt;今回の投稿では、Microsoft 365 Apps、Office LTSC 2021、Office 2019 のご利用時に「必要なサービスが無効になっています」と表示される現象についてご説明いたしま</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>Android にてアプリ保護ポリシーを適用していても OneNote アプリの組織データを Microsoft 365 アプリの個人領域へ共有できる動作について</title>
    <link href="https://officesupportjp.github.io/blog/clenw3diw000xf46y72q12jrq/"/>
    <id>https://officesupportjp.github.io/blog/clenw3diw000xf46y72q12jrq/</id>
    <published>2023-02-28T00:00:00.000Z</published>
    <updated>2023-10-30T00:20:57.513Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2023&#x2F;10&#x2F;30 Update</strong></span><br>本現象の対応が行われ、最新バージョンにては発生しない現象であることを記載しました。</p><p>こんにちは。Office サポートチームです。<br>この記事では、Android 端末で利用する OneNote アプリにて、<br>アプリ保護ポリシーを設定していても、組織データを個人データとして、<br>Microsoft 365 アプリに共有することができる動作について記載します。  </p><h1 id="事象の概要"><a href="#事象の概要" class="headerlink" title="事象の概要"></a>事象の概要</h1><p>BYOD で利用されるモバイル端末から企業データへアクセスする場合などを含め、<br>組織データを保護するための仕組みとして、Intune のアプリ保護ポリシーがあります。  </p><p>Android 端末においても例えば、Outlook や OneDrive, OneNote, Microsoft 365 アプリなど、<br>個人アカウントと組織アカウントの両方で利用可能なアプリに対して、<br>Intune のアプリ保護ポリシーにて、<br>[他のアプリに組織データを送信] を [ポリシーマネージドアプリ] と設定することで、<br>組織データを個人アカウントでサインイン済みの他のアプリに共有した際、<br>個人アカウントで扱うことを制限することが可能です。  </p><p>参考<br>Title: アプリ保護ポリシーの概要<br>URL: <a href="https://learn.microsoft.com/ja-jp/mem/intune/apps/app-protection-policy">https://learn.microsoft.com/ja-jp/mem/intune/apps/app-protection-policy</a>  </p><p>ただし、例外的な動作として、Android 端末において、<br>OneNote アプリの組織データを、Microsoft 365 アプリの個人領域へ共有可能であるという動作が確認されております。<br>具体的な手順は以下となります。  </p><ol><li>Microsoft 365 アプリに、個人アカウント、組織アカウントの両方でサインインし、Microsoft 365 アプリで個人アカウントが選択されている状態とする。</li><li>OneNote アプリで組織データとして扱われる OneDrive for Business 上のノートブックなどのページを開き、[…]-[ページの共有]-[プレーンテキスト]-[メモを作成 (Microsfoto 365)] をタップする。</li><li>Microsoft 365 アプリにサインインしている個人アカウントのメモとして保存される。</li></ol><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p><span style="color:#ff0000"><strong>2023&#x2F;10&#x2F;30 Update</strong></span><br>本現象の対応が行われ、最新バージョンにては、<br>OneNote の組織データのノートブックのページは、Microsoft 365 アプリの個人アカウントのメモとして保存されない動作となりました。</p><p><del>本動作について、現在開発部門で調査中となります。</del><br><del>新たな情報が確認された場合は、この記事に追記する形で公開していく予定です。</del>  </p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2023&amp;#x2F;10&amp;#x2F;30 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;本現象の対応が行われ、最新バージョンにては発生しない現象であることを記載しました。&lt;/p&gt;
&lt;p&gt;こんにちは</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>信頼済みドキュメントに関するコンテンツ ブロックメッセージの説明 (MC302216)(旧)</title>
    <link href="https://officesupportjp.github.io/blog/clefkdotu0001ukse0slv0l1u/"/>
    <id>https://officesupportjp.github.io/blog/clefkdotu0001ukse0slv0l1u/</id>
    <published>2023-02-24T00:00:00.000Z</published>
    <updated>2023-10-30T00:14:47.604Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2023&#x2F;10&#x2F;09 Update</strong></span><br><span style="color:#339966">有害サイトと分類されていたため移動しました。</span><br><br><br>本ページは <a href="https://officesupportjp.github.io/blog/clj709nu4004pqou8fyhg7wta/">信頼済みドキュメントに関するコンテンツ ブロックメッセージの説明 (MC302216)</a> に移動しました。</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2023&amp;#x2F;10&amp;#x2F;09 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color:#339966&quot;&gt;有害サイトと分類されていたため移動しました。&lt;/sp</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>VL 版の Office 2016 でオンラインストレージからファイルを開く際に稀にサインイン画面が表示される現象について</title>
    <link href="https://officesupportjp.github.io/blog/cldybofry00010gkj32idbkw7/"/>
    <id>https://officesupportjp.github.io/blog/cldybofry00010gkj32idbkw7/</id>
    <published>2023-02-10T00:00:00.000Z</published>
    <updated>2023-02-16T04:49:53.168Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。 </p><p>今回の投稿では、VL (ボリュームライセンス) 版の Office 2016 でオンラインストレージからファイルを開く際に稀にサインイン画面が表示される現象についてご説明いたします。</p><p><a href="https://officesupportjp.github.io/blog/cl0m8t2dj00393gvs3r7oar2m/index.html">VL 版の Office 2016 とは？</a></p><br><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>VL 版の Office 2016 において、Teams やブラウザを介して SharePoint 等のオンラインストレージよりファイルを開く際、稀に以下のようなサインイン画面が表示されます。</p><p>・例</p><p><img src="/blog/cldybofry00010gkj32idbkw7/image1.png"></p><br><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>本事象は Office 2016 で生じる可能性がございます。</p><p>本ダイアログが表示された場合、Office を再起動して事象が解消するかをご確認いただくとともに、改善されない場合には再度サインインをしていただきますようお願いいたします。<br>また、Microsoft 365 Apps ではオンラインストレージとのやり取りの機能が向上しておりますので、Microsoft 365 Apps をご利用いただき事象が改善するかをご確認いただけますと幸いです。</p><br><h2 id="留意点"><a href="#留意点" class="headerlink" title="留意点"></a>留意点</h2><p>本事象は以下のような場合には該当いたしません。</p><ul><li>Office を再起動してもファイルが開けない</li><li>Office のファイルの保存に失敗する</li><li>Office のサインインが出来ない</li></ul><p>このような場合には、以下の情報をご参考にいただけますと幸いです。</p><p><a href="https://officesupportjp.github.io/blog/cl0m69xu000124cvsclmc5vis/">MSI 版の Office 2016 で SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象について</a></p><p><a href="https://officesupportjp.github.io/blog/cl0m82yjj002mvovs9cil5fgy/index.html">SharePoint Server など WebDAV が有効なサーバーから Office ファイルが開かない、保存できない現象について</a></p><p><a href="https://officesupportjp.github.io/blog/cl0m6umvg001gi4vsgppfcmk0/">Office のサインインのトラブルシュートについて</a></p><br><p>今回の投稿は以上です。</p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。 &lt;/p&gt;
&lt;p&gt;今回の投稿では、VL (ボリュームライセンス) 版の Office 2016 でオンラインストレージからファイルを開く際に稀にサインイン画面が表示される現象についてご説明いたします。&lt;/p&gt;
&lt;p&gt;&lt;</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>Excel 2016 で 3D マップを利用するとエラーが発生する (状態コード 4)</title>
    <link href="https://officesupportjp.github.io/blog/cldu0kdx900004k6yd6dvgatz/"/>
    <id>https://officesupportjp.github.io/blog/cldu0kdx900004k6yd6dvgatz/</id>
    <published>2023-02-06T15:00:00.000Z</published>
    <updated>2023-02-16T04:50:10.968Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの佐村です。<br>今回の投稿では、Excel 2016 において、[挿入] タブの 3D マップを利用時にエラーとなる現象についてご案内いたします。  </p><h1 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h1><p>Excel 2016 の 3D マップ機能を利用しようとすると以下のエラーが発生します。  </p><p>3D Maps<br>3D Maps が Microsoft Bing 地図サービスに接続しているときにエラーが発生しました。　　<br>機能が制限される場合があります (状態コード: 4)。　</p><p><img src="/blog/cldu0kdx900004k6yd6dvgatz/img1.png"></p><p>その後、DirectX の初期化に関するエラーが表示され、3D マップ機能が起動しません。<br>※過去の利用履歴により上記エラー後に 3D マップ機能が起動することもあります。  </p><p><img src="/blog/cldu0kdx900004k6yd6dvgatz/img2.png"></p><h1 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h1><p>3D マップで利用する .Net framework で TLS 1.2 を利用して接続できるように<br>以下のレジストリを構成 (新規作成) します。<br>レジストリの設定には端末の管理者権限が必要となります。 </p><p>&lt;OS と Office が同じ bit&gt;<br>キー : HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319<br>名前 : SchUseStrongCrypto<br>種類 : REG_DWORD<br>値 : 1  </p><p>&lt;64bit OS 上に 32bit の Office&gt;<br>キー : HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319<br>名前 : SchUseStrongCrypto<br>種類 : REG_DWORD<br>値 : 1  </p><h3 id="ご参考"><a href="#ご参考" class="headerlink" title="ご参考"></a>ご参考</h3><p>クライアントの SSL&#x2F;TLS プロトコルと暗号スイートのAD FSを管理する<br><a href="https://learn.microsoft.com/ja-jp/windows-server/identity/ad-fs/operations/manage-ssl-protocols-in-ad-fs#enabling-strong-authentication-for-net-applications">https://learn.microsoft.com/ja-jp/windows-server/identity/ad-fs/operations/manage-ssl-protocols-in-ad-fs#enabling-strong-authentication-for-net-applications</a>  </p><h1 id="エラーの原因"><a href="#エラーの原因" class="headerlink" title="エラーの原因"></a>エラーの原因</h1><p>「状態コード: 4」のエラーは、TLS での接続に失敗していることが原因として考えられます。<br>2022年の下旬 (10月頃) に、コンテンツ配信サービス (3D マップ) 側でセキュリティ要件を変更したことにより、TLS 1.2 の接続が必要となりました。<br>これまでは TLS 1.0&#x2F;1.1 での接続も動作していましたが、TLS 1.2 での接続を必要とし、TLS 1.0&#x2F; 1.1 での接続をエラーとするよう変更がありました。 </p><p>Office 2019 や Microsoft 365 Apps では更新プログラムにより TLS 1.2 に<br>対応するように修正されましたが、Office 2016 は延長サポートフェーズであるため<br>更新による修正がリリースされていません。<br>そのため、レジストリを設定して TLS の接続方法を変更する必要があります。  </p><h1 id="レジストリの構成による影響について"><a href="#レジストリの構成による影響について" class="headerlink" title="レジストリの構成による影響について"></a>レジストリの構成による影響について</h1><p>レジストリ SchUseStrongCrypto&#x3D;1 とすると、.NET Framework 4.5.2 のバージョンで既定で利用されるプロトコルが TLS 1.2 &#x2F; 1.1 &#x2F; 1.0 となります。<br>※高いバージョンから優先的に使用されるため、基本的には TLS 1.2 を利用します。  </p><p>このレジストリが未指定または 0 となっている場合は、.NET Framework 4.5.2 では既定で利用されるプロトコルは SSL 3.0 &#x2F; TLS 1.0 となります。<br>また、.NET Framework のプログラム上で明示的にプロトコルバージョンを指定している場合上記のレジストリの値や有無に関わらず、プログラムで指定したバージョンのプロトコルを利用します。  </p><p>以上のことから、影響としてはプログラム上で明示的にプロトコルバージョンを指定して「いない」、かつ.NET Framework 4.5.2 をターゲットにビルドされているアプリを利用する場合に通信のプロトコルが変更されます。  </p><p>上記条件で通信先のサービスで TLS 1.2 をサポートしていない場合 (レガシサービスの場合) はエラーとなる可能性はございますが、セキュリティ観点から TLS 1.2 への対応を進めていただくことを推奨しております。  </p><h3 id="ご参考-1"><a href="#ご参考-1" class="headerlink" title="ご参考"></a>ご参考</h3><p>.NET Framework で TLS 1.1 および TLS 1.2 を有効化する方法 - まとめ –<br>※#6 をご参照ください。<br><a href="https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/dotnet-framework-tls12">https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/dotnet-framework-tls12</a> </p><p>今回の投稿は以上です。<br>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。 </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの佐村です。&lt;br&gt;今回の投稿では、Excel 2016 において、[挿入] タブの 3D マップを利用時にエラーとなる現象についてご案内いたします。  &lt;/p&gt;
&lt;h1 id=&quot;現象&quot;&gt;&lt;a href=&quot;#現象&quot; class=&quot;heade</summary>
      
    
    
    
    
    <category term="Excel" scheme="https://officesupportjp.github.io/blog/tags/Excel/"/>
    
  </entry>
  
  <entry>
    <title>「必要なサービスが無効になっています」と表示される現象について(旧)</title>
    <link href="https://officesupportjp.github.io/blog/cld8jp0gd00422skj5eabeqvb/"/>
    <id>https://officesupportjp.github.io/blog/cld8jp0gd00422skj5eabeqvb/</id>
    <published>2023-01-23T00:00:00.000Z</published>
    <updated>2023-10-30T00:14:47.604Z</updated>
    
    <content type="html"><![CDATA[<p>本ページは <a href="https://officesupportjp.github.io/blog/clmk7jget0001hckj66na16pi/">「必要なサービスが無効になっています」と表示される現象について</a> に移動しました。</p><p><span style="color:#ff0000"><strong>2023&#x2F;9&#x2F;15  Update</strong></span><br><span style="color:#339966">有害サイトと分類されていたため移動しました</span></p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本ページは &lt;a href=&quot;https://officesupportjp.github.io/blog/clmk7jget0001hckj66na16pi/&quot;&gt;「必要なサービスが無効になっています」と表示される現象について&lt;/a&gt; に移動しました。&lt;/p&gt;
&lt;p&gt;&lt;sp</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>Word 文書内の図の位置がずれて印刷される現象について</title>
    <link href="https://officesupportjp.github.io/blog/clc72h24j0001v0jo35060br5/"/>
    <id>https://officesupportjp.github.io/blog/clc72h24j0001v0jo35060br5/</id>
    <published>2022-12-28T00:00:00.000Z</published>
    <updated>2023-02-07T07:57:41.460Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、図を含んだ Word 文書を印刷した際に、図の位置が編集中の表示箇所とは異なる位置で印刷される現象について説明します。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>図や図形等のオブジェクトが挿入されている Word 文書を印刷した際、編集中や印刷プレビューで確認できる図やオブジェクトの配置場所とは異なる場所に図やオブジェクトが印刷されてしまう場合があります。<br>Word 文書の構成内容に依存して発生する場合があり、また、毎回必ず位置がずれるわけではなく、正常な位置で印刷される場合もあります。</p><p>Microsoft 365 Apps の Word の他、Word 2019 や Word 2021、過去のバージョンの Word でも発生する場合があります。</p><h2 id="回避方法"><a href="#回避方法" class="headerlink" title="回避方法"></a>回避方法</h2><p>上記の現象について、Word のバックグラウンド印刷の設定を変更することで回避できる場合があります。<br>手順を以下に説明します。</p><ol><li>Word を起動します。</li><li>[ファイル] メニューより [オプション] を選択します。</li><li>「Word のオプション」 ダイアログで [詳細設定] を選択します。</li><li>[印刷] の項目内にある [バックグラウンドで印刷する] のチェックをオフにします。</li><li>[OK] を押して 「Word のオプション」 ダイアログを閉じます。</li><li>Word を終了します。</li></ol><p>この設定を行った後で Word 文書を開きなおし、印刷を行います。</p><h2 id="Word-のバックグラウンド印刷について"><a href="#Word-のバックグラウンド印刷について" class="headerlink" title="Word のバックグラウンド印刷について"></a>Word のバックグラウンド印刷について</h2><p>[バックグラウンドで印刷する] の設定は、既定ではチェックがオンになっています。<br>チェックのオン、オフそれぞれの場合の動作は以下となります。</p><p>チェックがオンの場合 :<br>印刷を実行中に Word の操作が可能となります。<br>Word のウィンドウの下部に表示されるステータス バーに印刷状況が表示されます。</p><p>チェックがオフの場合 :<br>印刷処理が完了するまで Word の操作を行えません。<br>印刷中には印刷中であることを示すメッセージが表示されます。</p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、図を含んだ Word 文書を印刷した際に、図の位置が編集中の表示箇所とは異なる位置で印刷される現象について説明します。&lt;/p&gt;
&lt;h2 id=&quot;現象&quot;&gt;&lt;a href=&quot;#現象&quot; class=&quot;heade</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>Office プロセスを自プログラム専用にする方法</title>
    <link href="https://officesupportjp.github.io/blog/cl0mfb7bc0021nwvs6zie7xtv/"/>
    <id>https://officesupportjp.github.io/blog/cl0mfb7bc0021nwvs6zie7xtv/</id>
    <published>2022-12-26T00:00:00.000Z</published>
    <updated>2023-02-07T07:57:41.444Z</updated>
    
    <content type="html"><![CDATA[<hr><p><strong>2022&#x2F;12&#x2F;26 Update</strong><br>Microsoft 365 Apps での動作をベースに全体的に記事の構成を改訂しました。</p><hr><br><p>こんにちは、Office 開発 サポート チームです。</p><p><a href="https://officesupportjp.github.io/blog/cl0n10ddh000t90vsbpgv3r9l">前回の投稿</a>で Excel のプロセスを統合することについて記載しましたが、今回はこれに関連し、Office を操作するプログラムを開発するときに、プログラムから操作する Office プロセスを自分のプログラム専用にできるか、という話を記載します。<br><br></p><p>Office を操作するプログラム開発を行う際、プログラムの処理が行いやすいよう、Office アプリケーションのプロパティを変更したり、画面を非表示にすることがあります。このとき、プログラムから行うプロパティ設定や画面の状態を、ユーザーが開いている他の Office ファイルには反映させたくないといった理由から、「ユーザーが起動する Office とプログラムが起動する Office でプロセスを分けたい」というご相談を頂くことがあります。<br><br></p><p><strong><h4>実現方法</h4></strong><br><u>Excel</u><br>COM オートメーションで Office を起動してください。 (CreateObject や new、CoCreateInstance など)  </p><p><u>Word &#x2F; PowerPoint</u><br>このような動作を実現する方法はありません。</p><p><strong><h4>既定の動作</h4></strong><br>過去投稿で、Office では起動方法によって、既に起動されたプロセスがある場合には、これを利用して新しいファイルを開く動作となることをご紹介しています。  </p><p>過去の投稿)<br>タイトル : Excel 2013 からのウィンドウ管理方法変更について – シングル ドキュメント インターフェイス (SDI)<br>アドレス : <a href="https://officesupportjp.github.io/blog/cl0n10dct000i90vs4c2a3pct/">https://officesupportjp.github.io/blog/cl0n10dct000i90vs4c2a3pct/</a></p><p>タイトル : Office のプロセス インスタンス制御について<br>アドレス : <a href="https://officesupportjp.github.io/blog/cl0n10de6001p90vsaa9n6gy8/">https://officesupportjp.github.io/blog/cl0n10de6001p90vsaa9n6gy8/</a></p><br><p><strong><h4>対応方法 1</h4></strong><br>過去投稿でご案内している Excel の &#x2F;x コマンドライン スイッチや DisableMergeInstance レジストリのように、アプリ起動時に新規プロセスで起動するよう変更できる起動方法も一部用意されています。このような仕組みを用いて、後からユーザーがファイルを開くときに、起動済みのプログラム用のプロセスで開かれることを、ある程度は防ぐことができます。  </p><p>しかし、このような構成を行っても、例えば以下のような方法で 2 つめの Office ファイルを開くと、既存プロセスで開かれます。 </p><ul><li>Offie ファイルをダブル クリックする</li><li>OLE 埋め込みオブジェクトとして埋め込まれた Office ファイルを開く</li><li>他の Office オートメーションを行うプログラムが Process.Start 等の方法で Office プログラムを起動してファイルを開く</li></ul><br><p><strong><h4>対応方法 2</h4></strong><br>Excel のみは、COM オートメーションでプロセスを起動すると、以下のどちらのシナリオでも、起動した Excel プロセスが既存プロセスにマージされるのを防ぐことができます。</p><ul><li>既にプロセスが存在する状態で COM オートメーションでプロセスを起動する</li><li>COM オートメーションでプロセスを起動した後、ユーザーが新たにアプリを起動したりファイルを開く<br></li></ul><p>ただし、プログラムから起動したプロセスの Excel 画面を表示状態にしてユーザー操作可能とする場合、その画面内の操作 ([ファイル] - [開く] など) でファイルを開く場合は、そのプロセス内で開きます。<br><br></p><p><strong><h4>補足</h4></strong><br>リモートデスクトップで複数のユーザーが 1 つの端末にログインして Office を利用する場合、ユーザー間でプロセスが統合されることはありません。ただし、これを利用して意図的にログインしていないユーザーで Office を起動するような動作は、Office のサポート外の構成となります (Office のサーバーサイド オートメーションと呼ばれる構成に該当します) 。Office の起動ユーザーは、必ずログインしているユーザーで行う必要があります。  </p><p>Office のサーバーサイド オートメーションについては、公開情報や本ブログの過去投稿でご案内しています。  </p><p>タイトル : Office のサーバーサイド オートメーションについて<br>アドレス : <a href="https://support.microsoft.com/ja-jp/kb/257757">https://support.microsoft.com/ja-jp/kb/257757</a>  </p><p>タイトル : Office サーバー サイド オートメーションの危険性について<br>アドレス : <a href="https://officesupportjp.github.io/blog/cl0mfb7b7001wnwvshfp01l5u/">https://officesupportjp.github.io/blog/cl0mfb7b7001wnwvshfp01l5u/</a>  </p><br><p><strong><h4>図解</h4></strong><br>文章だけでは分かり辛い点もあるかと思いますので、以下に Excel の動作を例にどのような動作になるか、図を用いて説明します。Microsoft 365 Excel での既定の設定の場合を代表として解説します。Excel 以外のアプリでは動作が異なるため注意してください。<br><br></p><p>まず、以下に自分のプログラムが初めに Excel プロセスを起動した後、他の方法で Excel を利用する場合の動作を図解します。(ここで初めにプログラムからプロセスを起動するときは、Process.Start のように COM オートメーションではない方法での起動を想定しています。)</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image1.png">  </p><p>図 1. 自プログラム (Process.Start) → 他の方法</p><br><p>一方、&lt;対応方法 2&gt; に記載したように COM オートメーションでプロセスを起動した場合の図です。COM オートメーションで起動したプロセスには、他の操作によりファイルを開いた場合もマージされません。<br>※ ただし先述の通り、①で起動したプロセス内での操作で開くファイルは①のプロセスで開かれます。([開く] メニューからの操作や、OLE 埋め込みファイルを開く場合など)</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image4.png">  </p><p>図 2. 自プログラム (COM オートメーション) → 他の方法</p><br><p>次に、先にユーザー操作などですでに Excel プロセスを起動しているところに、自プログラムが Excel を起動した場合について図解します。</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image2.png">  </p><p>図 3. 他の方法 → 自プログラム</p><br><p>また、複数のプロセスが存在する場合の動作はさらに複雑です。以下の図に示す通り、既存プロセスに統合される場合にどちらのプロセスに統合されるかは、明確に決められておりません。</p><p><img src="/blog/cl0mfb7bc0021nwvs6zie7xtv/image3.png">  </p><p>図 4. 複数プロセスが存在する場合</p><br><p>以上の通り、Excel では COM オートメーションにより、自プログラムから起動したプロセスを自身専用にすることができますが、Word や PowerPoint では実現できません。また、Excel でも設計によっては、Process.Start 等の起動方法の方が実装しやすい処理もあるかと思いますので、このような場合は、プロセスの専用化とのトレードオフが生じます。</p><p>プロセスのマージが生じるようなプログラムを設計する場合は、自ブログラムで起動する Office プロセスがユーザー操作や他のプログラムで起動されるプロセスと統合されても問題ない動作となるよう設計してください。<br><br></p><p>今回の投稿は以上です。<br><br></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;2022&amp;#x2F;12&amp;#x2F;26 Update&lt;/strong&gt;&lt;br&gt;Microsoft 365 Apps での動作をベースに全体的に記事の構成を改訂しました。&lt;/p&gt;
&lt;hr&gt;
&lt;br&gt;

&lt;p&gt;こんにちは、Office 開発 サポート</summary>
      
    
    
    
    
    <category term="SDI" scheme="https://officesupportjp.github.io/blog/tags/SDI/"/>
    
  </entry>
  
  <entry>
    <title>Word での印刷で意図しない塗りつぶしが生じる</title>
    <link href="https://officesupportjp.github.io/blog/cla7qogkl006pa0jo434segs3/"/>
    <id>https://officesupportjp.github.io/blog/cla7qogkl006pa0jo434segs3/</id>
    <published>2022-11-08T00:00:00.000Z</published>
    <updated>2023-02-07T07:57:41.460Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、Word で文書を印刷した際、編集画面や印刷プレビューでの表示とは異なり、画像データの一部が塗りつぶされた状態で印刷されてしまう現象について説明します。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>Word 文書に以下のような構成の画像データを貼り付けて印刷した場合、編集時や印刷プレビューでは白もしくはグレー等の色で表示されている箇所がすべて塗りつぶされた状態で印刷されてしまう場合があります。</p><p>  ・EMF 形式のデータで構成される画像データを貼り付けている。<br>  ・EMF 形式のデータ内で、透過処理を行ったビットマップが使用されている。</p><p>例えば黒色の矩形のビットマップを透過処理にてグレーに見えるように表示させている画像データが貼られている Word 文書を印刷した時、画像データの当該箇所が黒で塗りつぶされた状態で印刷されてしまう場合があります。</p><h2 id="回避方法"><a href="#回避方法" class="headerlink" title="回避方法"></a>回避方法</h2><p>上記の要因で発生している現象につきましては、ご使用のプリンター ドライバーの設定でスプール ファイルの形式を変更可能であれば EMF スプール形式を選択いただくことで、現象を回避できる場合があります。<br>具体的な設定方法はプリンター ドライバーごとに異なりますので、各プリンター ドライバーのヘルプ等を参照くださいますようお願いいたします。</p><p>プリンター ドライバーの設定でスプール ファイルの形式を変更できないプリンターの場合は、以下のような手順で問題が発生する画像データをコピーしてビットマップとして貼り付けなおすことで現象を回避できる場合があります。なお、この手順の場合、印刷結果として出力される画像の変更前と比較して精度が低くなる可能性がございます。</p><p>ビットマップ形式で貼り付けなおす手順の例</p><ol><li>あらかじめオリジナルのファイルをコピーするなどしてバックアップしておきます。</li><li>Word で当該ファイルを開きます。</li><li>問題の生じる画像データを右クリックし、[切り取り] メニューを選択します。</li><li>Word の [ホーム] タブ内の [貼り付け] ボタン下の矢印をクリックして [貼り付けのオプション] より [形式を選択して貼り付け] を選択します。</li><li>「形式を選択して貼り付け」 ダイアログで [ビットマップ] を選択して OK を押して貼り付けます。</li><li>貼り付けられた画像データを確認し、別名を付けて保存します。</li></ol><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、Word で文書を印刷した際、編集画面や印刷プレビューでの表示とは異なり、画像データの一部が塗りつぶされた状態で印刷されてしまう現象について説明します。&lt;/p&gt;
&lt;h2 id=&quot;現象&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>Word for Mac での印刷時のカラー設定の表記差異について</title>
    <link href="https://officesupportjp.github.io/blog/cl9dgphrg0000m4vsb52864vv/"/>
    <id>https://officesupportjp.github.io/blog/cl9dgphrg0000m4vsb52864vv/</id>
    <published>2022-10-18T15:00:00.000Z</published>
    <updated>2023-02-07T07:57:41.460Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。</p><p>この記事では、Word for Mac での印刷時のカラー設定に関して、<br>確認されている動作をご案内いたします。</p><br /><h1 id="事象詳細"><a href="#事象詳細" class="headerlink" title="事象詳細"></a>事象詳細</h1><p>Word for Mac では、ご利用のドライバ等によって、<br>以下二か所から、カラー設定を行うことが可能です。<br>※実際の見た目はご利用のプリンタ・プリンタドライバ等によって異なります。</p><ul><li>[印刷部数と印刷ページ] メニュー<br><img src="/blog/cl9dgphrg0000m4vsb52864vv/%E5%8D%B0%E5%88%B7%E9%83%A8%E6%95%B0%E3%81%A8%E5%8D%B0%E5%88%B7%E3%83%9A%E3%83%BC%E3%82%B8.png"></li></ul><br><ul><li>[プリンタの機能] メニュー<br><img src="/blog/cl9dgphrg0000m4vsb52864vv/%E3%83%97%E3%83%AA%E3%83%B3%E3%82%BF%E3%81%AE%E6%A9%9F%E8%83%BD.png"></li></ul><br><p>それぞれの設定の変更を繰り返す際、Word for Mac の動作に影響を受け、<br>[印刷部数と印刷ページ] メニューと [プリンタの機能] メニュー の印刷のカラー印刷設定の表記が、<br>一方では “白黒で印刷する設定”, 一方では “カラーで印刷する設定” のように、<br>異なるカラー印刷設定を示す場合があることが確認されております。  </p><br><p>恐れ入りますが、現時点で有効な回避方法はございません。<br>Word for Mac を再起動すると再度両方の設定が一致した状態となりますので、<br>事象発生時には Word for Mac を再起動する、<br>印刷時に期待したカラー設定で印刷されているか印刷結果を再確認するなどによって、<br>ご対応くださいますようお願いいたします。  </p><br><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;/p&gt;
&lt;p&gt;この記事では、Word for Mac での印刷時のカラー設定に関して、&lt;br&gt;確認されている動作をご案内いたします。&lt;/p&gt;
&lt;br /&gt;

&lt;h1 id=&quot;事象詳細&quot;&gt;&lt;a href=&quot;#事象詳細&quot; cla</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>インターネット入手マクロ ブロックのトラブルシュートの流れ</title>
    <link href="https://officesupportjp.github.io/blog/cl97y6c2w0000ykse7nll9auc/"/>
    <id>https://officesupportjp.github.io/blog/cl97y6c2w0000ykse7nll9auc/</id>
    <published>2022-10-14T00:00:00.000Z</published>
    <updated>2023-10-30T00:14:47.604Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2023&#x2F;02&#x2F;09 Update</strong></span><br><span style="color:#339966">- &lt;5. Web サイトの URL を確認&gt; 内のインターネット一フォルダーの動作の項番ずれを修正し、詳細を追記しました。</span><br><span style="color:#339966">- &lt;補足 3: 信頼できる署名での回避方法&gt; を追記しました。</span><br><br><br><span style="color:#ff0000"><strong>2023&#x2F;05&#x2F;18 Update</strong></span><br><span style="color:#339966">序文に本動作を無効化するポリシーの記載を追加しました。</span><br><br><br><span style="color:#ff0000"><strong>2023&#x2F;06&#x2F;22 Update</strong></span><br><span style="color:#339966">- &lt;3. Web マーク有無の確認&gt; 内に Web マークの実体に関する説明を追加しました。</span><br><span style="color:#339966">- 信頼できる場所についてネットワーク上のパスを登録する際の注意点を追加しました。</span><br><br><br><span style="color:#ff0000"><strong>2023&#x2F;10&#x2F;09 Update</strong></span><br><span style="color:#339966">“5. Web サイトの URL を確認” - &lt;対処方法&gt; の記載を変更しました。</span><br><br><br>こんにちは、Office サポート チームの中村です。</p><p>2022 年 4 月以降、Office 製品ではインターネットから入手したマクロが既定でブロックされるようになる変更を進めています。すでに公開情報や過去のブログ記事で、この動作変更詳細や、ブロックされるマクロを有効化する方法をご案内しています。  </p><p>ただ、今回の動作変更では、マクロがブロックされるシナリオや関連する設定が多岐に渡り、公開情報にも様々な情報が掲載されています。このため、実際にマクロがブロックされている状態において、「何が理由でブロックされているのか」、「どのような対処方法をとるべきか」の判断が難しいことから、サポートへのお問い合わせを頂くことがあります。  </p><p>本記事ではこのようなユーザーに向けて、トラブルシュートの流れをまとめました。以下の記述に従って上から順に確認していくことで、そのファイルがブロックされている理由を特定し、その場合に検討できる対応方法を確認できる記事内容となっています。  </p><p>個々の動作詳細や、対応方法の設定手順などは割愛しますので、既存記事をご参照ください。  </p><p>&lt;既存関連記事&gt;<br>A) Macros from the internet will be blocked by default in Office<br><a href="https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked</a> (日本語版 - 機械翻訳)<br><a href="https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked</a> (英語版)  </p><p>B) インターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について (MC322553)<br><a href="https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/">https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/</a><br><br></p><p><strong><h3>インターネット入手ファイルのマクロ ブロック動作全体を無効化したい場合</h3></strong><br>以下でご案内する状況に応じた対処が難しい場合、この動作変更全体を無効化し、インターネット入手ファイルもローカル ファイルと同等に扱う以前の動作に戻すことも可能です。このような対処については、上記関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-1">【マクロを有効にする方法について】 - 1) ポリシーでマクロを有効にする方法</a>」をご参照ください。<br>ただし今回の動作変更は、メールに添付した Office ファイルや、インターネット上のサイトで公開されている Office ファイル内のマクロによる攻撃の増加を鑑みたセキュリティ強化を目的としたものです。このようなセキュリティ強化が無効化されることに十分にご留意ください。<br>特段の事情がない場合、以下の通りファイルや Web サイト、ネットワーク共有ごとに、安全と判断できるものを個別にブロック解除することをお勧めします。</p><br><br><p><strong><h2>前提: 動作概要</h2></strong><br>今回の動作変更で “インターネットから入手” と判断されマクロがブロックされるシナリオは、大きく分けて以下の 3 種類があります。</p><ul><li>外部から受信したメールの添付ファイル</li><li>ファイルに Web マークがついている</li><li>ファイルの格納フォルダー パスがインターネット ゾーンである (Web サイトやファイル共有上のファイルを開く場合)</li></ul><p>以下のトラブルシュートの流れでは、これらのどの条件に該当するかを順に確認していきます。  </p><br><br><p><strong><h2>トラブルシュートの流れ</h2></strong><br>まず、以下の確認の流れをフロー図で記載します。このフローで確認の流れをイメージし、1. から順に確認を進めてください。</p><p><img src="/blog/cl97y6c2w0000ykse7nll9auc/FlowChart.png">  </p><br><br>    <p><strong><h2 id="chapter1">1. エラーメッセージの確認</h2></strong><br>今回の変更の他にも、Office にはマクロの実行をブロックする様々な設定があります。<br>今回の動作変更によってブロックされている場合は以下のメッセージが表示されますので、まずはメッセージ内容がこの通りであるかを確認します。<br><img src="/blog/cl97y6c2w0000ykse7nll9auc/BlockMessage.png">  </p><p><u>次のステップ</u><br>メッセージ内容に相違がなければ、<a href="#chapter2">&lt;2. メール添付ファイルかの確認&gt;</a> に進みます。<br>異なるメッセージの場合は、メッセージ内容に応じた設定などの確認が必要ですので、この記事では割愛します。</p><br><br><p><strong><h2 id="chapter2">2. メール添付ファイルかの確認</h2></strong><br>Outlook アプリで受信した社外からのメールに添付された Office ファイルを、Outlook 上で添付ファイルのアイコンをダブル クリックしたり、Outlook の添付ファイル横の矢印で開いたメニューの [開く] から開いている場合は、【外部から受信したメールの添付ファイルであること】が理由でマクロがブロックされています。  </p><p>&lt;対処方法&gt;<br>一旦添付ファイルをマシンに保存してからファイルを開きます。<br>ただしその際に、さらに 3. 以降の理由でブロックされることが想定されます。保存したファイルがブロックされる場合は、3. 以降の確認を続けて行ってください。</p><p><u>次のステップ</u><br>このような操作シナリオではない場合は、<a href="#chapter3">&lt;3. Web マーク有無の確認&gt;</a> に進みます。</p><br><br><p><strong><h2 id="chapter3">3. Web マーク有無の確認</h2></strong><br>現在開いているファイルを、どこかに保存して開いている場合は、そのファイルを右クリックして [プロパティ] を確認します。<br>このとき、以下の赤枠のメッセージが表示される場合は、【ファイルに Web マーク (※) が付与されていること】が理由でマクロがブロックされています。(Web マークは、インターネット サイトからダウンロードしたファイルや、外部からのメール添付ファイルを保存した場合に付与されます。)<br><img src="/blog/cl97y6c2w0000ykse7nll9auc/WebMark.png">  </p><p>※<br>ここに記載の Web マークの実体はゾーン識別子 (Zone.Identifier) に保存されており、コマンド プロンプトで以下のように “&lt;ファイル パス&gt;:Zone.Identifier” と入力することで確認できます。この実行結果で ZoneId&#x3D;3 (インターネット) &#x2F; ZoneId&#x3D;4 (制限付きサイト) の場合が Web マークが付与されている状態です。ファイルのプロパティの赤枠は ZoneId&#x3D;2 (信頼済みサイト) などでも表示がされますが、マクロはブロックされません。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> more &lt; &quot;C:\temp\sample.xlsm:Zone.Identifier&quot;</span><br><span class="line"> -- コマンド実行結果例 --</span><br><span class="line"> [ZoneTransfer]</span><br><span class="line">ZoneId=3</span><br><span class="line">ReferrerUrl=https://xxxxxx.xxx</span><br><span class="line">HostUrl=https://xxxxxxxxx.xxx</span><br></pre></td></tr></table></figure><br><p>&lt;対処方法&gt;<br><u>1) Web マークを削除する</u><br>上図の [許可する] にチェックを入れて [OK] をクリックし、Web マークを削除します。<br>ただし、この理由に加えて、<a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> のブロック理由にも当てはまる場合があります。Web マークを削除してもマクロがブロックされる場合は、続けて <a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> について確認してください。  </p><p>※ 注<br>プロパティに上記のセキュリティ メッセージが表示される場合でも、厳密には Web マークには該当せずブロック対象とならない場合があります。この動作については、冒頭の公開情報 A) の「<a href="https://learn.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked#mark-of-the-web-and-zones">Web とゾーンのマーク</a>」を参照してください。このような細かな動作はありますが、マクロを利用したい場合は、「プロパティにセキュリティ メッセージが表示されていたら削除する」という運用にすると、シンプルな対応が可能です。  </p><br><br><p><u>2) ファイルを信頼されたフォルダーに格納する</u><br>以下のいずれかの方法で、「このフォルダーに格納したファイルは安全とみなす」という “信頼できるフォルダー” の設定が可能です。<br>任意の場所を信頼できるフォルダーとして設定したら、そこに Web マークがついたままのファイルを格納します。この場合は、ファイルに Web マークがあることより「その場所が安全である」ということが優先されるため、マクロを有効にできます。</p><p>  a. Office の [信頼できる場所] に登録する<br>  手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-3">3) 特定のフォルダーのファイルでマクロを有効にする方法</a>」を参照してください。  </p><p>  b. インターネット オプションの [信頼済みサイト] に登録する (ファイルの保存フォルダーがネットワーク共有の場合のみ)<br>  手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-4">4) Web・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</a>」を参照してください。  </p><p>  ※ a. &#x2F; b. の対処方法の違いは、後述の「<a href="#chapterEx1">補足1: フォルダーや URL を信頼する対処方法の違い</a>」をご参照ください。  </p><p><u>次のステップ</u><br>プロパティにセキュリティ メッセージが表示されていない場合は、ファイルの保存場所に応じて以下の手順に進みます。(ファイルが元々どこにあったかではなく、今開いているファイル自体が存在する場所です。)<br>ファイルをネットワーク共有に保存している場合 → <a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> に進みます。<br>Web サイトから直接ファイルを開いている場合 → <a href="#chapter5">&lt;5. Web サイトの URL を確認&gt;</a> に進みます。  </p><br><br>  <p><strong><h2 id="chapter4">4. ファイルの格納フォルダーパスの確認</h2></strong><br>ファイルに Web マークがついていなくても、ファイルの格納場所が「インターネット ゾーン」と判断される場合は、安全でない場所としてマクロがブロックされます。<br>インターネット ゾーンの判断はファイル格納パスによって行われ、一般的に以下の場合はインターネット ゾーンとなります。  </p><ul><li>IP アドレスで接続しているネットワーク共有 (例: \\111.111.111.111\share)</li><li>FQDN で接続しているネットワーク共有 (例: \\server.domain.com\share)<br>※ ネットワーク ドライブの場合、ネットワーク ドライブ割り当て時に上記のようなパスを使用すると同様にインターネット ゾーンとなります。</li></ul><p>この要因でブロックされているかを確認するため、ファイルをローカルにコピーして開いてください。(企業環境では、ユーザー プロファイルのフォルダーがフォルダー リダイレクト設定でサーバー上にリダイレクトされている場合があるため、C:¥work のように C ドライブ直下にフォルダーを作成してここにファイルを格納して確認することをお勧めします。)  </p><p>ローカルにコピーするとブロックされない場合は、【ファイル格納パス】が理由でマクロがブロックされています。  </p><p>&lt;対処方法&gt;<br><u>1) サーバー名のみで接続する</u><br>ネットワーク共有がクライアントと同じドメイン内にある場合は、「\\server\share」のようにサーバー名のみで接続します。この場合は、安全な場所と判断されるため、ファイル格納フォルダーパスによるブロックは行われません。</p><p><u>2) ファイルをローカルにコピーして開く</u><br>ファイルをローカル フォルダーにコピーしてから開きます。</p><p><u>3) Office の [信頼できる場所] に登録する (FQDN の場合のみ利用可能)</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-3">3) 特定のフォルダーのファイルでマクロを有効にする方法</a>」を参照してください。<br>※ 参照先に記載の [自分のネットワーク上にある場所を信頼する (推奨しません)] も併せて有効にする必要があります。</p><p><u>4) インターネット オプションの [信頼済みサイト] に登録する</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-4">4) Web・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</a>」を参照してください。</p><p><u>5)インターネット オプションの [ローカル イントラネット] に登録する</u><br>手順は 4) とほぼ同様です。手順 3. で [ローカル イントラネット] を選んで、[詳細設定] からフォルダー パスを追加できます。  </p><p>※3) ～ 5) の対処方法の違いは、後述の「<a href="#chapterEx1">補足1: フォルダーや URL を信頼する対処方法の違い</a>」をご参照ください。  </p><br><br><p><strong><h2 id="chapter5">5. Web サイトの URL を確認</h2></strong><br>Web サイトからファイルを開いている場合、その Web サイトがインターネット ゾーンの場合はマクロがブロックされます。<br>一般的に以下の場合はインターネット ゾーンとなります。  </p><ul><li>IP アドレスで接続 (例: <code>https://111.111.111.111</code>)</li><li>FQDN で接続(例: <code>https://server.domain.com</code>)</li></ul><p>この要因でブロックされているかを確認するため、一旦ファイルをローカルにダウンロードして <a href="#chapter3">&lt;3. Web マークの確認&gt;</a> を行ってください。<br>ダウンロードしたファイルに Web マークが付与されている場合は、ダウンロード元の Web サイトがインターネット ゾーンと判断されています。この場合、Web サイトから直接開くときは【ファイルをホストしている Web サイトの URL】が理由でマクロがブロックされています。</p><p>&lt;対処方法&gt;<br><u>1) サーバー名のみで接続する</u><br>Web サーバーがクライアントと同じドメイン内にある場合は、「<code>https://server</code>」のようにサーバー名のみで接続します。この場合は、通常イントラネットと判断されるため、ファイル格納フォルダーパスによるブロックは行われません。  </p><p><u>2) ファイルをダウンロードして開く</u><br>ファイルを開くときの確認メッセージで [保存] を選び、ローカルにダウンロードしてから開きます。<br>ただし、ダウンロードしたファイルが今度は <a href="#chapter3">&lt;3. Web マークの確認&gt;</a> や <a href="#chapter4">&lt;4. ファイルの格納フォルダーパスの確認&gt;</a> の理由でブロックされる場合があるため、ダウンロードしたファイルについて、改めてこれらの確認を行ってください。  </p><p><u>3) Office の [信頼できる場所] に登録する (FQDN の場合のみ)</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-3">3) 特定のフォルダーのファイルでマクロを有効にする方法</a>」を参照してください。<br>※ 参照先に記載の [自分のネットワーク上にある場所を信頼する (推奨しません)] も併せて有効にする必要があります。</p><p><u>4) インターネット オプションの [信頼済みサイト] に登録する</u><br>手順は先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-4">4) Web・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</a>」を参照してください。  </p><p>※3) ～ 4) の対処方法の違いは、後述の「補足 1: フォルダーや URL を信頼する対処方法の違い」をご参照ください。</p><p><strong>注意</strong><br>Microsoft Edge の IE モードや、Internet Explorer で Web サイトを開いている場合は、Web サイトの応答によっては (後述の <a href="#ResponseHeader">&lt;※ 応答ヘッダーの動作&gt;</a> 参照) [インターネット一時ファイル] 格納フォルダーにファイルをダウンロードして開きます。このフォルダーの場所は、[インターネット オプション] – [全般] タブ – [設定] の以下赤枠より確認できます。  </p><p><img src="/blog/cl97y6c2w0000ykse7nll9auc/IETempFolder.png">  </p><p>このフォルダーに一時保存されて開くシナリオは、先述の 1) および 3) ～ 4) の対応方法では回避できません。以下のいずれかの方法で対処してください。</p><ul><li>“2) ファイルをダウンロードして開く” で対処する</li><li>Web サイト側で、応答を変更した上で 1) &#x2F; 3) &#x2F; 4) のいずれかを実施する (後述の <a href="#ResponseHeader">&lt;※ 応答ヘッダーの動作&gt;</a> 参照)</li></ul><p>このフォルダーからファイルが開かれているかどうかは、Office の [ファイル] タブ - [情報] メニューから確認できます。[パスのコピー] をクリックし、その後テキスト エディタなどに貼り付けて、現在開いているファイルの格納フォルダーを確認します。  </p><p><img src="/blog/cl97y6c2w0000ykse7nll9auc/FilePath.png">  </p><br><p><strong><p id="ResponseHeader">※ 応答ヘッダーの動作</p></strong><br>Web サイトの応答によって、開かれる Office ファイルのパスが異なります。マクロ ブロックを避けるには、レスポンス ヘッダーを Content-Disposition:Inline に設定してください。</p><p>Content-Disposition:Attachment の場合:<br>インターネット一時フォルダーにテンポラリ ファイルとして保存され、Office からはこのテンポラリ ファイルを開く流れとなります。したがって、ファイル パスがインターネット一時フォルダーであるとみなされ、マクロがブロックされます。</p><p>Content-Disposition:Inline の場合:<br>Office からは、Web サイト上のファイルを開いている扱いとなり、ファイル パスは Web サイトの URL となります。したがって、1) の方法でホスト名のみで接続するか、3) ～ 4) の方法で Web サイトのパスを信頼する・社内ネットワークとして扱うことで、マクロはブロックされません。</p><br><br><p><strong><h2 id="chapterEx1">補足 1: フォルダーや URL を信頼する対処方法の違い</h2></strong><br>対処方法として記載した各フォルダーを信頼する方法について、動作の違いを以下にまとめます。これを参考に、どの方法を採用するかをご検討ください。</p><table><thead><tr><th></th><th>Office の  信頼できる場所</th><th>インターネット オプションの [信頼済みサイト]</th><th>インターネット オプションの [ローカル イントラネット]</th></tr></thead><tbody><tr><td>マクロ有効化の動作</td><td>(マクロのセキュリティ オプションが既定の場合)自動有効化</td><td>一旦無効な状態で開き、警告バーを表示 ([コンテンツの有効化] をクリックして有効化可能)</td><td>一旦無効な状態で開き、警告バーを表示 ([コンテンツの有効化] をクリックして有効化可能)</td></tr><tr><td>Web マークがついたファイルのマクロ有効化の動作</td><td>自動有効化</td><td>一旦無効な状態で開き、警告バーを表示 ([コンテンツの有効化] をクリックして有効化可能)</td><td><span style="color:#ff0000"><strong>ブロック</strong></span></td></tr><tr><td>設定単位</td><td>任意のフォルダー階層で指定可能</td><td>サーバーやホスト単位</td><td>サーバーやホスト単位</td></tr><tr><td>サブ フォルダーを含むか</td><td>選択可能 (フォルダーを登録するときに個別に指定)</td><td>含む</td><td>含む</td></tr><tr><td>IP アドレスでの指定</td><td><span style="color:#ff0000"><strong>不可</strong></span></td><td>可能</td><td>可能</td></tr><tr><td>適用範囲</td><td>Office のみ</td><td>ブラウザーでの Web サイト アクセスを含む当該ユーザーのネットワーク通信全般でゾーンに従ったセキュリティ レベルになる</td><td>ブラウザーでの Web サイト アクセスを含む当該ユーザーのネットワーク通信全般でゾーンに従ったセキュリティ レベルになる</td></tr></tbody></table><br><br>  <p><strong><h2 id="chapterEx2">補足 2: ゾーン判定の詳細な仕組み</h2></strong><br>上記の説明では、ネットワーク共有や Web サイトのゾーン判定について最も基本的な動作を説明しましたが、インターネット オプションの設定によっては、異なるゾーンと判断される場合もあります。ゾーン判定の詳細動作は、以下のブラウザー サポート チームのブログ記事をご参考としてください。</p><p>IE のセキュリティ ゾーンについて<br><a href="https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/IE-SecurityZones/">https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/IE-SecurityZones/</a>  </p><br><p><strong><h2 id="chapterEx3">補足 3: 信頼できる署名での回避方法</h2></strong><br>開発者向け手順のため上記の流れでは記載していませんが、他の対処方法として、対象ファイルの VBA マクロに信頼できる発行元の証明書でデジタル署名を行うことでも、マクロ ブロックを避けることができます。</p><p>この対応には、以下 2 つの作業が必要になります。</p><ul><li>マクロをブロックしたくない VBA マクロにデジタル署名を付与する</li><li>署名に使用する証明書をマクロを実行したいユーザー環境の証明書ストア [信頼された発行元] に、および、そのルート証明書を [信頼されたルート証明機関] に登録する</li></ul><p>VBA マクロへのデジタル署名の付与手順は、先述の関連記事 B) 内「<a href="/blog/cl0m4f5o1003504vsa5tp25c2/#EnableVBA-Sign">信頼できる発行元のデジタル署名を追加する方法</a>」でご案内しています。<br>使用する証明書の発行方法や、証明書ストアへの登録方法は Windows 上でのデジタル署名全般の動作となるため、本ブログでは割愛しています。<br><br></p><p>今回の投稿は以上です。</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2023&amp;#x2F;02&amp;#x2F;09 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color:#339966&quot;&gt;- &amp;lt;5. Web サイトの URL を確認&amp;</summary>
      
    
    
    
    
    <category term="VBA マクロ" scheme="https://officesupportjp.github.io/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/"/>
    
    <category term="セキュリティ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3/"/>
    
  </entry>
  
  <entry>
    <title>PowerPoint でのカラー印刷について</title>
    <link href="https://officesupportjp.github.io/blog/cl8ntfhk30000246y446z0u65/"/>
    <id>https://officesupportjp.github.io/blog/cl8ntfhk30000246y446z0u65/</id>
    <published>2022-09-30T00:00:00.000Z</published>
    <updated>2022-09-30T01:57:45.076Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、PowerPoint でカラー印刷に対応したプリンターに印刷をする際の色の設定について説明します。</p><h2 id="事象の詳細"><a href="#事象の詳細" class="headerlink" title="事象の詳細"></a>事象の詳細</h2><p>PowerPoint では印刷時に “カラー”、”グレースケール”、”単純白黒” のいずれかの設定を選んで印刷することができます。</p><p><img src="/blog/cl8ntfhk30000246y446z0u65/image1.png"></p><p>PowerPoint の既定の設定では、プリンター ドライバーの既定の設定よりも PowerPoint で印刷時に選択した設定が優先されて印刷されます。<br>プリンターから印刷された印刷結果が、PowerPoint で印刷時に選択した設定ではなく、プリンター ドライバーの既定の設定となって印刷される場合、以下のレジストリ値が設定されている可能性があります。<br><br><br><br></p><p>キー</p><p>HKEY_CURRENT_USER\Software\Microsoft\Office&lt;以下参照&gt;\PowerPoint</p><p>Office 2013 の場合 : 15.0<br>Office 2016、2019、2021、Microsoft 365 Apps の場合 : 16.0</p><p>値の名前 : IgnoreDevModeColor<br>値の種類 : REG_DWORD<br>設定されている値 : 1</p><p>レジストリ値が 1 でセットされている場合の動作としては、以下のようになります。</p><p>プリンターの既定設定 : カラー<br>PowerPoint の設定 : 単純白黒</p><p>印刷結果 : カラー</p><p>なお、本レジストリ値は、Office 製品をインストールした既定の状態では設定されていません。</p><p>PowerPoint からの印刷で色の設定が期待通りに動作しない場合、こちらの設定がされていないかご確認をお願いいたします。</p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、PowerPoint でカラー印刷に対応したプリンターに印刷をする際の色の設定について説明します。&lt;/p&gt;
&lt;h2 id=&quot;事象の詳細&quot;&gt;&lt;a href=&quot;#事象の詳細&quot; class=&quot;headerlin</summary>
      
    
    
    
    
    <category term="印刷" scheme="https://officesupportjp.github.io/blog/tags/%E5%8D%B0%E5%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>ボリュームライセンス版 Visio 2019、Project 2019 または Visio 2021、Project 2021 と Microsoft 365 Apps を共存インストールする方法について</title>
    <link href="https://officesupportjp.github.io/blog/cl8lbafua0000vg6yhn5ahyju/"/>
    <id>https://officesupportjp.github.io/blog/cl8lbafua0000vg6yhn5ahyju/</id>
    <published>2022-09-13T00:00:00.000Z</published>
    <updated>2022-09-30T07:23:38.445Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>本記事では、ボリュームライセンス版の Visio 2019 &#x2F; Project 2019 または Visio 2021 &#x2F; Project 2021 と Microsoft 365 Apps を共存インストールする方法についてご案内します。</p><p>ボリュームライセンス版の Visio 2019 &#x2F; Project 2019 または Visio 2021 &#x2F; Project 2021 と Microsoft 365 Apps は、共存してインストールすることが可能です。</p><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a><span style="color:#0000ff"><strong>前提条件</strong></span></h3><p>共存インストールのためにはバージョンによって以下の前提条件があるため、ご注意ください。</p><ul><li><p>Visio 2019 &#x2F; Project 2019 を共存インストールする場合<br>Microsoft 365 Apps バージョン 1808 以上を使用している必要があります。 </p></li><li><p>Visio 2021 &#x2F; Project 2021 を共存インストールする場合<br>Microsoft 365 Apps バージョン 2108 以上を使用している必要があります。</p></li></ul><p>また、同一端末に共存してインストール可能なクイック実行形式の Office 製品は、同一のチャネル、バージョン (ビルド)、bit である必要があります。<br>Microsoft 365 Apps と Visio &#x2F; Project を異なるバージョンとする等、複数のチャネルやビルド バージョンを同一端末にインストールすることはできません。</p><p>以下にインストールの詳細手順をご案内いたします。</p><h3 id="インストール手順"><a href="#インストール手順" class="headerlink" title="インストール手順"></a><span style="color:#0000ff"><strong>インストール手順</strong></span></h3><p>※インストール手順は Visio 2019 をインストールする手順を示します。 Visio 2021, Project 2019 &#x2F; Project 2021も同様の手順でインストールすることができます。</p><ol><li><p>現在インストールされている M365Apps の更新チャネル、ビルドを確認します。<br>  いずれかの Microsoft 365 Apps のソフトウェアを起動し、[ファイル] - [アカウント] の順にクリックし、[Wordのバージョン情報] (Word の場合) 欄に表示されている更新チャネル、ビルドを記録してください。</p><p> 例</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">バージョン 2018(ビルド 14326.21080 クイック実行)</span><br><span class="line">半期エンタープライズ チャネル</span><br></pre></td></tr></table></figure><p> 更新チャネル：半期エンタープライズ チャネル (SemiAnnual)<br> ビルド：14326.21080</p></li><li><p>インストール関連ファイルを保存するためのフォルダを用意します。<br> ※ この手順では “C:\Visio2019” を使用する例でご説明します。</p></li><li><p>以下のサイトの [Download] から、Office 展開ツールを入手して、手順 2 で作成したフォルダに保存します。<br>  Office 展開ツール (ODT)<br>  <a href="https://www.microsoft.com/en-us/download/details.aspx?id=49117">https://www.microsoft.com/en-us/download/details.aspx?id=49117</a><br>  ファイル名 [officedeploymenttool_xxxxx-xxxxx.exe]</p></li><li><p>ダウンロードしたファイルをダブルクリックします。<br>  マイクロソフト ソフトウェア ライセンス条項の確認画面が表示されるので、チェックボックスにチェックを付け、[Continue] をクリックします。その後、手順 2 で作成したフォルダを指定してファイルを展開します。<br>  ※ この手順では、”C:\Visio2019” フォルダに保存する例でご説明します。</p><ul><li>展開後に生成されるファイル<ul><li>configuration-Office365-x64.xml</li><li>configuration-Office365-x86.xml</li><li>configuration-Office2019Enterprise.xml</li><li>configuration-Office2021Enterprise.xml</li><li>setup.exe</li></ul></li></ul></li><li><p>ダウンロード用構成ファイルを作成します。</p><p> ※この手順はツールを使った構成ファイル作成方法もございます。後述の「Officeカスタマイズツールを使った XML ファイルの作成」をご参照ください。</p><p> 展開した上記ファイルのうち、いずれかの XML ファイルをメモ帳で開き、全ての内容を削除した後、以下のサンプル コードの &lt;Configuration&gt; から &lt;&#x2F;Configuration&gt;までをコピーして、貼り付けます。編集したファイルを、任意のファイル名で .xml ファイルとして保存します。 Channelの要素は手順 1 で取得したチャネル、Versionの要素は “16.0.” + (手順 1 で取得したビルド)となります。</p><p> ※ この手順では、”Visio-configuration.xml” という名前で保存する例でご説明します。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Configuration&gt;</span><br><span class="line">  &lt;Add SourcePath=&quot;C:\Visio2019&quot; OfficeClientEdition=&quot;64&quot; Channel=&quot;SemiAnnual&quot; Version=&quot;16.0.14326.21080&quot;&gt;</span><br><span class="line">    &lt;Product ID=&quot;VisioPro2019Volume&quot; PIDKEY=&quot;9BGNQ-K37YR-RQHF2-38RQ3-7VCBB&quot;&gt;</span><br><span class="line">      &lt;Language ID=&quot;ja-jp&quot; /&gt;</span><br><span class="line">    &lt;/Product&gt;</span><br><span class="line">  &lt;/Add&gt;</span><br><span class="line">&lt;/Configuration&gt;</span><br></pre></td></tr></table></figure><p> ※ 冒頭の「Add SourcePath&#x3D;」以下のパスには、手順 3 で指定した setup.exe の保存パスを指定します。<br> ※ 上記のサンプルは、Visio Visio 2019 の 64 ビット版、半期エンタープライズ チャネル、日本語版をダウンロードするための構成ファイルとなります。<br> ご利用の Visio&#x2F;Project のエディションによって、以下のように Product ID と PIDKEY を変更してください。</p><table><thead><tr><th>Product</th><th>ID</th><th>PIDKEY</th></tr></thead><tbody><tr><td>Visio Standard 2019</td><td>VisioStd2019Volume</td><td>7TQNQ-K3YQQ-3PFH7-CCPPM-X4VQ2</td></tr><tr><td>Visio Professional 2019</td><td>VisioPro2019Volume</td><td>9BGNQ-K37YR-RQHF2-38RQ3-7VCBB</td></tr><tr><td>Project Standard 2019</td><td>ProjectStd2019Volume</td><td>C4F7P-NCP8C-6CQPT-MQHV9-JXD2M</td></tr><tr><td>Project Professional 2019</td><td>ProjectPro2019Volume</td><td>B4NPR-3FKK7-T2MBV-FRQ4W-PKD2B</td></tr><tr><td>Visio Standard 2021</td><td>VisioStd2021Volume</td><td>MJVNY-BYWPY-CWV6J-2RKRT-4M8QG</td></tr><tr><td>Visio Professional 2021</td><td>VisioPro2021Volume</td><td>KNH8D-FGHT4-T8RK3-CTDYJ-K2HT4</td></tr><tr><td>Project Standard 2021</td><td>ProjectStd2021Volume</td><td>J2JDC-NJCYY-9RGQ4-YXWMH-T3D4T</td></tr><tr><td>Project Professional 2021</td><td>ProjectPro2021Volume</td><td>FTNWT-C6WBT-8HMGF-K9PRX-QV9H8</td></tr></tbody></table><p> ※ 上記 PIDKEY は KMS 認証を行うための GVLK となります。MAK 認証を行う場合、個別の専用プロダクトキーを入力ください。詳細は後述の「ライセンス認証について」の b) に記載されております。</p><p> KMS および Office、Project、Visio の Active Directory によるライセンス認証用の GVLKs<br> <a href="https://learn.microsoft.com/ja-jp/DeployOffice/vlactivation/gvlks?redirectedfrom=MSDN">https://learn.microsoft.com/ja-jp/DeployOffice/vlactivation/gvlks?redirectedfrom=MSDN</a></p><p> 下記公開情報をご参照のうえ、適宜 XML ファイルの要素を変更してください。<br> Office 展開ツールのオプションの構成<br> <a href="https://docs.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options">https://docs.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options</a></p></li><li><p>以下のコマンドを実行して、インストール実行モジュールのダウンロードを行います。<br>  [FilePath] 部分には、setup.exe の保存パス、および、Visio-configuration.xml の保存パスをそれぞれ指定します。 </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; [FilePath]setup.exe /download [FilePath]Visio-configuration.xml</span><br><span class="line">例 : &gt; C:\Visio2016\setup.exe /download C:\Visio2019\Visio-configuration.xml</span><br></pre></td></tr></table></figure></li><li><p>コマンド実行後、プロンプトが戻ってくるまで少し待ちます。(完了時にメッセージは表示されません。)<br> ダウンロード完了後、「Add SourcePath&#x3D;」で指定したフォルダ内に “Office” フォルダが作成され、インストール モジュールが保存されます。</p></li><li><p>ダウンロード作業とインストール作業を行う PC が別である場合、ダウンロード完了後の C:\Visio2019 フォルダの内容をすべてコピーし、インストールを行う PC にも C:\Visio2019 フォルダを作成して貼り付けてください。</p></li><li><p>以下のコマンドを実行して、ダウンロードしたモジュールからインストールを実行します。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; [FilePath]setup.exe /configure [FilePath]Visio-configuration.xml</span><br><span class="line">例 : &gt; C:\Visio2019\setup.exe /configure C:\Visio2019\Visio-configuration.xml</span><br></pre></td></tr></table></figure></li><li><p>インストールが完了したら、Visio 2019のライセンス認証を行います。<br>ライセンス認証するために、Office ソフトウェア保護プラットフォーム スクリプト (ospp.vbs) を使います。<br>64 ビット版では Program Files\Microsoft Office\Office16 フォルダに、32 ビット版では Program Files (x86)\Microsoft Office\Office16 フォルダにあります。以下が認証するためのコマンドになります。</p><p>ospp.vbsのあるフォルダに移動します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Program Files\Microsoft Office\Office16</span><br></pre></td></tr></table></figure><p>ospp.vbsを実行して、ライセンス認証を行います。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript ospp.vbs /act</span><br></pre></td></tr></table></figure><p>実行結果として、VisioPro2019 について Product activation successful と表示されると認証成功となります。<br>※ ライセンス認証の詳細に関しましては、後述の「ライセンス認証について」をご参照ください。</p></li></ol><h3 id="Officeカスタマイズツールを使った-XML-ファイルの作成"><a href="#Officeカスタマイズツールを使った-XML-ファイルの作成" class="headerlink" title="Officeカスタマイズツールを使った XML ファイルの作成"></a><span style="color:#0000ff"><strong>Officeカスタマイズツールを使った XML ファイルの作成</strong></span></h3><ol><li><p>Office カスタマイズ ツールにアクセス</p><p> Office カスタマイズ ツール ( <a href="https://config.office.com/">https://config.office.com</a> )にアクセスしてください。</p></li><li><p>展開の設定</p><p> 構成する製品、言語、およびアプリケーションの基本設定を選択します。 </p><p> 今回のインストール手順では以下の設定項目が最低限必要となります。その他の項目は適宜設定を追加してください。</p><ul><li><p>製品とリソース</p><p>  アーキテクチャで対応するビットを選択、製品は今回のインストールする Visio &#x2F; Project を選択してください。</p><p>  ※各構成ファイルでデプロイできるアーキテクチャは 1 つだけです。</p><p>  更新チャネルでは手順 1 で取得したチャネルとバージョンを選択してください。<br>  ※ Office 2019 永続エンタープライズ チャネル &#x2F; Office LTSC 2021 永続エンタープライズ チャネル が選択されていると、Microsoft 365 Apps と共存できません。 </p></li><li><p>言語</p><p>  主言語を選択してください。オペレーティング システムに合わせる を選択すると、クライアント デバイスで使用されているのと同じ言語が自動的にインストールされます。</p></li><li><p>インストール</p><p>  Office ファイルをクラウドから直接インストールするか、ネットワーク上のローカル ソースから直接インストールするかを選択します。今回のインストール手順では [インストールのオプション] - [ローカル ソース] よりソース パスに C:\Visio2019 と入力してください。</p></li><li><p>ライセンスとアクティブ化</p><p>  プロダクト キーは試用する認証方式を選択してください。MAK 認証を選択した場合は適切なライセンスキーを入力してください。</p></li></ul></li><li><p>構成ファイルのエクスポート</p><p> 右側のウィンドウで構成済みの設定を確認し、[エクスポート] を選択してください。<br> 使用許諾契約書の条項に同意し、構成ファイルに名前を付けてから、[ エクスポート ] を選択してダウンロードしてください。今回の手順では Visio-configuration と名前を設定します。</p></li><li><p>構成ファイルの配置</p><p> ダウンロードしたファイルを C:\Visio2019 に移動し、インストール手順 6 よりインストールを進めてください。</p></li></ol><p>Office カスタマイズ ツールの概要</p><p><a href="https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-customization-tool">https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-customization-tool</a></p><h3 id="ライセンス認証について"><a href="#ライセンス認証について" class="headerlink" title="ライセンス認証について"></a><span style="color:#0000ff"><strong>ライセンス認証について</strong></span></h3><p>ボリュームライセンス版の Office では、KMS 認証や MAK 認証などによりライセンス認証が実施可能です。<br>KMS 認証を行う場合、事前に KMS ホストを構築し、認証を行える環境を構築いただく必要がございます。<br>それぞれの詳細につきましては、以下をご参照ください。</p><p><span style="color:#0000ff"><strong>a) KMS ホストを構築し、ライセンス認証を行う手順</strong></span></p><p>通常のボリュームライセンス用の KMS ホストを構築することで、ライセンス認証が実施可能です。<br>KMS でのライセンス認証を行うためには、Office 2019 を利用する 5 台以上のクライアントが存在する必要があります。<br>ボリューム ライセンス版の Office のライセンス認証の KMS ホストの構築や、ライセンス認証の詳細手順については、以下をご参照ください。</p><p>Office のボリューム ライセンス認証の概要 </p><p><a href="https://docs.microsoft.com/ja-jp/deployoffice/vlactivation/plan-volume-activation-of-office">https://docs.microsoft.com/ja-jp/deployoffice/vlactivation/plan-volume-activation-of-office</a></p><p>ボリューム ライセンス版の Office のライセンス認証を行うように KMS ホスト コンピューターを構成する </p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/configure-a-kms-host-computer-for-office">https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/configure-a-kms-host-computer-for-office</a></p><p><span style="color:#0000ff"><strong>b) MAK を使用したコンピューターのライセンス認証手順</strong></span></p><p>Office 展開ツールで使用される configuration.xml ファイルの PIDKEY を指定し、認証を行います。<br>今回のインストールの手順ではサンプル XML ファイルの 「PIDKY&#x3D;　」 に KMS キーではなく MAK キーを入力してください。<br>詳細手順については、以下をご参照ください。</p><p>MAK を使用してボリューム ライセンスバージョンの Office をアクティブ化する</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/activate-office-by-using-mak">https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/activate-office-by-using-mak</a></p><p>Office LTSC 2021 を展開する</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/ltsc2021/deploy">https://docs.microsoft.com/ja-jp/DeployOffice/ltsc2021/deploy</a></p><p>Office 2019 を展開する (IT 担当者向け)</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/office2019/deploy">https://docs.microsoft.com/ja-jp/DeployOffice/office2019/deploy</a></p><h3 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a><span style="color:#0000ff"><strong>参考情報</strong></span></h3><p>今回ご案内した詳細につきましては、以下の公開情報に記載しております。</p><p>同一コンピューター上に異なるバージョンの Office、Visio、Project をインストールするためのサポート対象シナリオ  </p><p><a href="https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx">https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx</a></p><p>Office 展開ツール を利用する際の xml ファイル、および、コマンドの書式については、以下の技術情報をご覧ください。<br>概要: Office 展開ツール  </p><p><a href="https://technet.microsoft.com/ja-jp/library/jj219422.aspx">https://technet.microsoft.com/ja-jp/library/jj219422.aspx</a></p><p>Visio の展開ガイド</p><p><a href="https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-visio">https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-visio</a></p><p>Project の展開ガイド</p><p><a href="https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-project">https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-project</a></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;本記事では、ボリュームライセンス版の Visio 2019 &amp;#x2F; Project 2019 または Visio 2021 &amp;#x2F; Project 2021 と Microsoft 365 Apps を共存</summary>
      
    
    
    
    
    <category term="インストール" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/"/>
    
  </entry>
  
  <entry>
    <title>暗号化された Office ファイルを保護ビューで開き、保護ビューが閉じた後、クライアントの %localappdata% フォルダ配下 Packages フォルダに oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダが残存する</title>
    <link href="https://officesupportjp.github.io/blog/cl7pvphjn0000a46ygd3m4nro/"/>
    <id>https://officesupportjp.github.io/blog/cl7pvphjn0000a46ygd3m4nro/</id>
    <published>2022-09-06T00:00:00.000Z</published>
    <updated>2022-09-30T01:45:49.675Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、暗号化された Office ファイル (*) を保護ビューで開き、保護ビューが閉じた後、<br>クライアントのローカル フォルダ %localappdata%\Packages 配下に oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ (x は任意の英数字) が残存する事象について説明します。  </p><h1 id="事象の詳細"><a href="#事象の詳細" class="headerlink" title="事象の詳細"></a>事象の詳細</h1><p>Office アプリでは、暗号化された Office ファイルであるかどうかに関わらず、ファイルを保護ビューで開く場合、以下のフォルダを作成します。  </p><p>%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ<br>(例: C:\Users&lt;ユーザー名&gt;\AppData\Local\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx)  </p><p>この oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ配下に、元のファイルや元のファイルに紐づく情報を一時ファイルとしてコピー&#x2F;作成した上で、保護ビューでファイルを読み取り専用で開きます。  </p><p>この動作は、ユーザーが明示的に [編集を有効にする] を実行しない限り、リスクを軽減しながらファイルの内容を確認できるセキュリティを考慮した実装です。  </p><p>なお、Office ファイルが暗号化されていない場合は、[編集を有効にする] をクリックしたタイミングで、%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダは削除されます。  </p><p>一方、暗号化された Office ファイル (*) の場合、[編集を有効にする] をクリックしても、%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダは削除されず、残ります。  </p><p><img src="/blog/cl7pvphjn0000a46ygd3m4nro/image1.png"><br><img src="/blog/cl7pvphjn0000a46ygd3m4nro/image2.png">  </p><p>(*) 暗号化された Office ファイルとは、以下のような操作などで暗号化されたファイルを指します。<br>・Azure Information Protection 統合ラベル付けクライアントや Office アプリで秘密度ラベルを設定したファイル<br>・Office アプリの [ファイルの保護] - [アクセスの制限] からアクセス制限ありを設定したファイル<br>・SharePoint の Information Rights Management (IRM) を有効に設定したライブラリからダウンロードされたファイル  </p><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>この問題は、Microsoft 365 Apps にて確認されており、現在、製品開発部門で調査中です。<br>新たな情報が確認された場合は、この記事に追記する形で公開していく予定です。</p><h1 id="回避案"><a href="#回避案" class="headerlink" title="回避案"></a>回避案</h1><p>エクスプローラーを起動し、残っている %localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ<br>(例: C:\Users&lt;ユーザー名&gt;\AppData\Local\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx) を選択し、手動で削除してください。  </p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、暗号化された Office ファイル (*) を保護ビューで開き、保護ビューが閉じた後、&lt;br&gt;クライアントのローカル フォルダ %localappdata%\Packages 配下に oice_xx_x</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>WSFC 継続的可用性 (CA) が有効な共有フォルダーから Office ファイルが開けない</title>
    <link href="https://officesupportjp.github.io/blog/cl6q3dt1k0000ks3pemokg0de/"/>
    <id>https://officesupportjp.github.io/blog/cl6q3dt1k0000ks3pemokg0de/</id>
    <published>2022-08-12T00:00:00.000Z</published>
    <updated>2022-09-30T01:45:49.644Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの中村です。</p><p>今回の記事では、Windows Server Failover Cluster (WSFC) 構成のファイル サーバー上に作成した共有フォルダーで、継続的可用性 (Continuous Availability<br> (CA)) 設定を有効にすると、このフォルダー配下の Office ファイルを開くときに時間がかかる、という動作について説明します。なお、このときに要する時間は数十分となる場合があるため、ユーザーが開き終わるまで待機することなく「Office ファイルを開くことができず、Office アプリの応答がなくなる」といった現象として報告されることが想定されます。<br><br></p><h3 id="1-発生条件"><a href="#1-発生条件" class="headerlink" title="1. 発生条件"></a><strong>1. 発生条件</strong></h3><p> 以下をすべて満たす場合に発生します。</p><ul><li><p>Office デスクトップ アプリ バージョン 1812 以降</p></li><li><p>WSFC 構成のファイル サーバーで、共有フォルダーの継続的可用性 (CA) を有効にしている</p></li></ul><p> <img src="/blog/cl6q3dt1k0000ks3pemokg0de/WSFC_CA.png">  </p><ul><li><p>共有フォルダーの名前に NFKC 形式での Unicode正規化により、別の文字に置き換わる文字を使用している (例: 全角アルファベット)</p><p>Unicode 正規化の詳細は以下をご参照ください。<br>Using Unicode Normalization to Represent Strings<br><a href="https://docs.microsoft.com/en-us/windows/win32/intl/using-unicode-normalization-to-represent-strings">https://docs.microsoft.com/en-us/windows/win32/intl/using-unicode-normalization-to-represent-strings</a></p><p>※ サブ フォルダーは影響しません。共有ルート フォルダーの名前のみです。</p></li></ul><br><h3 id="2-原因"><a href="#2-原因" class="headerlink" title="2. 原因"></a><strong>2. 原因</strong></h3><p>WSFC 構成の継続的可用性 (CA) は、一般的に可用性が重要なスケールアウト ファイル サーバーなどの構成で利用され、ファイルへのアクセス中にフェイル オーバーが発生したときにも、フェイル オーバー後にそのままアクセスを継続することを実現します。<br>本機能の詳細は、以下の公開情報をご参照ください。</p><p>Windows Server 2012 Continuous Availability File Server feature<br><a href="https://docs.microsoft.com/en-us/archive/blogs/davguents_blog/windows-server-2012-continuous-availability-file-server-feature">https://docs.microsoft.com/en-us/archive/blogs/davguents_blog/windows-server-2012-continuous-availability-file-server-feature</a></p><p>この仕組みの実現のため、継続的可用性が有効な共有フォルダーが検出されると、SMB クライアントはそのファイル サーバーへのアクセスが失敗した場合も、しばらくの間リトライを繰り返します。このリトライによって、フェイル オーバー後に自動的に再接続され、継続アクセスが可能となります。<br><br></p><p>一方で、先述の発生条件に記載したバージョン以降の Office アプリケーションでは、セキュリティ脆弱性への対応のため、ファイルが格納されているネットワーク フォルダー パスを Unicode 正規化してアクセスする処理を追加しました。<br>例えば、「ｓｈａｒｅ」という全角英字を Unicode 正規化すると、半角英字「share」となります。したがって、「\\server\ｓｈａｒｅ\test.xlsx」という全角英字フォルダー内のファイルを開くときに、「\\server\share」 (半角英字) へのアクセスが発生することになります。</p><p>半角英字の「share」フォルダーが存在せず、そのようなフォルダーは存在しない旨のエラーが返されても以後の処理は正常に動作しますが、継続的可用性が有効な場合は、存在しないことによるエラーであってもこのエラーがすぐに Office に返らず、リトライが繰り返されます。<br>この結果、リトライ オーバーまで Office は待機し続け、ファイルを開くまでに長い時間を要します。</p><p>Windows OS の継続的可用性によるリトライ、Office アプリケーションのファイル オープン時の Unicode 正規化ともに、想定された仕組みであり、本動作は現在の製品動作上の制限事項です。<br><br></p><h3 id="3-回避策"><a href="#3-回避策" class="headerlink" title="3. 回避策"></a><strong>3. 回避策</strong></h3><p>以下のいずれかの方法による回避をご検討ください。</p><ol><li><p>共有フォルダーの名前に Unicode 正規化で別の文字となる文字を使用しない</p></li><li><p>共有フォルダーをネットワーク ドライブに割り当てて使用する<br>(この場合、Office が Unicode 正規化してアクセスするのはネットワーク ドライブを用いたパスとなるため、現象を回避できます)</p></li><li><p>共有フォルダーの継続的可用性を無効にする</p></li></ol><br>今回の投稿は以上です。  <br><br><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの中村です。&lt;/p&gt;
&lt;p&gt;今回の記事では、Windows Server Failover Cluster (WSFC) 構成のファイル サーバー上に作成した共有フォルダーで、継続的可用性 (Continuous Availabil</summary>
      
    
    
    
    
    <category term="ファイル I/O" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/"/>
    
  </entry>
  
</feed>
