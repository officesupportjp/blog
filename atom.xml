<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Office Client Support Blog</title>
  
  <subtitle>日本マイクロソフト Office Client サポート チームのブログです</subtitle>
  <link href="https://officesupportjp.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://officesupportjp.github.io/blog/"/>
  <updated>2022-09-28T07:38:00.329Z</updated>
  <id>https://officesupportjp.github.io/blog/</id>
  
  <author>
    <name>Office Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ボリュームライセンス版 Visio 2019、Project 2019 または Visio 2021、Project 2021 と Microsoft 365 Apps を共存インストールする方法について</title>
    <link href="https://officesupportjp.github.io/blog/cl8lbafua0000vg6yhn5ahyju/"/>
    <id>https://officesupportjp.github.io/blog/cl8lbafua0000vg6yhn5ahyju/</id>
    <published>2022-09-12T15:00:00.000Z</published>
    <updated>2022-09-28T07:38:00.329Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>本記事では、ボリュームライセンス版の Visio 2019 &#x2F; Project 2019 または Visio 2021 &#x2F; Project 2021 と Microsoft 365 Apps を共存インストールする方法についてご案内します。</p><p>ボリュームライセンス版の Visio 2019 &#x2F; Project 2019 または Visio 2021 &#x2F; Project 2021 と Microsoft 365 Apps は、共存してインストールすることが可能です。</p><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a><span style="color:#0000ff"><strong>前提条件</strong></span></h3><p>共存インストールのためにはバージョンによって以下の前提条件があるため、ご注意ください。</p><ul><li><p>Visio 2019 &#x2F; Project 2019 を共存インストールする場合<br>Microsoft 365 Apps バージョン 1808 以上を使用している必要があります。 </p></li><li><p>Visio 2021 &#x2F; Project 2021 を共存インストールする場合<br>Microsoft 365 Apps バージョン 2108 以上を使用している必要があります。</p></li></ul><p>また、同一端末に共存してインストール可能なクイック実行形式の Office 製品は、同一のチャネル、バージョン (ビルド)、bit である必要があります。<br>Microsoft 365 Apps と Visio &#x2F; Project を異なるバージョンとする等、複数のチャネルやビルド バージョンを同一端末にインストールすることはできません。</p><p>以下にインストールの詳細手順をご案内いたします。</p><h3 id="インストール手順"><a href="#インストール手順" class="headerlink" title="インストール手順"></a><span style="color:#0000ff"><strong>インストール手順</strong></span></h3><p>※インストール手順は Visio 2019 をインストールする手順を示します。 Visio 2021, Project 2019 &#x2F; Project 2021も同様の手順でインストールすることができます。</p><ol><li><p>現在インストールされている M365Apps の更新チャネル、ビルドを確認します。<br>  いずれかの Microsoft 365 Apps のソフトウェアを起動し、[ファイル] - [アカウント] の順にクリックし、[Wordのバージョン情報] (Word の場合) 欄に表示されている更新チャネル、ビルドを記録してください。</p><p> 例</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">バージョン 2018(ビルド 14326.21080 クイック実行)</span><br><span class="line">半期エンタープライズ チャネル</span><br></pre></td></tr></table></figure><p> 更新チャネル：半期エンタープライズ チャネル (SemiAnnual)<br> ビルド：14326.21080</p></li><li><p>インストール関連ファイルを保存するためのフォルダを用意します。<br> ※ この手順では “C:\Visio2019” を使用する例でご説明します。</p></li><li><p>以下のサイトの [Download] から、Office 展開ツールを入手して、手順 2 で作成したフォルダに保存します。<br>  Office 展開ツール (ODT)<br>  <a href="https://www.microsoft.com/en-us/download/details.aspx?id=49117">https://www.microsoft.com/en-us/download/details.aspx?id=49117</a><br>  ファイル名 [officedeploymenttool_xxxxx-xxxxx.exe]</p></li><li><p>ダウンロードしたファイルをダブルクリックします。<br>  マイクロソフト ソフトウェア ライセンス条項の確認画面が表示されるので、チェックボックスにチェックを付け、[Continue] をクリックします。その後、手順 2 で作成したフォルダを指定してファイルを展開します。<br>  ※ この手順では、”C:\Visio2019” フォルダに保存する例でご説明します。</p><ul><li>展開後に生成されるファイル<ul><li>configuration-Office365-x64.xml</li><li>configuration-Office365-x86.xml</li><li>configuration-Office2019Enterprise.xml</li><li>configuration-Office2021Enterprise.xml</li><li>setup.exe</li></ul></li></ul></li><li><p>ダウンロード用構成ファイルを作成します。</p><p> ※この手順はツールを使った構成ファイル作成方法もございます。後述の「Officeカスタマイズツールを使った XML ファイルの作成」をご参照ください。</p><p> 展開した上記ファイルのうち、いずれかの XML ファイルをメモ帳で開き、全ての内容を削除した後、以下のサンプル コードの &lt;Configuration&gt; から &lt;&#x2F;Configuration&gt;までをコピーして、貼り付けます。編集したファイルを、任意のファイル名で .xml ファイルとして保存します。 Channelの要素は手順 1 で取得したチャネル、Versionの要素は “16.0.” + (手順 1 で取得したビルド)となります。</p><p> ※ この手順では、”Visio-configuration.xml” という名前で保存する例でご説明します。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Configuration&gt;</span><br><span class="line">  &lt;Add SourcePath=&quot;C:\Visio2019&quot; OfficeClientEdition=&quot;64&quot; Channel=&quot;SemiAnnual&quot; Version=&quot;16.0.14326.21080&quot;&gt;</span><br><span class="line">    &lt;Product ID=&quot;VisioPro2019Volume&quot; PIDKEY=&quot;9BGNQ-K37YR-RQHF2-38RQ3-7VCBB&quot;&gt;</span><br><span class="line">      &lt;Language ID=&quot;ja-jp&quot; /&gt;</span><br><span class="line">    &lt;/Product&gt;</span><br><span class="line">  &lt;/Add&gt;</span><br><span class="line">&lt;/Configuration&gt;</span><br></pre></td></tr></table></figure><p> ※ 冒頭の「Add SourcePath&#x3D;」以下のパスには、手順 3 で指定した setup.exe の保存パスを指定します。<br> ※ 上記のサンプルは、Visio Visio 2019 の 64 ビット版、半期エンタープライズ チャネル、日本語版をダウンロードするための構成ファイルとなります。<br> ご利用の Visio&#x2F;Project のエディションによって、以下のように Product ID と PIDKEY を変更してください。</p><table><thead><tr><th>Product</th><th>ID</th><th>PIDKEY</th></tr></thead><tbody><tr><td>Visio Standard 2019</td><td>VisioStd2019Volume</td><td>7TQNQ-K3YQQ-3PFH7-CCPPM-X4VQ2</td></tr><tr><td>Visio Professional 2019</td><td>VisioPro2019Volume</td><td>9BGNQ-K37YR-RQHF2-38RQ3-7VCBB</td></tr><tr><td>Project Standard 2019</td><td>ProjectStd2019Volume</td><td>C4F7P-NCP8C-6CQPT-MQHV9-JXD2M</td></tr><tr><td>Project Professional 2019</td><td>ProjectPro2019Volume</td><td>B4NPR-3FKK7-T2MBV-FRQ4W-PKD2B</td></tr><tr><td>Visio Standard 2021</td><td>VisioStd2021Volume</td><td>MJVNY-BYWPY-CWV6J-2RKRT-4M8QG</td></tr><tr><td>Visio Professional 2021</td><td>VisioPro2021Volume</td><td>KNH8D-FGHT4-T8RK3-CTDYJ-K2HT4</td></tr><tr><td>Project Standard 2021</td><td>ProjectStd2021Volume</td><td>J2JDC-NJCYY-9RGQ4-YXWMH-T3D4T</td></tr><tr><td>Project Professional 2021</td><td>ProjectPro2021Volume</td><td>FTNWT-C6WBT-8HMGF-K9PRX-QV9H8</td></tr></tbody></table><p> ※ 上記 PIDKEY は KMS 認証を行うための GVLK となります。MAK 認証を行う場合、個別の専用プロダクトキーを入力ください。詳細は後述の「ライセンス認証について」の b) に記載されております。</p><p> KMS および Office、Project、Visio の Active Directory によるライセンス認証用の GVLKs<br> <a href="https://learn.microsoft.com/ja-jp/DeployOffice/vlactivation/gvlks?redirectedfrom=MSDN">https://learn.microsoft.com/ja-jp/DeployOffice/vlactivation/gvlks?redirectedfrom=MSDN</a></p><p> 下記公開情報をご参照のうえ、適宜 XML ファイルの要素を変更してください。<br> Office 展開ツールのオプションの構成<br> <a href="https://docs.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options">https://docs.microsoft.com/ja-jp/deployoffice/office-deployment-tool-configuration-options</a></p></li><li><p>以下のコマンドを実行して、インストール実行モジュールのダウンロードを行います。<br>  [FilePath] 部分には、setup.exe の保存パス、および、Visio-configuration.xml の保存パスをそれぞれ指定します。 </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; [FilePath]setup.exe /download [FilePath]Visio-configuration.xml</span><br><span class="line">例 : &gt; C:\Visio2016\setup.exe /download C:\Visio2019\Visio-configuration.xml</span><br></pre></td></tr></table></figure></li><li><p>コマンド実行後、プロンプトが戻ってくるまで少し待ちます。(完了時にメッセージは表示されません。)<br> ダウンロード完了後、「Add SourcePath&#x3D;」で指定したフォルダ内に “Office” フォルダが作成され、インストール モジュールが保存されます。</p></li><li><p>ダウンロード作業とインストール作業を行う PC が別である場合、ダウンロード完了後の C:\Visio2019 フォルダの内容をすべてコピーし、インストールを行う PC にも C:\Visio2019 フォルダを作成して貼り付けてください。</p></li><li><p>以下のコマンドを実行して、ダウンロードしたモジュールからインストールを実行します。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; [FilePath]setup.exe /configure [FilePath]Visio-configuration.xml</span><br><span class="line">例 : &gt; C:\Visio2019\setup.exe /configure C:\Visio2019\Visio-configuration.xml</span><br></pre></td></tr></table></figure></li><li><p>インストールが完了したら、Visio 2019のライセンス認証を行います。<br>ライセンス認証するために、Office ソフトウェア保護プラットフォーム スクリプト (ospp.vbs) を使います。<br>64 ビット版では Program Files\Microsoft Office\Office16 フォルダに、32 ビット版では Program Files (x86)\Microsoft Office\Office16 フォルダにあります。以下が認証するためのコマンドになります。</p><p>ospp.vbsのあるフォルダに移動します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Program Files\Microsoft Office\Office16</span><br></pre></td></tr></table></figure><p>ospp.vbsを実行して、ライセンス認証を行います。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript ospp.vbs /act</span><br></pre></td></tr></table></figure><p>実行結果として、VisioPro2019 について Product activation successful と表示されると認証成功となります。<br>※ ライセンス認証の詳細に関しましては、後述の「ライセンス認証について」をご参照ください。</p></li></ol><h3 id="Officeカスタマイズツールを使った-XML-ファイルの作成"><a href="#Officeカスタマイズツールを使った-XML-ファイルの作成" class="headerlink" title="Officeカスタマイズツールを使った XML ファイルの作成"></a><span style="color:#0000ff"><strong>Officeカスタマイズツールを使った XML ファイルの作成</strong></span></h3><ol><li><p>Office カスタマイズ ツールにアクセス</p><p> Office カスタマイズ ツール ( <a href="https://config.office.com/">https://config.office.com</a> )にアクセスしてください。</p></li><li><p>展開の設定</p><p> 構成する製品、言語、およびアプリケーションの基本設定を選択します。 </p><p> 今回のインストール手順では以下の設定項目が最低限必要となります。その他の項目は適宜設定を追加してください。</p><ul><li><p>製品とリソース</p><p>  アーキテクチャで対応するビットを選択、製品は今回のインストールする Visio &#x2F; Project を選択してください。</p><p>  ※各構成ファイルでデプロイできるアーキテクチャは 1 つだけです。</p><p>  更新チャネルでは手順 1 で取得したチャネルとバージョンを選択してください。<br>  ※ Office 2019 永続エンタープライズ チャネル &#x2F; Office LTSC 2021 永続エンタープライズ チャネル が選択されていると、Microsoft 365 Apps と共存できません。 </p></li><li><p>言語</p><p>  主言語を選択してください。オペレーティング システムに合わせる を選択すると、クライアント デバイスで使用されているのと同じ言語が自動的にインストールされます。</p></li><li><p>インストール</p><p>  Office ファイルをクラウドから直接インストールするか、ネットワーク上のローカル ソースから直接インストールするかを選択します。今回のインストール手順では [インストールのオプション] - [ローカル ソース] よりソース パスに C:\Visio2019 と入力してください。</p></li><li><p>ライセンスとアクティブ化</p><p>  プロダクト キーは試用する認証方式を選択してください。MAK 認証を選択した場合は適切なライセンスキーを入力してください。</p></li></ul></li><li><p>構成ファイルのエクスポート</p><p> 右側のウィンドウで構成済みの設定を確認し、[エクスポート] を選択してください。<br> 使用許諾契約書の条項に同意し、構成ファイルに名前を付けてから、[ エクスポート ] を選択してダウンロードしてください。今回の手順では Visio-configuration と名前を設定します。</p></li><li><p>構成ファイルの配置</p><p> ダウンロードしたファイルを C:\Visio2019 に移動し、インストール手順 6 よりインストールを進めてください。</p></li></ol><p>Office カスタマイズ ツールの概要</p><p><a href="https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-customization-tool">https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-customization-tool</a></p><h3 id="ライセンス認証について"><a href="#ライセンス認証について" class="headerlink" title="ライセンス認証について"></a><span style="color:#0000ff"><strong>ライセンス認証について</strong></span></h3><p>ボリュームライセンス版の Office では、KMS 認証や MAK 認証などによりライセンス認証が実施可能です。<br>KMS 認証を行う場合、事前に KMS ホストを構築し、認証を行える環境を構築いただく必要がございます。<br>それぞれの詳細につきましては、以下をご参照ください。</p><p><span style="color:#0000ff"><strong>a) KMS ホストを構築し、ライセンス認証を行う手順</strong></span></p><p>通常のボリュームライセンス用の KMS ホストを構築することで、ライセンス認証が実施可能です。<br>KMS でのライセンス認証を行うためには、Office 2019 を利用する 5 台以上のクライアントが存在する必要があります。<br>ボリューム ライセンス版の Office のライセンス認証の KMS ホストの構築や、ライセンス認証の詳細手順については、以下をご参照ください。</p><p>Office のボリューム ライセンス認証の概要 </p><p><a href="https://docs.microsoft.com/ja-jp/deployoffice/vlactivation/plan-volume-activation-of-office">https://docs.microsoft.com/ja-jp/deployoffice/vlactivation/plan-volume-activation-of-office</a></p><p>ボリューム ライセンス版の Office のライセンス認証を行うように KMS ホスト コンピューターを構成する </p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/configure-a-kms-host-computer-for-office">https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/configure-a-kms-host-computer-for-office</a></p><p><span style="color:#0000ff"><strong>b) MAK を使用したコンピューターのライセンス認証手順</strong></span></p><p>Office 展開ツールで使用される configuration.xml ファイルの PIDKEY を指定し、認証を行います。<br>今回のインストールの手順ではサンプル XML ファイルの 「PIDKY&#x3D;　」 に KMS キーではなく MAK キーを入力してください。<br>詳細手順については、以下をご参照ください。</p><p>MAK を使用してボリューム ライセンスバージョンの Office をアクティブ化する</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/activate-office-by-using-mak">https://docs.microsoft.com/ja-jp/DeployOffice/vlactivation/activate-office-by-using-mak</a></p><p>Office LTSC 2021 を展開する</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/ltsc2021/deploy">https://docs.microsoft.com/ja-jp/DeployOffice/ltsc2021/deploy</a></p><p>Office 2019 を展開する (IT 担当者向け)</p><p><a href="https://docs.microsoft.com/ja-jp/DeployOffice/office2019/deploy">https://docs.microsoft.com/ja-jp/DeployOffice/office2019/deploy</a></p><h3 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a><span style="color:#0000ff"><strong>参考情報</strong></span></h3><p>今回ご案内した詳細につきましては、以下の公開情報に記載しております。</p><p>同一コンピューター上に異なるバージョンの Office、Visio、Project をインストールするためのサポート対象シナリオ  </p><p><a href="https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx">https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx</a></p><p>Office 展開ツール を利用する際の xml ファイル、および、コマンドの書式については、以下の技術情報をご覧ください。<br>概要: Office 展開ツール  </p><p><a href="https://technet.microsoft.com/ja-jp/library/jj219422.aspx">https://technet.microsoft.com/ja-jp/library/jj219422.aspx</a></p><p>同一コンピューター上に異なるバージョンの Office、Project、Visio をインストールするためのサポート対象シナリオ</p><p><a href="https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx">https://technet.microsoft.com/ja-jp/library/mt712177(v=office.16).aspx</a></p><p>Visio の展開ガイド</p><p><a href="https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-visio">https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-visio</a></p><p>Project の展開ガイド</p><p><a href="https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-project">https://learn.microsoft.com/ja-jp/deployoffice/deployment-guide-for-project</a></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;本記事では、ボリュームライセンス版の Visio 2019 &amp;#x2F; Project 2019 または Visio 2021 &amp;#x2F; Project 2021 と Microsoft 365 Apps を共存</summary>
      
    
    
    
    
    <category term="インストール" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/"/>
    
  </entry>
  
  <entry>
    <title>暗号化された Office ファイルを保護ビューで開き、保護ビューが閉じた後、クライアントの %localappdata% フォルダ配下 Packages フォルダに oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダが残存する</title>
    <link href="https://officesupportjp.github.io/blog/cl7pvphjn0000a46ygd3m4nro/"/>
    <id>https://officesupportjp.github.io/blog/cl7pvphjn0000a46ygd3m4nro/</id>
    <published>2022-09-06T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.627Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。<br>この記事では、暗号化された Office ファイル (*) を保護ビューで開き、保護ビューが閉じた後、<br>クライアントのローカル フォルダ %localappdata%\Packages 配下に oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ (x は任意の英数字) が残存する事象について説明します。  </p><h1 id="事象の詳細"><a href="#事象の詳細" class="headerlink" title="事象の詳細"></a>事象の詳細</h1><p>Office アプリでは、暗号化された Office ファイルであるかどうかに関わらず、ファイルを保護ビューで開く場合、以下のフォルダを作成します。  </p><p>%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ<br>(例: C:\Users&lt;ユーザー名&gt;\AppData\Local\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx)  </p><p>この oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ配下に、元のファイルや元のファイルに紐づく情報を一時ファイルとしてコピー&#x2F;作成した上で、保護ビューでファイルを読み取り専用で開きます。  </p><p>この動作は、ユーザーが明示的に [編集を有効にする] を実行しない限り、リスクを軽減しながらファイルの内容を確認できるセキュリティを考慮した実装です。  </p><p>なお、Office ファイルが暗号化されていない場合は、[編集を有効にする] をクリックしたタイミングで、%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダは削除されます。  </p><p>一方、暗号化された Office ファイル (*) の場合、[編集を有効にする] をクリックしても、%localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダは削除されず、残ります。  </p><p><img src="/blog/cl7pvphjn0000a46ygd3m4nro/image1.png"><br><img src="/blog/cl7pvphjn0000a46ygd3m4nro/image2.png">  </p><p>(*) 暗号化された Office ファイルとは、以下のような操作などで暗号化されたファイルを指します。<br>・Azure Information Protection 統合ラベル付けクライアントや Office アプリで秘密度ラベルを設定したファイル<br>・Office アプリの [ファイルの保護] - [アクセスの制限] からアクセス制限ありを設定したファイル<br>・SharePoint の Information Rights Management (IRM) を有効に設定したライブラリからダウンロードされたファイル  </p><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>この問題は、Microsoft 365 Apps にて確認されており、現在、製品開発部門で調査中です。<br>新たな情報が確認された場合は、この記事に追記する形で公開していく予定です。</p><h1 id="回避案"><a href="#回避案" class="headerlink" title="回避案"></a>回避案</h1><p>エクスプローラーを起動し、残っている %localappdata%\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx フォルダ<br>(例: C:\Users&lt;ユーザー名&gt;\AppData\Local\Packages\oice_xx_xxxxxxxx_xxxxxxxx_xxxx) を選択し、手動で削除してください。  </p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、暗号化された Office ファイル (*) を保護ビューで開き、保護ビューが閉じた後、&lt;br&gt;クライアントのローカル フォルダ %localappdata%\Packages 配下に oice_xx_x</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>WSFC 継続的可用性 (CA) が有効な共有フォルダーから Office ファイルが開けない</title>
    <link href="https://officesupportjp.github.io/blog/cl6q3dt1k0000ks3pemokg0de/"/>
    <id>https://officesupportjp.github.io/blog/cl6q3dt1k0000ks3pemokg0de/</id>
    <published>2022-08-12T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.612Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの中村です。</p><p>今回の記事では、Windows Server Failover Cluster (WSFC) 構成のファイル サーバー上に作成した共有フォルダーで、継続的可用性 (Continuous Availability<br> (CA)) 設定を有効にすると、このフォルダー配下の Office ファイルを開くときに時間がかかる、という動作について説明します。なお、このときに要する時間は数十分となる場合があるため、ユーザーが開き終わるまで待機することなく「Office ファイルを開くことができず、Office アプリの応答がなくなる」といった現象として報告されることが想定されます。<br><br></p><h3 id="1-発生条件"><a href="#1-発生条件" class="headerlink" title="1. 発生条件"></a><strong>1. 発生条件</strong></h3><p> 以下をすべて満たす場合に発生します。</p><ul><li><p>Office デスクトップ アプリ バージョン 1812 以降</p></li><li><p>WSFC 構成のファイル サーバーで、共有フォルダーの継続的可用性 (CA) を有効にしている</p></li></ul><p> <img src="/blog/cl6q3dt1k0000ks3pemokg0de/WSFC_CA.png">  </p><ul><li><p>共有フォルダーの名前に NFKC 形式での Unicode正規化により、別の文字に置き換わる文字を使用している (例: 全角アルファベット)</p><p>Unicode 正規化の詳細は以下をご参照ください。<br>Using Unicode Normalization to Represent Strings<br><a href="https://docs.microsoft.com/en-us/windows/win32/intl/using-unicode-normalization-to-represent-strings">https://docs.microsoft.com/en-us/windows/win32/intl/using-unicode-normalization-to-represent-strings</a></p><p>※ サブ フォルダーは影響しません。共有ルート フォルダーの名前のみです。</p></li></ul><br><h3 id="2-原因"><a href="#2-原因" class="headerlink" title="2. 原因"></a><strong>2. 原因</strong></h3><p>WSFC 構成の継続的可用性 (CA) は、一般的に可用性が重要なスケールアウト ファイル サーバーなどの構成で利用され、ファイルへのアクセス中にフェイル オーバーが発生したときにも、フェイル オーバー後にそのままアクセスを継続することを実現します。<br>本機能の詳細は、以下の公開情報をご参照ください。</p><p>Windows Server 2012 Continuous Availability File Server feature<br><a href="https://docs.microsoft.com/en-us/archive/blogs/davguents_blog/windows-server-2012-continuous-availability-file-server-feature">https://docs.microsoft.com/en-us/archive/blogs/davguents_blog/windows-server-2012-continuous-availability-file-server-feature</a></p><p>この仕組みの実現のため、継続的可用性が有効な共有フォルダーが検出されると、SMB クライアントはそのファイル サーバーへのアクセスが失敗した場合も、しばらくの間リトライを繰り返します。このリトライによって、フェイル オーバー後に自動的に再接続され、継続アクセスが可能となります。<br><br></p><p>一方で、先述の発生条件に記載したバージョン以降の Office アプリケーションでは、セキュリティ脆弱性への対応のため、ファイルが格納されているネットワーク フォルダー パスを Unicode 正規化してアクセスする処理を追加しました。<br>例えば、「ｓｈａｒｅ」という全角英字を Unicode 正規化すると、半角英字「share」となります。したがって、「\\server\ｓｈａｒｅ\test.xlsx」という全角英字フォルダー内のファイルを開くときに、「\\server\share」 (半角英字) へのアクセスが発生することになります。</p><p>半角英字の「share」フォルダーが存在せず、そのようなフォルダーは存在しない旨のエラーが返されても以後の処理は正常に動作しますが、継続的可用性が有効な場合は、存在しないことによるエラーであってもこのエラーがすぐに Office に返らず、リトライが繰り返されます。<br>この結果、リトライ オーバーまで Office は待機し続け、ファイルを開くまでに長い時間を要します。</p><p>Windows OS の継続的可用性によるリトライ、Office アプリケーションのファイル オープン時の Unicode 正規化ともに、想定された仕組みであり、本動作は現在の製品動作上の制限事項です。<br><br></p><h3 id="3-回避策"><a href="#3-回避策" class="headerlink" title="3. 回避策"></a><strong>3. 回避策</strong></h3><p>以下のいずれかの方法による回避をご検討ください。</p><ol><li><p>共有フォルダーの名前に Unicode 正規化で別の文字となる文字を使用しない</p></li><li><p>共有フォルダーをネットワーク ドライブに割り当てて使用する<br>(この場合、Office が Unicode 正規化してアクセスするのはネットワーク ドライブを用いたパスとなるため、現象を回避できます)</p></li><li><p>共有フォルダーの継続的可用性を無効にする</p></li></ol><br>今回の投稿は以上です。  <br><br><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの中村です。&lt;/p&gt;
&lt;p&gt;今回の記事では、Windows Server Failover Cluster (WSFC) 構成のファイル サーバー上に作成した共有フォルダーで、継続的可用性 (Continuous Availabil</summary>
      
    
    
    
    
    <category term="ファイル I/O" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/"/>
    
  </entry>
  
  <entry>
    <title>ストア アドインを利用したファイルを一元展開で利用できるようになりました</title>
    <link href="https://officesupportjp.github.io/blog/cl6as2js40007m0u87h40erld/"/>
    <id>https://officesupportjp.github.io/blog/cl6as2js40007m0u87h40erld/</id>
    <published>2022-08-02T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.627Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。</p><p>以前の Microsoft 365 Apps では、Office ストアから入手した Web アドインの情報が埋め込まれた Office ファイルを、ストアの利用が禁止されているユーザー環境で開くと、該当の Web アドインが一元展開から配信されていたとしてもアドインが利用できませんでした。Microsoft 365 Apps でこの動作が改善され、このようなシナリオでも利用が可能となりましたので、本記事では、この改善の詳細について説明します。</p><h1 id="【前提】"><a href="#【前提】" class="headerlink" title="【前提】"></a>【前提】</h1><p>本記事に記載の “一元展開” とは、<a href="https://admin.microsoft.com/#/homepage">Microsoft 365 管理センター</a> より実施可能な設定で以下公開情報に掲載されています。  </p><p>タイトル : アドインの一元展開が組織で機能するかどうかを確認する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/centralized-deployment-of-add-ins">https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/centralized-deployment-of-add-ins</a>    </p><p>タイトル : Microsoft 365 管理センターにアドインをデプロイする<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/manage-deployment-of-add-ins">https://docs.microsoft.com/ja-jp/microsoft-365/admin/manage/manage-deployment-of-add-ins</a>    </p><p>上記に従って一元展開をすると以下のように [Office アドイン] 画面の [管理者による管理] タブから指定したアドインを利用できるようになります。</p><p><img src="/blog/cl6as2js40007m0u87h40erld/Office_Store_Admin_Managed.png"></p><p>特定の Web アドインのみの利用を許可したいテナントで、一元展開を活用して利用するアドインのみを展開し、Office ストアの利用を禁止する以下の 1) 2) のいずれかの設定も併せて適用するという利用方法が多く採用されています。</p><h3 id="1-Microsoft-365-管理センターでストアを禁止する設定"><a href="#1-Microsoft-365-管理センターでストアを禁止する設定" class="headerlink" title="1) Microsoft 365 管理センターでストアを禁止する設定"></a>1) Microsoft 365 管理センターでストアを禁止する設定</h3><p>Microsoft 365 管理センターにおいてストアを禁止する手順は以下となります。 後述する 2) の場合は、デスクトップ アプリケーションのみが対象となりますが、本設定は Office for the Web (Web 版 Office) も対象となります。</p><h4 id="lt-設定手順-gt"><a href="#lt-設定手順-gt" class="headerlink" title="&lt;設定手順&gt;"></a>&lt;設定手順&gt;</h4><ol><li><a href="https://admin.microsoft.com/#/homepage">Microsoft 365 管理センター</a> へグローバル管理者などでサインインします。</li><li>[設定] - [組織設定] をクリックします。</li><li>[組織設定] 画面 - [サービス] タブ に表示されている [ユーザーが所有するアプリとサービス] をクリックします。</li><li>表示された設定で [ユーザーが Office Store にアクセスすることを許可する] のチェックを外し、[保存] をクリックします。</li></ol><p>なお、本設定を適用すると、[Office アドイン] 画面の [ストア] タブに Office ストアが利用できない旨のメッセージが表示され、ストアが利用禁止になります。</p><br><h3 id="2-ポリシーでストアを禁止する設定"><a href="#2-ポリシーでストアを禁止する設定" class="headerlink" title="2) ポリシーでストアを禁止する設定"></a>2) ポリシーでストアを禁止する設定</h3><p>Office 管理用テンプレートのグループ ポリシーなどを利用し以下を設定すると [Office アドイン] 画面の [ストア] タブが非表示になり、ストアから入手した Web アドインが利用できなくなります。</p><h4 id="lt-グループ-ポリシー設定-gt"><a href="#lt-グループ-ポリシー設定-gt" class="headerlink" title="&lt;グループ ポリシー設定&gt;"></a>&lt;グループ ポリシー設定&gt;</h4><p>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Office 2016] - [アプリケーション設定] -[セキュリティ] - [セキュリティ センター]<br>&amp;nbsp;- [Office ストアのブロック] : 有効  </p><p>なお、上記ポリシーは Office デスクトップ アプリケーションの [トラスト センターの設定] - [信頼できるアドイン カタログ] - [Office ストアの Web アドインの起動を許可しない。] の強制的にチェック有りにし、変更不可とする設定となります。</p><h1 id="【改善内容】"><a href="#【改善内容】" class="headerlink" title="【改善内容】"></a>【改善内容】</h1><p>上記【前提】のように、ストアを利用禁止して一元展開で一部アドインを展開している環境において、以前は ストアから入手したアドインを利用している Office ファイルを開いた場合、表示されたアドインには、以下のような画面が表示され、アドインを利用することができませんでした。</p><p><img src="/blog/cl6as2js40007m0u87h40erld/Office_Store_Addin_Blocked1.png"></p><p><img src="/blog/cl6as2js40007m0u87h40erld/Office_Store_Addin_Blocked2.png"></p><p>これは、Office ファイルの作成時にどこからアドインが挿入されたがファイル内に記録されているためです。従来は、同じアドインが一元展開で利用できる状況でも、ストアから挿入したアドインとして記録されている場合は、一元展開のアドインが使われることはありませんでした。  </p><p>実運用で特にこの状況に直面する例として、Power Apps や Power BI、Dynamics のサイトから Office ファイルにデータを埋め込んで出力するシナリオの報告を多く頂いていました。これらのシナリオでは、ストア アドインの情報がファイルに埋め込まれます。</p><h4 id="lt-Power-Apps-gt"><a href="#lt-Power-Apps-gt" class="headerlink" title="&lt;Power Apps&gt;"></a>&lt;Power Apps&gt;</h4><p>タイトル : テーブル データを Excel で開く<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/powerapps/maker/data-platform/data-platform-excel-addin">https://docs.microsoft.com/ja-jp/powerapps/maker/data-platform/data-platform-excel-addin</a><br>該当箇所 : テーブル データを Excel で開く　　</p><h4 id="lt-Power-BI-gt"><a href="#lt-Power-BI-gt" class="headerlink" title="&lt;Power BI&gt;"></a>&lt;Power BI&gt;</h4><p>タイトル : PowerPoint にライブ Power BI レポート ページを追加する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/power-bi/collaborate-share/service-power-bi-powerpoint-add-in-install?tabs=export">https://docs.microsoft.com/ja-jp/power-bi/collaborate-share/service-power-bi-powerpoint-add-in-install?tabs=export</a><br>該当箇所 : “[エクスポート] オプションを使用する” に関する記述  </p><h4 id="lt-Dynamics-365-gt"><a href="#lt-Dynamics-365-gt" class="headerlink" title="&lt;Dynamics 365&gt;"></a>&lt;Dynamics 365&gt;</h4><p>- Excel<br>タイトル : Excel 用 Microsoft Dynamics AX アドインの使用について<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-excel">https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-excel</a><br>- Word<br>タイトル : Word 用 Microsoft Dynamics AX アドインの使用について<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-word">https://docs.microsoft.com/ja-jp/dynamicsax-2012/appuser-itpro/about-using-the-microsoft-dynamics-ax-add-in-for-word</a><br>※ Dynamics については、設定次第で一元展開したアドインを利用する設定も可能ですが、既定ではストア アドインを利用します。</p><p>本記事の改善によって、ファイルにストアからダウンロードしたアドインの情報が記録されていたとしても、一元展開で同じアドインを展開していれば、上記画面が表示されることなく、自動的に 一元展開されたアドインを利用することが可能になりました。</p><p>また同様に、従来はテナント A で一元展開されたアドインを用いて作成したファイルをテナント B で開いた場合も、テナント A の一元展開アドインの情報が記録されているため、以下画面が表示されて利用ができませんでした。</p><p><img src="/blog/cl6as2js40007m0u87h40erld/Admin_Managed_Addin_Blocked.png"></p><p>今回の改善は同じアドインであれば、展開方法に依存せず利用できるというものです。そのため、こちらのケースでも本改善によって自動的にストア アドインやテナント B の一元展開アドインを利用できます。</p><h1 id="【利用可能な-Office-バージョン】"><a href="#【利用可能な-Office-バージョン】" class="headerlink" title="【利用可能な Office バージョン】"></a>【利用可能な Office バージョン】</h1><p>上記機能が利用可能な Office バージョンは、Microsoft 365 Apps の各更新チャネルにおいてそれぞれ以下が対象となります。</p><ul><li>Microsoft 365 Apps 最新チャネル - バージョン 2107 (ビルド 14228.20204) 及びそれ以降</li><li>Microsoft 365 Apps 月次エンタープライズ チャネル - バージョン 2107 (ビルド 14228.20324) 及びそれ以降</li><li>Microsoft 365 Apps 半期エンタープライズ チャネル - バージョン 2202 (ビルド 14931.20604) 及びそれ以降</li></ul><br><p>今回の投稿は以上です。</p><br><p><strong>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;/p&gt;
&lt;p&gt;以前の Microsoft 365 Apps では、Office ストアから入手した Web アドインの情報が埋め込まれた Office ファイルを、ストアの利用が禁止されているユーザー環境で開くと、該当の W</summary>
      
    
    
    
    
    <category term="Web アドイン" scheme="https://officesupportjp.github.io/blog/tags/Web-%E3%82%A2%E3%83%89%E3%82%A4%E3%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>Office 利用時に storage.googleapis.com や cdn01.boxcdn.net への通信が発生する</title>
    <link href="https://officesupportjp.github.io/blog/cl4hy59k50027usvsc5k6cuto/"/>
    <id>https://officesupportjp.github.io/blog/cl4hy59k50027usvsc5k6cuto/</id>
    <published>2022-06-19T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.580Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000">2022&#x2F;08&#x2F;19 Update<br>[対応案] の内容を更新しました</span> </p><p>こんにちは、Office サポート チームです。<br>この記事では、クイック実行版 Office アプリケーション利用時に<br>storage.googleapis.com や cdn01.boxcdn.net への通信が発生する事象について説明します。</p><p>新たな情報がある場合には、随時この記事でお知らせします。  </p><h1 id="事象の詳細"><a href="#事象の詳細" class="headerlink" title="事象の詳細"></a>事象の詳細</h1><p>M365Apps や Office 2019 などのクイック実行版 Office アプリケーションで以下の操作をしたときに<br>storage.googleapis.com や cdn01.boxcdn.net への通信が発生します。</p><ul><li>[スタート] メニューから Excel 等を起動して、[開く] ボタンをクリックする</li><li>[名前を付けて保存] をクリックする</li></ul><p>このとき、プロキシ認証を利用している環境では<br>「storage.googleapis.com のプロキシサーバーに接続しています」や<br>「cdn01.boxcdn.net のプロキシサーバーに接続しています」<br>というメッセージが表示されます。  </p><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>本事象は、主に、クイック実行版 Office のクラウド側の設定追加の影響で発生しています。  </p><p>Office アプリケーションから接続するサービスの定義 (クラウド側の設定) として<br>サードパーティーの Egnyte や Box のファイル共有サービスの定義が追加されました。  </p><p>この新しいクラウド側の定義をクライアントが受信すると、<br>以降、Office のバックステージ ビューに、Egnyte や Box (いずれもサードパーティーのファイル共有サービス) が読み込まれ、<br>Egnyte のアイコン画像取得のために「storage.googleapis.com」へ<br>Box のアイコン画像取得のために「cdn01.boxcdn.net」への通信が発生します。</p><h1 id="対応案"><a href="#対応案" class="headerlink" title="対応案"></a>対応案</h1><p><span style="color:#ff0000">2022&#x2F;08&#x2F;19 現在、Egnyte および Box のアイコン画像取得のための通信先が、Microsoft 365 Apps をご利用いただくにあたり必須の通信先である 「cdn.odc.officeapps.live.com」 へ変更になっております。<br>そのため、現在本事象は発生いたしません。</span> </p><p><span style="color:#ff0000">本事象に対する対応として、下記のポリシー設定は不要となります。既に設定いただいている場合は、必要に応じて設定の見直しをご検討ください。</span></p><p>サードパーティーのファイル共有サービスを全く使っていない場合は、以下のポリシー設定で回避できます。</p><p>[ユーザーの構成]<br>- [ポリシー]<br>- [管理用テンプレート]<br>- [Microsoft Office 2016]<br>- [ツール | オプション | 全般 | サービス オプション]<br>- [オンライン コンテンツ]<br>- [サービス レベルのオプション]<br>を有効にして、 “Microsoft のサービスのみ” にする  </p><p>上記ポリシーを設定すると以下のレジストリが作成されます。<br>レジストリを直接設定することでも同じ動作となります。</p><p>キー : HKEY_CURRENT_USER\Software\Policies\Microsoft\office\16.0\common\internet<br>名前 : serviceleveloptions<br>種類 : REG_DWORD<br>データ : 1</p><p>BOX 等、サードパーティーのファイル共有サービスの一部製品をご利用の場合は<br>上記設定をすると、ご利用いただけなくなります (*1) ので<br>上記設定は行わずに、「storage.googleapis.com」 等へのプロキシ認証を除外することをご検討をお願いいたします。</p><p>(*1)<br>[場所の追加] や [アカウント] – [サービスの追加] – [ストレージ] の項目が表示されなくなります。</p><p>今回の投稿は以上です。<br>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;2022&amp;#x2F;08&amp;#x2F;19 Update&lt;br&gt;[対応案] の内容を更新しました&lt;/span&gt; &lt;/p&gt;
&lt;p&gt;こんにちは、Office サポート チームです。&lt;br&gt;この記事では、クイック実行版 Off</summary>
      
    
    
    
    
    <category term="クラウド ストレージ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>OneNote の OCR 機能で読み取りにくい文字列がある</title>
    <link href="https://officesupportjp.github.io/blog/cl28oxvt6002ku8uj1ose6ej2/"/>
    <id>https://officesupportjp.github.io/blog/cl28oxvt6002ku8uj1ose6ej2/</id>
    <published>2022-04-21T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.596Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの永田です。</p><p>デスクトップ版 OneNote は光学式文字認識 (OCR) をサポートしており、ページに挿入された画像からテキストを読み取って、クリップボードに取得することができます。このとき、画像の解像度や、画像の形式によって、期待通りにテキストを読み取れないことがあります。</p><p>読み取りに影響する要因は、以下のようなものがあります。</p><ul><li>フォントが小さい文字列<ul><li>画像に含まれる文字のフォント サイズが小さければ小さいほど、読み取られにくい</li></ul></li><li>罫線を含む文字列<ul><li>文字列の上や下に罫線がある場合、文字が正確に読み取られにくい</li></ul></li><li>表形式の文字列<ul><li>複数列によってレイアウトされている表形式の文字列は、レイアウトを維持して読み取られにくい</li></ul></li></ul><h1 id="対応状況"><a href="#対応状況" class="headerlink" title="対応状況"></a>対応状況</h1><p>この動作は OneNote の機能上の制限です。</p><h1 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h1><p>誠に恐れ入りますが、以下の方法を検討ください。</p><ul><li>フォントが小さい文字列<ul><li>画像の表示倍率を拡大して読み込む。拡大して画像がぼやける場合は、必要に応じてシャープネス機能を利用する。Word の場合、図の書式設定の「シャープネス」機能を利用可能。</li></ul></li><li>罫線を含む文字列<ul><li>文字列の上や下に罫線がある場合、最上段や最下段には出来るだけ罫線を含まないようスクリーンショットを採取して OneNote に貼り付けて読み取る</li></ul></li><li>表形式の文字列<ul><li>読み取り対象画像に対して、一列ずつスクリーンショットを採取して OneNote に貼り付けて読み取る</li></ul></li></ul><p>今回の投稿は以上です。</p><p><strong>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの永田です。&lt;/p&gt;
&lt;p&gt;デスクトップ版 OneNote は光学式文字認識 (OCR) をサポートしており、ページに挿入された画像からテキストを読み取って、クリップボードに取得することができます。このとき、画像の解像度や、画像の形</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>インターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について (MC322553)</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4f5o1003504vsa5tp25c2/</id>
    <published>2022-02-18T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.612Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2022&#x2F;03&#x2F;18 Update</strong></span><br><span style="color:#339966">- “【インターネット入手ファイルとみなされるシナリオ】” を追記しました。</span><br><span style="color:#339966">- “【マクロを有効にする方法について】” 内に以下を追記しました。</span><br><span style="color:#339966">&amp;nbsp;&amp;nbsp;- “1) ポリシーでマクロを有効にする方法” に [マクロの設定] による制御が実施されることを追記しました。</span><br><span style="color:#339966">&amp;nbsp;&amp;nbsp;- “4) Web 上のファイルを開くシナリオで、信頼済みサイトに登録する方法” を追記しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;06&#x2F;08 Update</strong></span><br><span style="color:#339966">ネットワーク共有がインターネット ゾーンとみなされるシナリオについて追記しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;07&#x2F;08 Update</strong></span><br><span style="color:#339966">最新チャネルへのリリースがロールバックされたため、冒頭の記載を変更しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;07&#x2F;29 Update</strong></span><br><span style="color:#339966">最新チャネルへのリリース再開されたため、記載を変更しました。</span>  </p><br><p>こんにちは、Office サポート チームです。</p><p>本記事では、2022 年 4 月 より Microsoft 365 Apps への展開が開始されるインターネットから入手した Office ファイルのマクロがブロックされる既定の動作変更について説明します。本記事に記載の既定の動作変更は 7 月 27 日 (米国時間) に最新チャネルにおいてリリースが開始されました。</p><br><h1 id="【前提】"><a href="#【前提】" class="headerlink" title="【前提】"></a>【前提】</h1><p>今回のご説明は以下公開情報でご案内している内容となります。</p><p>タイトル : Macros from the internet will be blocked by default in Office<br>アドレス  : <a href="https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/ja-jp/DeployOffice/security/internet-macros-blocked</a> (日本語版 - 機械翻訳)<br>アドレス  : <a href="https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked">https://docs.microsoft.com/en-us/DeployOffice/security/internet-macros-blocked</a> (英語版)  </p><p>また、以下のとおり、ブログ記事も公開されています。</p><p>タイトル : Helping users stay safe: Blocking internet macros by default in Office<br>アドレス  : <a href="https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805">https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805</a> (英語版)</p><p>上記公開情報 &#x2F; ブログ記事には最新状況の更新がされている場合があるため、適宜ご確認ください。</p><br><h1 id="【概要】"><a href="#【概要】" class="headerlink" title="【概要】"></a>【概要】</h1><p>上記公開情報で記載の概要は、Office のセキュリティ向上のため、 Office アプリケーションにてインターネットから入手した Office ファイルのマクロの実行をブロックするよう既定の動作を変更するという内容です。</p><p>これまでの Office では、インターネットから入手したファイルは保護ビューでは開かれますが、保護ビューを解除して編集モードにした後のマクロの実行可否の判断には、インターネットからの入手であることは考慮されず、他のセキュリティ設定でブロックされない限りはマクロを実行できました。今回の変更で、インターネットから入手したファイルは既定でマクロ実行がブロックされるようになります。</p><p>本変更はインターネットから入手したすべての Office ファイルが対象ではなく、特定の条件でマクロの有効 &#x2F; 無効が決定されなかった場合にブロックされる動作となります。</p><p>つまり、この条件次第でインターネットから入手するファイルのマクロを今後も実行できるようになりますので、引き続きマクロを実行したい場合は、いずれかの先に判断される条件を利用してマクロを有効にできますので、本記事で詳しく紹介します。</p><p>なお、ここで言う「インターネットから入手したファイル」とは、Mark of the Web (MOTW) 属性と呼ばれる Windows によってインターネットからのファイル取得時に自動的に付与される Web マークが付与されたファイルを指します。</p><br><h1 id="【インターネット入手ファイルとみなされるシナリオ】"><a href="#【インターネット入手ファイルとみなされるシナリオ】" class="headerlink" title="【インターネット入手ファイルとみなされるシナリオ】"></a>【インターネット入手ファイルとみなされるシナリオ】</h1><p>以下のようなシナリオがインターネット入手ファイルとみなされ、既定でマクロが無効化されるようになります。</p><ul><li>外部から受信したメールの添付ファイルを開く</li><li>ブラウザーでインターネット ゾーンのサイトからダウンロードしたファイルを開く</li><li>インターネット ゾーンの Web サイト上のファイルを直接開く (IP アドレスや FQDN で接続されたネットワーク共有のファイルを開く場合を含む)</li></ul><br><h1 id="【本変更の対象範囲について】"><a href="#【本変更の対象範囲について】" class="headerlink" title="【本変更の対象範囲について】"></a>【本変更の対象範囲について】</h1><p>先の 公開情報 “この変更のOfficeのバージョン” に記載のとおり、本件の対象となる Office アプリケーションは Access &#x2F; Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word です。</p><p>また、本変更の対象の Office は Windows デバイスにインストールされる以下となります。</p><ul><li>Microsoft 365 Apps 最新チャネル (プレビュー)</li><li>Microsoft 365 Apps 最新チャネル</li><li>Microsoft 365 Apps 月次エンタープライズ チャネル</li><li>Microsoft 365 Apps 半期エンタープライズ チャネル (プレビュー)</li><li>Microsoft 365 Apps 半期エンタープライズ チャネル</li><li>製品版 Office 2021</li><li>製品版 Office 2019</li><li>製品版 Office 2016</li></ul><br><h1 id="【変更される既定の動作の詳細】"><a href="#【変更される既定の動作の詳細】" class="headerlink" title="【変更される既定の動作の詳細】"></a>【変更される既定の動作の詳細】</h1><p>今回の既定の動作の変更は、先の公開情報に記載の以下フローチャートにて <span style="color:#ff0000"><strong>赤枠で囲った 7 の状況</strong></span> となった場合に該当します。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-macro-flowchart.png"></p><p>上記フローチャートにおいて今回の動作変更の影響を受ける条件は以下をすべて満たす場合となります。</p><ul><li>開かれるマクロ付きファイルにインターネットから入手されたことを意味する Web マークが付与されている (フローチャート 1 &#x3D; START)</li><li>マクロ付きファイルが “信頼できる場所”  に保存されていない (フローチャート 2 &#x3D; No)</li><li>マクロ付きファイルが デジタル署名されていない、またはデジタル署名されているが “信頼できる発行元” に登録されている証明書と署名が一致しない (フローチャート 3 &#x3D; No)</li><li>クラウド ポリシー &#x2F; グループ ポリシー等のポリシーにてマクロの有効 &#x2F; 無効が設定されていない (フローチャート 4a,4b &#x3D; No)</li><li>ユーザーが以前このファイルを開いていない、または以前このファイルを開いたが表示される通知にて [コンテンツを有効にする] を選択していない (フローチャート 6 &#x3D; No)</li></ul><p>これらの条件すべてに合致した場合、以下のとおり動作が変更となります。</p><h3 id="変更前"><a href="#変更前" class="headerlink" title="変更前"></a>変更前</h3><p>以下のオプション設定に従ってマクロの有効 &#x2F; 無効を決定します。</p><h4 id="lt-オプション設定-Excel-アプリケーションから確認する例-gt"><a href="#lt-オプション設定-Excel-アプリケーションから確認する例-gt" class="headerlink" title="&lt;オプション設定 (Excel アプリケーションから確認する例)&gt;"></a>&lt;オプション設定 (Excel アプリケーションから確認する例)&gt;</h4><p>[ファイル] タブ - [オプション] - [トラスト センター]- [トラスト センターの設定] - [マクロの設定] - [マクロの設定] の選択</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/macro-settings.png"></p><p>なお、既定の設定である “警告して、VBA マクロを有効にする” の場合、以下が出力されます。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-security-warning-banner.png"></p><h3 id="変更後"><a href="#変更後" class="headerlink" title="変更後"></a>変更後</h3><p>以下のメッセージが出力されマクロの実行がブロックされます。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-security-risk-banner.png"></p><br><h1 id="【マクロを有効にする方法について】"><a href="#【マクロを有効にする方法について】" class="headerlink" title="【マクロを有効にする方法について】"></a>【マクロを有効にする方法について】</h1><p>上記の動作変更にて無効化されたマクロを有効にする方法を以下に説明します。</p><h2 id="1-ポリシーでマクロを有効にする方法"><a href="#1-ポリシーでマクロを有効にする方法" class="headerlink" title="1) ポリシーでマクロを有効にする方法"></a>1) ポリシーでマクロを有効にする方法</h2><p>Office 管理用テンプレートのグループ ポリシーなどを利用し以下を設定するとインターネットから入手した Office ファイルについてもマクロを有効にできます。</p><h4 id="lt-グループ-ポリシー設定-gt"><a href="#lt-グループ-ポリシー設定-gt" class="headerlink" title="&lt;グループ ポリシー設定&gt;"></a>&lt;グループ ポリシー設定&gt;</h4><ul><li>Access<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Access 2016] - [アプリケーション設定] -[セキュリティ] - [セキュリティ センター]<br>&amp;nbsp;- [インターネットから取得した Office ファイル内のマクロの実行をブロックします] : 無効</li><li>Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft xxx 2016] - [xxx のオプション] - [セキュリティ] - [セキュリティ センター]<br>&amp;nbsp;- [インターネットから取得した Office ファイル内のマクロの実行をブロックします] : 無効<br>注) xxx はそれぞれ Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word です。<br></li></ul><p>なお、この設定とは別にオプションの [トラスト センターの設定] - [マクロの設定] による、マクロ全体のセキュリティ設定による制御は行われます。例として、既定の “警告して、VBA マクロを有効にする” 設定の場合には、以下が表示されます。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/vba-security-warning-banner.png"></p><br><h2 id="2-特定のファイルでマクロを有効にする方法"><a href="#2-特定のファイルでマクロを有効にする方法" class="headerlink" title="2) 特定のファイルでマクロを有効にする方法"></a>2) 特定のファイルでマクロを有効にする方法</h2><p>特定のファイルでマクロを有効にする方法ついて、以下の “Web マークを削除する方法” 及び “信頼できる発行元のデジタル署名を追加する方法” があります。</p><h3 id="Web-マークを削除する方法"><a href="#Web-マークを削除する方法" class="headerlink" title="Web マークを削除する方法"></a>Web マークを削除する方法</h3><p>インターネットから入手したファイルには Web マークが付与されると先ほど述べましたが、この Web マークの実体はWindows OS で広く利用されている NTFS ファイルシステムの代替データストリーム（ADS：Alternate Data Stream）に保存されているゾーン識別子 (Zone.Identifier) です。</p><p>そのため、このゾーン識別子を削除すると、本動作変更の対象外となり、ローカルで作成したマクロ付きファイルと同様の動作となります。以下画面から削除する手順と PowerShell で削除する手順をそれぞれ記載します。</p><h4 id="lt-ゾーン識別子の削除手順-画面-gt"><a href="#lt-ゾーン識別子の削除手順-画面-gt" class="headerlink" title="&lt;ゾーン識別子の削除手順 (画面) &gt;"></a>&lt;ゾーン識別子の削除手順 (画面) &gt;</h4><ol><li>エクスプローラーから該当のマクロ付きファイルを右クリックし、[プロパティ]を表示します。</li><li>[全般] タブの最下部に以下画面のように [セキュリティ] が表示されている場合は、右側の [許可する] をチェックし、[OK] をクリックします。</li></ol><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/file-property-security.png"></p><h4 id="lt-ゾーン識別子の削除手順-PowerShell-コマンド-gt"><a href="#lt-ゾーン識別子の削除手順-PowerShell-コマンド-gt" class="headerlink" title="&lt;ゾーン識別子の削除手順 (PowerShell コマンド) &gt;"></a>&lt;ゾーン識別子の削除手順 (PowerShell コマンド) &gt;</h4><p>以下のコマンドを PowerShell で実行します。  (対象ファイル : C:\temp\sample.xlsm)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Remove-Item &#x27;C:\temp\sample.xlsm&#x27; -Stream Zone.Identifier;  </span><br></pre></td></tr></table></figure><br><h3 id="信頼できる発行元のデジタル署名を追加する方法"><a href="#信頼できる発行元のデジタル署名を追加する方法" class="headerlink" title="信頼できる発行元のデジタル署名を追加する方法"></a>信頼できる発行元のデジタル署名を追加する方法</h3><p>Office アプリケーション実行環境にて、”信頼できる発行元” として登録されている証明書を使用したデジタル署名がマクロに追加されている場合にはマクロが実行可能となります。</p><p>この動作を利用してマクロを実行可能とするため、署名者は秘密鍵を持つ証明書で VBA マクロに署名を行い、この証明書をマクロ実行環境のユーザーの「信頼された発行元」ストアに登録します。証明書の信頼に関する動作詳細は Windows 全般の動作となるため本記事では割愛し、Office の動作に関わる部分のみ以下に記載します。</p><p>以下に各 Office アプリケーション上での “信頼できる発行元” として登録されている証明書の確認方法を記載します。</p><h4 id="lt-オプション設定-信頼できる発行元-gt"><a href="#lt-オプション設定-信頼できる発行元-gt" class="headerlink" title="&lt;オプション設定 - 信頼できる発行元&gt;"></a>&lt;オプション設定 - 信頼できる発行元&gt;</h4><p>[ファイル] タブ - [オプション] - [トラスト センター] - [トラスト センターの設定] -  [信頼できる発行元]</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/trusted-publisher.png"></p><p>上記画面にて “信頼できる発行元” として登録されているデジタル証明書の一覧を確認することが可能です。  </p><p>マクロにデジタル署名を付与する手順は以下となります。</p><h4 id="lt-デジタル署名追加手順-gt"><a href="#lt-デジタル署名追加手順-gt" class="headerlink" title="&lt;デジタル署名追加手順&gt;"></a>&lt;デジタル署名追加手順&gt;</h4><ol><li>マクロ付きファイルを各 Officeアプリケーションで開きます。</li><li>[Alt] + [F11] キーを を押下し、Visual Basic Editor (VBE) を開きます。</li><li>VBE の [ツール] タブ - [デジタル署名] をクリックします。</li><li>表示されたウィンドウの [選択] をクリックし、使用する “信頼できる発行元” の証明書を選択して [OK] をクリックします。</li><li>“この VBA プロジェクトは以下のように署名されています。” の下の “証明書名” に選択した証明書名が表示されたことを確認し、[OK] をクリックします。</li><li>ファイルを保存して閉じます。</li></ol><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/digital-signature.png"></p><br><h2 id="3-特定のフォルダーのファイルでマクロを有効にする方法"><a href="#3-特定のフォルダーのファイルでマクロを有効にする方法" class="headerlink" title="3) 特定のフォルダーのファイルでマクロを有効にする方法"></a>3) 特定のフォルダーのファイルでマクロを有効にする方法</h2><p>各アプリケーションの以下オプション設定で確認 &#x2F; 追加可能な “信頼できる場所” に登録されているパスにマクロ付きファイルを保存をすることにより、マクロが実行可能となります。</p><h4 id="lt-オプション-設定-gt"><a href="#lt-オプション-設定-gt" class="headerlink" title="&lt;オプション 設定&gt;"></a>&lt;オプション 設定&gt;</h4><p>[ファイル] タブ - [オプション] - [トラスト センター] - [トラスト センターの設定] -  [信頼できる場所]<br>注) 既定で登録された場所は特殊なフォルダですので、マクロを実行したいファイルを保存するためのフォルダは [新しい場所の追加] から任意の場所を追加することをお勧めします。</p><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/trusted-location.png"></p><p>注) Access &#x2F; Excel &#x2F; PowerPoint &#x2F; Visio &#x2F; Word の各アプリケーションでそれぞれ異なる設定となります。</p><p>なお、本設定は以下グループ ポリシーでも追加 &#x2F; 削除が可能です。</p><h4 id="lt-グループポリシー設定-信頼できる場所-gt"><a href="#lt-グループポリシー設定-信頼できる場所-gt" class="headerlink" title="&lt;グループポリシー設定 - 信頼できる場所&gt;"></a>&lt;グループポリシー設定 - 信頼できる場所&gt;</h4><ul><li>Access<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Access 2016] - [アプリケーション設定] - [セキュリティ]<br>&amp;nbsp;- [セキュリティ センター] - [信頼できる場所]<br>&amp;nbsp;&amp;nbsp;- [信頼できる場所 #1 - #20] : 有効 且つ [パス] に C:\temp などのフォルダーパスを登録します。</li><li>Visio<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Visio 2016] - [Visio のオプション] -[セキュリティ]<br>&amp;nbsp;- [セキュリティ センター]<br>&amp;nbsp;&amp;nbsp;- [信頼できる場所 #1 - #20] : 有効 且つ [パス] に C:\temp などのフォルダーパスを登録します。  </li><li>Excel &#x2F; PowerPoint &#x2F; Word<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft xxx 2016] - [xxx のオプション] -[セキュリティ]<br>&amp;nbsp;- [セキュリティ センター] - [信頼できる場所]<br>&amp;nbsp;&amp;nbsp;- [信頼できる場所 #1 - #20] : 有効 且つ [パス] に C:\temp などのフォルダーパスを登録します。<br>注) xxx は それぞれ Excel &#x2F; PowerPoint &#x2F; Word です。</li></ul><p>また、[信頼できる場所] 下部に表示されている [自分のネットワーク上にある信頼できる場所を許可する (推奨しません)] に対応するグループ ポリシーは以下となります。共有フォルダーなどネットワーク上のパスを指定する場合はこちらをご利用ください。</p><h4 id="lt-グループポリシー設定-自分のネットワーク上にある信頼できる場所を許可する-gt"><a href="#lt-グループポリシー設定-自分のネットワーク上にある信頼できる場所を許可する-gt" class="headerlink" title="&lt;グループポリシー設定 - 自分のネットワーク上にある信頼できる場所を許可する&gt;"></a>&lt;グループポリシー設定 - 自分のネットワーク上にある信頼できる場所を許可する&gt;</h4><ul><li>Access<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Access 2016] - [アプリケーション設定] - [セキュリティ]<br>&amp;nbsp;- [セキュリティ センター] - [信頼できる場所] - [ネットワーク上の信頼できる場所を許可する]</li><li>Visio<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft Visio 2016] - [Visio のオプション] - [セキュリティ]<br>&amp;nbsp;- [セキュリティ センター] - [ネットワーク上の信頼できる場所を許可する]</li><li>Excel &#x2F; PowerPoint &#x2F; Word<br>[ユーザーの構成] - [ポリシー] - [管理用テンプレート]<br>- [Microsoft xxx 2016] - [xxx のオプション] - [セキュリティ]<br>&amp;nbsp;- [セキュリティ センター] - [信頼できる場所] - [ネットワーク上の信頼できる場所を許可する]<br>注) xxx は それぞれ Excel &#x2F; PowerPoint &#x2F; Word です。</li></ul><br><h2 id="4-Web-・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法"><a href="#4-Web-・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法" class="headerlink" title="4) Web ・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法"></a>4) Web ・ネットワーク共有上のファイルを開くシナリオで、信頼済みサイトに登録する方法</h2><p>自社 Web サイトや社内ファイル サーバーなど、安全が保証されている場所の Office ファイルを開く場合は、Web サイトまたはサーバーを信頼済みサイトに登録すると、インターネット入手ファイルとみなされずマクロを有効にできます。</p><h4 id="lt-信頼済みサイト登録手順-gt"><a href="#lt-信頼済みサイト登録手順-gt" class="headerlink" title="&lt;信頼済みサイト登録手順&gt;"></a>&lt;信頼済みサイト登録手順&gt;</h4><ol><li>タスクバーにある検索ボックスに “インターネット オプション” と入力します。</li><li>表示された [インターネット オプション] をクリックし、[インターネットのプロパティ] を開きます。</li><li>[セキュリティ] タブ - [信頼済みサイト] を選択し [サイト] をクリックします。</li><li>マクロの実行を許可する Office ファイルが格納されたサイト・サーバーの URL を入力して [追加] をクリックします。<br>&lt;登録内容&gt;<br>Web サイト : URL (例: <a href="https://www.microsoft.com/">https://www.microsoft.com</a>)<br>ネットワーク共有 : 接続時に指定している相手先サーバーの FQDN (例: \\server.domain.com) または IP アドレス (例: 111.111.111.111)<br>※ http:&#x2F;&#x2F; で始まる URL や、ネットワーク共有を追加する場合は、下部の [このゾーンのサイトにはすべてサーバーの確認 (https:) を必要とする] のチェックを外します。</li><li>[閉じる] をクリックし、[信頼済みサイト] 画面を閉じます。</li><li>[インターネットのプロパティ] 画面で [OK] をクリックして画面を閉じます。</li></ol><p><img src="/blog/cl0m4f5o1003504vsa5tp25c2/trusted-sites.png"></p><p>補足)<br>Internet Explorer の場合は、Web サイトの応答ヘッダーが Content-Disposition: Attachment のときはインターネット一時フォルダにファイルがダウンロードされます。このフォルダに格納されたファイルは、Office ではすべてインターネット入手ファイルとみなすため、信頼済みサイトに登録してもマクロはブロックされます。</p><p>Edge ブラウザーの場合は、一時フォルダにダウンロードされたファイルも、サイトのゾーン設定に従って Web マークが付与され、それによってマクロのブロック有無が決定されるため信頼済みサイトへの登録でマクロを有効にできるようになります。</p><h2 id="ご参考"><a href="#ご参考" class="headerlink" title="ご参考"></a>ご参考</h2><p>Office グループポリシー管理用テンプレートの導入手順について、以下に詳細が記載されていますので、こちらをご確認ください。</p><p>タイトル : Office の管理用テンプレートを使用してグループ ポリシー (GPO) で Office 365 ProPlus を制御する<br>アドレス  : <a href="https://answers.microsoft.com/ja-jp/msoffice/forum/all/office/3ec9d79c-44ec-4273-97e2-2a6f3a1fd8ef">https://answers.microsoft.com/ja-jp/msoffice/forum/all/office/3ec9d79c-44ec-4273-97e2-2a6f3a1fd8ef</a>  </p><p>また、上記以外に Microsoft 365 管理センターより設定可能な Office にサインインしているユーザーに適用するクラウド ポリシーや Microsoft Intune を利用したグループ ポリシーを構成する方法も存在します。ご利用の Office バージョンや環境に応じてこれらもご利用ください。以下に公開情報を記載します。</p><p>タイトル : Microsoft 365 Apps for enterprise 向け Office クラウド ポリシー サービスの概要<br>アドレス  : <a href="https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-cloud-policy-service">https://docs.microsoft.com/ja-jp/deployoffice/admincenter/overview-office-cloud-policy-service</a> (日本語版 - 機械翻訳)<br>アドレス  : <a href="https://docs.microsoft.com/en-us/deployoffice/admincenter/overview-office-cloud-policy-service">https://docs.microsoft.com/en-us/deployoffice/admincenter/overview-office-cloud-policy-service</a> (英語版)  </p><p>タイトル : Windows 10&#x2F;11 テンプレートを使用して、Microsoft Intune でグループ ポリシー設定を構成する<br>アドレス  : <a href="https://docs.microsoft.com/ja-jp/mem/intune/configuration/administrative-templates-windows">https://docs.microsoft.com/ja-jp/mem/intune/configuration/administrative-templates-windows</a> (日本語版 - 機械翻訳)<br>アドレス  : <a href="https://docs.microsoft.com/en-us/mem/intune/configuration/administrative-templates-windows">https://docs.microsoft.com/en-us/mem/intune/configuration/administrative-templates-windows</a> (英語版)    </p><br><p>今回の投稿は以上です。</p><br><p><strong>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2022&amp;#x2F;03&amp;#x2F;18 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color:#339966&quot;&gt;- “【インターネット入手ファイルとみなされるシナリ</summary>
      
    
    
    
    
    <category term="VBA マクロ" scheme="https://officesupportjp.github.io/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/"/>
    
  </entry>
  
  <entry>
    <title>Office ファイルの SPO &amp; OneDrive 移行におけるマクロ (VBA) 影響</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4rqa2001y50vshhi75we2/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4rqa2001y50vshhi75we2/</id>
    <published>2022-02-17T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.565Z</updated>
    
    <content type="html"><![CDATA[<br><hr><p><strong>2022&#x2F;3&#x2F;18 Update</strong><br>2. &#x2F; 3. にそれぞれ、他のファイル内の VBA を参照している場合の影響と回避策を追加しました。</p><hr><br><p>こんにちは、Office サポート チームの中村です。</p><p>Office ファイルの保存場所として、ファイル サーバーの共有フォルダから、SharePoint Online のドキュメント ライブラリや 個人用 OneDrive &#x2F; OneDrive for Business への移行を検討する企業も増えてきたかと思います。Office ファイルでは業務効率化のためマクロ (VBA) を利用されていることが多く、弊社サポートにも、マクロ ファイル自身やマクロ内で操作するファイルの保存場所がクラウドになることの影響を確認したい、というお問い合わせを時折頂きます。</p><p>今後、さらにクラウド活用が進むと想定されるため、今回の記事で、このようなシナリオで一般的に生じる影響と対応方法、考慮すべき点についてまとめたいと思います。<br><br></p><h2 id="1-クラウド移行で変化すること"><a href="#1-クラウド移行で変化すること" class="headerlink" title="1. クラウド移行で変化すること"></a><strong>1. クラウド移行で変化すること</strong></h2><p>ファイルの格納場所を変更したとき、マクロに影響を与える要素は主に以下の 2 点です。</p><p>・フォルダやファイルのパスが UNC 共有パス形式 (\\Server\folder) から URL 形式 (http:&#x2F;&#x2F;tenantname.sharepoint.com&#x2F;xxxx など) に変わる<br>・SharePoint や OneDrive によってアクセス権が管理される<br><br></p><h2 id="2-ファイル-パス変更の影響"><a href="#2-ファイル-パス変更の影響" class="headerlink" title="2. ファイル パス変更の影響"></a><strong>2. ファイル パス変更の影響</strong></h2><p>マクロからファイルやフォルダを操作するときに使用する関数によっては、URL 形式に対応していません。このような関数を利用している場合は、マクロ処理の見直しが必要です。以下に、マクロで主に使用されるファイル操作関数の URL 形式対応状況を記載します。<br><br></p><h3 id="Excel-x2F-Word-x2F-PowerPoint-のライブラリ"><a href="#Excel-x2F-Word-x2F-PowerPoint-のライブラリ" class="headerlink" title="Excel &#x2F; Word &#x2F; PowerPoint のライブラリ"></a><strong>Excel &#x2F; Word &#x2F; PowerPoint のライブラリ</strong></h3><p>これらのアプリ用のライブラリ Microsoft xxx 16.0 Object Library (xxx は各種アプリ名) で提供されるファイル操作メソッドやプロパティは、Web 上のファイルを直接読み書きすることを想定しているため、基本的に URL 形式を扱うことができます。これらのメソッド・プロパティを利用している場合は、特に対応の必要はありません。<br>例) Excel の Workbooks.Open や Workbook.Path<br>※ Access ファイルは Web から直接開くことができず、ダウンロードしてから開くため URL 形式を扱うことは想定されません。<br><br></p><p><strong>補足情報</strong><br>エクスプローラーで、OneDrive や SharePoint ライブラリの同期フォルダからファイルを開く場合、以前の Office バージョンでは、ThisWorkbook.Path などで開いたファイルのパスを取得すると、同期フォルダのローカル パスが返されました。<br>Microsoft 365 の最新チャネル バージョン 1903 および半期チャネル バージョン 2008 以降は、この操作シナリオでも、サーバー側の URL パスが返るようになりました。<br>古い Office バージョンを利用する場合は、取得されるパスが異なることに注意してください。<br><br></p><h3 id="VBA-関数"><a href="#VBA-関数" class="headerlink" title="VBA 関数"></a><strong>VBA 関数</strong></h3><p>Dir や Open といった VBA 関数は、URL 形式に対応していません。以下に、ファイル操作に関わる主な VBA 関数がまとめられていますが、ここに記載されている関数を利用している場合、他の仕組みへの変更を検討してください。</p><p>Directories and files keyword summary<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/directories-and-files-keyword-summary">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/directories-and-files-keyword-summary</a><br>Input and output keyword summary<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/input-and-output-keyword-summary">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/input-and-output-keyword-summary</a><br><br></p><h3 id="FileSystemObject-ライブラリ"><a href="#FileSystemObject-ライブラリ" class="headerlink" title="FileSystemObject ライブラリ"></a><strong>FileSystemObject ライブラリ</strong></h3><p>Scripting.FileSystemObject ライブラリで提供される各種メソッドは、URL 形式に対応していません。以下の公開情報で Scripting.FileSystemObject ライブラリで提供されるファイル・フォルダ操作メソッドがまとめられています。これらを利用している場合は、他の仕組みへの変更を検討してください。</p><p>FileSystemObject object<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/filesystemobject-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/filesystemobject-object</a><br>File object<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/file-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/file-object</a><br>Folder object<br><a href="https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/folder-object">https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/folder-object</a><br><br></p><h3 id="補足-1-その他、独自にパスを解析・組み立てる処理"><a href="#補足-1-その他、独自にパスを解析・組み立てる処理" class="headerlink" title="補足 1) その他、独自にパスを解析・組み立てる処理"></a><strong>補足 1) その他、独自にパスを解析・組み立てる処理</strong></h3><p>マクロの独自処理として、例えばマクロ ファイル自身の格納フォルダ パスの一部を加工して処理結果ファイルの出力パスを組み立てるなど、パスのテキストを意識した処理がある場合は注意が必要です。URL 形式への変更に伴い、既存の文字列操作処理では、期待する結果が得られない場合があります。<br><br></p><h3 id="補足-2-他のファイルへの参照"><a href="#補足-2-他のファイルへの参照" class="headerlink" title="補足 2) 他のファイルへの参照"></a><strong>補足 2) 他のファイルへの参照</strong></h3><p>先述したような一般的なライブラリは、クライアント マシンに登録されたものを呼び出すため、ファイルの保存場所が変わっても影響を受けません。<br>しかし、他の Excel ブックを [参照設定] で参照して、そのブック内の独自に作成した VBA プロシージャを呼び出している場合、参照先のファイルをクラウドに移行すると、参照不可となります。(VBA の参照設定は URL 形式に対応していないため、参照設定を再設定してもクラウド上のファイルは参照できません。)</p><p>参照設定の他にも、マクロ処理内でパスを指定して他のファイルを開いている場合は、パスの指定方法がファイルの移動後も有効な実装となっているか十分に確認してください。<br><br></p><h2 id="3-影響を受ける場合の対処方法"><a href="#3-影響を受ける場合の対処方法" class="headerlink" title="3. 影響を受ける場合の対処方法"></a><strong>3. 影響を受ける場合の対処方法</strong></h2><p>一般的には、以下のような対処方法が検討できます。実際の処理内容や環境構成、対応にかけられる工数などを考慮して対処方法をご検討ください。<br><br></p><h3 id="a-Office-ライブラリを用いて操作する"><a href="#a-Office-ライブラリを用いて操作する" class="headerlink" title="a. Office ライブラリを用いて操作する"></a><strong>a. Office ライブラリを用いて操作する</strong></h3><p>先述の通り、Microsoft xxx 16.0 Object Library で提供されるメソッド・プロパティは基本的に URL 形式を扱うことができます。そして、Word や Excel は、テキスト ファイルを扱うこともできます。現在 VBA 関数や FileSystemObject でテキスト ファイルを操作している場合には、これを Word や Excel アプリで Microsoft xxx 16.0 Object Library を用いて扱うよう変更することが検討できます。<br><br></p><h3 id="b-不要なファイル・フォルダ操作を止める"><a href="#b-不要なファイル・フォルダ操作を止める" class="headerlink" title="b. 不要なファイル・フォルダ操作を止める"></a><strong>b. 不要なファイル・フォルダ操作を止める</strong></h3><p>例えば、次回利用時に引き継ぎたい内容を動的に保持する設定ファイルを別ファイルとして用意し、これを読み書きするために対応していない関数を使っている、というシナリオを考えます。このような場合、これをマクロ ファイル自身のどこかに保持する (Excel の非表示シート、Word の隠し文字、ファイルのユーザー設定プロパティ等) ことで、他のファイルへの読み書きを行わないようにする、といった対応もマクロの内容次第では検討できます。<br><br></p><h3 id="c-Graph-API-に変更する-ファイル操作と-Excel-操作が対応"><a href="#c-Graph-API-に変更する-ファイル操作と-Excel-操作が対応" class="headerlink" title="c. Graph API に変更する (ファイル操作と Excel 操作が対応)"></a><strong>c. Graph API に変更する (ファイル操作と Excel 操作が対応)</strong></h3><p>SharePoint Online や OneDrive に対し、HTTP リクエスト ベースで操作する API として Graph API が提供されています。現在、SharePoint ライブラリや OneDrive のフォルダ・ファイル自体の操作 (作成やコピー、削除など) と、Excel ファイルの操作用 API が利用できます。ただし、プログラムの実装イメージがマクロと大きく異なりますので、Graph API 自体の利用に習熟している開発者向けの代替案です。  </p><p>Microsoft Graph API を使用する<br><a href="https://docs.microsoft.com/ja-jp/graph/use-the-api">https://docs.microsoft.com/ja-jp/graph/use-the-api</a><br>Microsoft Graph REST API v1.0 リファレンス<br><a href="https://docs.microsoft.com/ja-jp/graph/api/overview">https://docs.microsoft.com/ja-jp/graph/api/overview</a>  </p><p>現時点では、マクロで可能な全ての操作が Graph API からも行えるものではありませんが、簡単な操作は可能です。ただし、一般的に、マクロから呼び出すことには適していません。一般的には、独立したアプリケーションを作成して HTTP リクエストを発行し、Web 上のファイルを操作します。また、Microsoft 365 サービスへの認証も考慮する必要があります。  </p><p><strong>参考資料</strong><br>(WebAPI)OAuth Bearer Token (Access Token) の取得方法について<br><a href="https://officesupportjp.github.io/blog/cl0m8t2ac00023gvs6bwo9tp2/">https://officesupportjp.github.io/blog/cl0m8t2ac00023gvs6bwo9tp2/</a><br>(WebAPI)Microsoft Graph を使用した開発に便利なツール群<br><a href="https://officesupportjp.github.io/blog/cl0m8t2ae00033gvsbtlo3btc/">https://officesupportjp.github.io/blog/cl0m8t2ae00033gvsbtlo3btc/</a><br>(WebAPI)Microsoft Graph - OneDrive API (C Sharp) を使ったサンプル コード<br><a href="https://officesupportjp.github.io/blog/cl0m8t2aa00013gvsa2mr8xj5/">https://officesupportjp.github.io/blog/cl0m8t2aa00013gvsa2mr8xj5/</a><br>(WebAPI)Microsoft Graph – Excel REST API (C Sharp) を使い Range を操作するサンプル コード<br><a href="https://officesupportjp.github.io/blog/cl0m8t2a400003gvsgcr96w6h/">https://officesupportjp.github.io/blog/cl0m8t2a400003gvsgcr96w6h/</a><br><br></p><h3 id="d-OneDrive-や-SharePoint-ライブラリの同期フォルダを操作する"><a href="#d-OneDrive-や-SharePoint-ライブラリの同期フォルダを操作する" class="headerlink" title="d. OneDrive や SharePoint ライブラリの同期フォルダを操作する"></a><strong>d. OneDrive や SharePoint ライブラリの同期フォルダを操作する</strong></h3><p>OneDrive 同期クライアントで、ファイル格納フォルダをクライアント コンピューターと同期すると、ローカルの同期フォルダにファイルがコピーされます。この同期フォルダに対してマクロから操作を行うと、通常のローカル パスとして扱うことができます。(なお、先述の通り、ThisWorkbook.Path の結果は最新の Microsoft 365 では URL 形式になり、同期フォルダのローカル パスではない点にご注意ください。)  </p><p>Windows の OneDrive とファイルを同期する<br><a href="https://support.microsoft.com/ja-jp/office/615391c4-2bd3-4aae-a42a-858262e42a49">https://support.microsoft.com/ja-jp/office/615391c4-2bd3-4aae-a42a-858262e42a49</a>  </p><p>ただし、マクロから編集した内容がサーバー上へ同期されることは、マクロの動作としては保証されません。マクロからは、ローカルの同期フォルダへの操作が成功することをもって成功と判断されます。ネットワークの問題で同期に失敗したり、クラウド上のファイルに他のユーザーから競合する変更が行われて同期エラーが生じるなど、クラウド上にマクロの実行結果が期待通り反映されない可能性についての考慮が必要です。<br><br></p><h4 id="補足-WebDAV-パスでのアクセス"><a href="#補足-WebDAV-パスでのアクセス" class="headerlink" title="補足: WebDAV パスでのアクセス"></a><strong>補足: WebDAV パスでのアクセス</strong></h4><p>SharePoint ライブラリを Internet Explorer で開くと、[エクスプローラ―で開く] というメニューが使用でき、”\\SharePoint サイト\DavWWWRoot\Folder” のような UNC パスで、ライブラリが開かれていました。これは、WebDAV と呼ばれる Web フォルダを読み書き可能とする技術を用いて​実現されています。<br>以前は、このパスを用いてマクロからアクセスすることも検討できる方法の 1 つでした。<br>しかしながら、この仕組みはレガシな技術を用いており、Edge ブラウザでは対応していません。<br>また、WebDAV でのアクセスには別のサービス (WebClient サービス) が利用されるため、マクロが実行されている Office アプリの認証情報は引き継がれません。<br>WebClient サービス用の認証情報の保存にはまもなくサポートを終了する Internet Explorer を利用する必要があることなどからも、新たに WebDAV パスでの利用を検討することは推奨しません。<br><br></p><h3 id="e-参照設定を-Application-Run-に変更する"><a href="#e-参照設定を-Application-Run-に変更する" class="headerlink" title="e. 参照設定を Application.Run に変更する"></a><strong>e. 参照設定を Application.Run に変更する</strong></h3><p>参照設定で他のファイルの VBA プロシージャを呼び出している場合、参照設定を止め、以下のようにファイルを開いた上で Application.Run で実行することが検討できます。</p><p>例:<br>Ref.xlsm に SampleProc() が含まれているとします。   </p><p>&lt;変更前&gt;<br>[参照設定] から Ref.xlsm を参照し、VBA コードから SampleProc をそのまま呼び出し  </p><p>&lt;変更後&gt;<br>参照設定は解除し、以下のように呼び出し  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Workbooks.Open &quot;https://xxxx/Ref.xlsm&quot;</span><br><span class="line">Application.Run &quot;Ref.xlsm!SampleProc&quot;</span><br></pre></td></tr></table></figure><br><h2 id="4-Microsoft-365-サービスへの認証とアクセス権"><a href="#4-Microsoft-365-サービスへの認証とアクセス権" class="headerlink" title="4. Microsoft 365 サービスへの認証とアクセス権"></a><strong>4. Microsoft 365 サービスへの認証とアクセス権</strong></h2><p>対応方法のうち、引き続きマクロから Microsoft 365 サービス上のファイルへのアクセスを行う “a. Office ライブラリを用いて操作する” の場合、マクロが実行されている Office アプリケーションにサインインしているユーザーとして認証が行われます。このため、マクロ実行時の Office サインイン ユーザーに、マクロで操作するファイルへのアクセス権を付与する必要があります。<br><br></p><h2 id="5-サポートされる-Office-クライアント-アプリケーション"><a href="#5-サポートされる-Office-クライアント-アプリケーション" class="headerlink" title="5. サポートされる Office クライアント アプリケーション"></a><strong>5. サポートされる Office クライアント アプリケーション</strong></h2><p>マクロからの操作においても、Microsoft 365 サービスとの接続がサポートされる Office クライアント アプリケーションがサポート対象です。サポートされる製品は、以下の公開情報でご確認ください。</p><p>Office versions and connectivity to Microsoft 365 services<br><a href="https://docs.microsoft.com/en-us/deployoffice/endofsupport/microsoft-365-services-connectivity">https://docs.microsoft.com/en-us/deployoffice/endofsupport/microsoft-365-services-connectivity</a></p><p>今回の投稿は以上です。<br><br></p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;br&gt;

&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;2022&amp;#x2F;3&amp;#x2F;18 Update&lt;/strong&gt;&lt;br&gt;2. &amp;#x2F; 3. にそれぞれ、他のファイル内の VBA を参照している場合の影響と回避策を追加しました。&lt;/p&gt;
&lt;hr&gt;
&lt;br&gt;

&lt;p&gt;こんにち</summary>
      
    
    
    
    
    <category term="オートメーション" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AA%E3%83%BC%E3%83%88%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/"/>
    
    <category term="クラウド ストレージ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>お知らせ - Japan Office Client Support Blog について</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkl00039eovs4fp4ffbt/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkl00039eovs4fp4ffbt/</id>
    <published>2022-01-31T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.612Z</updated>
    
    <content type="html"><![CDATA[<p>いつも Microsoft Office をご愛顧いただき誠にありがとうございます。<br>「Japan Office Client Support Blog」の運用についてお知らせします。</p><p>「Japan Office Client Support Blog」は、Office サポートチームより、よくお問い合わせをいただく情報をサポートトピックとして、皆様よりご要望が多い情報を配信します。</p><p>また、「Office サポートチーム」フォーラムにて公開しておりました記事について、本ブログでの公開を進めております。</p><p>なお、本ブログは情報発信専用のフォーラムとなります。</p><p>Office サポートチーム</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;いつも Microsoft Office をご愛顧いただき誠にありがとうございます。&lt;br&gt;「Japan Office Client Support Blog」の運用についてお知らせします。&lt;/p&gt;
&lt;p&gt;「Japan Office Client Support Blog」</summary>
      
    
    
    
    
    <category term="お知らせ" scheme="https://officesupportjp.github.io/blog/tags/%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/"/>
    
  </entry>
  
  <entry>
    <title>Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkk8002oeovs8ggucayv/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkk8002oeovs8ggucayv/</id>
    <published>2021-06-21T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.596Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。  </p><p>今回の投稿では、Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて説明します。</p><p>以下、問題の切り分けに有用な情報を以下にご案内いたします。</p><p>これらの手順を上から順にご実施ください。</p><br><p><strong>&lt;実施方法&gt;</strong></p><p><strong>1) Office への再サインイン</strong></p><p>-——————————-</p><p>1. Office からサインアウトし、Office を全て終了します。</p><p>2. OS のスタートメニュー - 歯車 - “アカウント” - “職場または学校にアクセスする” をクリックし、”職場または学校アカウント” として表示されている項目がある場合、”切断” をクリックします</p><p>※ Azure AD や AD に接続済みの項目を “切断” しますと、ドメインから外れてしまいますので、Azure AD や AD に接続済み の項目は切断しないようにご注意ください。</p><p>3. OS からログオフします。(可能であれば、再起動してください)</p><p>4. Office を起動してサインインし、事象が解消するかをお試しください。</p><br><p><strong>2) Office のファイルキャッシュクリア</strong></p><p>-————————————————–</p><p>1. Excel 等を開きます。</p><p>2. [ファイル] タブ - “オプション” を開きます。</p><p>3. “保存” より、”キャッシュ” の設定 - [ファイルを閉じたときに Office ドキュメント キャッシュから削除する] オプションでチェックを入れ有効に設定し、[キャッシュ ファイルの削除] を実施します。</p><br><p>Office 2016 等をご利用されている場合、上記項目が見つからない可能性があります。その場合、代わりに以下の手順をご実施ください。</p><br><p>1. Office を全て終了します。</p><p>2. [スタート]-[すべてのプログラム]-[Microsoft Officeツール]-[Office アップロードセンター] をクリックし、[設定] を押下後、[キャッシュ ファイルの削除] を実施してください。</p><p>3. [ファイルを閉じたときに Office ドキュメント キャッシュから削除する] オプションでチェックを入れ有効に設定します。</p><p>4. [OK] ボタンをクリックし、Microsoft Office アップロード センターの設定 ダイアログを閉じます。  </p><br><p><strong>3) Office のファイルキャッシュの完全クリア</strong></p><p>-————————————————–</p><p>1. Ctrl + Shift + Esc キーを押してタスク マネージャーを起動します。</p><p>2. [プロセス] タブで [MSOSYNC.EXE] が存在する場合、クリックし、[プロセスの終了] をクリックしてから、タスク マネージャーを終了します。</p><p>3. %userprofile%\AppData\Local\Microsoft\Office\16.0\ に移動します。</p><p>※ Office 2013 の場合は 15.0 となります。</p><p>4. OfficeFileCache フォルダー配下のファイルを削除できるもののみ、削除して下さい。</p><p>5. スタートメニューを右クリックして [ファイル名を指定して実行] から regedit と入力し、レジストリ エディタを起動します。</p><p>6. 以下のキーを展開します。</p><p>HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Common\Internet\Server Cache</p><p>7. Server Cache キーを選択し、削除します。</p><p>8. OS を再起動します。  </p><br><p><strong>4) Office のサインインキャッシュのクリア</strong></p><p>-————————————————–</p><p>以下の記事の手順により、サインインキャッシュのクリアをご実施ください。</p><p>Title : Office のサインインのトラブルシュートについて<br>URL : <a href="https://officesupportjp.github.io/blog/Office%20%E3%81%AE%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%81%AE%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/">https://officesupportjp.github.io/blog/Office のサインインのトラブルシュートについて</a></p><br><p><strong>- 関連情報</strong></p><p>Title : MSI 版の Office 2016 で SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象について</p><p>URL : <a href="https://officesupportjp.github.io/blog/MSI%20%E7%89%88%E3%81%AE%20Office%202016%20%E3%81%A7%20SPO%E3%80%81OneDrive%E3%80%81WebDav%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%8B%E3%82%89%20Office%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E9%96%8B%E3%81%8B%E3%81%AA%E3%81%84%E3%80%81%E4%BF%9D%E5%AD%98%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E7%8F%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/">https://officesupportjp.github.io/blog/MSI 版の Office 2016 で SPO、OneDrive、WebDav サーバーから Office ファイルが開かない、保存できない現象について</a></p><br><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。  &lt;/p&gt;
&lt;p&gt;今回の投稿では、Teams、SPO、OneDrive、WebDavサーバーから Office ファイルが開かない、保存できない現象のトラブルシューティングについて説明します。&lt;/p&gt;
&lt;p&gt;以下、問</summary>
      
    
    
    
    
    <category term="ファイル I/O" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/"/>
    
    <category term="クラウド ストレージ" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89-%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>Office 製品のサインインで先進認証が有効化、無効化されているかを確認する方法について</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkk1002beovs87lwadzx/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkk1002beovs87lwadzx/</id>
    <published>2021-06-17T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.580Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。  </p><p>Office 製品のサインインで先進認証が有効化、無効化されているかを確認したいとお問い合わせいただくことがございます。</p><p>本投稿では、先進認証の有効化、無効化を確認する方法についてご案内いたします。</p><p><strong>【確認方法について】</strong></p><p>Office のサインイン画面を表示することで確認することが可能です。</p><p><strong>- 先進認証が有効の場合 (以下の何れかが表示されます)</strong></p><p><img src="/blog/cl0m4xkk1002beovs87lwadzx/image1.png"><br><img src="/blog/cl0m4xkk1002beovs87lwadzx/image2.png"></p><p><strong>- 先進認証が無効の場合</strong></p><p><img src="/blog/cl0m4xkk1002beovs87lwadzx/image3.png"></p><p><strong>【先進認証を有効化、無効化する方法について】</strong></p><p><strong>- Office 2013 製品の場合</strong></p><p>Office 2013 製品では、既定で先進認証が無効です。</p><p>以下のレジストリキーを設定することで、先進認証を有効にしていただけます。</p><p>キー: HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\15.0\Common\Identity<br>名前: EnableADAL<br>種類: REG_DWORD<br>データ: 1</p><p>名前: Version<br>種類: REG_DWORD<br>データ: 1</p><p>※ Office 2013 では、Microsoft Update により更新プログラムを最新に適用していただかないと、上記のレジストリを設定しても先進認証が有効にならない場合がございます。</p><p>※ 本レジストリキーは HKEY_CURRENT_USER 配下のため、レジストリエディターで値を編集される場合、別の管理者ユーザーなどでレジストリエディターを起動しないでください。</p><p><strong>- Office 2016、2019、Microsoft 365 Apps (Office 365 ProPlus) 製品の場合</strong></p><p>Office 2016 以降となるこれらの製品では、既定で先進認証が有効です。</p><p>Microsoft 365 Apps 製品では将来的に廃止される可能性はございますが、以下のレジストリの設定により、先進認証を無効化していただけます。</p><p>キー: HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Common\Identity<br>名前: EnableADAL<br>種類: REG_DWORD<br>データ: 0</p><p>※ 本レジストリキーは HKEY_CURRENT_USER 配下のため、レジストリエディターで値を編集される場合、別の管理者ユーザーなどでレジストリエディターを起動しないでください。</p><p><strong>【参考資料】</strong></p><p>EnableADAL の説明や各製品の詳細につきましては、以下の資料をご参考にいただきますようお願いいたします。</p><p>Title : 2013、Office 2016、および 2019 Office 2019 クライアント アプリOfficeのしくみ</p><p>URL : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/modern-auth-for-office-2013-and-2016?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/modern-auth-for-office-2013-and-2016?view=o365-worldwide</a></p><p>Title : Windows デバイスの Office 2013 の先進認証を有効にする<a href="https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/modern-auth-for-office-2013-and-2016?view=o365-worldwide"></a><br>URL : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/security-and-compliance/enable-modern-authentication?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/admin/security-and-compliance/enable-modern-authentication?view=o365-worldwide</a></p><p><strong>- 関連記事</strong>  </p><p>Title : Office のサインインでネットワーク接続がない旨のメッセージが表示される事象について<br>URL : <a href="https://officesupportjp.github.io/blog/Office%20%E3%81%AE%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%81%A7%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A5%E7%B6%9A%E3%81%8C%E3%81%AA%E3%81%84%E6%97%A8%E3%81%AE%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E4%BA%8B%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/">https://officesupportjp.github.io/blog/Office のサインインでネットワーク接続がない旨のメッセージが表示される事象について</a></p><p>今回の投稿は以上です。</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。  &lt;/p&gt;
&lt;p&gt;Office 製品のサインインで先進認証が有効化、無効化されているかを確認したいとお問い合わせいただくことがございます。&lt;/p&gt;
&lt;p&gt;本投稿では、先進認証の有効化、無効化を確認する方法についてご案</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>「このコンピューターに組織内の別のアカウントが既にサインインしています」と表示される</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkkf002zeovs7htveccc/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkkf002zeovs7htveccc/</id>
    <published>2021-04-13T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.612Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。  </p><p>Office 製品のサインイン時に以下のようなエラーが表示されるとお問い合わせいただくことがございます。  </p><p><img src="/blog/cl0m4xkkf002zeovs7htveccc/image1.png"></p><p><strong>【事象について】</strong></p><p>以下の公開情報のとおり、組織内の別のアカウントが既に Office にサインインしているために発生してます。  </p><p>Title : “申し訳ございません。組織の別のアカウントが、このコンピューターで既にサインインしています” という Office 2013 があります。<br>URL : <a href="https://docs.microsoft.com/ja-jp/office/troubleshoot/office-suite-issues/another-account-already-signed-in">https://docs.microsoft.com/ja-jp/office/troubleshoot/office-suite-issues/another-account-already-signed-in</a><br>※ Office 2013 と記載されておりますが、Microsoft 365 Apps for Enterprise も対象となります。</p><p><strong>【解消方法について】</strong></p><p>以下の手順で事象が解消されるかをご確認いただきますようお願いいたします。  </p><p>- 手順<br>1. Office にサインインしているユーザーをすべてサインアウトし、Office を終了してください。<br>2. OS のスタートメニュー - 歯車 - “アカウント” - “職場または学校にアクセスする” をクリックし、”職場または学校アカウント” として表示されている項目がある場合、”切断” をクリックします<br>※ Azure AD や AD に接続済みの項目を “切断” しますと、ドメインから外れてしまいますので、Azure AD や AD に接続済み の項目は切断しないようにご注意ください。</p><p><img src="/blog/cl0m4xkkf002zeovs7htveccc/image2.png"></p><p>3. Office を起動し、サインインをご実施ください</p><p>なお、”職場または学校にアクセスする” のアカウントは、Office のサインイン時に “すべてのアプリにサインインしたままにする” の旨のダイアログで、”このアプリのみ” を選択せず、そのまま OK をクリックした場合に追加されます。</p><p><img src="/blog/cl0m4xkkf002zeovs7htveccc/image3.png"></p><p>※ このダイアログの文言は OS のバージョンによって変わる場合がございます。</p><p>“職場または学校にアクセスする” にアカウントが追加されると、Office のサインインや Office 365 ポータルへのアクセス等でパスワードが求められなくなる等の利点がございますが、<br>共用の端末の場合等でこのアカウントの追加が必要ございません場合、今後、以下の対応をご検討いただけますと幸いです。  </p><p>方法 1) “すべてのアプリにサインインしたままにする” の旨のダイアログで、”このアプリのみ” を選択する<br>方法 2) 以下の BlockAADWorkplaceJoin レジストリを設定し、”すべてのアプリにサインインしたままにする” の旨のダイアログを表示させないようにする。  </p><p>Title : Azure Active Directory デバイス管理の FAQ<br>URL : <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/faq">https://docs.microsoft.com/ja-jp/azure/active-directory/devices/faq</a><br>-—- 抜粋開始 —–<br>HKLM\SOFTWARE\Policies\Microsoft\Windows\WorkplaceJoin, “BlockAADWorkplaceJoin”&#x3D;dword:00000001<br>-—- 抜粋終了 —–</p><p>今回の投稿は以上です。  </p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。  &lt;/p&gt;
&lt;p&gt;Office 製品のサインイン時に以下のようなエラーが表示されるとお問い合わせいただくことがございます。  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/cl0m4xkkf002zeovs7htv</summary>
      
    
    
    
    
    <category term="サインイン、認証" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%80%81%E8%AA%8D%E8%A8%BC/"/>
    
  </entry>
  
  <entry>
    <title>Office ファイルを開こうとすると、実際に開いているユーザーとは異なるユーザーが使用中と表示される</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkju001zeovsftbsaen9/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkju001zeovsftbsaen9/</id>
    <published>2021-03-11T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.565Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの半田です。<br>この記事では、Office ファイルを開こうとすると、実際に開いているユーザーとは<br>異なるユーザーが使用中と表示されることがある事象と、その対処策について説明します。  </p><p><strong>現象</strong><br>通常、既に別のユーザーが開いているファイルを開こうとすると、以下のように別のユーザーがファイルを編集中である旨のメッセージが表示されます。<br>このとき、実際には TestUserA がファイルを開いていないにも関わらず TestUserA がファイルを使用中と表示されたり、<br>誰も当該ファイルを開いていないにも関わらず、別のユーザーがファイルを使用中と表示される事象が発生することがあります。  </p><p><img src="/blog/cl0m4xkju001zeovsftbsaen9/image1.png" alt="別のユーザーが既にファイルを開いていると表示されるメッセージ">  </p><p><strong>Office の動作について</strong><br>この事象の原因と対処策について説明する前に、関連する Office の動作について解説します。  </p><p>基本的に、Office アプリは既存のファイルを開く際、開こうとしているファイルが存在するフォルダ内に<br>~$&lt;ファイル名&gt; という名前の一時ファイルを作成し、この ~$ つきの一時ファイルに自身のユーザー名を記録します。<br>例えば、”TestFile.xlsx” というファイルを開く場合は、”~$TestFile.xlsx” という一時ファイルを作成して、自分自身のユーザー名を記録します。<br>(補足: *.xls や Access ファイルなどの一部の Office ファイルについては、開いても ~$ つきファイルは作成されません)  </p><p>これにより、既に別のユーザーによって開かれている Office ファイルを開こうとすると<br>同フォルダ内に存在する ~$ つきファイルに記録されているユーザー名を確認することで<br>当該のファイルが誰によって開かれているか確認&#x2F;通知することが可能になっています。  </p><p>なおこの ~$ つきのファイルは、対応する Office ファイルが閉じられると同時に削除されます。  </p><p><strong>考えられる原因</strong><br>Office アプリは、開こうとしているファイルと同じフォルダに、対応する ~$ つきの一時ファイルが存在しないか確認し、<br>存在している場合、そのファイル内に記録されているユーザー名をもとに、誰がファイルを開いているのか通知します。  </p><p>この ~$ つきの一時ファイルは、対応する Office ファイルが閉じられると同時に削除されることが期待されますが<br>Office がクラッシュしたり、クライアント - ファイルサーバー間の接続が突然切断されるなどの予期しない動作が発生した場合、<br>削除されずに残存する場合があります。  </p><p>この場合、予期せず残存した ~$ つきファイルに起因して、実際とは異なるユーザーがファイルを使用中と表示されたり<br>誰も当該ファイルを開いていないにも関わらず、別のユーザーがファイルを使用中と表示される事象が発生することがあります。  </p><p><strong>検討される対処策</strong><br>~$ つきファイルの残存に起因して発生している事象については、この ~$ つきファイルを削除することで改善することが期待できます。<br>なお、エクスプローラーで ~$ つきファイルを表示させるためには、[フォルダー オプション] – [表示] から、以下の設定を行う必要があります。  </p><p>・[隠しファイル、隠しフォルダー、および隠しドライブを表示する] : [有効]<br>・[保護されたオペレーティング システム ファイルを表示しない (推奨)] : [無効]   </p><p>また、~$ つきのファイルは、ファイルを開いているユーザー情報を格納するためのファイルであるため<br>このファイルを削除しても、元の Office ファイルの情報が欠落することはありません。  </p><p>今回の投稿は以上です。<br><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの半田です。&lt;br&gt;この記事では、Office ファイルを開こうとすると、実際に開いているユーザーとは&lt;br&gt;異なるユーザーが使用中と表示されることがある事象と、その対処策について説明します。  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;現象</summary>
      
    
    
    
    
    <category term="ファイル I/O" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-I-O/"/>
    
  </entry>
  
  <entry>
    <title>Excel に入力した記号のフォントが Cambria Math に変更される事象について</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkiz000ueovs9w63bz08/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkiz000ueovs9w63bz08/</id>
    <published>2021-03-04T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.518Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの永田です。</p><p>Excelで、「≧」「⇒」といった一部の記号のフォントが、予期せず Cambria Math に変更される事象が発生することがあります。 情報に更新があり次第、このブログ記事は更新される予定です。</p><p><strong>事象</strong></p><p>Excelで、「≧」「⇒」といった一部の記号のフォントが、予期せず Cambria Math に変更される</p><p><strong>再現手順</strong></p><ol><li>Excel を起動する</li><li>新規ブックを追加する</li><li>セル A1 を選択し、ホーム - フォント 欄より、フォントを Arial に設定する</li><li>セル A1 をダブルクリックして編集モードにする</li><li>日本語入力 ON にして、「だいなり」と入力し、≧ 記号を入力して決定する</li></ol><p>結果</p><p>フォントが Cambria Math に変更される。また、それに伴って行の高さが予期せず大きくなる。</p><p><strong>再現条件</strong></p><p>以下の場合には再現しません</p><ul><li>[ファイル] - [オプション] - [言語] - [Office の編集言語と構成機能] より、英語 (米国) が &lt;優先&gt; となっている場合には発生しない。日本語が &lt;優先&gt; の場合に発生する。</li><li>上記の手順 4. を飛ばして、編集モードまたは入力モードにしない状態で「≧」記号だけを入力した場合、発生しない。</li><li>上記の手順 3. の手順で、セルのフォントを MS Pゴシック などに設定した場合、発生しない。</li></ul><p>以下の場合、事象が発生します</p><ul><li>既に「≧」記号が入力され、期待通りに表示されているセルについて、セルのフォントを Arial に変更後、セルをダブルクリックすると、記号のフォントが Cambria Math に変更される。</li><li>セルのフォントが Arial の状態で、[挿入] - [記号と特殊記号] - [記号と特殊記号] を開き、[フォント(F): MS Pゴシック]、[種類(U): 数学記号] をそれぞれ選択し、一覧から記号を挿入すると、挿入直後はフォントが変化しない。ただし、このセルをダブルクリックすると、記号のフォントが Cambria Math に変更される。</li></ul><p><strong>影響範囲</strong></p><p>Microsoft 365 Apps 内の Excel、および、ボリュームライセンス版の Excel 2019 で発生します。Microsoft 365 Apps の場合、現時点で最新のバージョン 2102 (13801.20274) でも発生します。</p><p>Excel 2013 や、ボリュームライセンス版の Excel 2016、パッケージ版の Excel 2016 では発生しません。</p><p><strong>対応状況</strong></p><p>マイクロソフトでは現時点でこの問題を調査中です。</p><p><strong>回避策</strong></p><p>現段階での回避策としては、誠に恐れ入りますが、以下の方法を検討ください。</p><ul><li>すでに Cambria Math に変換されたセルは、セルを選択して「MS ゴシック」など日本語フォントに設定する</li><li>これから「≧」記号を入力するセルは、予め「MS ゴシック」など日本語フォントに設定しておく</li><li>「≧」記号の両辺の数字を英数字フォント (Arial など) に変更したい場合には、予めセル全体を「MS ゴシック」など日本語フォントに設定した後、セルをダブルクリックして編集モードにし、「≧」記号以外の箇所 (例: 記号の両辺の数字など) を選択して、フォントを Arial などに変更する。</li><li>[ファイル] - [オプション] - [言語] - [Office の編集言語と構成機能] より、優先する言語を、英語に変更する。</li></ul><p>今回の投稿は以上です。</p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの永田です。&lt;/p&gt;
&lt;p&gt;Excelで、「≧」「⇒」といった一部の記号のフォントが、予期せず Cambria Math に変更される事象が発生することがあります。 情報に更新があり次第、このブログ記事は更新される予定です。&lt;/p&gt;</summary>
      
    
    
    
    
    <category term="フォント" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88/"/>
    
  </entry>
  
  <entry>
    <title>クリップボード アクセスの競合による Office でのコピー-貼り付け失敗</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkl2003deovs5ntr794w/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkl2003deovs5ntr794w/</id>
    <published>2021-01-19T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.627Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの中村です。</p><p>Office アプリケーション上でコピーや貼り付け操作を行ったときに、コピーしたはずのデータが貼り付けられなかったり、エラーが発生することがあります。これは、他のアプリケーションとのクリップボードへのアクセスが競合したことが原因である場合が非常に多いものとなります。このような原因でコピー・貼り付けに失敗する場合、基本的には再度コピーや貼り付けを行うしかありません。</p><p>弊社サポートへのお問い合わせの中で、このような状況が避けられないことに疑問を持つ声を時折頂いていますので、今回の記事では、この仕組みを解説します。</p><h4 id="1-Windows-のコピー・貼り付けの仕組み"><a href="#1-Windows-のコピー・貼り付けの仕組み" class="headerlink" title="1. Windows のコピー・貼り付けの仕組み"></a><strong>1. Windows</strong> <strong>のコピー・貼り付けの仕組み</strong></h4><p>Windows 上では、例えば Office &#x2F; インターネット ブラウザ &#x2F; メモ帳など、異なるアプリケーション間でデータをコピーして貼り付けることができます。このような操作が実現できるのは、OS の「クリップボード」がコピーデータを仲介しているためです。アプリケーション上でデータをコピーすると、クリップボードにコピーしたデータを格納します。また、別のアプリケーションで貼り付けを行うときには、クリップボードからコピーしたデータを取り出します。</p><p>このクリップボードを介したコピー・貼り付けの仕組みにおいては、データの整合性を担保することが重要です。例えば、コピーしたデータをクリップボードに格納している途中で他のアプリケーションがこのデータを読み取ると、中途半端な状態のコピーデータが読み取られる危険があります。また、同時に複数のプロセスが異なるコピーデータをクリップボードに書きこむと、データが破損する懸念があります。このような問題を避けるため、クリップボードに複数のアプリケーションから同時にアクセスができないよう、あるアプリケーションからクリップボードにアクセスしている最中は、クリップボードをロックする仕組みとなっています。</p><p><img src="/blog/cl0m4xkl2003deovs5ntr794w/image1.png"></p><p>このようにクリップボードがロックされている間に他のプロセスがクリップボードをオープンすると、そのアクセスは失敗します。つまり、コピーしたデータが格納できなかったり、貼り付けたいデータが取得できず何も貼り付けられなかったり、といった状況となります。アプリケーションによっては、クリップボードのオープン失敗を検知してエラーメッセージを表示することもあります。このような状況を、「クリップボード アクセスの競合」と呼んでいます。</p><p><img src="/blog/cl0m4xkl2003deovs5ntr794w/image2.png"></p><p>上記の図におけるプロセス B からは、自身がコピーなどのためにクリップボードにアクセスするとき、クリップボードがロックされているか、通常確認を行うことはありませんし、仮に確認しても強制的にロックを解除することはできません。このため、上図のようにタイミングによってはクリップボードにアクセスできない場合があることは Windows のクリップボードを介したコピー・貼り付けの仕組み上、避けることはできません。Office がプロセス B の立場になった場合も同様ですので、Office 上でのコピー・貼り付けにおいてもこの仕組みの制約を受けることになります。  </p><h4 id="2-問題に直面するシナリオ"><a href="#2-問題に直面するシナリオ" class="headerlink" title="2. 問題に直面するシナリオ"></a><strong>2. 問題に直面するシナリオ</strong></h4><p>ユーザー操作によるコピーと貼り付けでのみクリップボードが使われる場合、この流れはシリアルに行われますので、競合が発生することはありません。しかし、実際の Windows 上では、様々な目的でユーザーが意識していないタイミングでクリップボードへのアクセスが行われることがあります。以下に、その例を記載します。  </p><p><strong>・Windows 10 のクリップボード履歴機能</strong></p><p>Windows 10 バージョン 1807 から追加された新機能で、コピーしたデータの過去複数件の履歴を保持して貼り付けられるようになりました。この機能の実現のため、クリップボードにデータが格納されると、クリップボード履歴機能のプロセスからクリップボードにアクセスが発生します。</p><p>参考)クリップボードの概要<br><a href="https://support.microsoft.com/ja-jp/windows/30375039-ce71-9fe4-5b30-21b7aab6b13f">https://support.microsoft.com/ja-jp/windows/30375039-ce71-9fe4-5b30-21b7aab6b13f</a></p><p><strong>・エクスプローラの [貼り付け] ボタン</strong></p><p>エクスプローラのリボンに [貼り付け] ボタンがあります。コピーデータがファイルなどのエクスプローラ上で貼り付けられるデータの場合に、このリボンのボタンを活性化するため、リボンが展開表示されている場合は、コピー時にエクスプローラからもアクセスが発生します。(リボンを閉じた状態で OS を再起動してそのままリボンを開かなければ、このアクセスは発生しません。)  </p><p><strong>・リモート デスクトップのクリップボード共有</strong></p><p>リモート デスクトップ時に、[ローカル リソース] タブで [クリップボード] のチェックを有効にすると、ローカルとリモートのマシン間でデータをコピーすることができます。この機能が有効な状態でリモート接続している場合、これを管理するプロセス (rdpclip.exe) からクリップボードにアクセスが発生します。  </p><p><strong>・他の Office アプリケーション</strong></p><p>Office アプリケーション間では、Word と Excel など、別の Office アプリケーション同士でコピー・貼り付けを行う独自の仕組み (Office クリップボード) があります。この機能は、OS にクリップボード履歴機能が搭載される以前から、コピーデータの履歴を利用できる機能を提供していました。この機能実現のため、いずれかの Office アプリケーションでコピーが行われると、起動している他の Office アプリケーションからクリップボードにアクセスが発生します。</p><p>なお、この機能については以下のレジストリを設定することで無効化できます。Office クリップボードを無効化しても、通常の OS としてのコピー・貼り付け機能の範囲でコピー操作を利用できます。</p><p>&lt;Office クリップボードの無効化&gt;<br>キー : HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Common\General<br>名前: AcbControl<br>種類: REG_DWORD<br>値 : 2147483648 (10 進)<br>※ Microsoft 365 &#x2F; Office 2019 &#x2F; Office 2016 向けのレジストリ キーです。<br>※ すべての Office アプリケーションを終了した状態で設定してください。  </p><p><strong>・サードパーティ製品 (主にクリップボード監視機能、セキュア接続機能などを提供する製品)</strong></p><p>サードパーティ ソフトでも、クリップボードへのアクセスが行われることがあります。</p><p>例えばセキュリティ ソフトなどには、ユーザーによるデータの持ち出しを監視するため、クリップボード監視機能がついているものがあります。このような製品の多くでは、クリップボード監視機能によって、データのコピー・貼り付けなどに連動してクリップボードにアクセスが発生します。</p><p>また、Windows のリモート デスクトップに似た、独自のセキュア接続としてリモート マシンに接続するソフトでも、クリップボード共有のためアクセスが発生することがあります。  </p><p>このように、様々なプロセスからクリップボードへのアクセスは発生しますが、ほとんどの場合、実際にはクリップボードがロックされるのは非常に短い時間であるため、実際に競合が生じることは一般的な環境やユーザー操作シナリオではそれほど多くはありません。</p><p>ただ、クリップボード アクセスの競合は、クリップボードがロックされている時間が長いほど発生しやすくなります。ロック時間の長さは、コピーデータのサイズやアプリケーションの処理の流れによって異なります。また当然、クリップボード アクセスを行うプロセスが多いほど競合の可能性は高くなるため、様々な製品を導入された環境や、多数のアプリケーションを起動していると比較的発生しやすくなります。そして、プログラムからループ処理で短い時間で繰り返しコピーや貼り付けを行うときは競合の可能性が高くなります。</p><p>これらの要素に該当する環境や利用状況では、実際にある程度高い頻度で競合が発生することがある、という報告は弊社サポートにも寄せられています。  </p><h4 id="3-対応方法"><a href="#3-対応方法" class="headerlink" title="3. 対応方法"></a><strong>3. 対応方法</strong></h4><p>1. でご説明した通り、仕組み上、クリップボードへのアクセス競合を完全に防ぐことはできません。このため、Office アプリケーションで競合によるコピー・貼り付けの失敗が生じる状況では、競合相手のプロセスを停止 (クリップボードにアクセスする機能を無効化) して解消するか、ユーザーが再度コピーや貼り付けを行う運用対処しかありません。</p><p>クリップボードへのアクセスが失敗した場合の Office の動作は、アプリケーションによって異なります。</p><p><strong>Excel</strong></p><p>コピー時にクリップボードへのアクセスに失敗すると以下のようなメッセージが表示され、このときにも、その Excel プロセス内ではデータの貼り付けが可能です。(他のアプリケーションには貼り付けられません。)</p><p><img src="/blog/cl0m4xkl2003deovs5ntr794w/image3.png"></p><p>貼り付け時のクリップボード アクセス失敗の場合は、クリップボードからデータを取得できないため貼り付けられません。この時は、特にエラーメッセージは表示されません。  </p><p><strong>Word &#x2F; PowerPoint</strong></p><p>コピー、貼り付け共に特にエラーメッセージは表示されず、自アプリケーション内でも貼り付けはできません。  </p><p><ins><strong>マクロ等からのコピー処理で発生する場合の対処</strong></ins></p><p>VBA マクロやその他言語で Office をオートメーションしていて、その処理の中でコピー・貼り付けを行うときに現象が発生する場合は、コピー・貼り付けではなく、別の方法でデータの転記を行うよう変更して回避することをお勧めします。</p><p>例えば、Excel でセルをコピーして別のシートに貼り付けるような場合は、コピー元のセル オブジェクトの Valueなどを貼り付け先のセルに設定するよう変更し、Copy や Paste といったメソッドは使用しないことが検討できます。</p><p>例: B1 セルの内容を A1 セルへクリップボードを経由して貼り付けるコードの変更イメージ</p><p>変更前:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ActiveSheet.Range(&quot;B1&quot;).Copy</span><br><span class="line">ActiveSheet.Range(&quot;A1&quot;).Select</span><br><span class="line">ActiveSheet.Paste</span><br></pre></td></tr></table></figure><p>変更後:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActiveSheet.Range(&quot;A1&quot;).Value = ActiveSheet.Range(&quot;B1&quot;).Value</span><br></pre></td></tr></table></figure><p>今回の投稿は以上です。  </p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの中村です。&lt;/p&gt;
&lt;p&gt;Office アプリケーション上でコピーや貼り付け操作を行ったときに、コピーしたはずのデータが貼り付けられなかったり、エラーが発生することがあります。これは、他のアプリケーションとのクリップボードへのアク</summary>
      
    
    
    
    
    <category term="コピー＆ペースト" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%B3%E3%83%94%E3%83%BC%EF%BC%86%E3%83%9A%E3%83%BC%E3%82%B9%E3%83%88/"/>
    
  </entry>
  
  <entry>
    <title>Excel で ScrollArea プロパティを設定すると、キーボード操作でシートがスクロールしない</title>
    <link href="https://officesupportjp.github.io/blog/cl0m4xkiy000reovs1r3cadx0/"/>
    <id>https://officesupportjp.github.io/blog/cl0m4xkiy000reovs1r3cadx0/</id>
    <published>2021-01-12T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.518Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームの中村です。</p><p>Excel には、ワークシートのスクロール可能な範囲を設定する ScrollArea というシート プロパティが用意されています。本記事では、このScrollArea プロパティを設定したとき、キーボードの矢印キーや Tab キーなどで選択セルを移動したとき、ウィンドウに表示されていないセルに移動しても、そのセルが画面に表示されるようシートがスクロールしない動作について記載します。  </p><h4 id="1-現象"><a href="#1-現象" class="headerlink" title="1. 現象"></a><strong>1. 現象</strong></h4><p>以下の画面キャプチャをご覧ください。この画面では、O2 セルが現在選択されていますが、画面右端に見切れて表示された状態になっています。(赤枠部分)</p><p>通常、例えば A2 セルから右矢印キーや、Tab キーで B2、C2・・・と順に列を移動すると、選択状態のセル全体がウィンドウ内に見える位置に自動的にスクロールされます。しかしながら、後述の状況においては、この画面キャプチャのように十分にスクロールされない場合があります。またこのあと、O 列以降のセルに移動してもこの位置のままスクロールしません。</p><p><img src="/blog/cl0m4xkiy000reovs1r3cadx0/image1.png">  </p><h4 id="2-現象が発生する状況"><a href="#2-現象が発生する状況" class="headerlink" title="2. 現象が発生する状況"></a><strong>2. 現象が発生する状況</strong></h4><p>この動作に直面する主な状況は、ワークシートの ScrollArea プロパティが設定された状態で、かつセルの幅や高さが広げられているときに、スクロール可能範囲の終端に近いセルに移動する場合です。</p><p>Excel が画面外の領域にスクロールするときに、スクロール後のウィンドウ内に表示するシート範囲などを、セルの幅や高さ &#x2F; ウィンドウのサイズ &#x2F; 残りのスクロール可能範囲などの要素を基に算出します。これらの要素の組み合わせ次第で、スクロール後の表示位置を期待通りに算出できない場合があり、この現象が発生します。</p><p>また、Excel バージョンによっても細かな動作は異なるため、例えば同じファイルを同じウィンドウ サイズで開いても、スクロールしなくなる動作が生じる列や行はバージョンによって異なる場合があります。</p><p>発生に関わる条件をまとめると以下の通りです。</p><p><strong>条件 1:</strong><br>ワークシートの ScrollArea プロパティが設定されていること</p><p>※プログラムからは Worksheet オブジェクトのプロパティや、Visual Basic Editor でプロパティ ウィンドウからも設定・確認できます。</p><p>ScrollArea プロパティ (Excel)<br><a href="https://docs.microsoft.com/ja-jp/office/vba/api/excel.worksheet.scrollarea">https://docs.microsoft.com/ja-jp/office/vba/api/excel.worksheet.scrollarea</a></p><p><img src="/blog/cl0m4xkiy000reovs1r3cadx0/image2.png"></p><p><strong>条件 2:</strong><br>以下の要素等の組み合わせによって発生</p><ul><li>選択セルから ScrollArea プロパティの終端までの残りの幅・高さ</li><li>Excel ブック画面のウィンドウ サイズ</li><li>各セルの幅や高さ</li><li>シートの倍率</li><li>ウィンドウ サイズなどの算出に関わるディスプレイの拡大縮小、スケール設定</li></ul><p>この動作は、ユーザーの利用上、不便な場合がある動作であることは認識しておりますが、現状のスクロール動作の内部処理上の制約として、現時点でサポートされる全てのバージョンの Excel で発生しうる制限動作となっています。(2021&#x2F;1&#x2F;12 現在、サポート対象の Excel は Excel 2013 &#x2F; 2016 &#x2F; 2019 &#x2F; Office 365 の Excel です。)  </p><h4 id="3-回避策"><a href="#3-回避策" class="headerlink" title="3. 回避策"></a><strong>3. 回避策</strong></h4><p>この動作が生じるファイルやウィンドウ サイズなどの構成でも、以下のいずれかの方法でスクロールできます。  </p><h5 id="3-1-スクロールバーでスクロールする"><a href="#3-1-スクロールバーでスクロールする" class="headerlink" title="3-1. スクロールバーでスクロールする"></a><strong>3-1. スクロールバーでスクロールする</strong></h5><p>マウス操作でスクロール バーによってスクロールすると、画面をスクロールできます。</p><p>以下は、先述のファイルでスクロール バーの右矢印 (赤枠部分) をマウスで操作してスクロールした例です。</p><p><img src="/blog/cl0m4xkiy000reovs1r3cadx0/image3.png">  </p><h5 id="3-2-ScrollArea-を広げる、または解除する"><a href="#3-2-ScrollArea-を広げる、または解除する" class="headerlink" title="3-2. ScrollArea を広げる、または解除する"></a><strong>3-2. ScrollArea を広げる、または解除する</strong></h5><p>移動先のセルから、ScrollArea の終端までの幅や高さが十分に広い場合には、正常にスクロールできます。</p><p>例えば A～Q 列にあるテーブルの範囲だけスクロールするさせるため、ScrollArea プロパティに A ～ Q 列を設定しているとします。これを、例えば Z 列など、ある程度余裕を持った範囲をスクロールできるよう設定すると、実際にスクロールしたい範囲では期待通りスクロールできます。(どの列までを ScrollArea に設定すれば問題ないかは、条件 2 の各要素に依存します。具体的な値は定められませんが、実際の環境・ファイルで動作を確認しながら、余裕を持った範囲を設定してください。)</p><p>ScrollArea を広げるにあたって、例えば上記の例であれば、テーブル外の R ～ Z 列のセルを選択させたくない場合は、シート保護の設定で [ロックされたセル範囲の選択] を無効にすることでセル選択を禁止できます。  </p><p><strong>設定手順:</strong><br>1. 選択させたくないセル (上記の例では R ～ Z 列) のセルを右クリックし、[セルの書式設定] – [保護] で [ロック] を有効にします。(既定では有効です。)</p><p>2. 反対に、選択を可能とするセル (上記の例では A ~ Q 列) は同様のメニューで、[ロック] を無効にします。</p><p>3. [校閲] タブ – [シートの保護] – “このシートのすべてのユーザーに許可する操作” の一覧で [ロックされたセル範囲の選択] のチェックを外します。</p><p><img src="/blog/cl0m4xkiy000reovs1r3cadx0/image4.png"><br><img src="/blog/cl0m4xkiy000reovs1r3cadx0/image5.png"></p><p>VBA などのプログラムからは、以下で設定できます。</p><p>Worksheet. EnableSelection プロパティ (Excel)<br><a href="https://docs.microsoft.com/ja-jp/office/vba/api/excel.worksheet.enableselection">https://docs.microsoft.com/ja-jp/office/vba/api/excel.worksheet.enableselection</a></p><p>このプロパティで xlUnlockedCells を設定します。このプロパティは、ワークシートを保護した状態でのみ有効ですので、さらに以下の Protect メソッドでワークシートを保護します。</p><p>Protect メソッド (Excel)<br><a href="https://docs.microsoft.com/ja-jp/office/vba/api/excel.worksheet.protect">https://docs.microsoft.com/ja-jp/office/vba/api/excel.worksheet.protect</a></p><p>また、選択セルの移動を制限することが ScrollArea プロパティを設定している目的である場合は、上記の設定を代わりに行うことで、ScrollArea プロパティの設定自体を削除することも検討できます。(ただし、スクロール バーの操作ではスクロールできます。)</p><p>ScrollArea 設定を削除する場合は、プログラムからは ScrollArea プロパティに空の値 (“”) を設定してください。プロパティ ウィンドウの場合は、ScrollArea プロパティの値を削除してください。  </p><p>今回の投稿は以上です。  </p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームの中村です。&lt;/p&gt;
&lt;p&gt;Excel には、ワークシートのスクロール可能な範囲を設定する ScrollArea というシート プロパティが用意されています。本記事では、このScrollArea プロパティを設定したとき、キーボード</summary>
      
    
    
    
    
    <category term="オートメーション" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%AA%E3%83%BC%E3%83%88%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>PowerPoint Online で日本語フォントが変更される</title>
    <link href="https://officesupportjp.github.io/blog/cl0m69xv6002k4cvsan4d7rs0/"/>
    <id>https://officesupportjp.github.io/blog/cl0m69xv6002k4cvsan4d7rs0/</id>
    <published>2020-12-04T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.596Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポート チームです。</p><p>本記事では、PowerPoint Online で日本語フォントが異なるフォントで表示される問題について説明します。</p><p><strong>現象</strong></p><p>PowerPoint の表内の日本語フォントが、PowerPoint Online で表示すると異なるフォントで表示されます。</p><p>例えば、スライド マスターでテーマ フォントを Meiryo UI に設定しているプレゼンテーションで、PowerPoint Online 上では英数字用のフォント (例では Arial) で表示されます。</p><p><img src="/blog/cl0m69xv6002k4cvsan4d7rs0/image1.png">  </p><p><strong>原因</strong></p><p>この現象は問題としてフィードバックを行いました。</p><p><strong>回避策</strong></p><p>以下のいずれかの回避策で現象を回避できます。</p><p>1. 表のフォントを明示的に指定します。</p><p>スライド マスターでテーマ フォントを設定した場合、表のフォント自体は [+本文のフォント] となりますが、表のフォントを [Meiryo UI] など明示的に指定します。</p><p>2. 英数字用フォントを変更します。</p><p>スライド マスターでテーマ フォントの英数字用フォントとして、[Meiryo UI] など日本語に設定したいフォントを指定します。</p><p>新たな情報が確認された場合には、この記事に追記する形で公開していく予定です。</p><p>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポート チームです。&lt;/p&gt;
&lt;p&gt;本記事では、PowerPoint Online で日本語フォントが異なるフォントで表示される問題について説明します。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;現象&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;PowerPoint の</summary>
      
    
    
    
    
    <category term="フォント" scheme="https://officesupportjp.github.io/blog/tags/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88/"/>
    
  </entry>
  
  <entry>
    <title>Office 展開ツール (16.0.13328.20356) で生じる事象について</title>
    <link href="https://officesupportjp.github.io/blog/cl0m69xv1002b4cvs76yt55d6/"/>
    <id>https://officesupportjp.github.io/blog/cl0m69xv1002b4cvs76yt55d6/</id>
    <published>2020-11-16T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.580Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Office サポートの西川 (直) です。  </p><div style="color:#ff0000">  <p><strong>2020&#x2F;11&#x2F;19 記事の内容を更新しました</strong></p><p><strong>2020&#x2F;11&#x2F;24 記事の内容を更新しました</strong></p></div><p>Office 展開ツール (16.0.13328.20356) にて、以下の事象が報告されておりますのでご案内いたします。  </p><p><strong>【事象】</strong>  </p><p>Office 展開ツール (16.0.13328.20356) では、現時点で以下の事象が報告されております。  </p><ol><li><p>XMLファイルの Logging 要素 Path 属性に定義したフォルダにログファイルが出力されない  </p></li><li><p>Office 展開ツールを管理者権限で実行しない場合、&#x2F;download オプションでダウンロードが行えない  </p></li><li><p>XMLファイルの Add 要素 Version 属性を定義した場合、.cab ファイルがダウンロードされない</p></li></ol><p><strong>- 参考</strong></p><p><a href="https://docs.microsoft.com/ja-jp/officeupdates/odt-release-history"></a><a href="https://docs.microsoft.com/en-us/officeupdates/odt-release-history">https://docs.microsoft.com/en-us/officeupdates/odt-release-history</a>  </p><div style="color:#ff0000">  <p><strong>1) については、Office 展開ツールの仕様変更によるものとなります。今後、Logging 要素 Path 属性はご利用いただけません。</strong></p><p><strong>2) と 3) については、</strong></p><p><strong>最新の Office 展開ツールにて修正されておりますので、最新の Office 展開ツールをご利用いただきますようお願いいたします。</strong></p></div><p><strong>今回の投稿は以上です。</strong>  </p><p>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Office サポートの西川 (直) です。  &lt;/p&gt;
&lt;div style=&quot;color:#ff0000&quot;&gt;  

&lt;p&gt;&lt;strong&gt;2020&amp;#x2F;11&amp;#x2F;19 記事の内容を更新しました&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;20</summary>
      
    
    
    
    
    <category term="インストール" scheme="https://officesupportjp.github.io/blog/tags/%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/"/>
    
  </entry>
  
  <entry>
    <title>Windows 10 バージョン 2004 以降で VBA 関数 StrComp() で全角カナと半角カナが一致判定されない</title>
    <link href="https://officesupportjp.github.io/blog/cl0m69xvc002t4cvs5918c1f6/"/>
    <id>https://officesupportjp.github.io/blog/cl0m69xvc002t4cvs5918c1f6/</id>
    <published>2020-11-12T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.596Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>2020&#x2F;11&#x2F;24 Update</strong></span><br><span style="color:#339966">「4. その他の発生シナリオ」セクションを追加し、Excel での検索・置換 (Find &#x2F; Replace) での発生を追記しました。</span>  </p><p><span style="color:#ff0000"><strong>2021&#x2F;10&#x2F;22 Update</strong></span><br><span style="color:#339966">現象発生 OS と回避策に記載の対応を行った場合の既知の問題を追記しました。</span>  </p><p><span style="color:#ff0000"><strong>2021&#x2F;10&#x2F;18 Update</strong></span><br><span style="color:#339966">Windows 11 では修正済みであることを追記しました。</span>  </p><p><span style="color:#ff0000"><strong>2022&#x2F;6&#x2F;8 Update</strong></span><br><span style="color:#339966">Windows 10 向けの更新情報を追記しました。</span>   </p><p>こんにちは、Office サポート チームの中村です。</p><p>先日、以下の記事で同じ原因により Access フォームで発生する問題について記載していますが、VBA 関数 StrComp() も影響を受けることが分かったため、本記事にて詳細をご案内します。  </p><p><strong>関連記事</strong></p><p>Windows 10 バージョン 2004 以降で 半角カナのフォームを含んだ Access ファイルでエラーが発生する<br><a href="https://officesupportjp.github.io/blog/cl0m69xvc002u4cvsgc7a3bfp/">https://officesupportjp.github.io/blog/cl0m69xvc002u4cvsgc7a3bfp/</a>  </p><h4 id="1-現象"><a href="#1-現象" class="headerlink" title="1. 現象"></a><strong>1. 現象</strong></h4><p>VBA には、StrComp() という 2 つの文字列が一致するかを比較する関数が用意されています。</p><p>StrComp 関数<br><a href="https://docs.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/strcomp-function">https://docs.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/strcomp-function</a>  </p><p>例えば以下のサンプル コードのように、濁点または半濁点を含む文字列を、一方は全角、もう一方を半角で比較すると、以前の OS では一致とみなされ 0 が返っていました。</p><p>しかし、Windows 10 バージョン 2004 以降の OS 上で実行すると、不一致を示す -1 が返ります。  </p><p>&lt;サンプル コード&gt;</p><pre><code>Sub Sample()    MsgBox StrComp(&quot;サンプル&quot;, &quot;ｻﾝﾌﾟﾙ&quot;, vbTextCompare)End Sub</code></pre><p>本現象は、Office バージョンに関係なく発生します。  </p><h4 id="2-原因"><a href="#2-原因" class="headerlink" title="2. 原因"></a><strong>2. 原因</strong></h4><p>Windows 10 バージョン 2004 で、OS の自然言語処理を担う NLS (National Language Support) バージョンが更新されました。</p><p>&lt;OS バージョンと NLS バージョン&gt;  </p><table><thead><tr><th align="left">OS バージョン</th><th align="left">NLS バージョン</th></tr></thead><tbody><tr><td align="left">Windows 10 バージョン 1909</td><td align="left">6.2</td></tr><tr><td align="left">Windows 10 バージョン 2004 以降</td><td align="left">6.3</td></tr><tr><td align="left">Windows 11</td><td align="left">6.4</td></tr></tbody></table><p>この新しいバージョン 6.3 の NLS ソート テーブルにて、濁点および半濁点を含むカナ文字について、半角と全角が異なる文字と認識される問題の影響で現象が発生します。上記の例の場合、”プ” (全角) と “ﾌﾟ” (半角) が違う文字と判定されます。</p><p>この問題は、OS の更新プログラムについての公開情報でも既知の問題として記載されています。</p><p>Current status of Windows 10, version 2004 and Windows Server, version 2004<br><a href="https://support.microsoft.com/en-us/topic/windows-10-update-history-24ea91f4-36e7-d8fd-0ddb-d79d9d0cdbda">https://support.microsoft.com/en-us/topic/windows-10-update-history-24ea91f4-36e7-d8fd-0ddb-d79d9d0cdbda</a></p><p>Windows 10 update history - Updates for Windows 10, version 20H2 and Windows Server, version 20H2<br><a href="https://support.microsoft.com/en-us/topic/windows-10-update-history-7dd3071a-3906-fa2c-c342-f7f86728a6e3">https://support.microsoft.com/en-us/topic/windows-10-update-history-7dd3071a-3906-fa2c-c342-f7f86728a6e3</a></p><p>Windows 10 update history - Updates for Windows 10, version 21H1<br><a href="https://support.microsoft.com/en-us/topic/windows-10-update-history-1b6aac92-bf01-42b5-b158-f80c6d93eb11">https://support.microsoft.com/en-us/topic/windows-10-update-history-1b6aac92-bf01-42b5-b158-f80c6d93eb11</a></p><p>&lt;公開情報より該当の記載を抜粋&gt;</p><table><thead><tr><th align="left"><strong>Symptom</strong></th><th align="left"><strong>Workaround</strong></th></tr></thead><tbody><tr><td align="left">Certain Japanese half-width Katakana and full-width Katakana characters that have a consonant mark aren’t interpreted as the same character. When you use the <strong>CompareStringEx()</strong> function with the <em>NORM_IGNOREWIDTH</em> flag to compare them, these characters are evaluated as different because of an issue in the sorting rule**.** This issue affects all the updates starting on June 9, 2020 for Windows 10, version 2004.</td><td align="left">12&#x2F;9&#x2F;20:<br>  1. Open the Command Prompt window (cmd.exe) with elevated privileges.<br>  2. Run “reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\Sorting\Versions &#x2F;ve &#x2F;d 0006020F &#x2F;f”<br>  3. Restart the computer or processes to see the full effect.<br><br>  <strong>Important</strong> If you have not installed KB4586853 or later on the computer, setting an invalid value in this registry might prevent the computer from starting up.<br><br> This workaround reverts the National Language Support (NLS) sorting rule to version 6.2, which is used in Windows 10, version 1909 and earlier. When sharing data between systems, consider applying the workaround consistently. If you use this workaround, conduct sufficient testing and evaluations to mitigate problems caused by different sorting rule versions on multiple systems.</td></tr></tbody></table><p>※ Windows 10 バージョン 21H2 においても引き続きこの問題は発生します。</p><h4 id="3-対応状況-x2F-回避策"><a href="#3-対応状況-x2F-回避策" class="headerlink" title="3. 対応状況 &#x2F; 回避策"></a><strong>3. 対応状況 &#x2F; 回避策</strong></h4><p>Windows 11 では、NLS バージョン 6.4 に更新され、この問題は修正されています。<br>Windows 10 向けには、問題が修正された NLS バージョン 6.4 を利用できるようにする更新プログラムが公開されました。</p><p><strong>問題への対応を行った Windows 10 の更新プログラム</strong><br>June 2, 2022—KB5014023 (OS Builds 19042.1741, 19043.1741, and 19044.1741) Preview<br><a href="https://support.microsoft.com/en-us/topic/65ac6a5d-439a-4e88-b431-a5e2d4e2516a">https://support.microsoft.com/en-us/topic/65ac6a5d-439a-4e88-b431-a5e2d4e2516a</a></p><p>この更新を適用すると、Windows 10 で NLS バージョン 6.4 を利用できるようになります。ただし、実際に 6.4 を利用するよう構成するには、以下のレジストリを設定する必要があります。</p><p>キー : HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\Sorting\Versions<br>名前 : (既定)<br>種類 : REG_DWORD<br>値 : 0x00060403 (16 進数)</p><p>注意:<br>本レジストリの変更で NLS バージョンを 6.4 に変更した OS についてもサポートします。<br>ただし、アプリケーションの実装やビジネスロジックによっては、ソートの整合が崩れたり、データが不正となる可能性がありますので、何か問題が発生してお問い合わせいただく場合には、NLS バージョンを 6.4 に変更して運用していることを担当エンジニアにお知らせください。</p><p> 更新プログラムの適用以外には、後述のいずれかの回避策で現象を回避できます。 </p><p><strong>a.</strong> <strong>比較対象の文字列を全角、または半角に統一する</strong></p><p>実際の VBA コードでは、値は VBA 定数、Excel シート上のセルの値や Access データベースのテーブルの値、ユーザーフォームなど、様々な場所から取得されることが想定されます。VBA コード取得元となる文字列を探して全角 &#x2F; 半角が統一されるよう変更します。  </p><p><strong>b. StrConv</strong> <strong>関数で全角、または半角に統一してから比較する</strong></p><p>複雑なコードで比較対象文字列の取得元を特定することが困難な場合や、ユーザーが入力するため制御が難しい場合などには、StrConv 関数を用いて全角または半角に変換してから、StrComp 関数の比較に使用することが検討できます。</p><p>StrConv 関数<br><a href="https://docs.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/strconv-function">https://docs.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/strconv-function</a></p><p>&lt;回避案 b サンプル コード&gt;</p><p>以下の例では、比較する文字列を両方とも全角カナに変換しています。</p><pre><code>Sub Sample()    str1 = &quot;サンプル&quot;    str2 = &quot;ｻﾝﾌﾟﾙ&quot;    MsgBox StrComp(StrConv(str1, vbWide), StrConv(str2, vbWide), vbTextCompare)End Sub</code></pre><p>基本的には、上記の a. &#x2F; b. いずれかの方法での対応を強く推奨します。</p><p>ただ、ファイルや VBA の変更が難しい場合などには、クライアントの環境設定による以下の回避策もあります。いずれも、Office の他の動作や、OS 全体に影響を及ぼす設定となるため、以下 c. &#x2F; d. 案を利用する場合は、影響に十分にご留意ください。  </p><p><strong>c. Office</strong> <strong>モジュールを互換モードに設定する</strong></p><p>Office アプリケーションの実行モジュールを互換モードで動作するよう設定すると、古い NLS バージョンを使用するため現象が発生しません。</p><p>主な Office アプリケーションの実行モジュール名は以下になります。</p><p>Excel : EXCEL.EXE<br>Word : WINWORD.EXE<br>PowerPoint : POWERPNT.EXE<br>Access : MSACCESS.EXE</p><p>互換モードに変更したアプリケーションでの全ての動作が互換モードになるため、Windows 10 OS で新たにサポートされた機能を前提とした機能が動作しなくなるなどの影響が生じる場合があります。(例 : Excel の [オプション] – [全般] にある “複数ディスプレイを使用する場合” で [表示を優先した最適化] を選択することができなくなります)  </p><p><strong>d. レジストリを使用して NLS バージョンを以前のバージョン (6.2) に変更する</strong></p><p>システム全体で影響を受けるため、Office 以外のアプリケーションも以前の NLS バージョンを使用するようになります。アプリケーションの実装やビジネスロジックによっては、ソートの整合が崩れたり、データが不正となる可能性があります。<br>また実際に、「令和」合字データのソートや、Windows ライセンス認証で問題が生じることが確認されていますので、d 案を採用いただくよりは、先述の対応を行った更新プログラムの適用が可能であれば、NLS バージョン 6.4 への変更をお勧めします。</p><p>c. &#x2F; d. の具体的な設定方法や注意点については、既に公開された Access フォームの現象をご案内する以下のフォーラム記事で説明していますので、こちらを参照してください。</p><p>Windows 10 バージョン 2004 以降で 半角カナのフォームを含んだ Access ファイルでエラーが発生する<br><a href="https://officesupportjp.github.io/blog/cl0m69xvc002u4cvsgc7a3bfp/">https://officesupportjp.github.io/blog/cl0m69xvc002u4cvsgc7a3bfp/</a>  </p><p>※ 参照箇所<br>c 案 : 3-1. Access アプリケーション観点 - Access の EXE (MSACCESS.EXE) について、”Windows 8” の互換設定を行う<br>d 案 : 3-3. OS 観点 – Windows OS の NLS バージョンを 6.3 から 6.2 に変更する  </p><p><strong>注意</strong><br>この d 案の設定を行うと、Windows のライセンス認証が行われない場合があることを確認しています。ライセンス認証を実行する際はこの変更を元に戻してから実行してください。</p><h4 id="4-その他の発生シナリオ"><a href="#4-その他の発生シナリオ" class="headerlink" title="4. その他の発生シナリオ"></a><strong>4. その他の発生シナリオ</strong></h4><p>ここまで、一般に利用頻度の比較的高い StrComp() での発生シナリオを中心に説明してきましたが、内部的に文字の比較を行う以下の機能でも同様の問題による現象が発生します。  </p><p>・Range.Find() &#x2F; Range.FindNext() &#x2F; Range.FindPrevious() メソッドによる検索や Range.Replace() メソッドによる置換で、濁点・半濁点を含む半角カナと全角カナが一致判定されません。<br>※ 手動での検索や置換も同様です。</p><p>今回の投稿は以上です。  </p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;2020&amp;#x2F;11&amp;#x2F;24 Update&lt;/strong&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color:#339966&quot;&gt;「4. その他の発生シナリオ」セクションを追加し、E</summary>
      
    
    
    
    
    <category term="VBA マクロ" scheme="https://officesupportjp.github.io/blog/tags/VBA-%E3%83%9E%E3%82%AF%E3%83%AD/"/>
    
  </entry>
  
  <entry>
    <title>Excel for Microsoft 365 で上書きモードで DBCS を 1 文字を編集すると 2 文字分上書きされる</title>
    <link href="https://officesupportjp.github.io/blog/cl0m69xtr000o4cvs2pym5n2d/"/>
    <id>https://officesupportjp.github.io/blog/cl0m69xtr000o4cvs2pym5n2d/</id>
    <published>2020-10-20T00:00:00.000Z</published>
    <updated>2022-09-28T05:24:50.518Z</updated>
    
    <content type="html"><![CDATA[<p><span style="color:#ff0000"><strong>【最終更新日: 2021&#x2F;02&#x2F;10】</strong></span></p><p>こんにちは、Office サポートです。<br>本記事では新たに確認された、Excel for Microsoft 365 で上書きモードで DBCS を 1 文字を編集すると 2 文字分上書きされる問題について説明します。  </p><p><strong>現象</strong><br>Excel for Microsoft 365 で Insert キーを押下し、<br>上書きモードで DBCS (2 バイト文字) を編集すると、意図せず 2 文字ぶん上書きされます。  </p><p><strong>再現手順</strong><br>例) 「あい<strong>う</strong>えお」を「あい<strong>か</strong>えお」に直したい場合</p><p>1. 任意のセルに、「あいうえお」と入力します。<br>2.「う」のまえにカーソル入れます。<br>3. [insert] キーで上書きモードにします。</p><p><img src="/blog/cl0m69xtr000o4cvs2pym5n2d/image1.png"></p><p>4.「か」と入力し、確定のため [Enter] キーを押します。</p><p>結果 :<br>「う」と「え」の部分が、「か」で上書きされて、「あいかお」になります。  </p><p><img src="/blog/cl0m69xtr000o4cvs2pym5n2d/image2.png"></p><p>期待する結果は、「あいかえお」です。  </p><p><strong>解決方法</strong>  </p><p>以下の更新チャネル&#x2F;バージョンで修正しました。<br>下記以降の更新チャネル&#x2F;バージョンに更新することで解決します。</p><p>　最新チャネル (プレビュー) : バージョン 2012 (ビルド 13530.20064)<br>　最新チャネル : バージョン 2012 (ビルド 13530.20316)<br>　半期エンタープライズ チャネル (プレビュー) : バージョン 2008 (ビルド 13127.21064)<br>　半期エンタープライズ チャネル : バージョン 2008 (ビルド 13127.21064)</p><p>　月次エンタープライズ チャネル : バージョン 2012 (ビルド 13530.20528)</p><p><strong>回避策</strong><br>[insert] キーで挿入モードに切り替えて、編集します。  </p><p><strong>状況</strong><br>マイクロソフトでは、この問題をこの資料の対象製品として記載されているマイクロソフト製品の問題として認識しています  </p><p><strong>更新履歴</strong><br>2021&#x2F;01&#x2F;14 : 解決方法を追加しました。</p><p>2021&#x2F;02&#x2F;10 : 解決方法に、月次エンタープライズ チャネルを追加しました。  </p><p><strong>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;【最終更新日: 2021&amp;#x2F;02&amp;#x2F;10】&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;こんにちは、Office サポートです。&lt;br&gt;本記事では新たに確認された、Excel for </summary>
      
    
    
    
    
  </entry>
  
</feed>
